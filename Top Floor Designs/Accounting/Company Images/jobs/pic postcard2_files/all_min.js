                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.widget)
{
vp.widget=function(){};
}








vp.widget.RichTextArea=function $vpfn_WKL23BeosCMbOj_hwzpjXA22$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;


var _oElementStyle={};


var _bIsRendered=false;


var _sValue="";


var _sOuputValue="";


var _iCachedSelectionOffsetStart=null;


var _iPollTimer=null;


var _iKeyTimer=null;


var m_oLastSelectedRange=null;


var _oIFrame;


var _oEditableElement;



var _bSuspendPolling=false;


var KEYDOWN_TIMER_INTERVAL=350;



var _oCachedSelectionNode=null;


var _oColorMap={};





this.editableElement=null;





this.attributes={};





this.maxWidth=400;





this.minWidth=200;





this.maxHeight=200;





this.minHeight=13;





this.style={
fontWeight:"normal",
fontStyle:"normal",
color:"#000000",
fontSize:16,
fontFamily:"Arial"
};





this.onfocus=new vp.events.CustomEvent(this,"onfocus");





this.onblur=new vp.events.CustomEvent(this,"onblur");





this.onchange=new vp.events.CustomEvent(this,"onchange");





this.onkeydown=new vp.events.CustomEvent(this,"onkeydown");





this.onkeyup=new vp.events.CustomEvent(this,"onkeyup");





this.onselectionchange=new vp.events.CustomEvent(this,"onselectionchange");





this.ondelaychange=new vp.events.CustomEvent(this,"ondelaychange");

this.oninitialrender=new vp.events.CustomEvent(this,"oninitialrender");

this.isFocused=false;

this.resizeManually=false;





var startUpdateTimer=function $vpfn_jemO77fm5oAP1bbyAv4emQ169$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iKeyTimer){
clearTimeout(_iKeyTimer);
}

_iKeyTimer=setTimeout(fireDelayChanged,KEYDOWN_TIMER_INTERVAL);
};







var storeColor=function $vpfn_DOxLuRUi$jPxToO5aNmhkg183$21(vValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var sRgbHex=vValue.toHex();

_oColorMap[sRgbHex]=vValue;

return sRgbHex;
};







var fetchColor=function $vpfn_5puUX_u1MqBZqsEAuf3uXA198$21(sValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oRgbColor=new vp.color.Color(sValue);

return _oColorMap[oRgbColor.toHex()];
};









var serializeStyleValue=function $vpfn_HbIGcyQAiwdr77UnZUqMog213$30(sProp,vValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sProp=="color"&&vValue){

return storeColor(vValue);
}
else
{

return vValue.toString();
}
};









var deserializeStyleValue=function $vpfn_IsIIhNHVC0uLpuYVznNU_Q233$32(sProp,sValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sProp=="color"&&sValue){

return fetchColor(sValue);
}
else if(sProp=="fontSize"&&sValue){

return parseInt(sValue);
}
else{

return sValue;
}
};

var normalizeParagraphTags=function $vpfn_XNuu9gJ1X1axTfHDnZp5Kg248$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(document.all)
{
me._convertDivsToParagraphs(_oEditableElement);
}
else
{
me._convertParagraphsToDivs(_oEditableElement);
}
};






this.setElementStyle=function $vpfn_t_7zrGHZAoqu6YWTU4YbgA264$27(sStyle,sValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_oElementStyle[sStyle]=sValue;
if(me.element){


if(_oIFrame&&sStyle.indexOf("font")===0){
_oIFrame.contentDocument.styleSheets[0].cssRules[0].style[sStyle]=sValue;
}


else if(_oIFrame&&
sStyle.indexOf("border")==-1&&
sStyle.indexOf("margin")==-1&&
sStyle!="backgroundColor"&&
sStyle!="cssFloat"&&
sStyle!="styleFloat")
{

if(sStyle.indexOf("width")!==-1||sStyle.indexOf("height")!==-1)
{
me.element.style[sStyle]=sValue;
_oIFrame.style[sStyle]=sValue;
}
_oIFrame.contentDocument.body.style[sStyle]=sValue;
}
else{
me.element.style[sStyle]=sValue;
}
}
};





this.disabledStyles=[];





this.disabledFeatures=[];






this.limitFontSize=true;






var disableStyles=function $vpfn_7wvLQ8wPR0iBnvs7Fv7lWg319$24(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oNode){
oNode=_oEditableElement;
}

var i;

for(i=0;i<me.disabledStyles.length;i++){
if(oNode.style[me.disabledStyles[i]]!==""){
me._setStyle(oNode,me.disabledStyles[i],oNode.style[me.disabledStyles[i]]);
}
}

if(oNode.style["fontSize"]){
me._setStyle(oNode,"fontSize",me._getStyle(oNode,"fontSize"));
}

if(me.disabledStyles.indexOf("color")==-1){
vp.widget.RichTextArea.prototype._highlightWhiteText(oNode);
}

for(i=0;i<oNode.childNodes.length;i++){
var oChild=oNode.childNodes[i];
if(oChild.nodeType==1){
disableStyles(oChild);
}
}
};





this.render=function $vpfn_lJil4h$5VDt7Gtr4ouadhw352$18(oParent){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bIsRendered){
return;
}

me.element=vp.web.getOwnerDocument(oParent).createElement("DIV");
me.element.style.border="1px black solid";
me.element.style.width=me.minWidth+"px";
me.element.style.height="20px";

var sProp;

for(sProp in me.attributes){
me.element[sProp]=me.attributes[sProp];
}

oParent.appendChild(me.element);

var fnAfterLoad=function $vpfn_rNDcMNUslul33zZWvQmUrw370$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bWasRendered=_bIsRendered;

_bIsRendered=true;


for(sProp in me.style){
me._setStyle(_oEditableElement,sProp,me.style[sProp]);
}


for(sProp in _oElementStyle){
me.setElementStyle(sProp,_oElementStyle[sProp]);
}

_oEditableElement.innerHTML=_sValue;

me.normalize();

_sValue=_oEditableElement.innerHTML;

if(_bFocusOnRender){
me.focus();
}

if(!bWasRendered){
setTimeout(me.oninitialrender.fire,0);
}
};


if(document.all){
_oEditableElement=vp.web.getOwnerDocument(me.element).createElement("DIV");
_oEditableElement.contentEditable=true;


me.element.appendChild(_oEditableElement);

vp.events.add(_oEditableElement,"keyup",onKeyUpHandler);
vp.events.add(_oEditableElement,"keypress",onKeyPressHandler);
vp.events.add(_oEditableElement,"keydown",onKeyDownHandler);
vp.events.add(_oEditableElement,"focus",onFocusHandler);
vp.events.add(_oEditableElement,"mouseup",fireSelectionChanged);
vp.events.add(_oEditableElement,"paste",onPasteHandler);

vp.ui.addClass(_oEditableElement,"richTextFieldIE");

vp.events.add(me.element,"click",normalizeClickOutsideEditableElement);

fnAfterLoad();










}


else{
_oIFrame=vp.web.getOwnerDocument(me.element).createElement("IFRAME");
_oIFrame.frameBorder=0;
_oIFrame.width="100%";
_oIFrame.style.clear="both";

_oIFrame.style.overflow='auto';
_oIFrame.marginHeight=0;
_oIFrame.marginWidth=0;
_oIFrame.style.width="100px";
_oIFrame.style.height="20px";

var fnLoadIFrame=function $vpfn_6Mp1ivC7GTGOzbQ7PLePLg445$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDoc=_oIFrame.contentDocument;
if(oDoc){
_oEditableElement=oDoc.getElementById("root");
}



if(!_oEditableElement){
setTimeout(fnLoadIFrame,100);
return;
}

vp.events.add(oDoc,"focus",onFocusHandler);
vp.events.add(oDoc,"keyup",onKeyUpHandler);
vp.events.add(oDoc,"keydown",onKeyDownHandler);
vp.events.add(oDoc,"keypress",onKeyPressHandler);
vp.events.add(oDoc,"paste",onPasteHandler);
vp.events.add(oDoc,"mousedown",bubbleMouseDownEvent);
vp.events.add(oDoc,"mouseup",fireSelectionChanged);
vp.events.add(oDoc,"mouseup",bubbleMouseUpEvent);
vp.events.add(oDoc,"mousemove",bubbleMouseMoveEvent);

fnAfterLoad();
};

_oIFrame.onload=fnLoadIFrame;

var sIFrameURL="/vp/JS-Lib/common/vp.widget.richtextarea.iframe.htm";
if(window.vpSiteVersion){
sIFrameURL+="?v="+window.vpSiteVersion;
}
_oIFrame.src=sIFrameURL;

me.element.appendChild(_oIFrame);

vp.events.add(me.element.ownerDocument,"mouseup",documentMouseupHandler);
}
};

var normalizeClickOutsideEditableElement=function $vpfn_1gMHO6jQFxjbOFbqDphqQQ485$47(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);







if(e.target==me.element){
me.focus();
vp.events.cancelEvent(e);
}
};

var _bWasScrollbarClicked=false;

var bubbleMouseDownEvent=function $vpfn_wy4FdRUeuBKaH6_5l49kjg502$31(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



_bWasScrollbarClicked=false;
if(e.target.tagName=="HTML"){
_bWasScrollbarClicked=true;
}

vp.events.fireEvent(me.element,"mousedown");
};

var documentMouseupHandler=function $vpfn_hzTlSw_WyaaOeTm7p$JS8A514$33(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bWasScrollbarClicked=false;
};

var bubbleMouseUpEvent=function $vpfn_t_bzBT3Lu9eY_HtYFgYtUw518$29(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
documentMouseupHandler();
vp.events.fireEvent(me.element,"mouseup");
};

var bubbleMouseMoveEvent=function $vpfn_7xNFekY3xCpkw_euIWr9sQ523$31(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




if(_bWasScrollbarClicked){
return;
}

var oRect=vp.ui.getRect(me.element);

e=vp.core.shallowCopy(e);
e.clientX+=(oRect.left-me.element.ownerDocument.body.scrollLeft);
e.clientY+=(oRect.top-me.element.ownerDocument.body.scrollTop);

vp.events.fireEvent(me.element,"mousemove",e);
};






var onDocumentMouseDownHandler=function $vpfn_9H$0iHEU7VsKWv_25SnXCQ546$37(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.isFocused){
return;
}


if(e){
e=vp.events.getEvent(e);

var oTarget=e.target;

if(oTarget){
if(oTarget==me.element||vp.ui.isChildOf(oTarget,me.element)){
return;
}


if(me._isUnselectable(oTarget)){
return;
}
}
}


try{
if(document.all){
document.selection.empty();
}
else{
if(_oIFrame.contentWindow.getSelection()){
_oIFrame.contentWindow.getSelection().removeAllRanges();
}

_oIFrame.blur();
}
}
catch(ex){}

fnRemoveMailtoAnchors();


vp.events.remove(document,"mousedown",onDocumentMouseDownHandler);


if(_iPollTimer){
clearInterval(_iPollTimer);
_iPollTimer=null;
}

fireSelectionChanged();

me.isFocused=false;
me.onblur.fire();
};




this.blur=function $vpfn_D7DCyym2CcLyLT30rdkarQ605$16(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
onDocumentMouseDownHandler();
};





var onFocusHandler=function $vpfn_ro6GeKvFglNGOmkp3EKIuQ613$25(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isFocused){
return;
}

me.isFocused=true;


if(_iPollTimer){
clearInterval(_iPollTimer);
}
_iPollTimer=setInterval(checkForChanges,300);


vp.events.add(document,"mousedown",onDocumentMouseDownHandler);

me.onfocus.fire();
};


var _bFocusOnRender=false;




this.focus=function $vpfn_lpvr00Qwe6gBpYddCQV5zg638$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bIsRendered){
var oRange;

if(document.all){
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
oRange.collapse(false);
oRange.select();

setTimeout(function $vpfn_A8kCkHpQPwuFvfYkPMu4dg648$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.element.scrollTop=0;},10);
}
else{
var delayFocus=function $vpfn_MT3pmHI30kPsTiSDeAAWEw651$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_oIFrame){
setTimeout(arguments.callee,10);
}

oRange=_oIFrame.contentDocument.createRange();
oRange.selectNodeContents(_oEditableElement);
oRange.collapse(false);
var oSelection=_oIFrame.contentWindow.getSelection();

if(oSelection){
oSelection.removeAllRanges();
oSelection.addRange(oRange);
}

if(_oIFrame.contentWindow&&
typeof(_oIFrame.contentWindow.focus)==="function"){
_oIFrame.contentWindow.focus();
}
};

setTimeout(delayFocus,0);
}
}
else{
_bFocusOnRender=true;
}
};






var onKeyUpHandler=function $vpfn_J1cfsyRPCrJACB6sfxElOQ685$25(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);

if(!(e.ctrlKey&&e.keyCode==86))
{


switch(e.keyCode){
case 13:
case 8:
case 46:
fnRemoveMailtoAnchors();
labelSanctionedTags();
break;
case 32:
fnRemoveMailtoAnchors();
break;
default:
break;
}

if(e.altKey)
{



var altKeyHack=function $vpfn_kHQluLGpsS1UeDpdnNAAoA711$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
checkForChanges(true);
};

setTimeout(altKeyHack,500);
}
else{
checkForChanges(true);
me.onkeyup.fire(e);
}
}

_bSuspendPolling=false;
};





var onKeyPressHandler=function $vpfn_6ZkuS5e_R3NKNKHwP_5kxA730$28(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bSuspendPolling=true;
};





var onPasteHandler=function $vpfn_03S0$Z3rLhM5t1TFNbyoPA738$25(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
setTimeout(function $vpfn_A8kCkHpQPwuFvfYkPMu4dg739$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
cleanUnsanctionedTags();
},100);
};





var onKeyDownHandler=function $vpfn_ZEk94XV8$eG0Wrm5Y_oL2Q748$27(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);


if(e.ctrlKey&&!e.altKey){
switch(e.keyCode){
case 66:
me.toggleStyle("fontWeight");
vp.events.cancel(e);
break;
case 73:
me.toggleStyle("fontStyle");
vp.events.cancel(e);
break;
case 90:
if(me.isHistoryDisabled){
vp.events.cancelEvent(e);
}
else{
undo();
vp.events.cancel(e);
}
break;
case 89:
if(me.isHistoryDisabled){
vp.events.cancelEvent(e);
}
else{
redo();
vp.events.cancel(e);
}
break;

case 67:
case 86:
case 88:
case 37:
case 38:
case 39:
case 40:
setTimeout(fireSelectionChanged,10);
vp.events.cancelBubble(e);
break;
case 65:
vp.events.cancelBubble(e);
break;
case 75:
case 85:
vp.events.cancelEvent(e);
break;

default:
if(!document.all){
vp.events.fireEvent(document,"keydown",e);
}
break;
}
}
else if(e.keyCode==46)
{
vp.events.cancelBubble(e);
}
else if(e.keyCode>=37&&e.keyCode<=40)
{
setTimeout(fireSelectionChanged,10);
vp.events.cancelBubble(e);
}
else if(e.keyCode==9)
{
if(!document.all){

vp.events.cancel(e);
vp.events.fireEvent(document,"keydown",e);
}

checkForChanges(true);
me.blur();
}
else if(e.keyCode==32){
fnRemoveMailtoAnchors();
}

me.onkeydown.fire(e);
};






var labelSanctionedTags=function $vpfn_UdYGXd9QGM$eN_LxAIaS$Q838$30(oElem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oElem){
oElem=_oEditableElement;
}

var iLen=oElem.childNodes.length;
for(var i=0;i<iLen;i++){
var oChild=oElem.childNodes[i];
if(oChild.nodeType==1){
if(oChild.getAttribute(me.SANCTIONED_TAG_ATTRIBUTE)!="1"){
if(me.SANCTIONED_TAGS.contains(oChild.tagName)){
oChild.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");
}
}

labelSanctionedTags(oChild);
}
}
};







var cleanUnsanctionedTags=function $vpfn_tP5TEU31cAqmMKujXR0OgA864$32(oElem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oElem){
oElem=_oEditableElement;

if(document.all){
var sHTML=oElem.innerHTML;


if(sHTML.indexOf("<FONT")!=-1){
sHTML=sHTML.replace(/\<FONT[^\>]*?\>/gi,"");
sHTML=sHTML.replace(/\<\/FONT\>/gi,"");
oElem.innerHTML=sHTML;
}
}
}




var ownerDocument=null;

for(var i=0;i<oElem.childNodes.length;i++){
var oChild=oElem.childNodes[i];
if(oChild.nodeType==8){

ownerDocument=vp.web.getOwnerDocument(oChild);
var oCommentNode=ownerDocument.createTextNode("");
oChild.parentNode.replaceChild(oCommentNode,oChild);
}
else if(oChild.nodeType==1){
if(oChild.getAttribute(me.SANCTIONED_TAG_ATTRIBUTE)!="1"){



ownerDocument=vp.web.getOwnerDocument(oChild);

if(oChild.tagName=="P"&&oChild.parentNode==_oEditableElement){
var oNewP=ownerDocument.createElement(document.all?"P":"DIV");
oNewP.innerHTML=vp.web.htmlEncode(getCleanedInnerText(oChild));
oNewP.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");
oChild.parentNode.replaceChild(oNewP,oChild);
}
else{
var oNewTextNode=ownerDocument.createTextNode(getCleanedInnerText(oChild));
oChild.parentNode.replaceChild(oNewTextNode,oChild);
}
}
else{
cleanUnsanctionedTags(oChild);
}
}
}
};






var getCleanedInnerText=function $vpfn_O7y$jFAywgK6HOe5Gt6KrA923$30(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sText=oNode.innerHTML;

sText=sText.replace(/\<[^>]*?\>/gi," ");
sText=sText.replace(/\s/gi," ");
sText=sText.replace(/\s{2,}/gi," ");
sText=sText.replace(/&nbsp;/gi," ");

return sText;
};

var addMozillaSpacer=function $vpfn_2j7O5chlLRowiumqAtUBAg934$27(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!document.all&&oNode.innerHTML.length===0){
oNode.innerHTML=me.EMPTY_MOZ_SPACER;
}
};

var removeMozillaSpacer=function $vpfn_ZWTlLtCz0n2iyH2vMhJxLg941$30(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!document.all){
if(oNode.childNodes.length!=1){
var oSpacer;

var aBR=oNode.getElementsByTagName("BR");
var iLen=aBR.length;
for(var i=0;i<iLen;i++){
if(aBR[i].getAttribute("mozspacer")=="1"){
oSpacer=aBR[i];
break;
}
}

if(oSpacer){
oSpacer.parentNode.removeChild(oSpacer);
}
}
}
};






var checkForChanges=function $vpfn_0CnsLOct0imT2qdtRU8EqA967$26(bIsKeyEvent){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.actionInProgress){
return;
}

if(_bSuspendPolling&&!bIsKeyEvent){
return;
}

if(hasInnerHTMLChanged()){
removeMozillaSpacer(_oEditableElement);

if(!bIsKeyEvent){
cleanUnsanctionedTags();
}

setChanged();
}



if(!bIsKeyEvent){
var oRange=getSelectedRange();
if(!me._isRangeEqual(oRange,m_oLastSelectedRange)){
startSelectionChangeTimer();
m_oLastSelectedRange=oRange;
};
}
};

var _iSelectionChangeTimer=null;

var startSelectionChangeTimer=function $vpfn_6MKNZbTeb4_HikB0mL42Xg999$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iSelectionChangeTimer){
clearTimeout(_iSelectionChangeTimer);
}

_iSelectionChangeTimer=setTimeout(fireSelectionChanged,500);
};

var fireSelectionChanged=function $vpfn_sgtfunPliybEWkMJcDiITQ1007$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_oCachedSelectionNode=null;
me.onselectionchange.fire();
};





this.disableHistory=function $vpfn_EBmCnBUjuKcxgpADc3LKCA1016$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isHistoryDisabled=true;
clearUndoStack();
};

var _aUndoStack=[];
var _iCurrentUndoIndex=-1;

var clearUndoStack=function $vpfn_bZ5PvcgWTLx_0gX2OgU0bw1024$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_aUndoStack=[];
_iCurrentUndoIndex=-1;
};

var updateFromUndoStack=function $vpfn_GLSSx2HZIKUYW20k4R5GgQ1029$30(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isHistoryDisabled=true;


me.setValue(_aUndoStack[_iCurrentUndoIndex].innerXML);


var oStyle=_aUndoStack[_iCurrentUndoIndex].style;
for(var sStyle in oStyle){
var sStyleValue=oStyle[sStyle];

me.style[sStyle]=sStyleValue;
me._setStyle(_oEditableElement,sStyle,sStyleValue);
}

me.isHistoryDisabled=false;

me.onchange.fire();
me.ondelaychange.fire();
fireSelectionChanged();
};

var undo=function $vpfn_mGZbEsxZeE1XMMB$tjYcXA1051$15(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iCurrentUndoIndex>0){
_iCurrentUndoIndex--;
updateFromUndoStack();
}
};

var redo=function $vpfn_AyAe4NL2Ry9wiDWLDvQa5w1058$15(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_aUndoStack.length>_iCurrentUndoIndex+1){
_iCurrentUndoIndex++;
updateFromUndoStack();
}
};

var addToHistory=function $vpfn_KPFn7A8bwupc4kkJVXsegw1065$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isHistoryDisabled){

var oStyle={};
for(var i=0;i<me.SUPPORTED_STYLES.length;i++){
var sStyle=me.SUPPORTED_STYLES[i];
var sStyleValue;
if(_oEditableElement){
sStyleValue=me._getStyle(_oEditableElement,sStyle);
}
else{
sStyleValue=me.style[sStyle];
}
oStyle[sStyle]=sStyleValue;
}


_iCurrentUndoIndex++;
_aUndoStack[_iCurrentUndoIndex]={
"innerXML":_sValue,
"style":oStyle
};

_aUndoStack=_aUndoStack.slice(0,_iCurrentUndoIndex+1);
}
};

var fireDelayChanged=function $vpfn_RuJbim0vn0zfXE1gwe61HQ1092$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.actionInProgress){
return;
}

if(me.isFocused){
me.cacheSelection();
}

me._normalizeNode(_oEditableElement);
disableStyles();

if(me.isFocused)
{
me.restoreSelection();
}


for(var i=0;i<me.SUPPORTED_STYLES.length;i++){
var sStyle=me.SUPPORTED_STYLES[i];
me.style[sStyle]=me._getStyle(_oEditableElement,sStyle);
}

addToHistory();
me.ondelaychange.fire();
};








var setChanged=function $vpfn_QJ$$7W0Yhj9rGI6mwz6nCA1126$21(bForceDelayChange,bSuppressEvents){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

_sOuputValue=null;

_oCachedSelectionNode=null;


_sValue=_oEditableElement.innerHTML;


if(!me.resizeManually){
updateSize();
}

bSuppressEvents=bSuppressEvents?true:false;
if(!bSuppressEvents){
if(bForceDelayChange){

fireDelayChanged();
}
else{

startUpdateTimer();
}

me.onchange.fire();
}
};





var hasInnerHTMLChanged=function $vpfn_frFLXNcrWrnHiLcmljL73g1159$30(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _oEditableElement.innerHTML!=_sValue;
};




var updateSize=function $vpfn_lNTxVpk0uORhNEKsHTNtyw1166$21(fnCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(document.all){
updateSizeIE(fnCallback);
}
else{
updateSizeMozilla(fnCallback);
}
};




this.setSize=function $vpfn_B6PTKF_DqYU3XRj58VGevw1178$19(iWidth,iHeight){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.resizeManually){

}

if(iWidth<=0||iHeight<=0){

}

if(_oIFrame){
_oIFrame.style.width=iWidth+"px";
_oIFrame.style.height=iHeight+"px";
}

me.element.style.width=(iWidth+2)+"px";
me.element.style.height=(iHeight+2)+"px";

me.setAutoScroll();

};

this.setSizeAuto=function $vpfn_psWvCRKYeqYLYAHZF1oqEQ1199$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.resizeManually){

}

if(_oIFrame){
_oIFrame.style.width="100%";
_oIFrame.style.height="10px";
}

me.element.style.width="100%";
me.element.style.height="10px";
};

this.setAutoScroll=function $vpfn_WNqNGhideJuCs2CCMEYngg1213$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_oIFrame){
_oIFrame.style.overflowY="auto";
_oIFrame.style.overflowX="auto";
}

me.element.style.overflowY="auto";
me.element.style.overflowX="auto";
};




this.refresh=function $vpfn_b6dzdBYYExMkR09Dk7w3NA1226$19(fnCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
updateSize(fnCallback);
};

var parseIntOrDefault=function $vpfn_an6W2UPM6aJ7vpJhdX3wkQ1230$28(vVal,iDefault){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iDefault)=="undefined"){
iDefault=0;
}

var iVal=iDefault;
if(vVal!==null){
iVal=parseInt(vVal);
if(isNaN(iVal)){
iVal=iDefault;
}
}

return iVal;
};





var updateSizeMozilla=function $vpfn_nmxtKz7i9sdO9k2fkBip9g1250$28(fnCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!fnCallback){
fnCallback=function(){};
}

if(!_oEditableElement||!_oIFrame.contentDocument){
fnCallback();
return;
}

var fnUpdate=function $vpfn_9Sdfj6H$FglIWU4XgPSteQ1260$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}






if(!_oEditableElement||!_oIFrame.contentDocument){
fnCallback();
return;
}

var oRoot=_oEditableElement;
var oBody=_oIFrame.contentDocument.body;
var oDocElement=_oIFrame.contentDocument.documentElement;

if(!me.resizeManually){
_oIFrame.style.width=me.maxWidth-2+"px";
me.element.style.width=me.maxWidth+"px";

if(oDocElement.scrollHeight>me.maxHeight){
_oIFrame.style.height=me.maxHeight+"px";
me.element.style.height=me.maxHeight+2+"px";
}
else if(oDocElement.scrollHeight<me.minHeight){
_oIFrame.style.height=me.minHeight+"px";
me.element.style.height=me.minHeight+2+"px";
}
else{
_oIFrame.style.height=oDocElement.scrollHeight+"px";
me.element.style.height=oDocElement.scrollHeight+2+"px";
}

if(oBody.scrollWidth>me.element.offsetWidth){
var height=Math.min(oDocElement.scrollHeight+24,me.maxHeight);
_oIFrame.style.height=height+"px";
me.element.style.height=height+"px";
}
}

fnCallback();
};

setTimeout(fnUpdate,0);
};

var _iLastValueSize=-1;




var updateSizeIE=function $vpfn_EQyPyJy1ya6SeM6WdrAOEw1311$23(fnCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!fnCallback){
fnCallback=function(){};
}

_iLastValueSize=_sValue.length;

if(!me.resizeManually){
if(me.element.scrollWidth>me.maxWidth){
me.element.style.width=me.maxWidth-4+"px";
me.element.style.overflowX="scroll";
}
else{
me.element.style.width=me.minWidth-4+"px";
me.element.style.overflowX="hidden";
}

if(me.element.scrollHeight>=me.maxHeight){
me.element.style.height=me.maxHeight+"px";
me.element.style.overflowY="auto";
}
else{

if(me.element.scrollWidth>me.element.offsetWidth){
me.element.style.height=_oEditableElement.scrollHeight+24+"px";
}
else{
if(me.minHeight>_oEditableElement.offsetHeight){
me.element.style.height=me.minHeight+"px";
}
else{
me.element.style.height=_oEditableElement.offsetHeight+4+"px";
}
}

me.element.style.overflowY="hidden";
}
}

fnCallback();
};






var isCollapsed=function $vpfn_D6jA6LzmcOue1i6YH_xoGA1358$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();

if(!oRange){
return false;
}

if(typeof(oRange.collapsed)=="undefined")
{
return oRange.text.length===0;
}

return oRange.collapsed;
};





var getSelectedRange=function $vpfn__izAP3$4jha2RiMsVYAblA1377$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered){
return null;
}

var oRange;


if(!me.isFocused){
if(document.all){
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
}
else{
oRange=_oIFrame.contentDocument.createRange();
oRange.selectNodeContents(_oEditableElement);
}
}

else{
if(document.all){
oRange=document.selection.createRange();


if(!vp.ui.isChildOf(oRange,_oEditableElement)){
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
oRange.collapse(true);
}
}
else{
var oSelection=_oIFrame.contentWindow.getSelection();
if(oSelection&&oSelection.rangeCount>0){
oRange=_oIFrame.contentWindow.getSelection().getRangeAt(0);
}
else{
return null;
}
}
}

return oRange;
};






this.getSelectionStyle=function $vpfn_$8wBGSHHHP$5734CTsTrLw1426$29(sStyle){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered){

return deserializeStyleValue(sStyle,me.style[sStyle]);
}

var sListTag=null;
if(sStyle=="orderedList"){
sListTag="OL";
}
else if(sStyle=="unorderedList"){
sListTag="UL";
}

var oTarget=getSelectedRange();

if(oTarget&&me.isSelected()){
if(!_oCachedSelectionNode){

_oCachedSelectionNode=document.createElement("SPAN");
var oParent;

if(document.all){
oParent=oTarget.parentElement();
_oCachedSelectionNode.innerHTML=oTarget.htmlText;
}
else{
oParent=oTarget.commonAncestorContainer;

if(oParent.nodeType!=1){
oParent=oParent.parentNode;
}

_oCachedSelectionNode.appendChild(oTarget.cloneContents());
}

for(var sProp in me.style){
_oCachedSelectionNode.style[sProp]=me._getCurrentStyle(oParent,sProp,_oEditableElement);
}

me._normalizeNode(_oCachedSelectionNode);
}

if(sListTag){
var bIsCopy=false;
var oParentTemp=oParent;

var aItems=_oCachedSelectionNode.getElementsByTagName("LI");
if(aItems.length>=1){
bIsCopy=true;
oParentTemp=aItems[0];
}

while(oParentTemp&&oParentTemp!=_oEditableElement){
if(oParentTemp.tagName==sListTag){
return true;
}
oParentTemp=oParentTemp.parentNode;
if(!oParentTemp&&bIsCopy){
oParentTemp=oParent;
}
}
return false;
}
else{
var sStyleValue=getStyleRecursive(_oCachedSelectionNode,sStyle);
return deserializeStyleValue(sStyle,sStyleValue);
}
}

else{
if(sListTag){
return _oEditableElement.innerHTML.indexOf("<"+sListTag+">")!=-1;
}
else{
return me.getStyle(sStyle);
}
}

};


var getStyleRecursive=function $vpfn_Z2jmqMTExMnz82U1$$jIBQ1508$28(oNode,sStyle){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var vVal=me._getCurrentStyle(oNode,sStyle,_oEditableElement);

var iLen=oNode.childNodes.length;
for(var i=0;i<iLen;i++){
var oChild=oNode.childNodes[i];
if(oChild.nodeType==1&&vp.web.getInnerText(oChild).trim().length>0)
{
var vChildVal=getStyleRecursive(oChild,sStyle);
if(!vChildVal||vChildVal!=vVal){
if(vp.web.getInnerText(oChild).trim()==vp.web.getInnerText(oNode).trim()){
vVal=vChildVal;
}
else{
return null;
}
}
}
}

return vVal;
};


this.isSelected=function $vpfn_4aR5SZ19CEwQZYQgDmmxLw1532$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered){
return false;
}

return me.isFocused;


















};






var getSelectionTokenName=function $vpfn_YfyFmwzqWBR5W5UcY4nDzA1563$32(bStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(bStart?"start":"end")+"_token_"+me.element.id;
};






var insertTokenInRange=function $vpfn_dwxWQIMTT9TD6tWjgcHqAw1572$29(bStart,oRange){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDoc=document.all?document:_oIFrame.contentDocument;
var sTokenName=getSelectionTokenName(bStart);


var oOldToken=oDoc.getElementById(sTokenName);
while(oOldToken){
if(oOldToken.parentNode){
oOldToken.parentNode.removeChild(oOldToken);
}
oOldToken.id="";
oOldToken=oDoc.getElementById(sTokenName);
}

var oToken=oDoc.createElement("A");
oToken.id=sTokenName;
oToken.style.display="none";
oToken.innerHTML="*!t";

oToken.setAttribute("isToken",true);

oToken.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");


var oClonedRange=document.all?oRange.duplicate():oRange.cloneRange();
oClonedRange.collapse(bStart);


if(document.all){


var sTokenHTML=oToken.outerHTML;
var oParent=oClonedRange.parentElement();
if(oParent.tagName=="P"&&oParent.innerHTML.length===0){
sTokenHTML+="&nbsp;";
}
oClonedRange.pasteHTML(sTokenHTML);
}
else{
oClonedRange.insertNode(oToken);
}
};





this.createBookmark=function $vpfn_ga6xAnSqH5RsBctVAkKrHQ1619$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();
var oBookmark=null;

if(oRange){
oBookmark=new vp.text.Range(oRange);
}

return oBookmark;
};





this.restoreFromBookmark=function $vpfn_dHsmaKyvC$6HW7rycviBtw1634$31(oBookmark){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oBookmark){
oBookmark.select();
}
};




this.cacheSelection=function $vpfn_Y43jHoBb87zoawdKrhehuQ1643$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();

if(oRange){
var sSelectedText=document.all?oRange.text:oRange.toString();


if(sSelectedText!==""){
insertTokenInRange(false,oRange);
}


insertTokenInRange(true,oRange);
}



if(document.all||sSelectedText!==""){
me.restoreSelection(true);
}
};





this.restoreSelection=function $vpfn_RS4$d0SFAZDPVgrByhV1BA1669$28(bPreserveTokens){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i;
var oDoc=document.all?document:_oIFrame.contentDocument;

var oStartToken=oDoc.getElementById(getSelectionTokenName(true));

if(!oStartToken){
return;
}


var oRange=document.all?document.body.createTextRange():oDoc.createRange();
document.all?
oRange.moveToElementText(oStartToken):
oRange.selectNode(oStartToken);

oRange.collapse(false);


if(!bPreserveTokens){
oStartToken.id="";
oStartToken.parentNode.removeChild(oStartToken);
}


var oEndToken=oDoc.getElementById(getSelectionTokenName(false));

if(oEndToken){

var oEndRange=document.all?document.body.createTextRange():oDoc.createRange();
document.all?
oEndRange.moveToElementText(oEndToken):
oEndRange.selectNode(oEndToken);
oEndRange.collapse(true);



if(document.all){
oRange.setEndPoint("EndToStart",oEndRange);
}
else{
oRange.setEnd(oEndRange.startContainer,oEndRange.startOffset);
}


if(!bPreserveTokens){
oEndToken.id="";
oEndToken.parentNode.removeChild(oEndToken);
}
}

if(me.isFocused){

if(document.all){
oRange.select();

fnRemoveMailtoAnchors();
}
else{
var oSelection=_oIFrame.contentWindow.getSelection();

if(oSelection){
oSelection.removeAllRanges();
oSelection.addRange(oRange);
}
}
}
};

var fnRemoveMailtoAnchors=function $vpfn_EMOLJ3w0$yn5izc_ZjfjTw1738$32(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!document.all){
return;
}

if(_oEditableElement.innerText.indexOf(".")==-1){
return;
}



var aElements=_oEditableElement.getElementsByTagName("A");
for(var i=0;i<aElements.length;i++){
var isToken=aElements[i].getAttribute("isToken");
if(!isToken){
aElements[i].outerHTML=aElements[i].innerHTML;






i--;
}
}
};









var replacePlaceholderWithStyle=function $vpfn_QIs5ZK$FaUxViL6kpdG5ag1773$38(oNode,sStyle,vValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1){
var bDoRecurse=true;



if((document.all&&oNode.tagName=="STRIKE")||
(!document.all&&oNode.style.textDecoration=="line-through")){

if(oNode.tagName=="STRIKE"){
var oSpan=vp.web.getOwnerDocument(oNode).createElement("SPAN");

while(oNode.childNodes.length>0){
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oSpan.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oSpan,oNode);

oNode=oSpan;
}
else{
vp.ui.removeStyle(oNode,"textDecoration");
}

me._removeStyleRecursive(oNode,sStyle);
me._setStyle(oNode,sStyle,vValue);

bDoRecurse=false;
}

if(bDoRecurse){
var oChildNodes=oNode.childNodes;
var iLen=oChildNodes.length;

for(var i=0;i<iLen;i++){
replacePlaceholderWithStyle(oChildNodes[i],sStyle,vValue);
}
}
}
};





this.pasteInto=function $vpfn_ku9OimeVOXlAEmhsFLC8pQ1818$21(sText){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();

if(document.all){
oRange.pasteHTML(sText);
}
else{
var TOKEN="p4978x43";
var oTextNode=_oIFrame.contentDocument.createElement("SPAN");
oTextNode.innerHTML=sText+TOKEN;

oRange.deleteContents();
oRange.insertNode(oTextNode);

_oIFrame.contentWindow.find(TOKEN);
oRange=getSelectedRange();
oRange.deleteContents();

}
};





this.toggleStyle=function $vpfn_6YmFvmD$m9LqY0mZJ8q_rg1843$23(sStyle){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sCurrentValue=me.getStyle(sStyle);
var sNewValue=null;

if(sStyle=="fontWeight"){
sNewValue=sCurrentValue=="bold"?"normal":"bold";
}
else if(sStyle=="fontStyle"){
sNewValue=sCurrentValue=="italic"?"normal":"italic";
}

me.setStyle(sStyle,sNewValue);
};







this.setStyle=function $vpfn_8qLzE9INZOvLnKNL$waqLQ1863$20(sStyle,vStyleValue,bWholeField){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.actionInProgress=true;


if(!bWholeField&&isCollapsed()){
bWholeField=true;
}

try{
var bDoNormalize=sStyle.indexOf("List")==-1&&sStyle!="textAlign";


if(_bIsRendered&&me.isSelected()&&getSelectedRange()!==null&&!bWholeField){

var sStyleValue=serializeStyleValue(sStyle,vStyleValue);


if(bDoNormalize){
me.cacheSelection();
}

var oTarget=document.all?document:_oIFrame.contentWindow.document;




if(bDoNormalize){
oTarget.execCommand("StrikeThrough",false,true);
replacePlaceholderWithStyle(_oEditableElement,sStyle,sStyleValue);
}
else{
try{

var oCommand=me._getCommandFromStyle(sStyle,sStyleValue);
oTarget.execCommand(oCommand.id,false,sStyleValue);
}
catch(ex){

if(ex.message.indexOf("nsIDOMNSHTMLDocument.execCommand")==-1){
throw ex;
}
}
}



if(bDoNormalize){
me._normalizeNode(_oEditableElement);
me.restoreSelection();
}


labelSanctionedTags();



me.style[sStyle]=me._getStyle(_oEditableElement,sStyle);
}

else{

if(_bIsRendered){
me._removeStyleRecursive(_oEditableElement,sStyle);
}


me.setStyleSimple(sStyle,vStyleValue);
}

if(_bIsRendered){
disableStyles();

me.actionInProgress=false;


setChanged(true);
}
}
finally{
me.actionInProgress=false;
}

};





this.setStyleSimple=function $vpfn_4dFCa6S_4YRw0NKtCT4dfQ1951$26(sStyle,vValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue=serializeStyleValue(sStyle,vValue);

me.style[sStyle]=sStyleValue;

if(_bIsRendered){
me._setStyle(_oEditableElement,sStyle,sStyleValue);
}
};







this.getStyle=function $vpfn_AsrfSwWueDtnVMEAH8toJg1967$20(sStyle){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue;
if(sStyle.indexOf("List")===-1){
if(_bIsRendered&&_oEditableElement){
sStyleValue=getStyleRecursive(_oEditableElement,sStyle);
}
else{
sStyleValue=me.style[sStyle];
}
}
else{
var sHTML=_oEditableElement?_oEditableElement.innerHTML:_sValue;
var sListTag=sStyle==="unorderedList"?"<UL":"<OL";
sStyleValue=sHTML.substr(0,3).toUpperCase()===sListTag;
}
return deserializeStyleValue(sStyle,sStyleValue);
};






this.getStyleSimple=function $vpfn_7K99XJIKpYeHDoTmHC2wNQ1990$26(sStyle){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue=me.style[sStyle];
return deserializeStyleValue(sStyle,sStyleValue);
};





this.normalize=function $vpfn_uyg92rOB4vBx2E5QRIAfxA1999$21(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_oEditableElement){
normalizeParagraphTags();
labelSanctionedTags();
disableStyles();
addMozillaSpacer(_oEditableElement);

if(!me.resizeManually){
updateSize();
}
}
};






var convertNodeColorStyles=function $vpfn_P7l6QERSmzbh41V_ryZriw2017$33(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{

var sStyle=oNode.getAttribute("style");
if(sStyle&&sStyle.length>0){

var sCSSText=sStyle.toLowerCase();
if(sCSSText.indexOf("color:")!=-1){
var oCSS=new vp.web.CssString(sCSSText);
var sColorString=oCSS.getItem("color");
if(sColorString){

var oColor=new vp.color.Color(sColorString);

oCSS.setItem("color",storeColor(oColor));


oNode.setAttribute("style",oCSS.toString());
}
}
}
}
else{

}


for(var i=0;i<oNode.childNodes.length;i++){
convertNodeColorStyles(oNode.childNodes[i]);
}
};






this.setValue=function $vpfn_hNSJRD9gmkxv88M9MkNzkw2055$20(sValue,bSuppressEvents){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var oXmlDoc=vp.web.getXMLDocument('<div>'+sValue+'</div>');
convertNodeColorStyles(oXmlDoc.documentElement);
sValue=vp.web.getInnerXML(oXmlDoc.documentElement);


sValue=me._XMLToHTML(sValue);

if(_oEditableElement){
if(sValue==_sValue){
return;
}

_oEditableElement.innerHTML=sValue;

me.normalize();

sValue=_oEditableElement.innerHTML;
}
else{
_iLastValueSize=sValue.length;
}

_sValue=sValue;
_sOuputValue=null;

addToHistory();

if(_oEditableElement){

checkForChanges(true);
}
};






var convertNodeToXML=function $vpfn_7SkluorQNzbNJ_QxpH$9Bg2096$27(oNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsFirstNode=false;


var oXMLDoc=arguments[1];
if(!oXMLDoc){
oXMLDoc=vp.web.getXMLDocument();
bIsFirstNode=true;
}

var oNewNode;

if(oNode.nodeType==1)
{
oNewNode=oXMLDoc.createElement(oNode.tagName.toUpperCase());
if(bIsFirstNode){
oNewNode.setAttribute("xml:space","preserve");
}


if(oNode.style.cssText){
var sCSSText=oNode.style.cssText.toLowerCase();


if(sCSSText.indexOf("color:")!=-1){
var oCSS=new vp.web.CssString(sCSSText);
var sColorString=oCSS.getItem("color");
if(sColorString){

var oColor=fetchColor(sColorString);

oCSS.setItem("color",oColor.toString());
}
sCSSText=oCSS.toString();
}

oNewNode.setAttribute("style",sCSSText);
}

if(oNode.align){
oNewNode.setAttribute("align",oNode.align);
}
}

else{
oNewNode=oXMLDoc.createTextNode(oNode.nodeValue);
}

for(var i=0;i<oNode.childNodes.length;i++){
var oNewChild=convertNodeToXML(oNode.childNodes[i],oXMLDoc);
oNewNode.appendChild(oNewChild);
}

return oNewNode;
};





this.getOutputXMLNode=function $vpfn_RXfb0ngBv3YIrM1YREaJWQ2156$28(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDiv=document.createElement("DIV");
for(var sProp in me.style){

oDiv.style[sProp]=me.style[sProp];
}
oDiv.innerHTML=me.getInternalHTML();

removeMozillaSpacer(oDiv);

me._normalizeNode(oDiv);
cleanUnsanctionedTags(oDiv);
me._cleanupOutputNode(oDiv);
me._convertDivsToParagraphs(oDiv);

return convertNodeToXML(oDiv);
};





this.getValue=function $vpfn_3OgOuBbt3Foc1kjjU27ujg2178$20(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_sOuputValue===null){
var oNode=me.getOutputXMLNode();

if(oNode&&oNode.childNodes[0]){
_sOuputValue=me._postProcessOutputXML(vp.web.getInnerXML(oNode));
}
else{
_sOuputValue="";
}
}

return _sOuputValue;
};





this.getInternalHTML=function $vpfn_NR_G1VUy_nxaZCjsLk5DXg2197$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sHTML=_oEditableElement?_oEditableElement.innerHTML:_sValue;

if(!document.all){
sHTML=me._stripTrailingBR(sHTML);
}

return sHTML;
};

this.getBoundingRect=function $vpfn_nRi4_rNyUR2DTo4PjuQ7Uw2207$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.ui.getRect(me.element);
};

this.turnOffBrowserAutoComplete=function(){

};
};





vp.widget.RichTextArea.SUPPORTED_STYLES=["fontSize","fontFamily","color","fontWeight","fontStyle","textAlign"];





vp.widget.RichTextArea.prototype.SUPPORTED_STYLES=vp.widget.RichTextArea.SUPPORTED_STYLES;





vp.widget.RichTextArea.SUPPORTED_STYLES_STRING_FORMAT=["font-size","font-family","color","font-weight","font-style","text-align"];





vp.widget.RichTextArea.prototype.SUPPORTED_STYLES_STRING_FORMAT=vp.widget.RichTextArea.SUPPORTED_STYLES_STRING_FORMAT;





vp.widget.RichTextArea.SANCTIONED_TAG_ATTRIBUTE="richtextok";





vp.widget.RichTextArea.prototype.SANCTIONED_TAG_ATTRIBUTE=vp.widget.RichTextArea.SANCTIONED_TAG_ATTRIBUTE;





vp.widget.RichTextArea.EMPTY_MOZ_SPACER="<br richtextok=\"1\" mozspacer=\"1\">";





vp.widget.RichTextArea.prototype.EMPTY_MOZ_SPACER=vp.widget.RichTextArea.EMPTY_MOZ_SPACER;





vp.widget.RichTextArea.SANCTIONED_TAGS=["P","SPAN","BR","UL","OL","LI","DIV"];





vp.widget.RichTextArea.prototype.SANCTIONED_TAGS=vp.widget.RichTextArea.SANCTIONED_TAGS;







vp.widget.RichTextArea.prototype._convertParagraphsToDivs=function $vpfn_rE0TNTiYNYn6$49Q5g7LLQ2282$60(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{
var i;

if(oNode.tagName=="P")
{
var oDiv=vp.web.getOwnerDocument(oNode).createElement("DIV");

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
var sValue=this._getStyle(oNode,this.SUPPORTED_STYLES[i]);
if(sValue!=="")
{
this._setStyle(oDiv,this.SUPPORTED_STYLES[i],sValue);
}
}

if(oNode.align&&oNode.align!=="")
{
this._setStyle(oDiv,"textAlign",oNode.align);
}

while(oNode.childNodes.length>0)
{
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oDiv.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oDiv,oNode);

oNode=oDiv;
}

for(i=0;i<oNode.childNodes.length;i++)
{
this._convertParagraphsToDivs(oNode.childNodes[i]);
}
}
};









vp.widget.RichTextArea.prototype._convertDivsToParagraphs=function $vpfn_CaBQxz$8mBoBNPBvLHschg2331$60(oNode,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(oTopNode)=="undefined")
{
oTopNode=oNode;
}

if(oNode.nodeType==1)
{
var i;


if(oNode!=oTopNode)
{
if(oNode.tagName=="DIV"&&oNode.parentNode.tagName!="LI")
{


if(oNode.parentNode==oTopNode)
{
var oP=vp.web.getOwnerDocument(oNode).createElement("P");

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
var sStyle=this.SUPPORTED_STYLES[i];
if(sStyle!="textAlign")
{
var sStyleValue=oNode.style[sStyle];
if(sStyleValue&&sStyleValue!=="")
{
oP.style[sStyle]=sStyleValue;
}
}
}


if(oNode.align&&oNode.align!=="")
{
oP.align=oNode.align;
}

while(oNode.childNodes.length>0)
{
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oP.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oP,oNode);

oNode=oP;
}


if(oNode.style.textAlign&&oNode.style.textAlign!=="")
{
oNode.align=oNode.style.textAlign;
vp.ui.removeStyle(oNode,"textAlign");
}
}
}

for(i=0;i<oNode.childNodes.length;i++)
{
this._convertDivsToParagraphs(oNode.childNodes[i],oTopNode);
}
}

};







vp.widget.RichTextArea.prototype._cleanupOutputNode=function $vpfn_AU4usEj148E4QqjEYjWz3g2405$54(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<oNode.childNodes.length;i++)
{
var oChild=oNode.childNodes[i];

if(oChild.nodeType==1)
{
if(oChild.tagName=="A")
{
oChild.id="";
oChild.parentNode.removeChild(oChild);
}
else
{

oChild.removeAttribute(this.SANCTIONED_TAG_ATTRIBUTE);


vp.ui.removeStyle(oChild,"backgroundColor");


for(var j=0;j<this.SUPPORTED_STYLES.length;j++)
{
var sStyle=this.SUPPORTED_STYLES[j];
var sStyleTemp=oChild.getAttribute(sStyle+"_disabled");
if(sStyleTemp)
{
oChild.removeAttribute(sStyle+"_disabled");
oChild.style[sStyle]=sStyleTemp;
}
}


if(oChild.style.textAlign!=="")
{
oChild.align=oChild.style.textAlign;
vp.ui.removeStyle(oChild,"textAlign");
}

this._cleanupOutputNode(oChild);
}
}
else
{

}
}
};







vp.widget.RichTextArea.prototype._postProcessOutputXML=function $vpfn_cBF_F_PNheLeUJM_dpR6RA2461$57(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

sXML=sXML.replace(/\<br\s*\/\>/gi,"<BR />");
return sXML;
};







vp.widget.RichTextArea.prototype._XMLToHTML=function $vpfn_lghrIeNJxY4dbePe6hAx2g2474$46(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sXML.length===0)
{
return sXML;
}


sXML=sXML.replace(/\<br\s*\/\>/gi,"<br>");


var bInTag=false;
var aData=sXML.split("");
var iLen=aData.length;
for(var i=0;i<iLen;i++)
{
if(aData[i]=="<")
{
bInTag=true;
}
else if(aData[i]==">")
{
bInTag=false;
}
else if(i>0&&!bInTag&&aData[i]==" "&&aData[i-1]==" ")
{
aData[i]="&nbsp;";
}

}

return aData.join("");
};







vp.widget.RichTextArea.prototype._stripTrailingBR=function $vpfn_oLMsDvF87OFvyBoy4naqRA2514$52(sHTML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return sHTML.replace(/\<br[^\>]*?\>$/gi,"");
};









vp.widget.RichTextArea.prototype._getCommandFromStyle=function $vpfn_y8XM7_tPly7qob_G2XlZug2527$56(sStyle,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCommand={};

switch(sStyle)
{
case"fontWeight":
oCommand.id="Bold";
oCommand.value=sValue=="bold";
break;
case"fontStyle":
oCommand.id="Italic";
oCommand.value=sValue=="italic";
break;
case"color":
oCommand.id="ForeColor";
oCommand.value=sValue;
break;
case"fontSize":
oCommand.id="FontSize";
oCommand.value=sValue;
break;
case"fontFamily":
oCommand.id="FontName";
oCommand.value=sValue;
break;
case"textAlign":
oCommand.id="Justify"+sValue.substr(0,1).toUpperCase()+sValue.substr(1).toLowerCase();
oCommand.value=null;
break;
case"orderedList":
oCommand.id="InsertOrderedList";
oCommand.value=null;
break;
case"unorderedList":
oCommand.id="InsertUnorderedList";
oCommand.value=null;
break;
default:
throw new Error("The style "+sStyle+" is not supported");
}

return oCommand;
};













vp.widget.RichTextArea.prototype._normalizeNode=function $vpfn_JzSV$7U$mvtUJGsaCXVKvg2584$50(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bTrailingBRRemoved=false;
var oLastChild=oNode.lastChild;
if(oLastChild&&oLastChild.nodeType==1&&oLastChild.tagName=="BR")
{
oNode.removeChild(oLastChild);
bTrailingBRRemoved=true;
}


var TAGS_TO_PRESERVE=["BR"];
var sTempHTML=oNode.innerHTML.replace(/[\n\r\t\f]/gi,"");
var i;

for(i=0;i<TAGS_TO_PRESERVE.length;i++)
{
var oRe=new RegExp("\\<(\\/{0,1}"+TAGS_TO_PRESERVE[i]+"[^\\>]*?)\\>","gim");
sTempHTML=sTempHTML.replace(oRe,"#StartTag#$1#EndTag#");
}

oNode.innerHTML=sTempHTML;

try
{
this._normalizeNodeRecursive(oNode);
}
finally
{
sTempHTML=oNode.innerHTML.replace(/\#StartTag\#/gim,"<");
sTempHTML=sTempHTML.replace(/\#EndTag\#/gim,">");

oNode.innerHTML=sTempHTML;
}


if(oNode.childNodes.length==1)
{
var oFirstChild=oNode.childNodes[0];
if(oFirstChild.nodeType==1&&(oFirstChild.tagName=="P"||oFirstChild.tagName=="DIV"))
{
if(this._isStyleSubset(oNode,oFirstChild))
{
oNode.innerHTML=oFirstChild.innerHTML;
}
}
}

if(bTrailingBRRemoved)
{
oNode.appendChild(oLastChild);
}
};







vp.widget.RichTextArea.prototype._normalizeNodeRecursive=function $vpfn_0JeWlxFA0$1WE75fqY2CpA2644$59(oNode,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsTopNode=false;



if(!oTopNode)
{
oTopNode=oNode;
bIsTopNode=true;
}

var i;
var bHasHTMLNodes=false;
var oPreviousChild=null;
var oPreviousTextNode=null;
var oChildNode=null;
var sStyle=null;



if(oNode.childNodes.length>1)
{
for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];

var bCanMerge=true;
var vLastValue=null;

for(var j=0;j<oNode.childNodes.length;j++)
{
oChildNode=oNode.childNodes[j];

if(oChildNode.nodeType!=1||oChildNode.tagName=="A")
{
bCanMerge=false;
break;
}

var vCurrentValue=this._getStyle(oChildNode,sStyle);

if(!vCurrentValue)
{
bCanMerge=false;
break;
}

if(vLastValue!==null&&vLastValue!=vCurrentValue)
{
bCanMerge=false;
break;
}

vLastValue=vCurrentValue;
}

if(bCanMerge)
{
this._setStyle(oNode,sStyle,vLastValue);
for(j=0;j<oNode.childNodes.length;j++)
{
this._setStyle(oNode.childNodes[j],sStyle,null);
}
}
}
}



for(i=0;i<oNode.childNodes.length;i++)
{
oChildNode=oNode.childNodes[i];

if(oChildNode.nodeType==1&&oChildNode.tagName!="A")
{

this._normalizeNodeRecursive(oChildNode,oTopNode);


if(oChildNode.tagName=="OL"||oChildNode.tagName=="UL")
{
if(oChildNode.childNodes.length===0)
{
if(oChildNode.removeNode)
{
oChildNode.removeNode();
}
else if(oChildNode.parentNode&&oChildNode.parentNode.nodeType==1)
{
oChildNode.parentNode.removeChild(oChildNode);
}
}
}

else if(oChildNode.tagName!="SPAN")
{
oPreviousChild=null;
bHasHTMLNodes=true;
}

else if(oChildNode.innerHTML.length===0&&oChildNode.parentNode)
{
oChildNode.parentNode.removeChild(oChildNode);
}
else
{

if(this._isNodeValidAndAttached(oPreviousChild)&&
this._isNodeValidAndAttached(oChildNode)&&
this._areStylesEqual(oChildNode,oPreviousChild))
{

var sPreviousText=oPreviousTextNode?oPreviousTextNode.nodeValue:"";

oChildNode.innerHTML=oPreviousChild.innerHTML+sPreviousText+oChildNode.innerHTML;
oPreviousChild.parentNode.removeChild(oPreviousChild);

if(oPreviousTextNode)
{
oPreviousTextNode.parentNode.removeChild(oPreviousTextNode);
}

oPreviousTextNode=null;


this._normalizeNodeRecursive(oChildNode,oTopNode);
}

oPreviousChild=oChildNode;
bHasHTMLNodes=true;
}
}
else if(oChildNode.nodeType==3)
{

if(oChildNode.nodeValue.replace(/\s/gim,"")!=="")
{
oPreviousChild=null;
oPreviousTextNode=null;
}
else
{
oPreviousTextNode=oChildNode;
}
}
else
{
oPreviousChild=null;
oPreviousTextNode=null;
}
}


if(!bHasHTMLNodes&&!bIsTopNode)
{
var oParent=oNode.parentNode;
var oChild=oNode;
while(oParent&&oParent.nodeType==1&&oChild!=oTopNode)
{


if(oChild.tagName=="SPAN"&&
vp.web.getInnerText(oChild).replace(/\*\!t/gi,"")==vp.web.getInnerText(oParent).replace(/\*\!t/gi,""))
{

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];
var sStyleValue=this._getStyle(oChild,sStyle);
if(sStyleValue!=="")
{
this._setStyle(oParent,sStyle,sStyleValue);
}
}


this._replaceNodeWithContents(oChild);
}

else if(oChild.tagName=="SPAN"&&this._isStyleSubset(oParent,oChild))
{
this._replaceNodeWithContents(oChild);
}

else
{
for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];
if(this._getCurrentStyle(oParent,sStyle,oTopNode)==this._getStyle(oChild,sStyle))
{
this._setStyle(oChild,sStyle,"");
}
}
}

oChild=oParent;
oParent=oParent.parentNode;
}
}
};






vp.widget.RichTextArea.prototype._replaceNodeWithContents=function $vpfn_NGbw5TLqfdN_SrtuNT5PfQ2852$60(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParent=oNode.parentNode;
var iLen=oNode.childNodes.length;
for(var i=0;i<iLen;i++)
{
oParent.insertBefore(oNode.childNodes[i].cloneNode(true),oNode);
}

oParent.removeChild(oNode);
oParent.normalize();
};

vp.widget.RichTextArea.prototype._isNodeValidAndAttached=function $vpfn_3F8Bpn4f93xLkPN3C573fw2865$59(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return oNode&&
oNode.parentNode&&
(oNode.parentNode.nodeType==3||oNode.parentNode.nodeType==1);
};










vp.widget.RichTextArea.prototype._getStyle=function $vpfn_lYWT0vOLOZnrUAglQczDhw2881$45(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sDisabledAttr=oNode.getAttribute(sStyle+"_disabled");


if(document.all&&!sDisabledAttr&&sStyle=="textAlign")
{
if(oNode.style.textAlign)
{
return oNode.style.textAlign;
}
else if(oNode.align)
{
return oNode.align;
}
else
{
return"";
}
}

if(sDisabledAttr)
{
return sDisabledAttr;
}
else if(oNode.style[sStyle])
{
return oNode.style[sStyle];
}
else
{
return"";
}
};










vp.widget.RichTextArea.prototype._setStyle=function $vpfn_XGvFxWuXi2UKDp1dI11$sA2925$45(oNode,sStyle,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(this.disabledStyles.indexOf(sStyle)!=-1)
{
oNode.setAttribute(sStyle+"_disabled",vValue);

if(!vValue)
{
oNode.removeAttribute(sStyle+"_disabled");
}

vp.ui.removeStyle(oNode,sStyle);
}
else
{
if(sStyle=="textAlign"&&document.all)
{
if(vValue)
{
oNode.align=vValue;
}
else
{
oNode.removeAttribute("align");
}
vp.ui.removeStyle(oNode,sStyle);
}
else
{
if(vValue)
{
oNode.style[sStyle]=vValue;
}
else
{
vp.ui.removeStyle(oNode,sStyle);
}
}


if(this.limitFontSize&&sStyle=="fontSize"&&vValue)
{
oNode.setAttribute(sStyle+"_disabled",vValue);
var iFontSize=(parseInt(vValue)*0.3)+10;
if(iFontSize>40)
{
iFontSize=40;
}
oNode.style.fontSize=iFontSize;
}
else
{
oNode.removeAttribute(sStyle+"_disabled");
}
}
};






vp.widget.RichTextArea.prototype._highlightWhiteText=function $vpfn_z2YtZqt7rctMNa13291zSQ2988$55(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sColor=vp.ui.getCurrentStyle(oNode,"color");
if(!sColor)
{
return;
}


var oColor=new vp.color.Color(sColor);


if(oColor.getBrightness()>235)
{
oNode.style.backgroundColor="#666";
}
else
{
oNode.style.backgroundColor="#FFF";
}
};







vp.widget.RichTextArea.prototype._removeStyleRecursive=function $vpfn_PelxTPXZjtwPK3CY$m6m4Q3016$57(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{
this._setStyle(oNode,sStyle,"");

var oChildren=oNode.childNodes;
var iLen=oChildren.length;
for(var i=0;i<iLen;i++)
{
this._removeStyleRecursive(oChildren[i],sStyle);
}
}
};









vp.widget.RichTextArea.prototype._isStyleSubset=function $vpfn__Z_KarZBsxdwiHizT2PTRg3039$50(oNode1,oNode2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=this.SUPPORTED_STYLES.length;
for(var i=0;i<iLen;i++)
{
if(this._getStyle(oNode2,this.SUPPORTED_STYLES[i])!==""&&this._getStyle(oNode1,this.SUPPORTED_STYLES[i])!==this._getStyle(oNode2,this.SUPPORTED_STYLES[i]))
{
return false;
}
}

return true;
};








vp.widget.RichTextArea.prototype._areStylesEqual=function $vpfn_KmyW1CPH_gwycpJghMagkg3060$51(oNode1,oNode2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=this.SUPPORTED_STYLES.length;
for(var i=0;i<iLen;i++)
{
if(this._getStyle(oNode1,this.SUPPORTED_STYLES[i])!=this._getStyle(oNode2,this.SUPPORTED_STYLES[i]))
{
return false;
}
}

return true;
};









vp.widget.RichTextArea.prototype._getCurrentStyle=function $vpfn_jRxb8BJiLXlHt0Wcjro1oQ3082$52(oNode,sStyle,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var vRet=null;


var oParent=oNode;
while(oParent&&oParent.nodeType==1&&oParent!=oTopNode.parentNode)
{
var sValue=this._getStyle(oParent,sStyle);
if(sValue!=="")
{
vRet=sValue;
break;
}
oParent=oParent.parentNode;
}


if(!vRet)
{
vRet=this.style[sStyle];
}


if(!vRet)
{
if(sStyle=="textAlign")
{
vRet="left";
}
else if(sStyle=="fontWeight")
{
vRet="normal";
}
else if(sStyle=="fontStyle")
{
vRet="normal";
}
else if(sStyle=="color")
{
vRet="#000000";
}
}


if(sStyle=="fontWeight")
{
if(vRet==400)
{
vRet="normal";
}
else if(vRet==700)
{
vRet="bold";
}
}

return vRet;
};








vp.widget.RichTextArea.prototype._isRangeEqual=function $vpfn_bMW$bN6H0Rt8Uo7twd1M$w3149$49(oRange1,oRange2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oRange1===null^oRange2===null)
{
return false;
}
else if(oRange1===null&&oRange2===null)
{
return true;
}

if(oRange1.compareBoundaryPoints)
{
var START_TO_END=1;
try
{
return oRange1.compareBoundaryPoints(START_TO_END,oRange2)===0;
}
catch(ex)
{

return false;
}
}
else if(oRange1.isEqual)
{
return oRange1.isEqual(oRange2);
}
};








vp.widget.RichTextArea.prototype._isUnselectable=function $vpfn_hRj10SdGl_weAitQBpiG4g3186$51(oElem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oElem.nodeType==1&&vp.core.getAttribute(oElem,"unselectable","").toLowerCase()=="on")
{
return true;
}
else if(oElem.nodeType==1&&oElem.tagName!="BODY")
{
return this._isUnselectable(oElem.parentNode);
}
else
{
return false;
}
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.widget)
{
vp.widget=function(){};
}








vp.widget.RichTextArea2=function $vpfn_k9M5bJByEBfFmdKRQAc6zQ22$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;


var _oElementStyle={};


var _bIsRendered=false;


var _sValue="";


var _sOuputValue="";


var _iCachedSelectionOffsetStart=null;


var _iPollTimer=null;


var _iKeyTimer=null;


var m_oLastSelectedRange=null;


var _oEditableElement;



var _bSuspendPolling=false;


var KEYDOWN_TIMER_INTERVAL=350;



var _oCachedSelectionNode=null;


var _oColorMap={};





this.editableElement=null;





this.attributes={};





this.maxWidth=400;





this.minWidth=200;





this.maxHeight=200;





this.minHeight=13;





this.style={
fontWeight:"normal",
fontStyle:"normal",
color:"#000000",
fontSize:16,
fontFamily:"Arial"
};





this.onfocus=new vp.events.CustomEvent(this,"onfocus");





this.onblur=new vp.events.CustomEvent(this,"onblur");





this.onchange=new vp.events.CustomEvent(this,"onchange");





this.onkeydown=new vp.events.CustomEvent(this,"onkeydown");





this.onkeyup=new vp.events.CustomEvent(this,"onkeyup");





this.onselectionchange=new vp.events.CustomEvent(this,"onselectionchange");





this.ondelaychange=new vp.events.CustomEvent(this,"ondelaychange");

this.oninitialrender=new vp.events.CustomEvent(this,"oninitialrender");

this.isFocused=false;

this.resizeManually=false;





var startUpdateTimer=function $vpfn_N8AImfyLOzQY2gi5p9tOEw167$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iKeyTimer)
{
clearTimeout(_iKeyTimer);
}

_iKeyTimer=setTimeout(fireDelayChanged,KEYDOWN_TIMER_INTERVAL);
};







var storeColor=function $vpfn_c0jTlIeqkU8DJJVfGhrkng183$21(vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var sRgbHex=vValue.toHex();

_oColorMap[sRgbHex]=vValue;

return sRgbHex;
};







var fetchColor=function $vpfn_CO5lk7cqQ5l0gKQFHBLw2Q199$21(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oRgbColor=new vp.color.Color(sValue);

return _oColorMap[oRgbColor.toHex()];
};









var serializeStyleValue=function $vpfn_WvlMCwhExwoJq1NRpgnoWQ215$30(sProp,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sProp=="color"&&vValue)
{

return storeColor(vValue);
}
else
{

return vValue.toString();
}
};









var deserializeStyleValue=function $vpfn_AGL5LwPEq7nkaxJ96vioUw237$32(sProp,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sProp=="color"&&sValue)
{

return fetchColor(sValue);
}
else if(sProp=="fontSize"&&sValue)
{

return parseInt(sValue);
}
else
{

return sValue;
}
};

var normalizeParagraphTags=function $vpfn_FNawPxpVU23ubjsU78jGxw256$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.browser.isIE)
{
me._convertDivsToParagraphs(_oEditableElement);
}
else
{
me._convertParagraphsToDivs(_oEditableElement);
}
};






this.setElementStyle=function $vpfn_PIG7WR6C$RL9QuKtdP7egg273$27(sStyle,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_oElementStyle[sStyle]=sValue;
if(me.element)
{
me.element.style[sStyle]=sValue;
}
};





this.disabledStyles=[];





this.disabledFeatures=[];






this.limitFontSize=true;






var disableStyles=function $vpfn_HlKUTguGeDn5Ecyl7E_vjQ306$24(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oNode)
{
oNode=_oEditableElement;
}
var i;

for(i=0;i<me.disabledStyles.length;i++)
{
if(oNode.style[me.disabledStyles[i]]!=="")
{
me._setStyle(oNode,me.disabledStyles[i],oNode.style[me.disabledStyles[i]]);
}
}

if(oNode.style["fontSize"])
{
me._setStyle(oNode,"fontSize",me._getStyle(oNode,"fontSize"));
}

if(me.disabledStyles.indexOf("color")==-1)
{
vp.widget.RichTextArea2.prototype._highlightWhiteText(oNode);
}

for(i=0;i<oNode.childNodes.length;i++)
{
var oChild=oNode.childNodes[i];
if(oChild.nodeType==1)
{
disableStyles(oChild);
}
}
};





this.render=function $vpfn_60oGEkh$hzVV4F86nv259g346$18(oParent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bIsRendered)
{
return;
}

me.element=vp.web.getOwnerDocument(oParent).createElement("DIV");
me.element.style.border="1px black solid";
me.element.style.width=me.minWidth+"px";
me.element.style.height="20px";
me.element.style.overflow="auto";

var sProp;

for(sProp in me.attributes)
{
me.element[sProp]=me.attributes[sProp];
}

oParent.appendChild(me.element);

_oEditableElement=me.element.ownerDocument.createElement("DIV");
_oEditableElement.contentEditable=true;

me.element.appendChild(_oEditableElement);
me.editableElement=_oEditableElement;
vp.events.add(_oEditableElement,"keyup",onKeyUpHandler);
vp.events.add(_oEditableElement,"keypress",onKeyPressHandler);
vp.events.add(_oEditableElement,"keydown",onKeyDownHandler);
vp.events.add(_oEditableElement,"focus",onFocusHandler);
vp.events.add(_oEditableElement,"mouseup",fireSelectionChanged);


vp.events.add(me.element,"focus",fnElementFocus);


vp.ui.addClass(_oEditableElement,"richTextFieldIE");

vp.events.add(me.element,"click",normalizeClickOutsideEditableElement);

var bWasRendered=_bIsRendered;

_bIsRendered=true;


for(sProp in me.style)
{
me._setStyle(_oEditableElement,sProp,me.style[sProp]);
}


for(sProp in _oElementStyle)
{
me.setElementStyle(sProp,_oElementStyle[sProp]);
}

_oEditableElement.innerHTML=_sValue;

me.normalize();

_sValue=_oEditableElement.innerHTML;

if(_bFocusOnRender)
{
me.focus();
}

if(!bWasRendered)
{
setTimeout(me.oninitialrender.fire,0);
}
$(_oEditableElement).css("outline","0px none");
};

var fnElementFocus=function $vpfn_TYwi_AXDX7LW0cbRkIkHsQ421$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.focus();
};

var normalizeClickOutsideEditableElement=function $vpfn_NcUxmsUqhTwAAHs3bN49xw426$47(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);





if(e.target==me.element)
{
me.focus();
vp.events.cancelEvent(e);
}
};







var onDocumentMouseDownHandler=function $vpfn_0MMKP_EtUi2C6N1DA86Ong447$37(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.isFocused)
{
return;
}


if(e)
{
e=vp.events.getEvent(e);

var oTarget=e.target;

if(oTarget)
{
if(oTarget==me.element||vp.ui.isChildOf(oTarget,me.element))
{
return;
}


if(me._isUnselectable(oTarget))
{
return;
}
}
}


try
{
if(vp.browser.isIE)
{
document.selection.empty();
}
else
{
window.getSelection().removeAllRanges();
}
}
catch(ex){}

fnRemoveMailtoAnchors();


vp.events.remove(document,"mousedown",onDocumentMouseDownHandler);


if(_iPollTimer)
{
clearInterval(_iPollTimer);
_iPollTimer=null;
}

fireSelectionChanged();

me.isFocused=false;
me.onblur.fire();
};




this.blur=function $vpfn_Iqrwj6xqyTqF8Fo50NMeyg512$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
onDocumentMouseDownHandler();
};





var onFocusHandler=function $vpfn_0fLlNQNRybSDOr6PkLQv2A521$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isFocused)
{
return;
}

me.isFocused=true;


if(_iPollTimer)
{
clearInterval(_iPollTimer);
}
_iPollTimer=setInterval(checkForChanges,300);


vp.events.add(document,"mousedown",onDocumentMouseDownHandler);

me.onfocus.fire();
};

var OnBlurHandler=function $vpfn_m2utNNYGUamAKb1hzur0Jw543$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isFocused=false;
me.onblur.fire();
};


var _bFocusOnRender=false;




this.focus=function $vpfn_Tq3YUEDT_5UdyZafx7I8sQ555$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bIsRendered)
{
_oEditableElement.focus();






var oRange;

if(document.all)
{
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
oRange.collapse(false);
oRange.select();

setTimeout(function $vpfn_aVIvxN8W9xMmD4WBa8qBcA575$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.element.scrollTop=0;},10);
}
else
{
oRange=document.createRange();
oRange.selectNodeContents(_oEditableElement);
oRange.collapse(false);
var oSelection=window.getSelection();
if(oSelection)
{
oSelection.removeAllRanges();
oSelection.addRange(oRange);
}
}
}
else
{
_bFocusOnRender=true;
}
};






var onKeyUpHandler=function $vpfn_rwqZiKo4XhHrpt3uyXZ_sQ601$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);


if(e.ctrlKey&&e.keyCode==86)
{
cleanUnsanctionedTags();
}
else
{


switch(e.keyCode)
{
case 13:
case 8:
case 46:
fnRemoveMailtoAnchors();
labelSanctionedTags();
break;
case 32:
fnRemoveMailtoAnchors();
break;
default:
break;
}



if(e.altKey)
{



var altKeyHack=function $vpfn_eQeZRNTzrmhzH3joB7EFmw636$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
checkForChanges(true);
};

setTimeout(altKeyHack,500);
}
else
{
checkForChanges(true);
me.onkeyup.fire(e);
}
}

_bSuspendPolling=false;
};





var onKeyPressHandler=function $vpfn_TH7QDSpMOaMU_Wsadv6DCA657$28(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bSuspendPolling=true;
};





var onKeyDownHandler=function $vpfn_snomzKAXsWCHY7lhx6AHJw666$27(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);


if(e.ctrlKey&&!e.altKey)
{
switch(e.keyCode)
{
case 66:
me.toggleStyle("fontWeight");
vp.events.cancel(e);
break;
case 73:
me.toggleStyle("fontStyle");
vp.events.cancel(e);
break;
case 90:
if(me.isHistoryDisabled)
{
vp.events.cancelEvent(e);
}
else
{
undo();
vp.events.cancel(e);
}
break;
case 89:
if(me.isHistoryDisabled)
{
vp.events.cancelEvent(e);
}
else
{
redo();
vp.events.cancel(e);
}
break;

case 67:
case 86:
case 88:
case 37:
case 38:
case 39:
case 40:
setTimeout(fireSelectionChanged,10);
vp.events.cancelBubble(e);
break;
case 65:
vp.events.cancelBubble(e);
break;
case 75:
case 85:
vp.events.cancelEvent(e);
break;

default:
if(!document.all)
{
vp.events.fireEvent(document,"keydown",e);
}
break;
}
}
else if(e.keyCode==46)
{
vp.events.cancelBubble(e);
}
else if(e.keyCode>=37&&e.keyCode<=40)
{
setTimeout(fireSelectionChanged,10);
vp.events.cancelBubble(e);
}
else if(e.keyCode==9)
{
checkForChanges(true);
me.blur();
}
else if(e.keyCode==32)
{
fnRemoveMailtoAnchors();
}

me.onkeydown.fire(e);
};






var labelSanctionedTags=function $vpfn_go5T_tnKNYI2yIfAFZOarA759$30(oElem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oElem)
{
oElem=_oEditableElement;
}

var iLen=oElem.childNodes.length;
for(var i=0;i<iLen;i++)
{
var oChild=oElem.childNodes[i];
if(oChild.nodeType==1)
{
if(oChild.getAttribute(me.SANCTIONED_TAG_ATTRIBUTE)!="1")
{
if(me.SANCTIONED_TAGS.contains(oChild.tagName))
{
oChild.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");
}
}

labelSanctionedTags(oChild);
}
}
};







var cleanUnsanctionedTags=function $vpfn_$XGZpRNk$iiiBuXRViYk5Q791$32(oElem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oElem)
{
oElem=_oEditableElement;

if(document.all)
{
var sHTML=oElem.innerHTML;


if(sHTML.indexOf("<FONT")!=-1)
{
sHTML=sHTML.replace(/\<FONT[^\>]*?\>/gi,"");
sHTML=sHTML.replace(/\<\/FONT\>/gi,"");
oElem.innerHTML=sHTML;
}
}
}




var ownerDocument=null;

for(var i=0;i<oElem.childNodes.length;i++)
{
var oChild=oElem.childNodes[i];
if(oChild.nodeType==8)
{

ownerDocument=vp.web.getOwnerDocument(oChild);
var oCommentNode=ownerDocument.createTextNode("");
oChild.parentNode.replaceChild(oCommentNode,oChild);
}
else if(oChild.nodeType==1)
{
if(oChild.getAttribute(me.SANCTIONED_TAG_ATTRIBUTE)!="1")
{



ownerDocument=vp.web.getOwnerDocument(oChild);

if(oChild.tagName=="P"&&oChild.parentNode==_oEditableElement)
{
var oNewP=ownerDocument.createElement(document.all?"P":"DIV");
oNewP.innerHTML=vp.web.htmlEncode(getCleanedInnerText(oChild));
oNewP.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");
oChild.parentNode.replaceChild(oNewP,oChild);
}
else
{
var oNewTextNode=ownerDocument.createTextNode(getCleanedInnerText(oChild));
oChild.parentNode.replaceChild(oNewTextNode,oChild);
}
}
else
{
cleanUnsanctionedTags(oChild);
}
}
}
};






var getCleanedInnerText=function $vpfn_AZuvpNrYpLfygUpOwci3rw861$30(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sText=oNode.innerHTML;

sText=sText.replace(/\<[^>]*?\>/gi," ");
sText=sText.replace(/\s/gi," ");
sText=sText.replace(/\s{2,}/gi," ");
sText=sText.replace(/&nbsp;/gi," ");

return sText;
};

var addMozillaSpacer=function $vpfn_FnQz$lDm_mZSrH2j3KKHLw873$27(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!document.all&&oNode.innerHTML.length===0)
{
oNode.innerHTML=me.EMPTY_MOZ_SPACER;
}
};

var removeMozillaSpacer=function $vpfn_4GPMC7MOP2Q0uhl_Y_0VhA882$30(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!document.all)
{
if(oNode.childNodes.length!=1)
{
var oSpacer;

var aBR=oNode.getElementsByTagName("BR");
var iLen=aBR.length;
for(var i=0;i<iLen;i++)
{
if(aBR[i].getAttribute("mozspacer")=="1")
{
oSpacer=aBR[i];
break;
}
}

if(oSpacer)
{
oSpacer.parentNode.removeChild(oSpacer);
}
}
}
};






var checkForChanges=function $vpfn_QRk59eY9Z72WUW0r8MqRDA914$26(bIsKeyEvent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.actionInProgress)
{
return;
}

if(_bSuspendPolling&&!bIsKeyEvent)
{
return;
}

if(hasInnerHTMLChanged())
{
removeMozillaSpacer(_oEditableElement);

if(!bIsKeyEvent)
{
cleanUnsanctionedTags();
}

setChanged();
}



if(!bIsKeyEvent)
{
var oRange=getSelectedRange();
if(!me._isRangeEqual(oRange,m_oLastSelectedRange))
{
startSelectionChangeTimer();
m_oLastSelectedRange=oRange;
};
}
};

var _iSelectionChangeTimer=null;

var startSelectionChangeTimer=function $vpfn_N9Lkjva3f2LezQuhcyci7A953$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iSelectionChangeTimer)
{
clearTimeout(_iSelectionChangeTimer);
}

_iSelectionChangeTimer=setTimeout(fireSelectionChanged,500);
};

var fireSelectionChanged=function $vpfn_AagzhXKa9PiHNvAVhYK_sA963$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_oCachedSelectionNode=null;
me.onselectionchange.fire();
};





this.disableHistory=function $vpfn_O8RmVf11XJ9I6vPLK9qVfw973$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isHistoryDisabled=true;
clearUndoStack();
};

var _aUndoStack=[];
var _iCurrentUndoIndex=-1;

var clearUndoStack=function $vpfn_2Yk0WGbBZQz5CER1Hr0qMA982$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_aUndoStack=[];
_iCurrentUndoIndex=-1;
};

var updateFromUndoStack=function $vpfn_fR9ovYxK5G0U$pnWUFimjQ988$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isHistoryDisabled=true;


me.setValue(_aUndoStack[_iCurrentUndoIndex].innerXML);


var oStyle=_aUndoStack[_iCurrentUndoIndex].style;
for(var sStyle in oStyle)
{
var sStyleValue=oStyle[sStyle];

me.style[sStyle]=sStyleValue;
me._setStyle(_oEditableElement,sStyle,sStyleValue);
}

me.isHistoryDisabled=false;

me.onchange.fire();
me.ondelaychange.fire();
fireSelectionChanged();
};

var undo=function $vpfn_VcCrbMkdXEDnzXBUY1jjPg1012$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iCurrentUndoIndex>0)
{
_iCurrentUndoIndex--;
updateFromUndoStack();
}
};

var redo=function $vpfn_qH62lHR$XpZaAU_IJF1a5A1021$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_aUndoStack.length>_iCurrentUndoIndex+1)
{
_iCurrentUndoIndex++;
updateFromUndoStack();
}
};

var addToHistory=function $vpfn_iRfeC4j7evc_X6E7i0VIiA1030$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isHistoryDisabled)
{

var oStyle={};
for(var i=0;i<me.SUPPORTED_STYLES.length;i++)
{
var sStyle=me.SUPPORTED_STYLES[i];
var sStyleValue;
if(_oEditableElement)
{
sStyleValue=me._getStyle(_oEditableElement,sStyle);
}
else
{
sStyleValue=me.style[sStyle];
}
oStyle[sStyle]=sStyleValue;
}


_iCurrentUndoIndex++;
_aUndoStack[_iCurrentUndoIndex]={
"innerXML":_sValue,
"style":oStyle
};

_aUndoStack=_aUndoStack.slice(0,_iCurrentUndoIndex+1);
}
};

var fireDelayChanged=function $vpfn_7TgMrFS61oGdGqyQSw_Q4Q1062$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.actionInProgress)
{
return;
}

if(me.isFocused)
{
me.cacheSelection();
}



disableStyles();

if(me.isFocused)
{
me.restoreSelection();
}


for(var i=0;i<me.SUPPORTED_STYLES.length;i++)
{
var sStyle=me.SUPPORTED_STYLES[i];
me.style[sStyle]=me._getStyle(_oEditableElement,sStyle);
}

addToHistory();
me.ondelaychange.fire();
};








var setChanged=function $vpfn_XGwgHbbR11RorbRRIYSpHw1101$21(bForceDelayChange,bSuppressEvents)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

_sOuputValue=null;

_oCachedSelectionNode=null;


_sValue=_oEditableElement.innerHTML;


if(!me.resizeManually)
{
updateSize();
}

bSuppressEvents=bSuppressEvents?true:false;
if(!bSuppressEvents)
{
if(bForceDelayChange)
{

fireDelayChanged();
}
else
{

startUpdateTimer();
}

me.onchange.fire();
}
};





var hasInnerHTMLChanged=function $vpfn_tgPaWVGkzkg2$qqt1A3nmQ1139$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _oEditableElement.innerHTML!=_sValue;
};




var updateSize=function $vpfn_sd42i1De4z5646jL0SsDkA1147$21(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.resizeManually)
{
var currentWidth=me.element.scrollWidth;


if(me.maxWidth!=me.minWidth)
{

if(currentWidth>me.minWidth)
{
me.element.style.width=me.maxWidth+"px";
}
else
{
me.element.style.width=me.minWidth+"px";
}
}


if(!vp.browser.isIE&&_oEditableElement.offsetHeight===0)
{
addMozillaSpacer(_oEditableElement);
}


if(me.element.scrollHeight>me.maxHeight)
{
me.element.style.height=(me.maxHeight)+"px";




_oEditableElement.style.width=$(me.element).width()-18+"px";
}
else if(me.element.scrollHeight<me.minHeight)
{
me.element.style.height=(me.minHeight)+"px";
}
else
{
_oEditableElement.style.width="100%";

if(currentWidth>me.element.offsetWidth)
{
me.element.style.height=_oEditableElement.scrollHeight+24+"px";
}
else
{
me.element.style.height=Math.max(me.minHeight,(_oEditableElement.offsetHeight+4))+"px";
}
}
}

if(fnCallback)
{
fnCallback();
}
};




this.setSize=function $vpfn_aNtfP7$c2Odt_Npg8HbSuw1211$19(iWidth,iHeight)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element.style.width=(iWidth+2)+"px";
me.element.style.height=(iHeight+2)+"px";

me.setAutoScroll();

};

this.setSizeAuto=function $vpfn_blrSaBFY$hSiKpGWfrpFhQ1220$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element.style.width="100%";
me.element.style.height="10px";
};

this.setAutoScroll=function $vpfn_FD$E5Z2J8CRhRabFhBhmhg1226$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element.style.overflowY="auto";
me.element.style.overflowX="auto";
};




this.refresh=function $vpfn_IfS9UQCidgyV$6Ge7yLWFg1235$19(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
updateSize(fnCallback);
};

var parseIntOrDefault=function $vpfn_3AkkcDsREJL0n7rQKrdQtA1240$28(vVal,iDefault)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iDefault)=="undefined")
{
iDefault=0;
}

var iVal=iDefault;
if(vVal!==null)
{
iVal=parseInt(vVal);
if(isNaN(iVal))
{
iVal=iDefault;
}
}

return iVal;
};





var isCollapsed=function $vpfn_YvUpyy$cZtBzA9f5u4qu8A1264$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();
if(!oRange)
{
return false;
}

if(typeof(oRange.collapsed)=="undefined")
{
return oRange.text.length===0;
}

return oRange.collapsed;
};





var getSelectedRange=function $vpfn_BoiofnHqUb009Q8Esc$tmQ1284$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered)
{
return null;
}

var oRange;

if(!me.isFocused)
{
if(document.all)
{
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
}
else
{
oRange=document.createRange();
oRange.selectNodeContents(_oEditableElement);
}
}

else
{
if(document.all)
{
oRange=document.selection.createRange();

if(!vp.ui.isChildOf(oRange,_oEditableElement))
{
oRange=document.body.createTextRange();
oRange.moveToElementText(_oEditableElement);
oRange.collapse(true);
}
}
else
{
var oSelection=window.getSelection();
if(oSelection&&oSelection.rangeCount>0)
{
oRange=window.getSelection().getRangeAt(0);
}
else
{
return null;
}
}
}

return oRange;
};






this.getSelectionStyle=function $vpfn_SgVtJSjWRGRC0pU_8w7IFw1342$29(sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered)
{

return deserializeStyleValue(sStyle,me.style[sStyle]);
}

var sListTag=null;
if(sStyle=="orderedList")
{
sListTag="OL";
}
else if(sStyle=="unorderedList")
{
sListTag="UL";
}

var oTarget=getSelectedRange();

if(oTarget&&me.isSelected())
{
if(!_oCachedSelectionNode)
{

_oCachedSelectionNode=document.createElement("SPAN");
var oParent;

if(document.all)
{
oParent=oTarget.parentElement();
_oCachedSelectionNode.innerHTML=oTarget.htmlText;
}
else
{
oParent=oTarget.commonAncestorContainer;

if(oParent.nodeType!=1)
{
oParent=oParent.parentNode;
}
var docFragment=oTarget.cloneContents();
_oCachedSelectionNode.appendChild(docFragment);
}

for(var sProp in me.style)
{
_oCachedSelectionNode.style[sProp]=me._getCurrentStyle(oParent,sProp,_oEditableElement);
}

me._normalizeNode(_oCachedSelectionNode);
}

if(sListTag)
{
var bIsCopy=false;
var oParentTemp=oParent;

var aItems=_oCachedSelectionNode.getElementsByTagName("LI");
if(aItems.length>=1)
{
bIsCopy=true;
oParentTemp=aItems[0];
}

while(oParentTemp&&oParentTemp!=_oEditableElement)
{
if(oParentTemp.tagName==sListTag)
{
return true;
}
oParentTemp=oParentTemp.parentNode;
if(!oParentTemp&&bIsCopy)
{
oParentTemp=oParent;
}
}
return false;
}
else
{
var sStyleValue=getStyleRecursive(_oCachedSelectionNode,sStyle);
return deserializeStyleValue(sStyle,sStyleValue);
}
}

else
{
if(sListTag)
{
return _oEditableElement.innerHTML.indexOf("<"+sListTag+">")!=-1;
}
else
{
return me.getStyle(sStyle);
}
}

};


var getStyleRecursive=function $vpfn_NlLibNPUq278VY5Vq0nmsA1443$28(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var vVal=me._getCurrentStyle(oNode,sStyle,_oEditableElement);

var iLen=oNode.childNodes.length;
for(var i=0;i<iLen;i++)
{
var oChild=oNode.childNodes[i];
if(oChild.nodeType==1&&vp.web.getInnerText(oChild).trim().length>0)
{
var vChildVal=getStyleRecursive(oChild,sStyle);
if(!vChildVal||vChildVal!=vVal)
{
if(vp.web.getInnerText(oChild).trim()==vp.web.getInnerText(oNode).trim())
{
vVal=vChildVal;
}
else
{
return null;
}
}
}
}

return vVal;
};


this.isSelected=function $vpfn_ZPN9U4QQvucFVucad10HaQ1472$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsRendered)
{
return false;
}

return me.isFocused;
};






var getSelectionTokenName=function $vpfn_qZ00_$pIiqmjAl924L$S$g1487$32(bStart)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(bStart?"start":"end")+"_token_"+me.element.id;
};






var insertTokenInRange=function $vpfn_64DELq4Z67q7Xm7Lez4P$A1497$29(bStart,oRange)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sTokenName=getSelectionTokenName(bStart);


var oOldToken=document.getElementById(sTokenName);
while(oOldToken)
{
if(oOldToken.parentNode)
{
oOldToken.parentNode.removeChild(oOldToken);
}
oOldToken.id="";
oOldToken=document.getElementById(sTokenName);
}

var oToken=document.createElement("A");
oToken.id=sTokenName;
oToken.style.display="none";
oToken.innerHTML="*!t";

oToken.setAttribute("isToken",true);

oToken.setAttribute(me.SANCTIONED_TAG_ATTRIBUTE,"1");


var oClonedRange=document.all?oRange.duplicate():oRange.cloneRange();
oClonedRange.collapse(bStart);


if(document.all)
{


var sTokenHTML=oToken.outerHTML;
var oParent=oClonedRange.parentElement();
if(oParent.tagName=="P"&&oParent.innerHTML.length===0)
{
sTokenHTML+="&nbsp;";
}
oClonedRange.pasteHTML(sTokenHTML);
}
else
{
oClonedRange.insertNode(oToken);
}
var oMyToken=document.getElementById(sTokenName);
};





this.createBookmark=function $vpfn_eKkSPySNVszdi7qjAL835Q1550$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();
var oBookmark=null;

if(oRange)
{
oBookmark=new vp.text.Range(oRange);
}

return oBookmark;
};





this.restoreFromBookmark=function $vpfn_i67icP_J_c9SAdnUqi9FIA1567$31(oBookmark)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oBookmark)
{
oBookmark.select();
}
};




this.cacheSelection=function $vpfn_76A_hjdjCOst2Tw5BqT3FA1578$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();
if(oRange)
{
var sSelectedText=document.all?oRange.text:oRange.toString();


if(sSelectedText!=="")
{
insertTokenInRange(false,oRange);
}


insertTokenInRange(true,oRange);
}



if(document.all||sSelectedText!=="")
{
me.restoreSelection(true);
}
};





this.restoreSelection=function $vpfn_gCXRKyAoXnzXq9LEH5$jGg1607$28(bPreserveTokens)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i;
var oDoc=document;

var oStartToken=oDoc.getElementById(getSelectionTokenName(true));

if(!oStartToken)
{

return;
}



var oRange=document.all?document.body.createTextRange():oDoc.createRange();
document.all?
oRange.moveToElementText(oStartToken):
oRange.selectNode(oStartToken);

oRange.collapse(false);


if(!bPreserveTokens)
{
oStartToken.id="";
oStartToken.parentNode.removeChild(oStartToken);
}


var oEndToken=oDoc.getElementById(getSelectionTokenName(false));

if(oEndToken)
{

var oEndRange=document.all?document.body.createTextRange():oDoc.createRange();
document.all?
oEndRange.moveToElementText(oEndToken):
oEndRange.selectNode(oEndToken);
oEndRange.collapse(true);



if(document.all)
{
oRange.setEndPoint("EndToStart",oEndRange);
}
else
{
oRange.setEnd(oEndRange.startContainer,oEndRange.startOffset);
}


if(!bPreserveTokens)
{
oEndToken.id="";
oEndToken.parentNode.removeChild(oEndToken);
}
}

if(me.isFocused)
{

if(document.all)
{
oRange.select();

fnRemoveMailtoAnchors();
}
else
{
var oSelection=window.getSelection();

if(oSelection)
{
oSelection.removeAllRanges();
oSelection.addRange(oRange);
}
}
}
};

var fnRemoveMailtoAnchors=function $vpfn_5xEfjMp5Ll$UwIptmyWLWA1689$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!document.all)
{
return;
}

if(_oEditableElement.innerText.indexOf(".")==-1)
{
return;
}



var aElements=_oEditableElement.getElementsByTagName("A");
for(var i=0;i<aElements.length;i++)
{
var isToken=aElements[i].getAttribute("isToken");
if(!isToken)
{
aElements[i].outerHTML=aElements[i].innerHTML;






i--;
}
}
};









var replacePlaceholderWithStyle=function $vpfn_fT6phQUorxD2RCSX0QWvlw1729$38(oNode,sStyle,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{
var bDoRecurse=true;



if((document.all&&oNode.tagName=="STRIKE")||
(!document.all&&oNode.style.textDecoration=="line-through"))
{

if(oNode.tagName=="STRIKE")
{
var oSpan=vp.web.getOwnerDocument(oNode).createElement("SPAN");

while(oNode.childNodes.length>0)
{
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oSpan.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oSpan,oNode);

oNode=oSpan;
}
else
{
vp.ui.removeStyle(oNode,"textDecoration");
}

me._removeStyleRecursive(oNode,sStyle);
me._setStyle(oNode,sStyle,vValue);

bDoRecurse=false;
}

if(bDoRecurse)
{
var oChildNodes=oNode.childNodes;
var iLen=oChildNodes.length;

for(var i=0;i<iLen;i++)
{
replacePlaceholderWithStyle(oChildNodes[i],sStyle,vValue);
}
}
}
};





this.pasteInto=function $vpfn_MGd35v_3CFaAB9SpsvI1tg1782$21(sText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRange=getSelectedRange();
if(document.all)
{
oRange.pasteHTML(sText);
}
else
{
var TOKEN="p4978x43";
var oTextNode=document.createElement("SPAN");
oTextNode.innerHTML=sText+TOKEN;

oRange.deleteContents();
oRange.insertNode(oTextNode);

window.find(TOKEN);

oRange=getSelectedRange();
oRange.deleteContents();

}
};





this.toggleStyle=function $vpfn_co0ExxUMfa0WFwPNglO$ng1810$23(sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sCurrentValue=me.getStyle(sStyle);
var sNewValue=null;

if(sStyle=="fontWeight")
{
sNewValue=sCurrentValue=="bold"?"normal":"bold";
}
else if(sStyle=="fontStyle")
{
sNewValue=sCurrentValue=="italic"?"normal":"italic";
}

me.setStyle(sStyle,sNewValue);
};







this.setStyle=function $vpfn_SHMjMrcLoBmNXWkKYvDHIw1833$20(sStyle,vStyleValue,bWholeField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.actionInProgress=true;

if(!bWholeField&&isCollapsed())
{
bWholeField=true;
}

try
{
var bDoNormalize=sStyle.indexOf("List")==-1&&sStyle!="textAlign";
var oRange=getSelectedRange();


if(_bIsRendered&&me.isSelected()&&oRange!==null&&!bWholeField)
{

var sStyleValue=serializeStyleValue(sStyle,vStyleValue);


if(bDoNormalize)
{
me.cacheSelection();
}

var oTarget=document;




if(bDoNormalize)
{
oTarget.execCommand("StrikeThrough",false,true);
replacePlaceholderWithStyle(_oEditableElement,sStyle,sStyleValue);
}
else
{
try
{



var oCommand=me._getCommandFromStyle(sStyle,sStyleValue);

if(vp.browser.isFirefox&&me.resizeManually&&
(oRange.startContainer==_oEditableElement.childNodes[0]||
vp.ui.isChildOf(oRange.startContainer,_oEditableElement.childNodes[0])))
{

wrapSelectionAndApplyCommand(oCommand);
}
else
{
oTarget.execCommand(oCommand.id,false,sStyleValue);
}
}
catch(ex)
{
if(vp.browser.isFirefox&&ex&&ex.result==2147500037)
{


wrapSelectionAndApplyCommand(oCommand);
}
else if(ex.message.indexOf("nsIDOMNSHTMLDocument.execCommand")==-1)
{
throw ex;
}
}
}



if(bDoNormalize)
{
me._normalizeNode(_oEditableElement);
me.restoreSelection();
}


labelSanctionedTags();



me.style[sStyle]=me._getStyle(_oEditableElement,sStyle);
}

else
{

if(_bIsRendered)
{
me._removeStyleRecursive(_oEditableElement,sStyle);
}


me.setStyleSimple(sStyle,vStyleValue);
}

if(_bIsRendered)
{
disableStyles();

me.actionInProgress=false;


setChanged(true);
}
}
finally
{
me.actionInProgress=false;
}
};

var wrapSelectionAndApplyCommand=function $vpfn_UYik0aQleC1K9q5c8a6EVw1949$39(oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var dummy=document.createElement('div');
dummy.style.height="1px;";


var ceNode=getSelectedRange().startContainer.parentNode;
while(ceNode&&ceNode.contentEditable!='true')
{
ceNode=ceNode.parentNode;
}

if(!ceNode)
{
throw'Selected node is not editable!';
}

ceNode.insertBefore(dummy,ceNode.childNodes[0]);
document.execCommand(oCommand.id,false,null);
dummy.parentNode.removeChild(dummy);
};





this.setStyleSimple=function $vpfn_0Zn1a2mMBtfB1eM72cIfNQ1976$26(sStyle,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue=serializeStyleValue(sStyle,vValue);

me.style[sStyle]=sStyleValue;

if(_bIsRendered)
{
me._setStyle(_oEditableElement,sStyle,sStyleValue);
}
};







this.getStyle=function $vpfn_531Q2mztJZDvc15m_gn8Sw1994$20(sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue;
if(sStyle.indexOf("List")===-1)
{
if(_bIsRendered&&_oEditableElement)
{
sStyleValue=getStyleRecursive(_oEditableElement,sStyle);
}
else
{
sStyleValue=me.style[sStyle];
}
}
else
{
var sHTML=_oEditableElement?_oEditableElement.innerHTML:_sValue;
var sListTag=sStyle==="unorderedList"?"<UL":"<OL";
sStyleValue=sHTML.substr(0,3).toUpperCase()===sListTag;
}
return deserializeStyleValue(sStyle,sStyleValue);
};






this.getStyleSimple=function $vpfn_AHqCWWE3Nl4xIj_Tl_7knw2022$26(sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sStyleValue=me.style[sStyle];
return deserializeStyleValue(sStyle,sStyleValue);
};





this.normalize=function $vpfn_PQQHg$kWyFvjMMJS6hrSPQ2032$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_oEditableElement)
{
normalizeParagraphTags();
labelSanctionedTags();
disableStyles();
addMozillaSpacer(_oEditableElement);

if(!me.resizeManually)
{
updateSize();
}
}
};






var convertNodeColorStyles=function $vpfn_Z_i82KICqfmNa6fayBMkXA2053$33(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{

var sStyle=oNode.getAttribute("style");
if(sStyle&&sStyle.length>0)
{

var sCSSText=sStyle.toLowerCase();
if(sCSSText.indexOf("color:")!=-1)
{
var oCSS=new vp.web.CssString(sCSSText);
var sColorString=oCSS.getItem("color");
if(sColorString)
{

var oColor=new vp.color.Color(sColorString);

oCSS.setItem("color",storeColor(oColor));


oNode.setAttribute("style",oCSS.toString());
}
}
}
}
else
{

}


for(var i=0;i<oNode.childNodes.length;i++)
{
convertNodeColorStyles(oNode.childNodes[i]);
}
};






this.setValue=function $vpfn_qae2LhNu7wEH$ufR6zdmNQ2097$20(sValue,bSuppressEvents)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var oXmlDoc=vp.web.getXMLDocument('<div>'+sValue+'</div>');
convertNodeColorStyles(oXmlDoc.documentElement);
sValue=vp.web.getInnerXML(oXmlDoc.documentElement);


sValue=me._XMLToHTML(sValue);

if(_oEditableElement)
{
if(sValue!==""&&sValue==_sValue)
{
return;
}

_oEditableElement.innerHTML=sValue;

me.normalize();

sValue=_oEditableElement.innerHTML;
}

_sValue=sValue;
_sOuputValue=null;

addToHistory();

if(_oEditableElement)
{

setChanged(false,bSuppressEvents);
}
};






var convertNodeToXML=function $vpfn_hBqiwIF9KiTEtTAqq9DX1Q2139$27(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsFirstNode=false;


var oXMLDoc=arguments[1];
if(!oXMLDoc)
{
oXMLDoc=vp.web.getXMLDocument();
bIsFirstNode=true;
}

var oNewNode;

if(oNode.nodeType==1)
{
oNewNode=oXMLDoc.createElement(oNode.tagName.toUpperCase());
if(bIsFirstNode)
{
oNewNode.setAttribute("xml:space","preserve");
}


if(oNode.style.cssText)
{
var sCSSText=oNode.style.cssText.toLowerCase();


if(sCSSText.indexOf("color:")!=-1)
{
var oCSS=new vp.web.CssString(sCSSText);
var sColorString=oCSS.getItem("color");
if(sColorString)
{

var oColor=fetchColor(sColorString);

if(typeof(oColor)!="undefined")
{
oCSS.setItem("color",oColor.toString());
}
}
sCSSText=oCSS.toString();
}

oNewNode.setAttribute("style",sCSSText);
}

if(oNode.align)
{
oNewNode.setAttribute("align",oNode.align);
}
}

else
{
oNewNode=oXMLDoc.createTextNode(oNode.nodeValue);
}

for(var i=0;i<oNode.childNodes.length;i++)
{
var oNewChild=convertNodeToXML(oNode.childNodes[i],oXMLDoc);
oNewNode.appendChild(oNewChild);
}

return oNewNode;
};





this.getOutputXMLNode=function $vpfn_bNcc86j3bUz4YayyxjsMLQ2211$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDiv=document.createElement("DIV");
for(var sProp in me.style)
{

oDiv.style[sProp]=me.style[sProp];
}
oDiv.innerHTML=me.getInternalHTML();

removeMozillaSpacer(oDiv);

me._normalizeNode(oDiv);
cleanUnsanctionedTags(oDiv);
me._cleanupOutputNode(oDiv);
me._convertDivsToParagraphs(oDiv);

return convertNodeToXML(oDiv);
};





this.getValue=function $vpfn_y_$_sHNTIIxnAsV71DpNpQ2235$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_sOuputValue===null)
{
var oNode=me.getOutputXMLNode();

if(oNode&&oNode.childNodes[0])
{
_sOuputValue=me._postProcessOutputXML(vp.web.getInnerXML(oNode));
}
else
{
_sOuputValue="";
}
}

return _sOuputValue;
};





this.getInternalHTML=function $vpfn_$yqQCfuUcH4Q3mWVmg3dDw2258$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sHTML=_oEditableElement?_oEditableElement.innerHTML:_sValue;

if(!document.all)
{
sHTML=me._stripTrailingBR(sHTML);
}

return sHTML;
};

this.getBoundingRect=function $vpfn_WoXu7o3inYEkBTdZcgeZlg2270$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.ui.getRect(me.element);
};

this.turnOffBrowserAutoComplete=function()
{

};
};





vp.widget.RichTextArea2.SUPPORTED_STYLES=["fontSize","fontFamily","color","fontWeight","fontStyle","textAlign"];





vp.widget.RichTextArea2.prototype.SUPPORTED_STYLES=vp.widget.RichTextArea2.SUPPORTED_STYLES;





vp.widget.RichTextArea2.SUPPORTED_STYLES_STRING_FORMAT=["font-size","font-family","color","font-weight","font-style","text-align"];





vp.widget.RichTextArea2.prototype.SUPPORTED_STYLES_STRING_FORMAT=vp.widget.RichTextArea2.SUPPORTED_STYLES_STRING_FORMAT;





vp.widget.RichTextArea2.SANCTIONED_TAG_ATTRIBUTE="richtextok";





vp.widget.RichTextArea2.prototype.SANCTIONED_TAG_ATTRIBUTE=vp.widget.RichTextArea2.SANCTIONED_TAG_ATTRIBUTE;





vp.widget.RichTextArea2.EMPTY_MOZ_SPACER="<br richtextok=\"1\" mozspacer=\"1\">";





vp.widget.RichTextArea2.prototype.EMPTY_MOZ_SPACER=vp.widget.RichTextArea2.EMPTY_MOZ_SPACER;





vp.widget.RichTextArea2.SANCTIONED_TAGS=["P","SPAN","BR","UL","OL","LI","DIV"];





vp.widget.RichTextArea2.prototype.SANCTIONED_TAGS=vp.widget.RichTextArea2.SANCTIONED_TAGS;







vp.widget.RichTextArea2.prototype._convertParagraphsToDivs=function $vpfn_e_u27ItFs01ptxzp4l3EVg2347$61(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{
var i;

if(oNode.tagName=="P")
{
var oDiv=vp.web.getOwnerDocument(oNode).createElement("DIV");

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
var sValue=this._getStyle(oNode,this.SUPPORTED_STYLES[i]);
if(sValue!=="")
{
this._setStyle(oDiv,this.SUPPORTED_STYLES[i],sValue);
}
}

if(oNode.align&&oNode.align!=="")
{
this._setStyle(oDiv,"textAlign",oNode.align);
}

while(oNode.childNodes.length>0)
{
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oDiv.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oDiv,oNode);

oNode=oDiv;
}

for(i=0;i<oNode.childNodes.length;i++)
{
this._convertParagraphsToDivs(oNode.childNodes[i]);
}
}
};









vp.widget.RichTextArea2.prototype._convertDivsToParagraphs=function $vpfn_$QA28cPRgIhfPVfccTc1AA2396$61(oNode,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(oTopNode)=="undefined")
{
oTopNode=oNode;
}

if(oNode.nodeType==1)
{
var i;


if(oNode!=oTopNode)
{
if(oNode.tagName=="DIV"&&oNode.parentNode.tagName!="LI")
{


if(oNode.parentNode==oTopNode)
{
var oP=vp.web.getOwnerDocument(oNode).createElement("P");

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
var sStyle=this.SUPPORTED_STYLES[i];
if(sStyle!="textAlign")
{
var sStyleValue=oNode.style[sStyle];
if(sStyleValue&&sStyleValue!=="")
{
oP.style[sStyle]=sStyleValue;
}
}
}


if(oNode.align&&oNode.align!=="")
{
oP.align=oNode.align;
}

while(oNode.childNodes.length>0)
{
var oTemp=oNode.removeChild(oNode.childNodes[0]);
oP.appendChild(oTemp);
}
oNode.parentNode.replaceChild(oP,oNode);

oNode=oP;
}


if(oNode.style.textAlign&&oNode.style.textAlign!=="")
{
oNode.align=oNode.style.textAlign;
vp.ui.removeStyle(oNode,"textAlign");
}
}
}

for(i=0;i<oNode.childNodes.length;i++)
{
this._convertDivsToParagraphs(oNode.childNodes[i],oTopNode);
}
}

};







vp.widget.RichTextArea2.prototype._cleanupOutputNode=function $vpfn_$Nsa8O3Z58D7iilfUVql$A2470$55(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<oNode.childNodes.length;i++)
{
var oChild=oNode.childNodes[i];

if(oChild.nodeType==1)
{
if(oChild.tagName=="A")
{
oChild.id="";
oChild.parentNode.removeChild(oChild);
}
else
{

oChild.removeAttribute(this.SANCTIONED_TAG_ATTRIBUTE);


vp.ui.removeStyle(oChild,"backgroundColor");


for(var j=0;j<this.SUPPORTED_STYLES.length;j++)
{
var sStyle=this.SUPPORTED_STYLES[j];
var sStyleTemp=oChild.getAttribute(sStyle+"_disabled");
if(sStyleTemp)
{
oChild.removeAttribute(sStyle+"_disabled");
oChild.style[sStyle]=sStyleTemp;
}
}


if(oChild.style.textAlign!=="")
{
oChild.align=oChild.style.textAlign;
vp.ui.removeStyle(oChild,"textAlign");
}

this._cleanupOutputNode(oChild);
}
}
else
{

}
}
};







vp.widget.RichTextArea2.prototype._postProcessOutputXML=function $vpfn_nyawOWwPp4ZqA4Ehli189w2526$58(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

sXML=sXML.replace(/\<br\s*\/\>/gi,"<BR />");
return sXML;
};







vp.widget.RichTextArea2.prototype._XMLToHTML=function $vpfn_35Qbw3iELkwfPSKjW16axg2539$47(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sXML.length===0)
{
return sXML;
}


sXML=sXML.replace(/\<br\s*\/\>/gi,"<br>");


var bInTag=false;
var aData=sXML.split("");
var iLen=aData.length;
for(var i=0;i<iLen;i++)
{
if(aData[i]=="<")
{
bInTag=true;
}
else if(aData[i]==">")
{
bInTag=false;
}
else if(i>0&&!bInTag&&aData[i]==" "&&aData[i-1]==" ")
{
aData[i]="&nbsp;";
}

}

return aData.join("");
};







vp.widget.RichTextArea2.prototype._stripTrailingBR=function $vpfn_tDRdX7ExkX3Ptu9cFjP1oQ2579$53(sHTML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return sHTML.replace(/\<br[^\>]*?\>$/gi,"");
};









vp.widget.RichTextArea2.prototype._getCommandFromStyle=function $vpfn_87XCiS9pmuA4Wg0hMBKDeQ2592$57(sStyle,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCommand={};

switch(sStyle)
{
case"fontWeight":
oCommand.id="Bold";
oCommand.value=sValue=="bold";
break;
case"fontStyle":
oCommand.id="Italic";
oCommand.value=sValue=="italic";
break;
case"color":
oCommand.id="ForeColor";
oCommand.value=sValue;
break;
case"fontSize":
oCommand.id="FontSize";
oCommand.value=sValue;
break;
case"fontFamily":
oCommand.id="FontName";
oCommand.value=sValue;
break;
case"textAlign":
oCommand.id="Justify"+sValue.substr(0,1).toUpperCase()+sValue.substr(1).toLowerCase();
oCommand.value=null;
break;
case"orderedList":
oCommand.id="InsertOrderedList";
oCommand.value=null;
break;
case"unorderedList":
oCommand.id="InsertUnorderedList";
oCommand.value=null;
break;
default:
throw new Error("The style "+sStyle+" is not supported");
}

return oCommand;
};













vp.widget.RichTextArea2.prototype._normalizeNode=function $vpfn_8P358DpmKoy37I7KUlaQeg2649$51(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bTrailingBRRemoved=false;
var oLastChild=oNode.lastChild;
if(oLastChild&&oLastChild.nodeType==1&&oLastChild.tagName=="BR")
{
oNode.removeChild(oLastChild);
bTrailingBRRemoved=true;
}


var TAGS_TO_PRESERVE=["BR"];
var sTempHTML=oNode.innerHTML.replace(/[\n\r\t\f]/gi,"");
var i;

for(i=0;i<TAGS_TO_PRESERVE.length;i++)
{
var oRe=new RegExp("\\<(\\/{0,1}"+TAGS_TO_PRESERVE[i]+"[^\\>]*?)\\>","gim");
sTempHTML=sTempHTML.replace(oRe,"#StartTag#$1#EndTag#");
}

oNode.innerHTML=sTempHTML;

try
{
this._normalizeNodeRecursive(oNode);
}
finally
{
sTempHTML=oNode.innerHTML.replace(/\#StartTag\#/gim,"<");
sTempHTML=sTempHTML.replace(/\#EndTag\#/gim,">");

oNode.innerHTML=sTempHTML;
}


if(oNode.childNodes.length==1)
{
var oFirstChild=oNode.childNodes[0];
if(oFirstChild.nodeType==1&&(oFirstChild.tagName=="P"||oFirstChild.tagName=="DIV"))
{
if(this._isStyleSubset(oNode,oFirstChild))
{
oNode.innerHTML=oFirstChild.innerHTML;
}
}
}

if(bTrailingBRRemoved)
{
oNode.appendChild(oLastChild);
}
};







vp.widget.RichTextArea2.prototype._normalizeNodeRecursive=function $vpfn_m5mJ9TiW8dk9LNAzsWCHUg2709$60(oNode,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsTopNode=false;



if(!oTopNode)
{
oTopNode=oNode;
bIsTopNode=true;
}

var i;
var bHasHTMLNodes=false;
var oPreviousChild=null;
var oPreviousTextNode=null;
var oChildNode=null;
var sStyle=null;



if(oNode.childNodes.length>1)
{
for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];

var bCanMerge=true;
var vLastValue=null;

for(var j=0;j<oNode.childNodes.length;j++)
{
oChildNode=oNode.childNodes[j];

if(oChildNode.nodeType!=1||oChildNode.tagName=="A")
{
bCanMerge=false;
break;
}

var vCurrentValue=this._getStyle(oChildNode,sStyle);

if(!vCurrentValue)
{
bCanMerge=false;
break;
}

if(vLastValue!==null&&vLastValue!=vCurrentValue)
{
bCanMerge=false;
break;
}

vLastValue=vCurrentValue;
}

if(bCanMerge)
{
this._setStyle(oNode,sStyle,vLastValue);
for(j=0;j<oNode.childNodes.length;j++)
{
this._setStyle(oNode.childNodes[j],sStyle,null);
}
}
}
}



for(i=0;i<oNode.childNodes.length;i++)
{
oChildNode=oNode.childNodes[i];

if(oChildNode.nodeType==1&&oChildNode.tagName!="A")
{

this._normalizeNodeRecursive(oChildNode,oTopNode);


if(oChildNode.tagName=="OL"||oChildNode.tagName=="UL")
{
if(oChildNode.childNodes.length===0)
{
if(oChildNode.removeNode)
{
oChildNode.removeNode();
}
else if(oChildNode.parentNode&&oChildNode.parentNode.nodeType==1)
{
oChildNode.parentNode.removeChild(oChildNode);
}
}
}

else if(oChildNode.tagName!="SPAN")
{
oPreviousChild=null;
bHasHTMLNodes=true;
}

else if(oChildNode.innerHTML.length===0&&oChildNode.parentNode)
{
oChildNode.parentNode.removeChild(oChildNode);
}
else
{

if(this._isNodeValidAndAttached(oPreviousChild)&&
this._isNodeValidAndAttached(oChildNode)&&
this._areStylesEqual(oChildNode,oPreviousChild))
{

var sPreviousText=oPreviousTextNode?oPreviousTextNode.nodeValue:"";

oChildNode.innerHTML=oPreviousChild.innerHTML+sPreviousText+oChildNode.innerHTML;
oPreviousChild.parentNode.removeChild(oPreviousChild);

if(oPreviousTextNode)
{
oPreviousTextNode.parentNode.removeChild(oPreviousTextNode);
}

oPreviousTextNode=null;


this._normalizeNodeRecursive(oChildNode,oTopNode);
}

oPreviousChild=oChildNode;
bHasHTMLNodes=true;
}
}
else if(oChildNode.nodeType==3)
{

if(oChildNode.nodeValue.replace(/\s/gim,"")!=="")
{
oPreviousChild=null;
oPreviousTextNode=null;
}
else
{
oPreviousTextNode=oChildNode;
}
}
else
{
oPreviousChild=null;
oPreviousTextNode=null;
}
}


if(!bHasHTMLNodes&&!bIsTopNode)
{
var oParent=oNode.parentNode;
var oChild=oNode;
while(oParent&&oParent.nodeType==1&&oChild!=oTopNode)
{


if(oChild.tagName=="SPAN"&&
vp.web.getInnerText(oChild).replace(/\*\!t/gi,"")==vp.web.getInnerText(oParent).replace(/\*\!t/gi,""))
{

for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];
var sStyleValue=this._getStyle(oChild,sStyle);
if(sStyleValue!=="")
{
this._setStyle(oParent,sStyle,sStyleValue);
}
}


this._replaceNodeWithContents(oChild);
}

else if(oChild.tagName=="SPAN"&&this._isStyleSubset(oParent,oChild))
{
this._replaceNodeWithContents(oChild);
}

else
{
for(i=0;i<this.SUPPORTED_STYLES.length;i++)
{
sStyle=this.SUPPORTED_STYLES[i];
if(this._getCurrentStyle(oParent,sStyle,oTopNode)==this._getStyle(oChild,sStyle))
{
this._setStyle(oChild,sStyle,"");
}
}
}

oChild=oParent;
oParent=oParent.parentNode;
}
}
};






vp.widget.RichTextArea2.prototype._replaceNodeWithContents=function $vpfn_MOflnRVh_NOhvAWNSvtddg2917$61(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParent=oNode.parentNode;
var iLen=oNode.childNodes.length;
for(var i=0;i<iLen;i++)
{
oParent.insertBefore(oNode.childNodes[i].cloneNode(true),oNode);
}

oParent.removeChild(oNode);
oParent.normalize();
};

vp.widget.RichTextArea2.prototype._isNodeValidAndAttached=function $vpfn_xoO1hM5qieJKpXFDlrthEQ2930$60(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return oNode&&
oNode.parentNode&&
(oNode.parentNode.nodeType==3||oNode.parentNode.nodeType==1);
};










vp.widget.RichTextArea2.prototype._getStyle=function $vpfn_IvFzNw8$3BRhkz9TaUy9Tg2946$46(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sDisabledAttr=oNode.getAttribute(sStyle+"_disabled");


if(document.all&&!sDisabledAttr&&sStyle=="textAlign")
{
if(oNode.style.textAlign)
{
return oNode.style.textAlign;
}
else if(oNode.align)
{
return oNode.align;
}
else
{
return"";
}
}

if(sDisabledAttr)
{
return sDisabledAttr;
}
else if(oNode.style[sStyle])
{
return oNode.style[sStyle];
}
else
{
return"";
}
};










vp.widget.RichTextArea2.prototype._setStyle=function $vpfn_J64n_dk$gMhr7R3VPnHogw2990$46(oNode,sStyle,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(this.disabledStyles.indexOf(sStyle)!=-1)
{
oNode.setAttribute(sStyle+"_disabled",vValue);

if(!vValue)
{
oNode.removeAttribute(sStyle+"_disabled");
}

vp.ui.removeStyle(oNode,sStyle);
}
else
{
if(sStyle=="textAlign"&&document.all)
{
if(vValue)
{
oNode.align=vValue;
}
else
{
oNode.removeAttribute("align");
}
vp.ui.removeStyle(oNode,sStyle);
}
else
{
if(vValue)
{
oNode.style[sStyle]=vValue;
}
else
{
vp.ui.removeStyle(oNode,sStyle);
}
}


if(this.limitFontSize&&sStyle=="fontSize"&&vValue)
{
oNode.setAttribute(sStyle+"_disabled",vValue);
var iFontSize=(parseInt(vValue)*0.3)+10;
if(iFontSize>40)
{
iFontSize=40;
}
oNode.style.fontSize=iFontSize+"px";
}
else
{
oNode.removeAttribute(sStyle+"_disabled");
}
}
};






vp.widget.RichTextArea2.prototype._highlightWhiteText=function $vpfn_oa9lOQoRh5StMWyXRg40VA3053$56(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sColor=vp.ui.getCurrentStyle(oNode,"color");
if(!sColor)
{
return;
}


var oColor=new vp.color.Color(sColor);


if(oColor.getBrightness()>235)
{
oNode.style.backgroundColor="#666";
}
else
{
oNode.style.backgroundColor="#FFF";
}
};







vp.widget.RichTextArea2.prototype._removeStyleRecursive=function $vpfn_8e6pqOXsR2svCvgflnSx1A3081$58(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.nodeType==1)
{
this._setStyle(oNode,sStyle,"");

var oChildren=oNode.childNodes;
var iLen=oChildren.length;
for(var i=0;i<iLen;i++)
{
this._removeStyleRecursive(oChildren[i],sStyle);
}
}
};









vp.widget.RichTextArea2.prototype._isStyleSubset=function $vpfn_gVJj0bwxoGcIQ6Hj6kS2SQ3104$51(oNode1,oNode2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=this.SUPPORTED_STYLES.length;
for(var i=0;i<iLen;i++)
{
if(this._getStyle(oNode2,this.SUPPORTED_STYLES[i])!==""&&this._getStyle(oNode1,this.SUPPORTED_STYLES[i])!==this._getStyle(oNode2,this.SUPPORTED_STYLES[i]))
{
return false;
}
}

return true;
};








vp.widget.RichTextArea2.prototype._areStylesEqual=function $vpfn_VAaibdP$GlMw8Xw9A3AYLw3125$52(oNode1,oNode2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=this.SUPPORTED_STYLES.length;
for(var i=0;i<iLen;i++)
{
if(this._getStyle(oNode1,this.SUPPORTED_STYLES[i])!=this._getStyle(oNode2,this.SUPPORTED_STYLES[i]))
{
return false;
}
}

return true;
};









vp.widget.RichTextArea2.prototype._getCurrentStyle=function $vpfn_ec1z2Vh_HDJWJQ5$6ItK1g3147$53(oNode,sStyle,oTopNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var vRet=null;


var oParent=oNode;
while(oParent&&oParent.nodeType==1&&oParent!=oTopNode.parentNode)
{
var sValue=this._getStyle(oParent,sStyle);
if(sValue!=="")
{
vRet=sValue;
break;
}
oParent=oParent.parentNode;
}


if(!vRet)
{
vRet=this.style[sStyle];
}


if(!vRet)
{
if(sStyle=="textAlign")
{
vRet="left";
}
else if(sStyle=="fontWeight")
{
vRet="normal";
}
else if(sStyle=="fontStyle")
{
vRet="normal";
}
else if(sStyle=="color")
{
vRet="#000000";
}
}


if(sStyle=="fontWeight")
{
if(vRet==400)
{
vRet="normal";
}
else if(vRet==700)
{
vRet="bold";
}
}

return vRet;
};








vp.widget.RichTextArea2.prototype._isRangeEqual=function $vpfn_r_w5gOY_lMNlX8CB2PTD7g3214$50(oRange1,oRange2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oRange1===null^oRange2===null)
{
return false;
}
else if(oRange1===null&&oRange2===null)
{
return true;
}

if(oRange1.compareBoundaryPoints)
{
var START_TO_END=1;
try
{
return oRange1.compareBoundaryPoints(START_TO_END,oRange2)===0;
}
catch(ex)
{

return false;
}
}
else if(oRange1.isEqual)
{
return oRange1.isEqual(oRange2);
}
};








vp.widget.RichTextArea2.prototype._isUnselectable=function $vpfn_6FTYqA6jHdG454Ylcm3beQ3251$52(oElem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oElem.nodeType==1&&vp.core.getAttribute(oElem,"unselectable","").toLowerCase()=="on")
{
return true;
}
else if(oElem.nodeType==1&&oElem.tagName!="BODY")
{
return this._isUnselectable(oElem.parentNode);
}
else
{
return false;
}
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(!vp.studio)
{
vp.studio={};
}







vp.studio.PlainTextArea=function $vpfn_f7kd$6OEkLInJ8_KCPqewQ15$26(bSingleLine)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.widget.TextArea;
this.inheritFrom(bSingleLine);

var me=this;

var base_getValue=this.getValue;
this.getValue=function $vpfn_sb9emL380TV$fAdGyEBOzA26$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.plainTextToXHTML(base_getValue());
};

var base_setValue=this.setValue;
this.setValue=function $vpfn_ilYM659iC2xNUxSgqX5aGA32$20(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
base_setValue(me.XHTMLToPlainText(sXML));
};

this.setStyle=function(){};

this.setStyleSimple=function(){};
};






vp.studio.PlainTextArea.prototype.plainTextToXHTML=function $vpfn_xcGFngeFms5UADiuWQJkxg47$53(sText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.web.xmlEncode(sText).replace(/(\r)?\n/gi,"<br />");
};






vp.studio.PlainTextArea.prototype.XHTMLToPlainText=function $vpfn_qBbQrNKY$xVyPziBmgDktA57$53(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.web.xmlDecode(sXML.replace(/\<br\s*\/\>/gi,"\r\n"));
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}






vp.studio.StudioTextMetaData=function $vpfn_7LF_thbzTrXq4H352NjTBA8$31(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.top=0.00;
this.right=0.00;
this.bottom=0.00;
this.left=0.00;

var parseData=function $vpfn_9vhBtOoYXUKs0K3imlGaaQ16$20(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(sMetaData)=="string")
{
if(sMetaData)
{
var items=sMetaData.split("_");
var iLen=items.length;
if(iLen==4)
{
me.top=vp.core.getNumber(items[0],0);
me.right=vp.core.getNumber(items[1],0);
me.bottom=vp.core.getNumber(items[2],0);
me.left=vp.core.getNumber(items[3],0);
}
}
}
};

parseData(sMetaData);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}






vp.studio.StudioEmbroideryUploadMetaData=function $vpfn_9powoC16HnVJisNAvghpaQ8$43(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.colorOverrides=[];

var parseData=function $vpfn_UrQWgzNkJ9H2iVHdE1z88A13$20(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(sMetaData)=="string")
{
if(sMetaData)
{
var items=sMetaData.split(",");
me.colorOverrides=items;
}
}
};

parseData(sMetaData);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}





vp.studio.ImagePreviewMetaData=function $vpfn_Fyffl22Y4zgXayLM7Ph0kQ7$33(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.imageQuality=IMAGE_QUALITY_VeryPoor;

var parseData=function $vpfn_QBsIL_X2Nwl_raInMiXchA12$20(sMetaData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sMetaData&&typeof(sMetaData)==="string")
{
me.imageQuality=parseInt(sMetaData);
}
};

parseData(sMetaData);
};

var FONT_VARIANT_None=0;
var FONT_VARIANT_Bold=1;
var FONT_VARIANT_Italic=2;
var FONT_VARIANT_BoldItalic=4;
var RECTANGLE_FILL_TYPE_Normal=0;
var RECTANGLE_FILL_TYPE_Gradient=1;
var RECTANGLE_FILL_TYPE_HooHa=2;
var GRADIENT_FILL_DIRECTION_Right=0;
var GRADIENT_FILL_DIRECTION_Up=1;
var GRADIENT_FILL_DIRECTION_Left=2;
var GRADIENT_FILL_DIRECTION_Down=3;
var PAGE_COLORIZATION_undefined='undefined';
var PAGE_COLORIZATION_color='color';
var PAGE_COLORIZATION_gray='gray';
var PAGE_COLORIZATION_blank='blank';
var PAGE_COLORIZATION_branded='branded';
var FONT_WEIGHT_Normal='Normal';
var FONT_WEIGHT_Bold='Bold';
var FONT_STYLE_Normal='Normal';
var FONT_STYLE_Italic='Italic';
var TEXT_ALIGN_Left='Left';
var TEXT_ALIGN_Center='Center';
var TEXT_ALIGN_Right='Right';
var TOOLBAR_SECTION_Basic='Basic';
var TOOLBAR_SECTION_Text='Text';
var TOOLBAR_SECTION_Insert='Insert';
var TOOLBAR_SECTION_Advanced='Advanced';
var PLACEHOLDER_TYPE_Image=1;
var PLACEHOLDER_TYPE_Map=2;
var PLACEHOLDER_TYPE_ComplexQrCode=3;
var STUDIO_COOKIE_FontDropdownTooltip=2;
var IMAGE_QUALITY_Undefined=0;
var IMAGE_QUALITY_VeryPoor=1;
var IMAGE_QUALITY_Poor=2;
var IMAGE_QUALITY_Fair=3;
var IMAGE_QUALITY_Good=4;
var COPY_LIBRARY_MATCHING_TAGS=["aboutustext","calltoaction","companymessage","tabledetailedmenu","headline","tablehours","moreinfo","productlist1","productdescription","offer","tablemenu"];var FEATURE_TwoFiveThreePhotoResolutionWarningInHolidayCardStudio=5175;

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}





if(!vp.studio.commands)
{
vp.studio.commands={};
}





var EditorConst={};





var Editor;


window.isAdvancedSSR=true;








var sHashDocID=vp.web.getUrlHashData("doc_id")||"";
var sHashPFID=vp.web.getUrlHashData("pf_id")||"";
var sHashShopperKitID=vp.web.getUrlHashData("shopper_kit_id")||"";
var sHashDateTime=vp.web.getUrlHashData("clearcache")||"";

if(sHashDocID||sHashPFID||sHashShopperKitID||sHashDateTime)
{
var oURL=new vp.web.URL(document.location.toString());
oURL.hash="";

if(sHashDocID)
{
oURL.setItem("doc_id",sHashDocID);
oURL.removeItem("combo");
oURL.removeItem("combo1");
oURL.removeItem("combo_id");
oURL.removeItem("icparts");
}

if(sHashPFID)
{
oURL.setItem("pf_id",sHashPFID);
}

if(sHashShopperKitID)
{
oURL.setItem("shopper_kit_id",sHashShopperKitID);




}

if(sHashDateTime)
{




oURL.hash="";
}

document.location.replace(oURL.toString());
}




vp.studio.init=function $vpfn_ZBXAmdGCrJlGgAGywqWwzA95$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor=new vp.studio.Editor();
};

var LOGGING_MAX_LEN=65536;

var BLANK_IMAGE=vp.ui.imageUrl("/vp/images/clearpixel.gif");

var BLEED_AREA_ZINDEX_OFFSET=17000;
var HANDLE_ZINDEX_OFFSET=10000;
var GRID_OVERLAY_ZINDEX_OFFSET=8000;
var MAIL_MASK_ZINDEX_OFFSET=7000;
var PRODUCT_OVERLAY_ZINDEX_OFFSET=6000;
var BRANDING_ZINDEX_OFFSET=5000;
var DOCITEM_ZINDEX_OFFSET=0;

var CMD_CHANGE_SELECTION="Change Selection";
var CMD_CHANGE_TEXT="Change Text";
var CMD_FOCUS_TEXT="Focus Text";

var FRAME_THICKNESS_1PX={
top:1,
left:1,
right:1,
bottom:1
};

var BRANDING_TYPE_NONE=0;
var BRANDING_TYPE_EDITABLE=1;
var BRANDING_TYPE_LOCKED=2;
var BRANDING_TYPE_ALWAYS_SHOW=3;
var BRANDING_TYPE_EDITABLE_ALWAYS_SHOW=4;

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


var DOCITEM_TYPE_TEXT=1;
var DOCITEM_TYPE_LIBRARY_IMAGE=2;
var DOCITEM_TYPE_UPLOADED_IMAGE=3;
var DOCITEM_TYPE_LOGO=4;
var DOCITEM_TYPE_PLACEHOLDER=5;
var DOCITEM_TYPE_SHAPE_LAYER=6;
var DOCITEM_TYPE_CALENDAR_GRID=7;
var DOCITEM_TYPE_PRODUCT_OVERLAY=8;
var DOCITEM_TYPE_TEXTAREA=9;
var DOCITEM_TYPE_WORDART=10;
var DOCITEM_TYPE_CARICATURE=11;
var DOCITEM_TYPE_CARICATURE_AREA=12;
var DOCITEM_TYPE_GRID_OVERLAY=13;
var DOCITEM_TYPE_SHAPE=14;
var DOCITEM_TYPE_OVAL=15;
var DOCITEM_TYPE_RECTANGLE=16;
var DOCITEM_TYPE_PATH_SHAPE=17;
var DOCITEM_TYPE_LINE=18;
var DOCITEM_TYPE_PAPEREFFECT=19;
var DOCITEM_TYPE_CUT_SHAPE=21;
var DOCITEM_TYPE_CUT_OVAL=22;
var DOCITEM_TYPE_CUT_RECTANGLE=23;
var DOCITEM_TYPE_CUT_PATH_SHAPE=24;
var DOCITEM_TYPE_CUT_SHAPE_LAYER=25;
var DOCITEM_TYPE_ARROW=26;
var DOCITEM_TYPE_MAIL_MASK=27;
var DOCITEM_TYPE_MAP=28;
var DOCITEM_TYPE_TABLE=29;
var DOCITEM_TYPE_PRODUCT_UNDERLAY=30;
var DOCITEM_TYPE_COMPLEX_QR_CODE=31;

var DOCITEM_IMAGE_TYPES=[
DOCITEM_TYPE_LIBRARY_IMAGE,
DOCITEM_TYPE_UPLOADED_IMAGE,
DOCITEM_TYPE_LOGO,
DOCITEM_TYPE_PAPEREFFECT,
DOCITEM_TYPE_PLACEHOLDER,
DOCITEM_TYPE_CARICATURE,
DOCITEM_TYPE_MAP
];

var DOCITEM_TEXT_TYPES=[
DOCITEM_TYPE_TEXT,
DOCITEM_TYPE_WORDART
];

var DOCITEM_FONT_ENABLED_TYPES=[
DOCITEM_TYPE_TEXT,
DOCITEM_TYPE_WORDART,
DOCITEM_TYPE_TABLE
];

var DOCITEM_JUSTIFY_ENABLED_TYPES=[
DOCITEM_TYPE_TEXT,
DOCITEM_TYPE_TABLE
];

var DOCITEM_SHAPE_TYPES=[
DOCITEM_TYPE_OVAL,
DOCITEM_TYPE_RECTANGLE,
DOCITEM_TYPE_PATH_SHAPE,
DOCITEM_TYPE_LINE
];

var DOCITEM_CUT_SHAPE_TYPES=[
DOCITEM_TYPE_CUT_OVAL,
DOCITEM_TYPE_CUT_RECTANGLE,
DOCITEM_TYPE_CUT_PATH_SHAPE
];

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



var ERR_SAVE_FAILED=-1001;
var ERR_INVALID_COORDINATE=-1002;



if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(typeof Editor=="undefined")
{
var Editor=null;
}

if(!LOGGING_MAX_LEN){
var LOGGING_MAX_LEN=65536;
}











vp.studio.Error=function $vpfn_m9R9eTk2qa_qMNmaP_4rqA39$18(vNumberOrError,sMessage,sInternalMessage,sAdditionalData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iNumber=0;
sMessage=sMessage||JSLM_StudioGenericScriptError;

if(typeof vNumberOrError=="number")
{
iNumber=vNumberOrError;
}
else
{
iNumber=vNumberOrError.number;
sMessage=vNumberOrError.message;
sInternalMessage=vNumberOrError.internalMessage;
sAdditionalData=vNumberOrError.data;
}





this.internalError=new Error(sMessage);

this.internalError.number=iNumber;
this.internalError.internalMessage=sInternalMessage||"";
this.internalError.data=sAdditionalData||"";





this.internalMessage=sInternalMessage;





this.data=sAdditionalData;





this.number=iNumber;





this.message=sMessage;

window._lastError=this;




this.throw_=function $vpfn_Zws2cEO32iHpTAOB4KkqPQ95$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
throw this.internalError;
};
};









vp.studio.Error.getLast=function $vpfn_EokOiqN8aZYwPHmrSgg$ZQ109$26(sMsg,sUrl,iLineNum)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var data="";
if(sUrl&&iLineNum)
{
sUrl=new vp.web.URL(sUrl).pathname;
data="line "+iLineNum+" in "+sUrl;
}


if(window._lastError)
{
if(typeof(sMsg)=="string"&&!window._lastError.internalMessage)
{
window._lastError.internalMessage=sMsg;
window._lastError.data=data;
}
return window._lastError;
}

else
{
return new vp.studio.Error(-1,sMsg,"",data);
}
};




vp.studio.Error.clearLast=function $vpfn_2tKreCFr0U_IuQnnNYNy1A139$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window._lastError=null;
};


vp.studio.Error.SEVERITY_WARNING=30;
vp.studio.Error.SEVERITY_ERROR=40;
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}





vp.studio.util=function(){};








vp.studio.util.loadScript=function $vpfn_sl3GkIEosy1gqA2QOjxxAg27$28(sURL,fnCallback,fnOnLoadCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.studio.util._lastScriptLoadCallback=fnCallback;

var oScript=document.createElement("SCRIPT");
oScript.language="JavaScript";
oScript.src=sURL;

$(oScript).load(fnOnLoadCallback);
document.body.appendChild(oScript);
};




vp.studio.util._scriptLoadComplete=function $vpfn_0YOWChYBUmQWZXKH2KFTrA43$37(fnFunction,iRequestID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(iRequestID&&iRequestID!==0&&iRequestID!=vp.studio.util._lastRequestID)
{
return;
}


if(fnFunction)
{
fnFunction();
}

if(vp.studio.util._lastScriptLoadCallback)
{
vp.studio.util._lastScriptLoadCallback();
vp.studio.util._lastScriptLoadCallback=null;
}
};








vp.studio.LogInfo=function $vpfn_OZlEHIQX2oKgWTE3KPb6Rg72$20(sCommandName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.xml.XMLNode;
this.inheritFrom("cmd");

var me=this;

this.attributes["name"]=sCommandName;

this.setItem=function $vpfn_Qfi402Y41yUUgCk_R0cBww84$19(sName,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.attributes[sName]=sValue;
};






this.setSelection=function $vpfn_h_otxGA7QNVIHXngCGO9dw94$24(oSelection,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!sName)
{
sName="selection";
}

me.attributes[sName]=oSelection.getInfo();
};






this.setCropInfo=function $vpfn_eZhwUtXhd7gQ81N3mqwL9w109$23(oCropInfo,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!sName)
{
sName="cropinfo";
}

var sData="null";
if(oCropInfo)
{
sData=oCropInfo.top+","+
"l:"+oCropInfo.left+","+
"r:"+oCropInfo.right+","+
"b:"+oCropInfo.bottom;
}

me.attributes[sName]="t:"+sData;
};






this.setRect=function $vpfn_Z7h3XxuBY6556a6AxkViFA133$19(oRect,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!sName)
{
sName="rect";
}

var sData="null";
if(oRect)
{
sData=oRect.top+","+
"l:"+oRect.left+","+
"w:"+oRect.width+","+
"h:"+oRect.height;
};

me.attributes[sName]="t:"+sData;
};






this.setArray=function $vpfn_cMY7ehPRq_6XhTDJmLGfNA157$20(sName,aArray)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!sName)
{
sName="array";
}

var sData="null";
if(aArray)
{
sData=aArray.join(",");
};

me.setItem(sName,sData);
};
};







vp.studio.util.cancelEventAndBlur=function $vpfn_rRcKg5sgFxRrQp$_4rIN9A180$36(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.cancelEvent(e);
};

vp.studio.util.isTextFieldSelected=function $vpfn_keqsGnDOS2uvGE6VkDQ79w185$37(oTextField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(document.all)
{
var oRange=document.selection.createRange();
return oRange.parentElement&&oRange.parentElement()==oTextField;
}
else
{
return false;
}
};

vp.studio.util.TEXT_PROPERTY_MAP={
"fontStyle":"fontStyle",
"fontWeight":"fontWeight",
"fontSize":"fontSize",
"fontColor":"color",
"align":"textAlign",
"fontFamily":"fontFamily"
};








vp.studio.util.getCssStyleFromTextProperty=function $vpfn_nAKbSHa4GmcGdkNTPs_ayA214$45(sProp)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sVal=vp.studio.util.TEXT_PROPERTY_MAP[sProp];

return sVal?sVal:sProp;
};






vp.studio.util.isUnsupportedCharCode=function $vpfn_6V3QUxPpSfhaSD5mucgX7w226$39(iCode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(vp.text.isRtlCode(iCode))
{
return true;
}

if(iCode>=0x0E00&&iCode<=0x0E7F)
{
return true;
}
else if(iCode>=0x0900&&iCode<=0x097F)
{
return true;
}

return false;
};






vp.studio.util.stripUnsupportedCharacters=function $vpfn_oqx0MrAqimZJViT6MTuGKQ250$44(sText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(typeof sText!="string")
{
throw new Error("vp.studio.util.stripUnsupportedCharacters(): Text is null.");
}

if(sText.length===0)
{
return sText;
}

var aOut=[];
for(var i=0;i<sText.length;i++)
{
if(!vp.studio.util.isUnsupportedCharCode(sText.charCodeAt(i)))
{
aOut.push(sText.charAt(i));
}
}

return aOut.join("");
};








vp.studio.util.differsIgnoreCase=function $vpfn_iFgRrAhX1sl_GAwc4Q6xaA282$35(oLeft,oRight)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oLeft&&oRight)
{
if(typeof(oLeft)=="string"&&typeof(oRight)=="string")
{

return oLeft.toLowerCase()!=oRight.toLowerCase();
}
else
{

return oLeft.toString().toLowerCase()!=oRight.toString().toLowerCase();
}
}
else
{

return oLeft!=oRight;
}
};







vp.studio.util.storeLargeData=function $vpfn_qwTtGA_bLWPy34KviHvlrw310$32(sData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oJson=[];
try
{
var url="/vp/ns/textwebservice.aspx";
var sResponse=vp.http.post(url,"d="+vp.web.urlEncode(sData));
oJson=vp.http.parseJSON(sResponse);
}
catch(e)
{
return"";
}
return oJson["id"];
};











vp.studio.util.quickHash=function $vpfn_CGFGSAej4ynWpcR65QVd3g336$27(sString)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var hash=sString.charCodeAt(0)||0;

for(var i=1;i<sString.length;i++)
{


hash<<=1;
hash^=sString.charCodeAt(i);
}



return Math.abs(hash);
};


vp.studio.trace=function $vpfn_k7mPvHKW6OUCYuVMOVGvAA356$18(sData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.debug)
{
return vp.debug.trace(sData);
}
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.EditorAsyncManager=function $vpfn_wmVwjryiExGvxAZplk6RfA10$31(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var Editor=oEditor;
var m_oActions={};
var m_iCount=0;
var me=this;
var m_iErrorTimer=null;





this._errorHandler=function $vpfn_vkxGz7rLXm_gpG5hNK6nBQ22$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.hideProgressBar();
var oError=new vp.studio.Error(-1,"An asynchronous operation timed out or didnt implement a callback handler");
oError.severity=vp.studio.Error.SEVERITY_WARNING;

oError.throw_();
};









this.start=function $vpfn_18pY2bOn8RFoViS7YOlOAQ39$17(fnAction,fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!m_iErrorTimer)
{
m_iErrorTimer=window.setTimeout(me._errorHandler,100000);
}

Editor.showProgressBar();


var oEventAction={
action:fnAction,
callback:fnCallback,
complete:false
};

m_oActions["_"+m_iCount]=oEventAction;

m_iCount++;


var fnCallbackWrapper=function $vpfn_TMHDxAMpD4iVzzIlz1YzNA60$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.item._handleCallback(this.action);
}
.getClosure(
{
action:oEventAction,
item:me
}
);


oEventAction.action(fnCallbackWrapper);
};





this._handleCallback=function $vpfn_7e0hA_0l5bdbbqnsar0vNw79$27(oEventAction)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sKey;


for(sKey in m_oActions)
{
if(!m_oActions[sKey].complete)
{
if(m_oActions[sKey]==oEventAction)
{
m_oActions[sKey].complete=true;
m_iCount--;
}
}
}


if(m_iCount===0)
{

for(sKey in m_oActions)
{
if(m_oActions[sKey].callback)
{
m_oActions[sKey].callback();
}
}

if(Editor.hideProgressBar)
{
Editor.hideProgressBar();
}


clearTimeout(m_iErrorTimer);
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.EditorAsyncActions=function $vpfn_3HdT4WUOZtorLgiws7xv0g10$31(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var Editor=oEditor;
var me=this;








this.login=function $vpfn_e4r1gr2oxADx9zx6fWz7Dw22$17(fnCallback,sForwardURL)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oWin=null;

if(!Editor.isUserLoggedIn||Editor.isUserAGuest)
{
vp.studio.instrumentation.add("Login-start");

var sUrl="/vp/ns/mini_sign_in.aspx?dialog=1";

if(fnCallback)
{



var fnLoginCallbackWrapper=function $vpfn_yxr6VxH_RzfVqejf2h$csw37$45()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Login-finished");
Editor.isUserLoggedIn=true;
fnCallback();
};

var iCallbackID=vp.win.createCallbackHandler(fnLoginCallbackWrapper);
sUrl+="&callback_id="+iCallbackID;
}

if(sForwardURL)
{
sUrl+="&rurl="+vp.web.urlEncode(sForwardURL);
}

vp.studio.ui.openDialog(
"loginWin",
Editor.loginPageTitle,
sUrl,
vp.dialog.chrome.Primary,
460,
420);
}
else if(fnCallback)
{
fnCallback();
}

return oWin;
};








this.save=function $vpfn_yb4qr2h__TyjVWmH7RduYg76$16(bPromptForDocName,bSaveToPortfolio)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Save-started");
if(!Editor.isUserLoggedIn||Editor.isUserAGuest)
{
vp.studio.instrumentation.add("Save-nouser");


var fnCallback=function $vpfn_y518eO20tjW9ZrC8OnNRNg84$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.save(bPromptForDocName,bSaveToPortfolio);
};

me.login(fnCallback);
return;
}


if(bPromptForDocName)
{


Editor.selection.clear();
vp.studio.instrumentation.add("Save-promptforname");

var changeName=function $vpfn_4SNXaZAJkFu0P$vVDtp6bQ101$29(sDocName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.text.trim(sDocName).length===0)
{
alert(JSLM_StudioNameDocumentInvalidLengthWarning);
vp.dialog.prompt(JSLM_StudioToolbarSaveAs,JSLM_StudioNameDocumentPrompt,Editor.docName,changeName);
return;
}
Editor.setDocumentChanged(true);
Editor.docName=sDocName;

vp.studio.instrumentation.add("SaveAs");
me.save(false,bSaveToPortfolio);
};

vp.dialog.prompt(JSLM_StudioToolbarSaveAs,JSLM_StudioNameDocumentPrompt,Editor.docName,changeName);
return;
}


Editor.asyncManager.onfinished=function $vpfn_e6rFevnUO$N1Gt7u0xGGSA121$41()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
alert(JSLM_StudioSaveDocumentConfirmation);
};

if(bSaveToPortfolio)
{
Editor.asyncManager.start(Editor.saveToPortfolio);
}
else
{
Editor.asyncManager.start(Editor.save);
}
};






this.saveAs=function $vpfn_4ocMQTuoa8gcuXjlobgSSw141$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.save(true,true);
};




this.goToPage=function $vpfn_DHevz4TegUvX6vU$BzN_lw149$20(iPageNumber,extraQSParams)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnGoNext=function $vpfn_jg$S5OEtoKgtPA5e_F9OGQ151$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.cancelMessageDisabled=true;
this.editor.goToPage(iPageNumber,extraQSParams);
}
.getClosure(
{
editor:Editor
});

var fnCallback=function $vpfn_y518eO20tjW9ZrC8OnNRNg161$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.showValidationErrorsDialog(fnGoNext);
};

var fnSave=(Editor.features.isEPTemplateEdit&&Editor.docID<=0)?Editor.saveAsEnterprisePartnerTemplate:Editor.save;
Editor.asyncManager.start(fnSave,fnCallback);
};





this.changeBacksideColor=function $vpfn_Jod$8QLn5Ly6iC4abgtb7Q174$31(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Change Backside Color");

var fnAction=function $vpfn_jg$S5OEtoKgtPA5e_F9OGQ178$23(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.changeBacksideColor(this.value,fnCallback);
}
.getClosure({
editor:Editor,
value:sValue
});

Editor.asyncManager.start(fnAction);
};






this.changePageColorization=function $vpfn_F9AEuWdLpznXxgYxO8I0cQ195$34(sValue,bRegenUI,fnCallback,iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Change Page Colorization");

var fnAction=function $vpfn_jg$S5OEtoKgtPA5e_F9OGQ199$23(fnCallbackInternal)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.changePageColorization(this.value,fnCallbackInternal,this.bRegenUI,iPageNumber);
}
.getClosure(
{
editor:Editor,
value:sValue,
bRegenUI:bRegenUI
}
);

Editor.asyncManager.start(fnAction,fnCallback);
};













this.changeCombo=function $vpfn_9c3wMDsY8jrg_lF_LeLgLw226$23(sICParts,sComboId,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oOptions)
{
oOptions={};
}


if(!Editor.isLoadComplete)
{
var fnChangeCombo=arguments.callee;
var fnRetry=function $vpfn_n4ttGdMgvnS95VuJRVAAwQ237$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
fnChangeCombo(sICParts,sComboId,oOptions);
};

window.setTimeout(fnRetry,100);
return;
}

vp.studio.instrumentation.add("Change Combo");

var fnAction=function $vpfn_jg$S5OEtoKgtPA5e_F9OGQ248$23(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

this.options.callback=fnCallback;
this.editor.changeCombo(this.icParts,this.comboId,this.options);
}
.getClosure(
{
editor:Editor,
icParts:sICParts,
comboId:sComboId,
options:oOptions
});

Editor.asyncManager.start(fnAction);
};





this.showFoilPreview=function $vpfn_0iBYarn1msOJvgY5BuiVzw269$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oWin=vp.dialog.IFrameDialog.open("studioFoilPreviewWin","Foil Preview","/vp/ns/show_foil_preview.aspx?renderasfoil=true&renderasanimatedfoil=true&doc_id="+Editor.docID,vp.dialog.chrome.Primary,700,500);

var fnCallback=function $vpfn_jg$S5OEtoKgtPA5e_F9OGQ273$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Foil Preview-start");

var sFoilURL="/vp/ns/show_foil_preview.aspx?renderasfoil=true&renderasanimatedfoil=true&doc_id="+this.editor.docID;

vp.win.waitForLoadAndNavigate(this.win,sFoilURL);
}
.getClosure(
{
win:oWin,
editor:oEditor
}
);

Editor.asyncManager.start(Editor.save,fnCallback);
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}







vp.studio.UpdateXML=function $vpfn_zJPGnfzvXjlQDb2Ce_mbzw9$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var m_arr=[];





this.add=function $vpfn_nsUNnuU6SIXOgCA6moQ2QQ17$15(vNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_arr.push(vNode.toString());
};





this.toString=function $vpfn_h5IZkCi2zrDZyTqpb5QWLg26$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"<update>"+m_arr.join("")+"</update>";
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof vp=="undefined")
{
var vp={};
}

if(typeof vp.studio=="undefined")
{
vp.studio={};
}






vp.studio.CommandManager=function $vpfn_TXqZkuZlNCGtgO7eiVLsLg19$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

var DEFAULT_RETRY_COUNT=0;

var sDefaultUrl="/Sales/Studio/StudioWebService.aspx";

var oXMLQueue=[];
var oJSONQueue={};
var oUrl=new vp.web.URL(sDefaultUrl);





this.hasQueuedCommands=false;





this.enqueueXML=function $vpfn_MSkKmu_T8TLl0xpAG1y6$Q41$22(oCommandNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oXMLQueue.push(oCommandNode);
me.hasQueuedCommands=true;
};





this.enqueueJSON=function $vpfn__wPE6XODx4JaPK1ZRkI_3A51$23(oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var key in oCommand)
{
oJSONQueue[key]=oCommand[key];
}

me.hasQueuedCommands=true;
};







this.addContextInformation=function $vpfn_zmuIzJ8SqM_DYtP_CGdVtA67$33(sKey,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oUrl.setItem(sKey,sValue);
};







this.postAndFlush=function $vpfn_LBnlA0lazrqQnGntRE0dEQ78$24(fnCallback,fnErrorCallback,iRetryCount)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.hasQueuedCommands)
{
return;
}


if(typeof(iRetryCount)==="undefined")
{
iRetryCount=DEFAULT_RETRY_COUNT;
}

var sUpdateXML="<update>"+oXMLQueue.join("")+"</update>";

var sUpdateJSON=vp.http.serializeJSON(oJSONQueue);

sendRequest(oUrl.toString(),sUpdateXML,sUpdateJSON,fnCallback,fnErrorCallback,iRetryCount);


oXMLQueue=[];
oJSONQueue={};
me.hasQueuedCommands=false;
oUrl=new vp.web.URL(sDefaultUrl);
};





var sendRequest=function $vpfn_N3zFIXpq9_0XDjIO6ovmLA108$22(sUrl,sUpdateXML,sUpdateJSON,fnCallback,fnErrorCallback,iRetryCount)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var fnHandleError=function $vpfn_mflBtSzSOiTkxJ4ZnGB88g111$28(ex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.errCallback)
{
this.errCallback(ex);
return;
}
else
{
throw ex;
}
}
.getClosure({errCallback:fnErrorCallback});


var fnCallbackWrapper=function $vpfn_mflBtSzSOiTkxJ4ZnGB88g126$32(sRet)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oResponse;

try
{

oResponse=vp.http.parseJSON(sRet);
}
catch(ex)
{


if(iRetryCount>0)
{
iRetryCount--;
sendRequest(sUrl,sUpdateXML,sUpdateJSON,this.callback,this.errCallback,iRetryCount);
return;
}
else
{
this.handleError(ex);
}
}


var responseCode=oResponse["rc"];
if(responseCode!==0)
{
this.handleError(new Error(oResponse.error_message));
return;
}


if(this.callback)
{
this.callback(oResponse);
}
}
.getClosure({callback:fnCallback,handleError:fnHandleError});


var oQS=new vp.web.QueryString();
oQS.setItem("updateXML",sUpdateXML);
oQS.setItem("updateJSON",sUpdateJSON);
vp.http.postAsync(sUrl,oQS.toString(),fnCallbackWrapper,fnHandleError);
};

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.KeyMapper=function $vpfn_23Z_llbgtXq3ifcmUUscVQ13$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.onkeydown=new vp.events.CustomEvent(this,"onkeydown");





this.onkeypress=new vp.events.CustomEvent(this,"onkeypress");





this.disabled=false;





var keyDownHandler=function $vpfn_CqDrpYS5YN7igs3zMXuaqw39$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

e=vp.events.getEvent(e);

if(me.disabled)
{
return;
}


if(vp.forms.isTextBox(e.target)&&!Editor.currentField)
{
return;
}



if(Editor.features.isIFrameRichTextEnabled)
{

if(e.keyCode==8&&!Editor.currentField&&!document.all)
{
vp.events.cancel(e);
}



if(e.keyCode==9&&Editor.currentField&&!document.all&&Editor.currentField.textAreaType==TEXT_AREA_TYPE_RICH)
{
var iIndex=-1;
var iHighestTextIndex=0;
var iLowestTextIndex=-1;

var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(Editor.items[i]==Editor.currentField)
{
iIndex=i;
}

if(Editor.items[i].type==DOCITEM_TYPE_TEXT)
{
iHighestTextIndex=i;

if(iLowestTextIndex==-1)
{
iLowestTextIndex=i;
}
}
}

if(iIndex<iHighestTextIndex&&!e.shiftKey)
{
Editor.currentField.externalTextField.blur();
Editor.items[iIndex+1].externalTextField.focus();
}
else if(iIndex>iLowestTextIndex&&e.shiftKey)
{
Editor.currentField.externalTextField.blur();
Editor.items[iIndex-1].externalTextField.focus();
}

vp.events.cancel(e);
}
}


if(vp.events.isModifierKey(e)&&e.keyCode==90)
{
Editor.history.undo();
vp.events.cancel(e);
}


if(vp.events.isModifierKey(e)&&e.keyCode==89)
{
Editor.history.redo();
vp.events.cancel(e);
}

me.onkeydown.fire(e);
};

var keyPressHandler=function $vpfn_LvQqaviEquMdXekt4Fbo0g124$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.disabled)
{
return;
}

me.onkeypress.fire(e);
};

vp.events.add(document,"keydown",keyDownHandler);
vp.events.add(document,"keypress",keyPressHandler);
};





vp.events.isModifierKey=function $vpfn_pBVskzpfrsEleketcpu6bg142$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return(vp.browser.OS.isMac?e.metaKey:(e.ctrlKey&&!e.altKey));
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.Editor=function $vpfn_VuU07EybMEIWv897Hd6roQ14$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.isAssrStudio=true;





this.docID=0;





this.comboID=0;






this.enterprisePartnerTemplateID=0;






this.icParts="";






this.renderingTechnology="gdi";





this.icParts2="";





this.PFID="";





this.pageNumber=1;





this.numberOfDocumentPages=1;





this.singleProductBundleId=0;





this.isFromAdvancedGallery=vp.web.getQueryString("ag");





this.useRangyRichText=vp.web.getQueryString("useRangyRichText");





this.isAdvanced=false;





this.isSmartLayout=false;






this.showUnauthorizedDocumentAccessGuardPage=false;




this.showCustomAlert=null;






this.substrateColor=null;




this.colorOverride=null;





this.items=[];





this.imageAreas=[];





this.cutShapes=[];





this.documentArea=null;







this.docItemHandleArea=null;






this.documentAreaContainer=null;





this.textFieldsArea=null;




this.gridOverlay=null;





this.currentField=null;





this.lastAddedItem=null;





this.validationErrorData=null;






this.typoValidationRequestedByUser=false;





this.saveInProgress=false;





this.features={};





this.history=new vp.studio.CommandHistory();





this.keyMapper=new vp.studio.KeyMapper();





this.metaDataItems=[];





this.asyncManager=new vp.studio.EditorAsyncManager(me);







this.asyncActions=new vp.studio.EditorAsyncActions(me);





this.oninitialrender=new vp.events.CustomEvent(this,"oninitialrender");






this.onrender=new vp.events.CustomEvent(this,"onrender");





this.onupgradestart=new vp.events.CustomEvent(this,"onupgradestart");





this.onupgradecomplete=new vp.events.CustomEvent(this,"onupgradecomplete");





this.ondocumentchange=new vp.events.CustomEvent(this,"ondocumentchange");





this.oncombochange=new vp.events.CustomEvent(this,"oncombochange");





this.onsavestart=new vp.events.CustomEvent(this,"onsavestart");





this.onsavecomplete=new vp.events.CustomEvent(this,"onsavecomplete");





this.onzoom=new vp.events.CustomEvent(this,"onzoom");





this.onpagechange=new vp.events.CustomEvent(this,"onpagechange");





this.onregenerate=new vp.events.CustomEvent(this,"onregenerate");





this.onbeforeterminate=new vp.events.CustomEvent(this,"onbeforeterminate");





this.onadditem=new vp.events.CustomEvent(this,"onadditem");





this.onremoveitem=new vp.events.CustomEvent(this,"onremoveitem");





this.oncolorizationchange=new vp.events.CustomEvent(this,"oncolorizationchange");



var m_aZoomLevels=[];


this.resolutionWarningTooltipLocked=null;
this.resolutionWarningTooltipUnlocked=null;






this.addItem=function $vpfn_O0OqKyedYeHcaKpFLCsbSQ358$19(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
init();

oDocItem.coordinates.setZoom(me.zoomFactor);









if(Editor.isFlipbook
&&DOCITEM_TEXT_TYPES.contains(oDocItem.type)
&&me.getItemByID(oDocItem.id))
{
var oldDocItem=me.getItemByID(oDocItem.id);
if(oldDocItem!==oDocItem
&&oldDocItem.type==oDocItem.type)
{






var newStyles=oDocItem.getStyles();

var oldDocItemSelection=new vp.studio.Selection([oldDocItem]);
var setStylesCmd=new vp.studio.commands.SetStyles(oldDocItemSelection,newStyles);
setStylesCmd.execute();


oldDocItem.zIndex=oDocItem.zIndex;
oldDocItem.setZIndex();

me.lastAddedItem=oldDocItem;
ensureZIndexOrderUnique();
me.setDocumentChanged(true);
me.onadditem.fire({item:oDocItem});

return;
}
else
{



me.removeItem(oldDocItem);
}
}

me.items.add(oDocItem);

me.lastAddedItem=oDocItem;

ensureZIndexOrderUnique();

me.setDocumentChanged(true);

me.onadditem.fire({item:oDocItem});
};





this.removeItem=function $vpfn_6jK7$0RryAzJoBDUgMDzPg427$22(vIndexOrDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
init();

var iIndex=-1;
if(typeof(vIndexOrDocItem)=="number")
{
iIndex=vIndexOrDocItem;
}
else
{
var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
if(vIndexOrDocItem==me.items[i])
{
iIndex=i;
break;
}
}
}

if(iIndex<0)
{
return;
}



if(DOCITEM_IMAGE_TYPES.contains(me.items[iIndex].type)&&me.items[iIndex].imageAreaID)
{

var locationInImageArea=me.imageAreas[0].imagesInOrder.indexOf(me.items[iIndex].id);

if(locationInImageArea>-1)
{
me.imageAreas[0].imagesInOrder.splice(locationInImageArea,1);
}
}

me.items[iIndex].unrender();

me.items.splice(iIndex,1);

this.setDocumentChanged(true);

me.onremoveitem.fire();
};

this.removeAllButTextFields=function $vpfn_vteaZLXA8NUN_yJUALKEFQ476$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var removalIndex=0;
while(me.items.length>removalIndex)
{
if(!(Editor.isFlipbook&&DOCITEM_TEXT_TYPES.contains(me.items[removalIndex].type)))
{
me.removeItem(removalIndex);
}
else
{
removalIndex++;
}
}
};




this.removeAll=function $vpfn_hAHR65KOSf5VXpF$jDp69Q495$21(bMaintainTextFields)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
init();

if(bMaintainTextFields)
{
me.removeAllButTextFields();
}
else
{
while(me.items.length>0)
{
me.removeItem(0);
}
}

while(me.imageAreas.length>0)
{
me.imageAreas=[];
}
};




var init=function $vpfn_8HxXYGjphxE14S3VzAW6cQ520$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.isAdvanced&&!me.shapeEditorPanel)
{
if(typeof(vp.studio.ShapeEditorPanel)!="undefined")
{
me.shapeEditorPanel=new vp.studio.ShapeEditorPanel("divInlinePanel");
}
}
me.textFieldsArea=document.getElementById("divStudioTextFields");
if(!me.initComplete)
{
me.documentArea=document.getElementById("divStudioDocumentArea");
me.documentAreaContainer=vp.ui.get("divStudioDocumentAreaContainer");
me.docItemHandleArea=vp.ui.get("divStudioDocumentItemHandleArea");
me.textFieldsArea=document.getElementById("divStudioTextFields");
vp.events.add(me.documentArea,"contextmenu",vp.events.cancel);


initFrames();

vp.dialog.chrome.Primary.preloadImages();


if(Editor.features.enableExitWarningPop)
{
window.onbeforeunload=showCancelMessage;
}


var ZOOM_LEVELS=[1,1.25,1.5,1.75,2];

if($("#divPageSelectorArea")[0])
{
ZOOM_LEVELS=[1,1.325,1.65,1.975,2.3,2.625];
}

for(var i=0;i<ZOOM_LEVELS.length;i++)
{
m_aZoomLevels[i]=ZOOM_LEVELS[i]*me.zoomFactor;
}




var disableKeyMapper=function $vpfn_pEPx2QGpIpG1W0rqYXVcEA566$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.keyMapper.disabled=true;
};

var oCurrentWindow=window;
var enableKeyMapper=function $vpfn_uMgh$5sqxm5gFfoGPh32Og572$34(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(e.dialog.openerWindow==oCurrentWindow)
{
me.keyMapper.disabled=false;
}
};

vp.dialog.Dialog.onopen.addHandler(disableKeyMapper);
vp.dialog.Dialog.onclose.addHandler(enableKeyMapper);

if(window.scrollTo&&Editor.features.setScrollTopBelowHeader)
{

var jHeader=$('#divH1');
if(jHeader.length>0)
{
setTimeout(function $vpfn_Iw5A4IFpV0WcpmGWY92L1g589$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}window.scrollTo(0,jHeader.offset().top);},0);
}
}

me.initComplete=true;
}

};





var showCancelMessage=function $vpfn_VRQSAXGOrYx6w_qj_VC1mg602$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isLoadComplete&&!me.cancelMessageDisabled&&(me.isAdvanced||me.isFlipbook)&&me.isDocumentChanged())
{
if(vp.dialogstudio&&!vp.dialogstudio.enableNavWarning)
{

}
else
{
return JSLM_StudioNavigateCancelWarning;
}
}

var undefined;
return undefined;
};

var m_bDocumentChanged=false;





this.isDocumentChanged=function $vpfn_C4l0pbhEr2FK1iMA1srNgQ626$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_bDocumentChanged;
};





this.isRichTextEnabled=function $vpfn_yaSfqK2mJkiBCPtCfLn8eQ635$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return((vp.widget.RichTextArea||vp.widget.RichTextArea2)&&Editor.features.richTextEnabled)||
(vp.studio.richtext.TextArea&&Editor.features.rangyRichTextEnabled);
};





this.setDocumentChanged=function $vpfn_LmZe9VPfUj4BhmMQWZdcJg645$30(bChanged)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isLoadComplete)
{
return;
}

m_bDocumentChanged=bChanged;



if(me._documentChangeTimer)
{
clearTimeout(me._documentChangeTimer);
}
me._documentChangeTimer=window.setTimeout(documentChangeEvent,400);
};

var documentChangeEvent=function $vpfn_n$2bnF3H7Ddhpybg8_g2zQ663$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.ondocumentchange.fire();
};


var aggregateCutShapes=function $vpfn_7dFjmp2iC_AGS4OQb0JWPw669$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.cutShapes.length===0)
{
return;
}

var oCutShapesLayer=new vp.studio.CutShapeLayer();


for(var i=0;i<me.cutShapes.length;i++)
{
oCutShapesLayer.addShape(me.cutShapes[i]);
}

me.items.add(oCutShapesLayer);
};





var aggregateShapes=function $vpfn_7R0JLu3YJpXngRY0dWZwBQ691$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aItems=getItemsSortedByZIndex();

var iLayerCount=0;
var oCurrentLayer=null;


for(var i=0;i<aItems.length;i++)
{
if(DOCITEM_SHAPE_TYPES.contains(aItems[i].type))
{

if(aItems[i].locked)
{
if(oCurrentLayer===null)
{
oCurrentLayer=new vp.studio.ShapeLayer();
oCurrentLayer.id="vpls_shapelayer_"+iLayerCount;
iLayerCount++;
}

oCurrentLayer.addShape(aItems[i]);
}
}
else
{
if(oCurrentLayer!==null)
{
Editor.items.add(oCurrentLayer);
oCurrentLayer=null;
}
}
}

if(oCurrentLayer!==null)
{
Editor.items.add(oCurrentLayer);
}
};




var _bShapesChanged=false;




this.notifyShapesChanged=function $vpfn_HeHgBGVN699jKRBYZrcfMw740$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bShapesChanged=true;
};

var isUngroupedShape=function $vpfn_wpUpgzl5F950OXBXEhcl4g745$27(oDocumentItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return DOCITEM_SHAPE_TYPES.contains(oDocumentItem.type)&&!oDocumentItem.shapeLayer;
};




this.render=function $vpfn_TFXuoRN2phmUe9pQvORHoQ753$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
renderInternal();

me.onrender.fire();

if(!me.isLoadComplete)
{
initializeScrollContainer();

me.oninitialrender.fire();

if(me.wasFormattingRemoved)
{
window.setTimeout(alertFormattingRemoved,100);
}
}
$("#divFreeProductLeftColumnHeader").show();
me.isLoadComplete=true;
};

var initializeScrollContainer=function $vpfn_ogPE5voT_uGXkQAY_vi3Cw774$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oScrollArea=document.getElementById('divStudioDocumentScrollArea');
var editorWidth=document.getElementById("divStudioEditor").offsetWidth;

if($("#divPageSelectorArea")[0])
{
editorWidth-=$("#divPageSelectorArea").width();
}

oScrollArea.style.width=editorWidth+"px";
};

var renderInternal=function $vpfn_3K2NrKqv_b0RPyTMiWHZ1A787$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
init();

me.items.sort(vp.studio.DocumentItem.compare);

if(!me.isLoadComplete||me.isRegenerating)
{
aggregateShapes();
aggregateCutShapes();
}

for(var i=0;i<me.items.length;i++)
{
if(isUngroupedShape(me.items[i]))
{
me.notifyShapesChanged();
}

me.items[i].render(me);
}

var jCollageOptionsContainer=$("#collageOptionsContainer");
if(jCollageOptionsContainer.length==1)
{
if(me.imageAreas.length>0)
{
jCollageOptionsContainer.show();
}
else
{
jCollageOptionsContainer.hide();
}
}

if(Editor.features.checkImageResolution)
{
var $tooltipContent=$(".resolution-warning-tooltip-content");
me.resolutionWarningTooltipLocked=new vp.widget.RichTooltip("divStudioEditor",$tooltipContent.filter(".locked-image")[0]);
me.resolutionWarningTooltipLocked.setBehavior(TOOLTIP_BEHAVIOR_SHOW_CUSTOM);
me.resolutionWarningTooltipLocked.renderingStrategy=vp.widget.RichTooltip.renderingStrategies.BelowCenter;

me.resolutionWarningTooltipUnlocked=new vp.widget.RichTooltip("divStudioEditor",$tooltipContent.filter(".unlocked-image")[0]);
me.resolutionWarningTooltipUnlocked.setBehavior(TOOLTIP_BEHAVIOR_SHOW_CUSTOM);
me.resolutionWarningTooltipUnlocked.renderingStrategy=vp.widget.RichTooltip.renderingStrategies.BelowCenter;
}

if(!me.isAdvanced)
{


if(me.isCanvasPrint)
{
me.renderFrameRect("safeArea","black",FRAME_THICKNESS_1PX,"dotted",4);
}


if(me.isHorizontalFoldedBusinessCardInside||me.isHorizontalFoldedBusinessCardsProPath)
{
oFoldLineThickness={top:1,left:0,right:0,bottom:0};
me.renderFrameRect("horizontalMiddleFoldLine","red",oFoldLineThickness,"dotted",1);
}
if(me.isVerticalFoldedBusinessCardInside||me.isVerticalFoldedBusinessCardsProPath)
{
oFoldLineThickness={top:0,left:1,right:0,bottom:0};
me.renderFrameRect("verticalMiddleFoldLine","red",oFoldLineThickness,"dotted",1);
}

var oInnerBleed;
if(me.hasHiddenBleed())
{
oInnerBleed=me.hiddenBleed;

me.renderFrameRect("hiddenBleed","white",me.hiddenBleed,"solid",2);


if(me.cutShapes.length===0)
{
me.renderFrameRect("document","black",FRAME_THICKNESS_1PX,"solid",3);
}
}
else
{
var oThicknessHalfBleed={
top:me.bleed.top/2,
left:me.bleed.left/2,
right:me.bleed.right/2,
bottom:me.bleed.bottom/2
};

oInnerBleed=oThicknessHalfBleed;

me.renderFrameRect("document","white",oThicknessHalfBleed,"solid",1);


if(me.cutShapes.length===0)
{
if(me.useSceneOnCanvas&&!me.isMailingServices)
{
me.renderFrameRect("document","black",FRAME_THICKNESS_1PX,"dotted",3);
}
else
{
me.renderFrameRect("cutLine","black",FRAME_THICKNESS_1PX,"solid",2);
}
}
}





me.documentVisualSize={
width:(me.dimensions.width-(oInnerBleed.left+oInnerBleed.right))*me.zoomFactor,
height:(me.dimensions.height-(oInnerBleed.top+oInnerBleed.bottom))*me.zoomFactor
};
}
else
{
var oFoldLineThickness;


if(me.isBrochure)
{
oFoldLineThickness={top:0,left:1,right:0,bottom:0};
me.renderFrameRect("brochureFoldLine1","red",oFoldLineThickness,"dotted",1);
me.renderFrameRect("brochureFoldArea1","black",FRAME_THICKNESS_1PX,"dotted",1);
me.renderFrameRect("brochureFoldLine2","red",oFoldLineThickness,"dotted",1);
me.renderFrameRect("brochureFoldArea2","black",FRAME_THICKNESS_1PX,"dotted",1);
}


if(me.isEnvelopeBackside)
{
var flapLineThickness={top:1,left:0,right:0,bottom:0};
me.renderFrameRect("envelopeFlapLine","red",flapLineThickness,"dotted",1);
me.renderFrameRect("envelopeFlapArea","black",FRAME_THICKNESS_1PX,"dotted",1);
}


if(me.isCreditCard)
{
oFoldLineThickness={top:1,left:0,right:0,bottom:0};
me.renderFrameRect("creditCardForbiddenLine","red",oFoldLineThickness,"dotted",1);
}
}
};

var alertFormattingRemoved=function $vpfn_QeDRnauvP2KCxKAM6KxuWw935$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
alert(JSLM_StudioRichTextRemovedWarning);
};





this.hasHiddenBleed=function $vpfn_Yk3G4adSypV7QvVgrBi3cw944$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.hiddenBleed.top>0||
me.hiddenBleed.left>0||
me.hiddenBleed.bottom>0||
me.hiddenBleed.right>0);
};




this.refresh=function $vpfn_bv1Yn1Y60TApp9lVlFzV2g955$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
me.items[i].refresh();
}
};






this.renderOnLoad=function $vpfn_Pvge7nMl73cRqS0AXK3Jug969$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isLoadComplete)
{
me.render();
}
else
{
vp.events.addOnDOMLoadHandler(me.render);
}
};







this.frames={};





this.frameRects={};




var initFrames=function $vpfn_X6LcKuRR7dYAmR8FjF$Z5Q998$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


me.frameRects.cutLine={
top:Math.round(me.bleed.top/2),
left:Math.round(me.bleed.left/2),
width:me.dimensions.width-((me.bleed.left+me.bleed.right)/2),
height:me.dimensions.height-((me.bleed.top+me.bleed.bottom)/2)
};


me.frameRects.safeArea={
top:me.bleed.top+me.safetyMargin.top,
left:me.bleed.left+me.safetyMargin.left,
width:(me.dimensions.width-(me.bleed.left+me.bleed.right))-(me.safetyMargin.left+me.safetyMargin.right),
height:(me.dimensions.height-(me.bleed.top+me.bleed.bottom))-(me.safetyMargin.top+me.safetyMargin.bottom)
};


me.frameRects.document={
top:me.hiddenBleed.top,
left:me.hiddenBleed.left,
width:me.dimensions.width-(me.hiddenBleed.left+me.hiddenBleed.right),
height:me.dimensions.height-(me.hiddenBleed.top+me.hiddenBleed.bottom)
};


me.frameRects.hiddenBleed={
top:0,
left:0,
width:me.dimensions.width,
height:me.dimensions.height
};





var BROCHURE_FOLD_MARGIN=26;
var BROCHURE_FOLD1_LEFT=(me.pageNumber==1)?532:538;
var BROCHURE_FOLD2_LEFT=(me.pageNumber==1)?1062:1068;

me.frameRects.brochureFoldLine1={
top:0,
left:BROCHURE_FOLD1_LEFT,
width:1,
height:me.dimensions.height
};
me.frameRects.brochureFoldArea1={
top:0,
left:BROCHURE_FOLD1_LEFT-BROCHURE_FOLD_MARGIN,
width:(BROCHURE_FOLD_MARGIN*2)+1,
height:me.dimensions.height
};

me.frameRects.brochureFoldLine2={
top:0,
left:BROCHURE_FOLD2_LEFT,
width:1,
height:me.dimensions.height
};
me.frameRects.brochureFoldArea2={
top:0,
left:BROCHURE_FOLD2_LEFT-BROCHURE_FOLD_MARGIN,
width:(BROCHURE_FOLD_MARGIN*2)+1,
height:me.dimensions.height
};

me.frameRects.creditCardForbiddenLine={
top:me.dimensions.height*0.56,
left:0,
width:me.dimensions.width,
height:1
};


var ENVELOPE_FLAP_MARGIN=20;
var ENVELOPE_FLAP_TOP=Math.round(me.envelopeFlapRatio*me.dimensions.height);

me.frameRects.envelopeFlapLine={
top:ENVELOPE_FLAP_TOP,
left:0,
width:me.dimensions.width,
height:1
};
me.frameRects.envelopeFlapArea={
top:ENVELOPE_FLAP_TOP-ENVELOPE_FLAP_MARGIN,
left:0,
width:me.dimensions.width,
height:(ENVELOPE_FLAP_MARGIN*2)+1
};


me.frameRects.horizontalMiddleFoldLine={
top:Math.round(me.dimensions.height/2),
left:0,
width:me.dimensions.width,
height:1
};

me.frameRects.verticalMiddleFoldLine={
top:0,
left:Math.round(me.dimensions.width/2),
width:1,
height:me.dimensions.height
};
};









this.renderFrameRect=function $vpfn_KS1KW95FWv_kplcj2PUyfg1115$27(sName,sColor,oThicknessRect,sStyle,zIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.hideFrameBorder&&(sName!="safeArea"||Editor.hideSafeArea))
{
return;
}
if(!me.frames[sName])
{
me.frames[sName]=new vp.studio.Frame();
me.frames[sName].coordinates.setRect(me.frameRects[sName]);
}

me.frames[sName].coordinates.setZoom(me.zoomFactor);
me.frames[sName].zIndex=BLEED_AREA_ZINDEX_OFFSET+zIndex;
me.frames[sName].thicknessRect=oThicknessRect;
me.frames[sName].borderStyle=sStyle;
me.frames[sName].color=sColor;
me.frames[sName].render(me.documentArea);
};





this.unrenderFrameRect=function $vpfn_W0$Bk1JtwslFjmZsMjq3cA1139$29(sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.frames[sName])
{
me.frames[sName].unrender();
}
};






this.getItemByID=function $vpfn_p_R8Af8eEAB2fLwPTYwf2Q1152$23(sID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
if(me.items[i].id==sID)
{
return me.items[i];
}
}

return null;
};






this.getItemsByType=function $vpfn_6h2$fO6kKt7ckwX5T_fwVQ1171$26(vType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aList=[];
var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
if(typeof(vType)=="number")
{
if(me.items[i].type==vType)
{
aList.push(me.items[i]);
}
}
else
{
if(vType.contains(me.items[i].type))
{
aList.push(me.items[i]);
}
}

}

return aList;
};






this.getCurrentField=function $vpfn_t$tUP5HBVzQwnzh8EKAp2w1202$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i;
var field=null;

if(me.currentField)
{
field=me.currentField;
}
else
{




for(i=0;i<me.items.length;i++)
{
if(me.items[i].inlineActive&&
DOCITEM_TEXT_TYPES.contains(me.items[i].type))
{
field=me.items[i];
break;
}
}
}

return field;
};









var getUniqueID=function $vpfn_vvagU9jrmcees3gkg5NWeQ1239$22(sProp,sPrefix,aExcludeItems)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i,
sID,
iID=1;

var bUnique=false;

while(!bUnique)
{
sID=sPrefix+iID;
bUnique=true;

for(i=0;i<me.items.length;i++)
{
if(me.items[i][sProp]==sID)
{
bUnique=false;
break;
}
}

if(aExcludeItems)
{
for(i=0;i<aExcludeItems.length;i++)
{
if(aExcludeItems[i][sProp]==sID)
{
bUnique=false;
break;
}
}
}

iID++;
}

return sID;
};








this.assignUniqueID=function $vpfn_8sm4VWyChp44Iz1OKy9crg1286$26(oItem,arrExcludeItems)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oItem.id=getUniqueID("id",oItem.getIDPrefix(),arrExcludeItems);
};








this.assignUniqueLabel=function $vpfn_D_2dv9Za4a2vMB3KwRryMw1298$29(oItem,arrExcludeItems)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(DOCITEM_TEXT_TYPES.contains(oItem.type))
{
oItem.label=me.getUniqueTextFieldLabel();
}
};





this.getUniqueTextFieldLabel=function $vpfn_SAB96r39e4UMg8m8G2GTiw1310$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var PREFIX=JSLM_StudioNewTextFieldPrefix+" ";
var iID=1;

while(true)
{
var bFound=false;

for(var i=0;i<me.items.length;i++)
{
if(DOCITEM_TEXT_TYPES.contains(me.items[i].type)&&me.items[i].label==PREFIX+iID)
{
bFound=true;
break;
}
}

if(!bFound)
{
return PREFIX+iID;
}

iID++;

}

return null;
};





this.getMiniPreviewData=function $vpfn_FbwzJaSp_Ls8WWwA6SWeww1344$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.documentInitialState)
{
if(!window.documentInitialState)
{
throw new Error("Document initial state not initialized.");
}
me.documentInitialState=window.documentInitialState;
}

return{
documentInitialState:me.documentInitialState,
updateXML:"<update>"+getUpdateXML()+"</update>"
};
};



this.latestMiniPreviewId=null;

this.getMiniPreviewUrlFromExisting=function $vpfn_F5Joabrq6s2AYwr8bSQlVw1365$41(oUrlToReplace)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




var width=oUrlToReplace.getItem("width");


var height=oUrlToReplace.getItem("height");

var threedrollangle=oUrlToReplace.getItem("3drollangle");

var threedrotation=oUrlToReplace.getItem("3drotation");


var pageOverride=oUrlToReplace.getItem("page");


var comboid=oUrlToReplace.getItem("combo_id");

var combohash=oUrlToReplace.getItem("combo");

var customcolorscheme=oUrlToReplace.getItem("custom_color_scheme");

var colorschemeid=oUrlToReplace.getItem("color_scheme_id");

var sNewUrl;


try
{
sNewUrl=Editor.getMiniPreviewUrl(width,height,threedrollangle,threedrotation,comboid,combohash,customcolorscheme,colorschemeid,pageOverride);
}
catch(Ex)
{

}

return sNewUrl;
};


this.getMiniPreviewUrl=function $vpfn_hPcGKDKFY4AV5g4HMjBYkQ1408$29(width,height,threedrollangle,threedrotation,comboid,combohash,customcolorscheme,colorschemeid,pageOverride)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oData=me.getMiniPreviewData();

var postData=new vp.web.QueryString();

postData.setItem("d",oData.documentInitialState+"|"+oData.updateXML);
postData.setItem("pfid",me.PFID);
postData.setItem("page",pageOverride||me.pageNumber);
postData.setItem("width",width);
postData.setItem("studio_mini_preview",1);





if(height)
{
postData.setItem("height",height);
}
if(threedrollangle)
{
postData.setItem("3drollangle",threedrollangle);
}
if(threedrotation)
{
postData.setItem("3drotation",threedrotation);
}
if(comboid)
{
postData.setItem("combo_id",comboid);
}
if(combohash)
{
postData.setItem("combo",combohash);
}
if(customcolorscheme)
{
postData.setItem("custom_color_scheme",customcolorscheme);
}
if(colorschemeid)
{
postData.setItem("color_scheme_id",colorschemeid);
}

var url="/sales/documents/previewing/transientdocpreviewprovider.aspx";
var sResponse=vp.http.post(url,postData.toString());

return sResponse;
};






this.getMiniPreviewDataId=function $vpfn_9QK8IcuHztXcxg1EIx3zzg1464$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oData=me.getMiniPreviewData();
var dataId;

try
{
me.getMiniPreviewUrl();
}
catch(Ex)
{
}
try
{

dataId=vp.studio.util.storeLargeData(oData.documentInitialState+"|"+oData.updateXML);


dataId=me.PFID+"-"+dataId;
}
catch(ex)
{







return this.latestMiniPreviewId;
}

if(dataId)
{



this.latestMiniPreviewId=dataId;
}



return this.latestMiniPreviewId;
};







var getUpdateXML=function $vpfn_gbbjvgEFhjUgF20eVReSxw1516$23(bIsAutoSave)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=[];
var i;
arr.add("<statedata page=\""+me.pageNumber+"\" pfid=\""+me.PFID+"\" />");

arr.add("<fontscheme page=\""+me.pageNumber+"\" schemeid=\""+me.fontSchemeID+"\" />");
arr.add("<colorscheme page=\""+me.pageNumber+"\" schemeid=\""+me.colorSchemeID+"\" colors=\""+me.colorScheme.join(";")+"\"/>");

var bContainsUngroupedShapes=false;




for(i=0;i<me.items.length;i++)
{
if(isUngroupedShape(me.items[i]))
{
arr.add("<command value=\"deleteshapes\" />");
bContainsUngroupedShapes=true;
break;
}
}


var offerCheckbox=$("div.single-offer-tile input[type=checkbox]");
if(offerCheckbox.length>0)
{
var offerValue=$("div.single-offer-tile #oeROLI_ct17_o2809");
if(offerCheckbox.is(':checked')&&offerValue.length>0)
{
arr.add("<onlinebcoffer value='"+offerValue.val()+"'/>");
}
}



if(_bShapesChanged&&!bContainsUngroupedShapes)
{
arr.add("<command value=\"deleteshapes\" />");
}

for(i=0;i<me.items.length;i++)
{

if(me.items[i].brandingType!=BRANDING_TYPE_LOCKED&&
me.items[i].brandingType!=BRANDING_TYPE_ALWAYS_SHOW)
{
arr.add(me.items[i].getUpdateXML());
}
}


arr.add("<renderingtechnology value=\""+vp.web.htmlEncode(me.renderingTechnology)+"\" />");


if(!bIsAutoSave||me.docName)
{
arr.add("<renamedoc value=\""+vp.web.htmlEncode(me.docName)+"\" />");
}


if(me.substrateColor)
{
arr.add("<substratecolor value=\""+vp.web.htmlEncode(me.substrateColor)+"\" />");
}


if(me.colorOverride)
{
arr.add("<coloroverride value=\""+vp.web.htmlEncode(me.colorOverride)+"\" />");
}


if(Editor.imageAreas)
{
for(var iAreaCounter=0;iAreaCounter<Editor.imageAreas.length;iAreaCounter++)
{
arr.add(Editor.imageAreas[iAreaCounter].getUpdateXML());
}
}


arr.add("<editorinfo isadvanced=\""+me.isAdvanced+"\" "+
"advancedperpage=\""+me.features.advancedEditingPerPage+"\" "+
"disablecustomizationproductupgrade=\""+me.features.disableCustomizationProductUpgrade+"\" "+
"editingapplication=\""+me.editingApplication+"\" />");


arr.add("<saveinfo isautosave=\""+bIsAutoSave+"\" />");


if(me.markPagesAsViewed)
{
arr.add("<markpagesasviewed />");
vp.studio.instrumentation.add("StudioSave:MarkPagesAsViewed");
}


for(i=1;i<=me.numberOfDocumentPages;i++)
{
if(me.getPageInfo(i).setByUser)
{
var arrStringBuilder=[];
arrStringBuilder.push("<modifyotherpage ");
arrStringBuilder.push("pagenumber=\""+i+"\" ");
var oPageInfo=me.getPageInfo(i);
if(oPageInfo.comboId)
{
arrStringBuilder.push("comboid=\""+oPageInfo.comboId+"\" ");
}
if(oPageInfo.categoryId)
{
arrStringBuilder.push("categoryid=\""+oPageInfo.categoryId+"\" ");
}
if(oPageInfo.icParts)
{
arrStringBuilder.push("icparts=\""+vp.web.htmlEncode(oPageInfo.icParts)+"\" ");
}
if(oPageInfo.miniPreviewColor)
{
arrStringBuilder.push("color=\""+vp.web.htmlEncode(oPageInfo.miniPreviewColor)+"\" ");
}
if(oPageInfo.comboLanguageId)
{
arrStringBuilder.push("combolanguageid=\""+vp.web.htmlEncode(oPageInfo.comboLanguageId)+"\" ");
}
arrStringBuilder.push(" />");
arr.add(arrStringBuilder.join(""));
}
}


for(i=0;i<_aPagesToDelete.length;i++)
{
var delPageStringBuff=["<removepage number=\""];
delPageStringBuff[delPageStringBuff.length]=_aPagesToDelete[i];
delPageStringBuff[delPageStringBuff.length]=["\" />"];
arr.add(delPageStringBuff.join(''));
}


_aPagesToDelete=[];


for(i=0;i<_aAddPagesAfter.length;i++)
{
var addPageStringBuff=["<addpage number=\""];
addPageStringBuff[addPageStringBuff.length]=_aAddPagesAfter[i];
addPageStringBuff[addPageStringBuff.length]=["\" />"];
arr.add(addPageStringBuff.join(''));
}


_aAddPagesAfter=[];

arr.add(me._getAdditionalUpdateXml());

return arr.join("\n");
};




this._getAdditionalUpdateXml=function $vpfn_eq_h4EzkWYce1rttQ_OZhw1680$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"";
};






this.getQueryString=function $vpfn_0M3vTH98bX4UD3WSIOsuBA1690$26(iPageNum,sExtraQSParams)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oQS=new vp.web.QueryString();

if(me.docID!==0)
{
oQS.setItem("doc_id",me.docID);
}
else if(me.isAnEnterprisePartnerTemplate())
{
oQS.setItem("ep_template_id",me.enterprisePartnerTemplateID);
if(Editor.features.isEPTemplateEdit)
{
oQS.setItem("ept_anakin_edit",1);
}
}
else
{
oQS.setItem("combo1",me.icParts);
oQS.setItem("combo2",me.icParts2);
oQS.setItem("combo_id",me.comboID);
}

if(vp.web.getQueryString("dsprojectid")!=="")
{
oQS.setItem("dsprojectid",vp.web.getQueryString("dsprojectid"));
}

if(vp.web.getQueryString("csgt")!=="")
{
oQS.setItem("csgt",vp.web.getQueryString("csgt"));
}

oQS.setItem("pf_id",me.PFID);
oQS.setItem("page",iPageNum);

if(vp.web.getQueryString(EditorConst.renderingTechnologyParam)!=="")
{
oQS.setItem(EditorConst.renderingTechnologyParam,me.renderingTechnology);
}



if(vp.web.getQueryString("noredir"))
{
oQS.setItem("noredir",1);
}

if(EditorConst.postUrl!=="")
{
oQS.setItem("posturl",EditorConst.postUrl);
}

if(vp.web.getQueryString("referer"))
{
oQS.setItem("referer",vp.web.getQueryString("referer"));
}

if(sExtraQSParams&&sExtraQSParams.length>0)
{
oQS.append(sExtraQSParams);
}

oQS.setItem("ag",me.isFromAdvancedGallery);
if(me.isFromAdvancedGallery)
{
oQS.setItem("uei",vp.web.getQueryString("uei"));
}

if(vp.web.getQueryString("ag_category_id"))
{
oQS.setItem("ag_category_id",vp.web.getQueryString("ag_category_id"));
}

if(me.shopperKitId>0)
{
oQS.setItem("shopper_kit_id",me.shopperKitId);
}

if(me.singleProductBundleId>0)
{
oQS.setItem("spb_id",me.singleProductBundleId);
}

if(vp.web.getQueryString("rangyRichText"))
{
oQS.setItem("rangyRichText",vp.web.getQueryString("rangyRichText"));
}


if(vp.web.getQueryString("is_kit_mode")!==""||me.isInKitMode)
{
oQS.setItem("is_kit_mode",vp.web.getQueryString("is_kit_mode"));

if((me.shopperKitId<0)&&(vp.web.getQueryString("shopper_kit_id")!==""))
{
oQS.setItem("shopper_kit_id",vp.web.getQueryString("shopper_kit_id"));
}

if(((vp.web.getQueryString("kit_combo_id")!=="")||(vp.web.getQueryString("kit_combo_hash")!==""))&&(vp.web.getQueryString("kit_pf_id")!=="")&&(vp.web.getQueryString("product_kit_id")!==""))
{
if(vp.web.getQueryString("kit_combo_id")!=="")
{
oQS.setItem("kit_combo_id",vp.web.getQueryString("kit_combo_id"));
}
else
{
oQS.setItem("kit_combo_hash",vp.web.getQueryString("kit_combo_hash"));
}

oQS.setItem("kit_pf_id",vp.web.getQueryString("kit_pf_id"));
oQS.setItem("product_kit_id",vp.web.getQueryString("product_kit_id"));
}

if((vp.web.getQueryString("product_kit_id")!=="")&&(vp.web.getQueryString("kit_document_id")!==""))
{
oQS.setItem("product_kit_id",vp.web.getQueryString("product_kit_id"));
oQS.setItem("kit_document_id",vp.web.getQueryString("kit_document_id"));
}

if((vp.web.getQueryString("product_kit_id")!=="")&&(vp.web.getQueryString("kit_ep_template_id")!==""))
{
oQS.setItem("product_kit_id",vp.web.getQueryString("product_kit_id"));
oQS.setItem("kit_ep_template_id",vp.web.getQueryString("kit_ep_template_id"));
}
}


if(vp.web.getQueryString("dw_visited")!=="")
{
oQS.setItem("dw_visited",vp.web.getQueryString("dw_visited"));
}

if(me.isMailingServices)
{
oQS.setItem("msv",1);
}

return oQS.toString();
};





this.goToPage=function $vpfn_LhrVOz0T5xUwO2aJG5o71A1835$20(iPageNum,sExtraQSParams)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.showProgressBar();
vp.studio.instrumentation.add("Goto page "+iPageNum);

me.cancelMessageDisabled=true;

sExtraQSParams=sExtraQSParams||"";
var oQueryString=new vp.web.QueryString(me.getQueryString(iPageNum,sExtraQSParams));


oQueryString.setItem("isstudio","true");

if(me.goPostStudio)
{
oQueryString.setItem("go_post_studio","1");

if(me.proceedByNextButton)
{
oQueryString.setItem("next_button","1");
}
else if(me.proceedByBacksideLink)
{
oQueryString.setItem("back_side_link","1");
}
}

if(me.showCustomAlert)
{
alert(me.showCustomAlert);
me.showCustomAlert=null;
}
else if(me.showUnauthorizedDocumentAccessGuardPage)
{
var sReferrer=document.location.href;
var oUrl=new vp.web.URL("/studio/doc-access-guard.aspx");
oUrl.setItem("doc_id",me.docID);
oUrl.setItem("referrer",sReferrer);
document.location=oUrl.toString();
}
else
{
document.location=document.location.pathname+"?"+oQueryString.toString();
}
};




this.goToBacksideGallery=function $vpfn_TXxWWaDRu9W1BZfMMU$7Rw1884$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.showProgressBar();
vp.studio.instrumentation.add("Goto backside gallery");

var url=new vp.web.URL(EditorConst.backsideGalleryPageUrl);
url.setItem("doc_id",me.docID.toString());
url.setItem("back_url",document.location.pathname+"?"+me.getQueryString(1));
url.setItem("next_url",document.location.pathname+"?"+me.getQueryString(2));
if(me.substrateColor)
{
url.setItem("ssc",me.substrateColor);
}

document.location=url.toString();
};




this.goToStudioHub=function $vpfn_mXY9rSA1ttp6HWCTTvcpYQ1904$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.showProgressBar();
vp.studio.instrumentation.add("Goto studio hub");

var urlString="/kit-studio-hub.aspx?shopper_kit_id="+me.shopperKitId+"&is_kit_mode=true";
var url=new vp.web.URL(urlString);
document.location=url.toString();
};

this.goToFacebookPage=function $vpfn_hOQuj$s3g34j8$xRv$RJ2A1914$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var urlString="/vp/facebook-share.aspx";
var url=new vp.web.URL(urlString);

url.setItem("doc_id",me.docID.toString());
var fb_popup=vp.dialog.IFrameDialog.open(
"Facebook Holiday Card",
"Send your Facebook Holiday Card",
url.toString(),
vp.dialog.chrome.Message,
500,
500
);
};




this.goToMatchingSetGallery=function $vpfn_NukPpaFLIMZ4fR$bl4odhA1933$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.showProgressBar();
vp.studio.instrumentation.add("Goto matching set gallery");

var msGalleryQS="/vp/ns/matching_set_choose_products.aspx";
var url=new vp.web.URL(msGalleryQS);
url.setItem("doc_id",me.docID.toString());
url.setItem("combo_id",me.comboID.toString());
url.setItem("offered",me.PFID.toString());
url.setItem("disp_src",true);

document.location=url.toString();
};





var runMethodOnChildren=function $vpfn_LaB$PNg06lLmF$bhUx27cw1952$30(sMethodName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.items.length;i++)
{
if(me.items[i][sMethodName])
{
me.items[i][sMethodName]();
}
}
};







var runBooleanMethodOnChildren=function $vpfn_ZRIZk3tkAnR2PGHYxPFbwg1969$37(sBooleanMethodName,bAndResults)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var bResult=bAndResults;

for(var i=0;i<me.items.length;i++)
{
if(me.items[i][sBooleanMethodName])
{
if(bAndResults)
{
bResult=bResult&&me.items[i][sBooleanMethodName]();
}
else
{
bResult=bResult||me.items[i][sBooleanMethodName]();
}
}
}

return bResult;
};




this.deleteClickText=function $vpfn__0ElgWqzH5B4XH5I_CMQdA1995$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
runMethodOnChildren("deleteClickText");
me.ondocumentchange.fire();
};





this.hideClickText=function $vpfn_oXIiwB_l89Qkf3P2fv9hbg2005$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
runMethodOnChildren("hideClickText");
me.ondocumentchange.fire();
};




this.showClickText=function $vpfn_3ey_TxZn5fjEojJJz5j_NQ2014$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
runMethodOnChildren("showClickText");
me.ondocumentchange.fire();
};




this.hasClickText=function $vpfn_zRLaCKrPQHGwMmZtU59_iA2023$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return runBooleanMethodOnChildren("hasClickText",false);
};




this.hasText=function $vpfn_UMNb$$j3iXV1P6TjbvsXUQ2031$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return runBooleanMethodOnChildren("hasText",false);
};






this.regenerateEditorArea=function $vpfn_XbpgOW7B13Qs3v8RZCMU2A2041$32(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var reactiveNode=new vp.xml.XMLNode("reactivelayout");
var xml=new vp.studio.UpdateXML();
xml.add(getUpdateXML());
xml.add(reactiveNode);
postUpdateXML(xml,fnCallback,false,true);
};




var getItemsSortedByZIndex=function $vpfn_5DOvm1W7v8zQZhH3GSb6ug2053$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aTempItems=[];
for(var i=0;i<me.items.length;i++)
{
aTempItems[i]=me.items[i];
}

aTempItems.sort(vp.studio.DocumentItem.compareZIndex);

return aTempItems;
};




var ensureZIndexOrderUnique=function $vpfn_7NlmHGse4MOrgsILTikl9Q2069$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aTempItems=getItemsSortedByZIndex();

var iLastZIndex=null;
for(var i=0;i<aTempItems.length;i++)
{
var iDiff=0;

if(iLastZIndex!==null)
{
iDiff=parseInt(aTempItems[i].zIndex)-iLastZIndex;

if(iDiff<=0)
{
aTempItems[i].zIndex=parseInt(aTempItems[i].zIndex)+Math.abs(iDiff)+1;
}
}

iLastZIndex=aTempItems[i].zIndex;
}
};









var postUpdateXML=function $vpfn_lwJb8tqNNpAeBaqor_3FTQ2100$24(sUpdateXML,fnCallback,bSaveToPortfolio,bRegenerate,bIsSaveAsEPTemplate,iRetryCount)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iRetryCount)=="undefined")
{
iRetryCount=3;
}


var fnCallbackWrapper=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2108$32(sRet)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try
{

try
{

var oResponse=vp.http.parseJSON(sRet);
}
catch(ex)
{


if(iRetryCount>0)
{
iRetryCount--;
postUpdateXML(sUpdateXML,fnCallback,bSaveToPortfolio,bRegenerate,bIsSaveAsEPTemplate,iRetryCount);
return;
}
else
{
throw ex;
}
}


var responseCode=oResponse["rc"];

if(responseCode===0)
{
this.editor.docID=oResponse["doc_id"];

if(vp.web.getQueryString("doc_id")!=this.editor.docID.toString()&&this.editor.docID>0)
{
vp.web.setUrlHashData("doc_id",this.editor.docID);
}

if(this.editor.PFID!=oResponse["pf_id"])
{
this.editor.PFID=oResponse["pf_id"];
vp.web.setUrlHashData("pf_id",this.editor.PFID);
}


var backsidePreviewUrl=oResponse["backside_preview_url"];
if(backsidePreviewUrl)
{
this.editor.backsidePreviewUrl=backsidePreviewUrl;
}


var mapData=oResponse["maps"];
if(mapData)
{
for(var id in mapData)
{
var oMapIds=mapData[id];
var oMap=me.getItemByID(id);
if(oMap&&oMap.type===DOCITEM_TYPE_MAP)
{
oMap.mapData.id=oMapIds.data_id;
oMap.mapAddress.id=oMapIds.addr_id;
}
}
}


if(oResponse["regen_script"])
{
me.removeAll(oResponse["regen_maintain_textfields"]);
me.isRegenerating=true;
eval(oResponse["regen_script"]);
me.isRegenerating=false;
me.onregenerate.fire();
}

if(oResponse["resolution"])
{
var pages=oResponse["resolution"];
if(pages[me.pageNumber])
{
$(".resolution-warnings").show();
}
else
{
$(".resolution-warnings").hide();
}
}


if(oResponse["document_initial_state"])
{
me.documentInitialState=oResponse["document_initial_state"];
}

if(oResponse["validationErrorData"])
{
this.editor.validationErrorData=$.parseJSON(oResponse["validationErrorData"]);
}

if(oResponse["shopper_kit_id"]&&(oResponse["shopper_kit_id"]>0))
{
this.editor.shopperKitId=oResponse["shopper_kit_id"];

if(vp.web.getQueryString("shopper_kit_id")!=this.editor.shopperKitId.toString())
{
vp.web.setUrlHashData("shopper_kit_id",this.editor.shopperKitId);
}
}
}
else if(responseCode===-2)
{
this.editor.showUnauthorizedDocumentAccessGuardPage=true;
}
else if(responseCode===-3)
{
this.editor.hideProgressBar();
this.editor.showCustomAlert=oResponse["error_info"];
}
else
{
var oError=new vp.studio.Error(ERR_SAVE_FAILED,"Save failed. Return code incorrect. Server returned: "+sRet);
oError.throw_();
}

}
catch(e)
{
var oError2=new vp.studio.Error(e);
oError2.message=JSLM_StudioSaveDocumentError;
oError2.throw_();
}

if(this.callback)
{
this.callback();
}
}
.getClosure(
{
editor:me,
callback:fnCallback
}
);

var postData=new vp.web.QueryString();
postData.setItem("updateXML",sUpdateXML);
postData.setItem("validate",true);
postData.setItem("save_to_portfolio",bSaveToPortfolio?1:0);
postData.setItem("save_as_ep_template",bIsSaveAsEPTemplate?1:0);

postData.setItem("regenerate",bRegenerate?1:0);

if(me.cartItemId>0)
{
postData.setItem("cartItemId",me.cartItemId);
}


if(vp.web.getQueryString("co"))
{
postData.setItem("co",vp.web.getQueryString("co"));
}
if(vp.web.getQueryString("backsideFromAG"))
{
postData.setItem("backsideFromAG",vp.web.getQueryString("backsideFromAG"));
}


if((me.shopperKitId>0)||(me.productKitId>0))
{
postData.setItem("is_kit_mode",me.isInKitMode);

if(me.shopperKitId>0)
{
postData.setItem("shopper_kit_id",me.shopperKitId);
}
if((me.kitPrimaryComboId||me.kitPrimaryComboHash||me.kitEpTemplateId)&&me.kitPrimaryPfId&&me.productKitId)
{
if(me.productKitId>0)
{
postData.setItem("product_kit_id",me.productKitId);
}
if(me.kitPrimaryPfId)
{
postData.setItem("kit_pf_id",me.kitPrimaryPfId);
}
if(me.kitPrimaryComboId>0)
{
postData.setItem("kit_combo_id",me.kitPrimaryComboId);
}
else if(me.kitPrimaryComboHash)
{
postData.setItem("kit_combo_hash",me.kitPrimaryComboHash);
}
if(me.kitDocumentId>0)
{
postData.setItem("kit_document_id",me.kitDocumentId);
}
if(me.kitEpTemplateId>0)
{
postData.setItem("kit_ep_template_id",me.kitEpTemplateId);
}

if(me.kitPfIdList&&me.kitPfIdList.length>0)
{
postData.setItem("kit_pfids",me.kitPfIdList);
}
}


if(me.duplicateThisDesign)
{
postData.setItem("duplicate",1);


postData.setItem("kit_pfids",me.PFID);
postData.setItem("kit_pf_id",me.PFID);


if(me.kitDocumentId>0&&me.productKitId)
{
postData.setItem("kit_document_id",me.kitDocumentId);
postData.setItem("product_kit_id",me.productKitId);
}
}
}

var sURL="/vp/ns/studio_web_service.aspx?"+me.getQueryString(me.pageNumber)+"&u="+new Date().valueOf();

vp.http.postAsync(sURL,postData.toString(),fnCallbackWrapper);
};





this.saveToPortfolio=function $vpfn_qbkn1DlhVKYjNQyptO8xbg2346$27(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.save(fnCallback,true);
};









this.save=function $vpfn_N5V9qRtK1Np$O5aM$$vRAQ2359$16(fnCallback,bSaveToPortfolio,bPreserveClickText,bIsAutoSave,bRegenUI)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
bPreserveClickText=bPreserveClickText?true:false;


me.clearValidationState();


if(me.saveInProgress)
{
var fnRetrySave=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2369$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.save(this.callback,this.saveToPortfolio,this.preserveClickText);
}
.getClosure(
{
editor:me,
callback:fnCallback,
saveToPortfolio:bSaveToPortfolio,
preserveClickText:bPreserveClickText
}
);

window.setTimeout(fnRetrySave,100);
return;
}

me.saveInProgress=true;

me.onsavestart.fire();


if(!me.isDocumentChanged()&&
!bSaveToPortfolio&&
me.docID!==0&&
(!me.hasClickText()||bPreserveClickText)&&
!me.duplicateThisDesign)
{
me.saveInProgress=false;

var e={wasDocumentSaved:false};
me.onsavecomplete.fire(e);

if(fnCallback)
{
window.setTimeout(fnCallback,100);
}
return;
}


ensureZIndexOrderUnique();


if(!bPreserveClickText)
{
me.deleteClickText();
}


if(me.isSmartLayout)
{
vp.smartlayout.update();
}


if(!bIsAutoSave)
{
me.generateDocumentName();
}

vp.studio.instrumentation.add("Save-started");


var fnCallbackWrapper=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2433$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Save-finished");
m_bDocumentChanged=false;
me.saveInProgress=false;
var e={wasDocumentSaved:true};
this.saveEvent(e);

if(this.callback)
{
this.callback();
}

m_dLastSave=new Date();


if(m_iAutoSaveSeconds>0&&!this.isAutoSave)
{
var iAutoSaveSeconds=m_iAutoSaveSeconds;
me.setAutoSave(0);
me.setAutoSave(iAutoSaveSeconds);
}
}
.getClosure(
{
callback:fnCallback,
saveEvent:me.onsavecomplete.fire,
isAutoSave:bIsAutoSave
}
);

if(Editor.isFlipbook)
{



bRegenUI=true;
}


postUpdateXML("<update>"+getUpdateXML(bIsAutoSave)+"</update>",fnCallbackWrapper,bSaveToPortfolio,bRegenUI);
};





this.saveAsEnterprisePartnerTemplate=function $vpfn_HdA$e764bu4rOGpCg_A3Eg2480$43(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.saveInProgress)
{
var fnRetrySave=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2485$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.saveAsEnterprisePartnerTemplate(this.callback);
}
.getClosure(
{
editor:me,
callback:fnCallback
}
);

window.setTimeout(fnRetrySave,100);
return;
}

me.saveInProgress=true;


ensureZIndexOrderUnique();


if(me.isSmartLayout)
{
vp.smartlayout.update();
}

vp.studio.instrumentation.add("Save As EP Template-started");


var fnCallbackWrapper=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2514$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Save As EP Template-finished");
me.saveInProgress=false;

if(this.callback)
{
this.callback();
}
}
.getClosure(
{
callback:fnCallback
}
);


postUpdateXML("<update>"+getUpdateXML()+"</update>",fnCallbackWrapper,false,false,true);

};


var m_iAutoSaveSeconds=0;


var m_dLastSave=new Date();


var m_iAutoSaveTimer=null;





this.setAutoSave=function $vpfn_wfvJrIK2RCMJq2MEYqGbYA2548$23(iSeconds)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(m_iAutoSaveSeconds==iSeconds)
{
return;
}


if(iSeconds===0&&m_iAutoSaveTimer!==null)
{
clearInterval(m_iAutoSaveTimer);
}
else if(m_iAutoSaveSeconds===0)
{
clearInterval(m_iAutoSaveTimer);
m_iAutoSaveTimer=setInterval(autoSave,iSeconds*1000);
}

m_iAutoSaveSeconds=iSeconds;
};


var autoSave=function $vpfn_niKTFECo00luLv8zNClEPw2570$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isDocumentChanged())
{

if(!me.saveInProgress)
{
me.save(null,false,true,true);
}
}
};




this.generateDocumentName=function $vpfn_cbROtvW4ERwTIfeA1e50uw2585$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.docName)
{
return;
}

me.setDocumentChanged(true);

var MAX_NAME_LENGTH=64;

var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{

if(DOCITEM_TEXT_TYPES.contains(me.items[i].type)&&me.items[i].data!==""&&me.items[i].data!=me.items[i].clickText)
{
var sName=me.items[i].data;
sName=sName.replace(/\n/gi," ");
sName=sName.replace(/\r/gi,"");
sName=sName.replace(/\f/gi,"");
sName=vp.web.htmlDecode(vp.text.stripHtml(sName));
break;
}
}

if(!sName)
{
sName=Editor.defaultDocumentName;
}


sName.trim();
sName=vp.web.xmlEncodeDoubleByteUnicodeToAscii(sName);
if(sName.length>MAX_NAME_LENGTH)
{
sName=sName.substr(0,MAX_NAME_LENGTH-1);
}
me.docName=vp.web.xmlDecode(sName);
};

this.changePage=function $vpfn_s_pqXj7slJ4UUrXE9U4Ymw2626$22(iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var changePageNode=new vp.xml.XMLNode("changepage");
changePageNode.attributes["page"]=iPageNumber;

var xml=new vp.studio.UpdateXML();
xml.add(getUpdateXML());
xml.add(changePageNode);

var e={
prevPageNum:me.pageNumber,
newPageNum:iPageNumber
};


postUpdateXML(xml.toString(),
function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2643$12(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.onpagechange.fire(e);},
false,true);

};

this.toggleChangeColorAndLayoutLinks=function $vpfn_5myJHGxkYzpgxvi1wdO_3A2648$43()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var showChangeColorVisibility=(me.showChangeColorLink&&me.showChangeLayoutLink)?"":"none";
var changeColorDiv=$("#divChangeColorAndLayout");
changeColorDiv.css("display",showChangeColorVisibility);
changeColorDiv.parent().prev(".verticalDivider").css("display",showChangeColorVisibility);



var optionalColorDiv=vp.ui.get("divColorVariationPicker");
if(optionalColorDiv)
{
optionalColorDiv.style.display=(me.showChangeColorLink&&!me.showChangeLayoutLink)?"":"none";
}
};















this.changeCombo=function $vpfn_Q3a_ly2D5akrzYNVNwSCCw2679$23(sICParts,sComboId,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oOptions)
{
oOptions={};
}

if(typeof(oOptions.regenerate)=='undefined')
{
oOptions.regenerate=true;
}





this.notifyShapesChanged();


if(sComboId&&sComboId==me.comboID&&sICParts&&sICParts==me.icParts)
{
if(oOptions.callback)
{
setTimeout(oOptions.callback,1);
}
return;
}


var comboNode=new vp.xml.XMLNode("combochange");
comboNode.attributes["page"]=me.pageNumber;
comboNode.attributes["comboid"]=sComboId;
comboNode.attributes["icparts"]=sICParts;
comboNode.attributes["dominchange"]=oOptions.doMinChange?"True":"False";
comboNode.attributes["changeallpages"]=oOptions.changeAllPages?"True":"False";

if(Editor.PFID!=oOptions.pfId)
{
comboNode.attributes["pfid"]=oOptions.pfId;
}

if(Editor.enterprisePartnerTemplateId!=oOptions.epTemplateId)
{
comboNode.attributes["eptempateid"]=oOptions.epTemplateId;
}

if(oOptions.languageId)
{
comboNode.attributes["combolanguageid"]=oOptions.languageId;
}

if(oOptions.categoryId)
{
comboNode.attributes["categoryid"]=oOptions.categoryId;
}


comboNode.attributes["dontpreservestylechanges"]=(oOptions.dontPreserveStyleChanges||Editor.dontPreserveStyleChanges)?"True":"False";
Editor.dontPreserveStyleChanges=false;


if(Editor.bleedToggleCrop)
{
comboNode.attributes["desiredcrop"]=Editor.bleedToggleCrop;
}

var xml=new vp.studio.UpdateXML();
xml.add(getUpdateXML());
xml.add(comboNode);

var bChangedColor=false;
if((typeof(oOptions.color)!="undefined"))
{
var colorNode=new vp.xml.XMLNode("colorchange");
colorNode.attributes["page"]=me.pageNumber;
colorNode.attributes["mode"]=oOptions.color;
xml.add(colorNode);
bChangedColor=true;
}

var onPostComplete=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2759$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.toggleChangeColorAndLayoutLinks();
this.editor.showClickText();
this.editor.oncombochange.fire({pageNumber:this.editor.pageNumber,comboId:sComboId,comboHash:sICParts});
if(bChangedColor)
{
this.editor.oncolorizationchange.fire({pageNumber:this.editor.pageNumber,colorization:oOptions.color});
}

var oDivUploadImageControl=vp.ui.get("divUploadReplaceImageControl");
var oDivBackSideReplaceImageControl=vp.ui.get("divBackSideReplaceImageControl");

if(oDivUploadImageControl)
{
if(this.editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER).length>0||
this.editor.getItemsByType(DOCITEM_TYPE_UPLOADED_IMAGE).length>0)
{
vp.ui.show(oDivUploadImageControl);
}
else
{
vp.ui.hide(oDivUploadImageControl);
}
}

if(oDivBackSideReplaceImageControl)
{
if(this.editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER).length>0)
{
vp.ui.show(oDivBackSideReplaceImageControl);
}
else
{
vp.ui.collapse(oDivBackSideReplaceImageControl);
}
}

var oDivTextFieldStylizedContainer=vp.ui.get("divEditorTextFieldContainer");
if(oDivTextFieldStylizedContainer)
{
if(this.editor.getItemsByType(DOCITEM_TEXT_TYPES).length>0)
{
vp.ui.show(oDivTextFieldStylizedContainer);
}
else
{
vp.ui.collapse(oDivTextFieldStylizedContainer);
}
}

if(this.callback)
{
this.callback();
}
}
.getClosure(
{
editor:me,
callback:oOptions.callback
}
);


postUpdateXML(xml.toString(),onPostComplete,false,oOptions.regenerate);


if(!bChangedColor)
{
var optionColor=oOptions.color;


if((typeof(optionColor)!="undefined")&&(optionColor!==me.pageColorization))
{

me.changePageColorization(oOptions.color);
}


else if((typeof(optionColor)!="undefined")&&optionColor===me.pageColorization)
{

}


else if(me.pageColorization==PAGE_COLORIZATION_blank||me.pageColorization==PAGE_COLORIZATION_branded)
{
me.changePageColorization(PAGE_COLORIZATION_color);
}
}
};





this.changeBacksideColor=function $vpfn_ub9MrLULEYZNPf53DRqjoQ2855$31(sValue,fnCallback,bRegenUI)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(2==me.pageNumber&&me.pageColorization==sValue)
{




if(sValue!=PAGE_COLORIZATION_gray||!me.isFreeBackside)
{
fnCallback();
return;
}
}

me.changePageColorization(sValue,fnCallback,bRegenUI,2);
};

this.changePageColorization=function $vpfn_0Ljn9KIxBALN_WmkW_IpRw2873$34(sValue,fnCallback,bRegenUI,iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!iPageNumber)
{

iPageNumber=me.pageNumber;
}

var comboNode=new vp.xml.XMLNode("colorchange");
comboNode.attributes["page"]=iPageNumber;
comboNode.attributes["mode"]=sValue;

var xml=new vp.studio.UpdateXML();
xml.add(comboNode);
xml.add(getUpdateXML());



var oTextFieldContainer=vp.ui.get("divEditorTextFieldContainer");
var oAddTextLink=document.getElementById('aAddTextLink');
if(sValue==PAGE_COLORIZATION_blank||sValue==PAGE_COLORIZATION_branded)
{
if(oTextFieldContainer)
{
vp.ui.collapse(oTextFieldContainer);
}
if(oAddTextLink)
{
vp.ui.collapse(oAddTextLink);
}
}
else
{
if(oTextFieldContainer)
{
vp.ui.expand(oTextFieldContainer);
}
if(oAddTextLink)
{
vp.ui.expand(oAddTextLink);
}
}

var fnAfterUpdate=function $vpfn_Iw5A4IFpV0WcpmGWY92L1g2916$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.editor.pageColorization=this.value;
this.editor.oncolorizationchange.fire({pageNumber:iPageNumber,colorization:sValue});

if(this.callback)
{
this.callback();
}
}
.getClosure(
{
editor:me,
callback:fnCallback,
value:sValue
}
);

bRegenUI=typeof(bRegenUI)!='undefined'?bRegenUI:true;


postUpdateXML(xml.toString(),fnAfterUpdate,false,bRegenUI);
};

this.initializeBacksideColorSelector=function $vpfn_jWZ4yOByeQyfIcMotadfog2940$43()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnChangeColorizationRadioGroup=function $vpfn_bY3XF6megXY1ZqvzxiWqaw2942$45()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var colorizationRadioGroup=vp.studio.ui.getBacksideRadioGroup();
if(colorizationRadioGroup
&&(vp.forms.getValue(colorizationRadioGroup)!==this.pageColorization))
{
vp.forms.setValue(colorizationRadioGroup,this.pageColorization);
}
};

this.oncolorizationchange.addHandler(fnChangeColorizationRadioGroup);
};






this.changeColorScheme=function $vpfn_8I9rgrp5JVcGUD_q0AwIww2960$29(iColorSchemeID,aColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.colorSchemeID=iColorSchemeID;
me.colorScheme=aColors;

for(var i=0;i<me.items.length;i++)
{
if(me.items[i].applyColorScheme)
{
me.items[i].applyColorScheme(aColors);
}


else
{
me.refresh();
}
}










me.fieldColorScheme=aColors;
};

this.isStudioGalleryEnabled=function $vpfn_I8Q_l3SVU$WIK_7mquU5hQ2991$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ssElem=vp.ui.get('divFreeProductGallery');
if(ssElem)
{
return ssElem.style.display!="none";
}

return false;
};





this.startOrderProof=function $vpfn_elactnBBCyniKxlfc9AaLA3006$27(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("orderproof-start");

var fnCallbackWrapper=function $vpfn_bFd7G2R2XFNiT67qKLbtiQ3010$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
fnCallback(
me.docID,
me.isMailingServices,
me.shopperKitId?me.shopperKitId:0);
};

me.asyncManager.start(me.saveToPortfolio,fnCallbackWrapper);
};







this.changeColorOverride=function $vpfn_YRzmDunJjOt8926$NItLKA3027$31(iColor,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bColorChanged=false;
if(iColor!=me.colorOverride||bForce)
{
if(me.colorOverrides&&me.colorOverrides[iColor])
{
me.colorOverride=iColor;

for(var i=0;i<me.items.length;i++)
{
me.items[i].refresh();
if(me.items[i].refreshBaseTextField)
{
me.items[i].refreshBaseTextField();
}
}


m_bDocumentChanged=true;


bColorChanged=true;
}
}

return bColorChanged;
};







this.changeSubstrateColor=function $vpfn_LUmuj3lMyNcxdrVM3_nl9w3062$32(iColor,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bColorChanged=false;
if((me.substrateColor!=iColor||bForce)&&Editor.isLoadComplete)
{
if(me.colorOverrideSubstrateMap)
{
me.changeColorOverride(me.colorOverrideSubstrateMap[iColor]);
}


me.substrateColor=iColor;


m_bDocumentChanged=true;

bColorChanged=true;
}

return bColorChanged;
};





this.initializeSubstrateColor=function $vpfn_kQ2FccKCVhY57x5Bjj_erQ3088$36(iColor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.colorOverrideSubstrateMap)
{
var fnChangeColorOverride=function $vpfn_o6PUE51YAS8QC$1ybgDWuA3092$40(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.changeColorOverride(me.colorOverrideSubstrateMap[iColor]);
};
Editor.oninitialrender.addHandler(fnChangeColorOverride);
}


me.substrateColor=iColor;
};




this.upgradeToAdvanced=function $vpfn_lMglHp2YNKF2aP3QUnWnNQ3106$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.cancelMessageDisabled=(vp.web.getQueryString("cancelDisabledMessage")=="true");
if(!me.isLoadComplete)
{
window.setTimeout(me.upgradeToAdvanced,10);
return;
}

if(me.allowAdvancedStudio&&!me.isAdvanced)
{
vp.studio.instrumentation.add("Upgrade-start");
me.onupgradestart.fire();

me.setDocumentChanged(true);

me.showProgressBar();

var sUniqueKey=window.isDebug?new Date().valueOf():EditorConst.siteVersion;

if($.isArray(EditorConst.advancedFile))
{
var logic=EditorConst.advancedFile[0];
var toolbar=EditorConst.advancedFile[1];


$.ajax({
url:logic,
dataType:'script',
cache:true,
success:_.debounce(function $vpfn_Iw5A4IFpV0WcpmGWY92L1g3136$40(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$.ajax({
url:toolbar,
dataType:'script',
cache:true
});
},0)
});


vp.studio.util._lastScriptLoadCallback=upgradeCompleteHandler;
}
else
{
vp.studio.util.loadScript(EditorConst.advancedFile+"?u="+sUniqueKey,upgradeCompleteHandler);
}
}
};

var upgradeCompleteHandler=function $vpfn_yTbQ6OC$W7$XyfEF6CSzew3155$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i;


if(Editor.removeBrandingOnUpgrade)
{
for(i=0;i<me.items.length;i++)
{
if(me.items[i].brandingType==BRANDING_TYPE_LOCKED||
me.items[i].brandingType==BRANDING_TYPE_ALWAYS_SHOW)
{
me.removeItem(i);
}
}
}


me.gridOverlay=new vp.studio.GridOverlay();
me.gridOverlay.majorColor=Editor.features.gridLinesMajorColor;
me.gridOverlay.minorColor=Editor.features.gridLinesMinorColor;
Editor.addItem(me.gridOverlay);
me.gridOverlay.render(me);


if(Editor.rulerEnabled)
{
var rightRulerUrl=new vp.web.URL($("img","#rightRuler").attr("src"));
rightRulerUrl.setItem("offset",0);
$("img","#rightRuler").attr("src",rightRulerUrl.toString());
var bottomRulerUrl=new vp.web.URL($("img","#bottomRuler").attr("src"));
bottomRulerUrl.setItem("offset",0);
$("img","#bottomRuler").attr("src",bottomRulerUrl.toString);
}

renderInternal();

vp.studio.instrumentation.add("Upgrade-finished");
vp.spot.track("studio3_advanced_"+me.PFID);

me.hideProgressBar();
me.onupgradecomplete.fire();

};






this.decorate=function $vpfn_UZuWf8TsojzTvgiN3UHsNA3205$20(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateEditor(me);

for(var i=0,iLen=me.items.length;i<iLen;i++)
{
me.items[i].upgrade(oDecorator);
}
};




this.showProgressBar=function $vpfn_$EZ83Kp25CqAYbAh6AmCoA3218$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
init();

if(!me.progressBar)
{
me.progressBar=new vp.widget.LoadingBox();
me.progressBar.delay=0;
me.progressBar.manualHide=true;
me.progressBar.message=JSLM_StudioWaitingMessage;
}

var oRect=vp.ui.getRect(me.documentArea);


me.progressBar.top=oRect.top+((oRect.height-me.progressBar.height)/2);
me.progressBar.left=oRect.left+((oRect.width-me.progressBar.width)/2);


if(me.progressBar.top>0&&me.progressBar.left>0)
{

me.progressBar.show();
}
};




this.hideProgressBar=function $vpfn_73HkeQW0z_geDPZVzeB2gQ3247$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.progressBar)
{
me.progressBar.hide();
}
};

this.isAnEnterprisePartnerTemplate=function $vpfn_Uy2asDFdHffFQJKd849kmw3255$41()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.enterprisePartnerTemplateID!==0);
};





this.terminate=function $vpfn__yC3ALVE8YxZu6prQDT3rA3264$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try
{
me.onbeforeterminate.fire();

vp.win.closeChildWindows();

var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
me.items[i].terminate();
me.items[i]=null;
}

for(var prop in me)
{
me[prop]=null;
}

vp.events.removeAll();
vp.core.clearClosures();
}
catch(ex)
{
if(window.isDebug)
{
alert("Error on termination. "+ex);
}
}
};

vp.events.add(window,"unload",this.terminate);





this.setZoom=function $vpfn_lPgPeziMUBuBZ2WG3Me4vQ3302$19(fZoomFactor,bOverride)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.zoomFactor==fZoomFactor&&!bOverride)
{
return;
}

vp.studio.instrumentation.add("Zoom");

me.showProgressBar();

me.zoomFactor=fZoomFactor;


me.documentArea.style.width=Math.round(me.dimensions.width*me.zoomFactor)+'px';
me.documentArea.style.height=Math.round(me.dimensions.height*me.zoomFactor)+'px';
me.docItemHandleArea.style.width=Math.round(me.dimensions.width*me.zoomFactor)+'px';
me.docItemHandleArea.style.height=Math.round(me.dimensions.height*me.zoomFactor)+'px';

if(Editor.useSceneOnCanvas)
{
me.documentAreaContainer.style.width=Math.round(me.sceneDimensions.width*me.zoomFactor)+'px';
me.documentAreaContainer.style.height=Math.round(me.sceneDimensions.height*me.zoomFactor)+'px';

me.docItemHandleArea.style.top=Math.round(me.sceneDimensions.height*me.sceneDimensions.documentAreaTopOffsetRatio*me.zoomFactor)+'px';
me.docItemHandleArea.style.left=Math.round(me.sceneDimensions.width*me.sceneDimensions.documentAreaLeftOffsetRatio*me.zoomFactor)+'px';

me.documentArea.style.top=Math.round(me.sceneDimensions.height*me.sceneDimensions.documentAreaTopOffsetRatio*me.zoomFactor)+'px';
me.documentArea.style.left=Math.round(me.sceneDimensions.width*me.sceneDimensions.documentAreaLeftOffsetRatio*me.zoomFactor)+'px';
}
else
{
me.documentAreaContainer.style.width=Math.round(me.dimensions.width*me.zoomFactor)+'px';
me.documentAreaContainer.style.height=Math.round(me.dimensions.height*me.zoomFactor)+'px';
}

if(Editor.rulerEnabled)
{
var rightRulerUrl=new vp.web.URL($("img","#rightRuler").attr("src"));
rightRulerUrl.setItem("size",Math.round(me.dimensions.height*me.zoomFactor));
$("img","#rightRuler").attr("src",rightRulerUrl.toString());
var bottomRulerUrl=new vp.web.URL($("img","#bottomRuler").attr("src"));
bottomRulerUrl.setItem("size",Math.round(me.dimensions.width*me.zoomFactor));
$("img","#bottomRuler").attr("src",bottomRulerUrl.toString);
}


var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
me.items[i].coordinates.setZoom(me.zoomFactor);
me.items[i].refresh();
}

for(var sFrame in me.frames)
{
me.frames[sFrame].coordinates.setZoom(me.zoomFactor);
}

me.hideProgressBar();

me.onzoom.fire();
};




var getCurrentZoomIndex=function $vpfn_eqHGGUpCZyZwam5SQ4zyBA3369$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iCurrentIndex=m_aZoomLevels.indexOf(me.zoomFactor);


if(iCurrentIndex==-1)
{
for(var i=0;i<m_aZoomLevels.length;i++)
{
if(me.zoomFactor<m_aZoomLevels[i])
{
iCurrentIndex=i;
break;
}
}

if(iCurrentIndex==-1)
{
iCurrentIndex=m_aZoomLevels[m_aZoomLevels.length-1];
}
}

return iCurrentIndex;
};




this.zoomIn=function $vpfn_YtnLN6fnYpg44DjI4vmkRg3397$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isMaxZoom())
{
this.setZoom(m_aZoomLevels[getCurrentZoomIndex()+1]);
}
};




this.zoomMax=function $vpfn_C6DH1k6JxadsszP9GaZMWw3408$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.setZoom(m_aZoomLevels[m_aZoomLevels.length-1]);
};




this.zoomOut=function $vpfn_sVE6U6qM_c1Kn4UeULqupA3416$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isMinZoom())
{
this.setZoom(m_aZoomLevels[getCurrentZoomIndex()-1]);
}
};




this.zoomMin=function $vpfn_beimcpNxt13B3k1W2oewEw3427$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.setZoom(m_aZoomLevels[0]);
};





this.isMaxZoom=function $vpfn_tL_oj6DMvIEZ1sCxByl7qQ3436$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.zoomFactor>=m_aZoomLevels[m_aZoomLevels.length-1];
};





this.isMinZoom=function $vpfn_X7So_UbkJ0YFB4QnUuseAA3445$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.zoomFactor<=m_aZoomLevels[0];
};





var onHistoryChangeHandler=function $vpfn_JN3VlhpKYS5yToURHpMosg3454$33(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!e.command.doesntAffectDocument)
{
me.setDocumentChanged(true);
}

vp.studio.instrumentation.addCommand(e.type,e.command);

};

this.history.onadd.addHandler(onHistoryChangeHandler);
this.history.onbeforeundo.addHandler(onHistoryChangeHandler);
this.history.onbeforeredo.addHandler(onHistoryChangeHandler);

me.shapeEditorPanel=null;

this.getDocRect=function $vpfn_CBUvfj6yy9HSTccWeSTFMw3471$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.ui.getRect(me.documentArea);
};

this.getObjectRect=function $vpfn_5qsVklKucXlcaHh4wAf_7Q3476$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var selections=me.selection.getArray();
if(selections===null||selections.length===0||selections.length>1)
{
return null;
}
else
{
return vp.ui.getLocalRect(selections[0].manipulator.element);
}
};








this.getPageInfo=function $vpfn_BLKJqQTBCt_pzIHs7$xVzQ3496$23(iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me._pageInfoArray)
{
me._pageInfoArray=[];
}

if(!me._pageInfoArray[iPageNumber])
{
me._pageInfoArray[iPageNumber]=
{
pageNumber:iPageNumber,
managedContentKeyId:null,
comboId:null,
categoryId:null,
icParts:null,
miniPreviewColor:null,
previewSrc:null,
setByUser:false,
comboLanguageId:me.languageID
};
}

return me._pageInfoArray[iPageNumber];
};





var _aAddPagesAfter=[];




this.addPages=function $vpfn_XxuJgp$MyqYW0RkuMPvHSg3531$20(iInsertAfter,iNumPages)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!iNumPages)
{
iNumPages=1;
}

for(var i=0;i<iNumPages;i++)
{
_aAddPagesAfter.add(iInsertAfter);
}


me.setDocumentChanged(true);
};





var _aPagesToDelete=[];




this.deletePages=function $vpfn_UR9p8a1tCHgLwCA4ew_VpQ3557$23(iDeletePageNum,iNumPages)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!iNumPages)
{
iNumPages=1;
}


for(var i=0;i<iNumPages;i++)
{

_aPagesToDelete.add(iDeletePageNum);
}


me.setDocumentChanged(true);
};





this.addItems=function $vpfn_g6ECUPST3CFq46vdwIGl3w3580$20(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=oSelection.getLength();
for(var i=0;i<iLen;i++)
{
me.addItem(oSelection.getItem(i));
}

me.items.sort(vp.studio.DocumentItem.compare);

for(i=0;i<me.items.length;i++)
{
if(me.items[i].unrenderExternalTextField)
{
me.items[i].unrenderExternalTextField();
}
}

me.render();
};




this.deleteMetaDataCookie=function $vpfn_J6RKh9pb7mj7IfsmxfgY_Q3604$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.cookies.remove(EditorConst.studioTextMetaDataName);
};





this.removeItems=function $vpfn_Pc0fqZd$SIVvH02jjqJbCQ3613$23(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=oSelection.getLength();
for(var i=0;i<iLen;i++)
{
me.removeItem(oSelection.getItem(i));
}

me.render();
};





this.sortTextFields=function $vpfn_L3fdMnuA4JqVBJ2bl3X5mQ3628$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i;

for(i=0;i<me.items.length;i++)
{
if(me.items[i].type==DOCITEM_TYPE_TEXT)
{
me.items[i].unrenderExternalTextField();
}
}

me.items.sort(vp.studio.DocumentItem.compare);

for(i=0;i<me.items.length;i++)
{
if(me.items[i].type==DOCITEM_TYPE_TEXT)
{
me.items[i].renderExternalTextField(this);
}
}
};









this.getPropertyValues=function $vpfn_SejcChnTHMYalF7PZ3bcRg3659$29(fnGetProperty,aDocItemTypes,bSelectedOnly,fnPredicate)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var aDocItems=[];
for(var i=0;i<me.items.length;i++)
{
var oItem=me.items[i];
if((!aDocItemTypes||aDocItemTypes.contains(oItem.type))&&
(!bSelectedOnly||me.selection.isSelected(oItem))&&
(!fnPredicate||fnPredicate(oItem)))
{
aDocItems.add(oItem);
}
}


var oValueMap={};
for(i=0;i<aDocItems.length;i++)
{
var oValue=fnGetProperty(aDocItems[i]);
if(oValue)
{


var sKey="_"+oValue.toString();


if(!oValueMap[sKey])
{
oValueMap[sKey]=new Array(oValue,0);
}


oValueMap[sKey][1]++;
}
}


var aValueCounts=[];
for(var key in oValueMap)
{
aValueCounts.insertSorted(
oValueMap[key],
function $vpfn_Iw5A4IFpV0WcpmGWY92L1g3702$16(a,b){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return b[1]-a[1];}
);
}


return aValueCounts.map(function $vpfn_Iw5A4IFpV0WcpmGWY92L1g3707$32(a){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return a[0];});
};







this.getMaxProperty=function $vpfn_NDzADdup7zC$iCksyyIMxA3716$26(aDocItemTypes,sPropertyName,bGetMinValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iMaxValue=0;

for(var i=0;i<me.items.length;i++)
{
if(aDocItemTypes.length===0||aDocItemTypes.contains(me.items[i].type))
{
if((!bGetMinValue&&me.items[i][sPropertyName]>iMaxValue)||
(bGetMinValue&&me.items[i][sPropertyName]<iMaxValue))
{
iMaxValue=me.items[i][sPropertyName];
}
}
}

return iMaxValue;
};











this.getMostCommonCoordinate=function $vpfn_zD3StULoUhyR4wWa$eLNHA3745$35(iDocItemType,sCoordName,vDefault,bSelectedOnly,fnPredicate)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aDocItemTypes=[];
aDocItemTypes[0]=iDocItemType;

var aValues=me.getPropertyValues(
function $vpfn_Iw5A4IFpV0WcpmGWY92L1g3751$12(o){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return o.coordinates.getCoord(sCoordName);},
aDocItemTypes,
bSelectedOnly,
fnPredicate
);

return aValues.length>0?aValues[0]:vDefault;
};










this.getMostCommonTextProperty=function $vpfn_Qotv2wZsGDNM87yiHS2mnQ3769$37(sPropertyName,vDefault,bSelectedOnly,fnPredicate)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aValues=me.getPropertyValues(
function $vpfn_Iw5A4IFpV0WcpmGWY92L1g3772$12(o){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return o.data===""?null:o[sPropertyName];},
DOCITEM_TEXT_TYPES,
bSelectedOnly,
fnPredicate
);

return aValues.length>0?aValues[0]:vDefault;
};

this.documentHasPlaceholders=function $vpfn_UXtygE2TcI_fjmyJYxevng3781$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var bCurrentPageHasPlaceholders=Editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER).length>0;

if(me.pagesWithPlaceholders.length===0)
{


return bCurrentPageHasPlaceholders;
}
else if(me.pagesWithPlaceholders.length==1
&&me.pagesWithPlaceholders[0]==me.pageNumber)
{


return bCurrentPageHasPlaceholders;
}
else
{



return true;
}
};

this.getCopyLibraryDocItems=function $vpfn_DA4b_EDvCk7taAZXie_hNA3809$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aTextItems=[],aTableItems=[];

for(var i=0;i<this.items.length;i++)
{
if(COPY_LIBRARY_MATCHING_TAGS.contains(this.items[i].purposeName))
{
if(this.items[i].type===DOCITEM_TYPE_TABLE)
{
aTableItems.push(this.items[i]);
}
else
{
aTextItems.push(this.items[i]);
}

}
}

aTextItems.append(aTableItems);

return aTextItems;
};




this.clearValidationState=function $vpfn_FmhPfdbQK8kS_tJjV9lPOw3837$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.validationErrorData=null;
};

this.toggleMailMaskOverlay=function $vpfn_Br2dgsa4ELNLieiFklaYvw3842$33(bShow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var mailMaskOverlay=Editor.getItemsByType(DOCITEM_TYPE_MAIL_MASK);
if(mailMaskOverlay&&mailMaskOverlay.length>0)
{
mailMaskOverlay[0].toggle(bShow);
}

};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


vp.studio.Frame=function $vpfn_33TJdEOKd$v64dFt5aUl5w4$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

if(!window.studio_frameCount)
{
window.studio_frameCount=0;
}
var m_iFrameCount=window.studio_frameCount;

window.studio_frameCount++;

this.coordinates=new vp.studio.PrecisionCoordinates();

this.thicknessRect={
top:1,
left:1,
right:1,
bottom:1
};

this.borderStyle="solid";
this.color="black";
this.zIndex=0;

this.render=function $vpfn_BPFxHgVXVaJSsxDu2Et6Og29$18(oParentNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.rendered)
{
me.elements={
top:createElement(oParentNode,"top"),
left:createElement(oParentNode,"left"),
bottom:createElement(oParentNode,"bottom"),
right:createElement(oParentNode,"right")
};
}

for(var sElement in me.elements)
{
var oElement=me.elements[sElement];

if(me.borderStyle=="solid")
{
oElement.style.backgroundColor=me.color;
oElement.style.backgroundImage="";
}
else if(me.borderStyle=="dotted")
{
if(me.color=='red')
{
oElement.style.backgroundImage="url("+vp.ui.imageUrl("/vp/images/nns/studio/dotted_red.gif")+")";
}
else
{
oElement.style.backgroundImage="url("+vp.ui.imageUrl("/vp/images/nns/studio/dotted.gif")+")";
}
oElement.style.backgroundColor="";
}

oElement.style.zIndex=me.zIndex;
}

me.positionElements();
me.rendered=true;
};

var createElement=function $vpfn_b2YcV0R6KJi8eCo1LRbE0Q70$24(oParentNode,sID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oElement=document.createElement("DIV");
oElement.style.position="absolute";
oElement.style.fontSize="1px";
oElement.style.overflow="hidden";
oElement.id="frame_"+m_iFrameCount+"_element_"+sID;

oParentNode.appendChild(oElement);

return oElement;
};

this.unrender=function $vpfn_m3BChec0vfaZQo9LIIkxNg83$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var sCoord in me.elements)
{
me.elements[sCoord].parentNode.removeChild(me.elements[sCoord]);
}
me.rendered=false;
};

this.positionElements=function $vpfn_spXVPLxTFzwaZl4PX2$KpA92$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.elements)
{
return;
}

var oRect=me.coordinates.getRect();
var oZoomedThickness={};

for(var sProp in me.thicknessRect)
{
oZoomedThickness[sProp]=me.thicknessRect[sProp];
}

if(!isThicknessEqual(oZoomedThickness,{top:1,left:1,right:1,bottom:1}))
{
for(var sDim in oZoomedThickness)
{
if(oZoomedThickness[sDim]!==0)
{
oZoomedThickness[sDim]=Math.max(1,Math.round(oZoomedThickness[sDim]*me.coordinates.getZoom()));
}
}
}

me.elements.top.style.top=oRect.top+"px";
me.elements.top.style.left=oRect.left+"px";
me.elements.top.style.width=oRect.width+"px";
me.elements.top.style.height=oZoomedThickness.top+"px";
me.elements.top.style.display=('0px'==me.elements.top.style.height)?'none':'block';

me.elements.left.style.top=oRect.top+oZoomedThickness.top+"px";
me.elements.left.style.left=oRect.left+"px";
me.elements.left.style.width=oZoomedThickness.left+"px";
me.elements.left.style.height=Math.max(0,oRect.height-(oZoomedThickness.top+oZoomedThickness.bottom))+"px";
me.elements.left.style.display=('0px'===me.elements.left.style.height)?'none':'block';

me.elements.right.style.top=oRect.top+oZoomedThickness.top+"px";
me.elements.right.style.left=oRect.right-oZoomedThickness.right+"px";
me.elements.right.style.width=oZoomedThickness.right+"px";
me.elements.right.style.height=Math.max(0,oRect.height-(oZoomedThickness.top+oZoomedThickness.bottom))+"px";
me.elements.right.style.display=('0px'===me.elements.right.style.height)?'none':'block';

me.elements.bottom.style.top=oRect.bottom-oZoomedThickness.bottom+"px";
me.elements.bottom.style.left=oRect.left+"px";
me.elements.bottom.style.width=oRect.width+"px";
me.elements.bottom.style.height=oZoomedThickness.bottom+"px";
me.elements.bottom.style.display=('0px'===me.elements.bottom.style.height)?'none':'block';

if(Editor.rulerEnabled&&sDim&&!Editor.isAdvanced)
{
var rightRulerUrl=new vp.web.URL($("img","#rightRuler").attr("src"));
rightRulerUrl.setItem("offset",oZoomedThickness.top);
$("img","#rightRuler").attr("src",rightRulerUrl.toString());
var bottomRulerUrl=new vp.web.URL($("img","#bottomRuler").attr("src"));
bottomRulerUrl.setItem("offset",oZoomedThickness.left);
$("img","#bottomRuler").attr("src",bottomRulerUrl.toString);
}
};

var onZoomHandler=function $vpfn_mnll$3nXjF_g2dhWkZuZbg153$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.positionElements();
};

var isThicknessEqual=function $vpfn_h7yPSL39r$JufglDQXNARg158$27(oRect1,oRect2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return oRect1.top==oRect2.top&&
oRect1.left==oRect2.left&&
oRect1.bottom==oRect2.bottom&&
oRect1.right==oRect2.right;
};

this.coordinates.onzoom.addHandler(onZoomHandler);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}







vp.studio.RotationInfo=function $vpfn_7Bmm$Df7biG1nx5BtUlYqw9$25(angleInDegrees,initialWidth,initialHeight,displayAngleInDegrees)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.angleInDegrees=angleInDegrees||0;





this.initialWidth=initialWidth||0;





this.initialHeight=initialHeight||0;





this.displayAngleInDegrees=displayAngleInDegrees||0;




this.isRotated=function $vpfn_wMjCKh_l0PfCcJCvz0h6Rg40$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return((this.angleInDegrees%360)!==0)||((this.displayAngleInDegrees%360)!==0);
};





this.isSideways=function $vpfn_GnnHQInJMPf97LMsdQcy_Q49$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.angleInDegrees===90||
this.angleInDegrees===270;
};





this.rotateBy=function $vpfn_cfRcX8pcNZTGb5cAdzMzYA59$20(iDegrees)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


while(iDegrees<0)
{
iDegrees+=360;
}


me.angleInDegrees=(me.angleInDegrees+iDegrees)%360;
};






this.scaleX=function $vpfn_tk$AZvRp4C6AuQKi5X_TXA77$18(fScaleFactor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isSideways())
{
me.initialHeight*=fScaleFactor;
}
else
{
me.initialWidth*=fScaleFactor;
}
};






this.scaleY=function $vpfn_jxzcZ1ZQbPR_UKmWbbBFIw94$18(fScaleFactor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isSideways())
{
me.initialWidth*=fScaleFactor;
}
else
{
me.initialHeight*=fScaleFactor;
}
};






this.toString=function $vpfn_Nav1cDCVjX6GpwdQotSCLQ111$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"angle: "+me.angleInDegrees+
"; initial-width: "+me.initialWidth+
"; initial-height: "+me.initialHeight+
"; display-angle: "+me.displayAngleInDegrees;
};





this.copyFrom=function $vpfn_1OsT5lxwEZUJWYFORUw11A123$20(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.core.applyProperties(oObj,me,["angleInDegrees","initialWidth","initialHeight","displayAngleInDegrees"]);
};





this.clone=function $vpfn_1YDQL831Hnpz8$oRFy_BvQ132$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oClone=new vp.studio.RotationInfo();
oClone.copyFrom(me);
return oClone;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.PrecisionCoordinates=function $vpfn_y8ZCIr8zXBSd9skFAjJtbw12$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





var m_bIsBatch=false;







var m_bIsRotating=false;





var m_oRect={
top:0,
left:0,
width:0,
height:0
};





this.rotation=new vp.studio.RotationInfo(0,0,0);





var m_fZoomFactor=1;





this.boundElements=[];





this.eventsEnabled=true;





this.onresize=new vp.events.CustomEvent(this,"onresize");





this.onmove=new vp.events.CustomEvent(this,"onmove");





this.onrotate=new vp.events.CustomEvent(this,"onrotate");





this.onzoom=new vp.events.CustomEvent(this,"onzoom");






this.setZoom=function $vpfn_V2fzaUJIRq93AYNGHYks5g94$19(fZoomFactor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(fZoomFactor==m_fZoomFactor)
{
return;
}

var e={
originalZoomFactor:m_fZoomFactor,
newZoomFactor:fZoomFactor
};

m_fZoomFactor=fZoomFactor;

var bIsBatchTemp=m_bIsBatch;
m_bIsBatch=true;

me.updateBoundElements(true);

m_bIsBatch=bIsBatchTemp;

if(me.eventsEnabled&&!m_bIsBatch)
{
me.onzoom.fire(e);
}
};




this.updateBoundElements=function $vpfn__dLwOadlfO3VkQl17ZbrTA124$31(bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.setRectPrecise(m_oRect,bForce);
};





this.getZoom=function $vpfn_L5wNHCgp7QDI9Ar8Qsnj7g133$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_fZoomFactor;
};








this.setCoord=function $vpfn_htoma4BffLaNbn1101YLUg145$20(sCoord,iPixels,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iParsedPixels=parseInt(iPixels);
me.setCoordPrecise(sCoord,iParsedPixels/m_fZoomFactor,bForce);
};






this.setRect=function $vpfn_52LW$1iT1cHunoQxWgGgVw156$19(oPixelRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatchTemp=m_bIsBatch;
m_bIsBatch=true;
for(var sCoord in m_oRect)
{
me.setCoord(sCoord,oPixelRect[sCoord]);
}
m_bIsBatch=bIsBatchTemp;

if(me.eventsEnabled&&!m_bIsBatch)
{
updateRotation();
me.onresize.fire();
}
};







this.getCoord=function $vpfn_I7N2$VJD1tNNN6PA0_Rxuw179$20(sCoord)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return Math.round(me.getCoordPrecise(sCoord)*m_fZoomFactor);
};






this.getRect=function $vpfn_VGgxK5Yq6nyF9cGSIYHXFQ189$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect={};
for(var sCoord in m_oRect)
{
oRect[sCoord]=me.getCoord(sCoord);
}

oRect.right=oRect.left+oRect.width;
oRect.bottom=oRect.top+oRect.height;

return oRect;
};









this.setCoordPrecise=function $vpfn_BMg_Xwmoo9PGOF$gpKzi4g211$27(sCoord,fValue,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsResizing=(sCoord=="width"||sCoord=="height");
if((bIsResizing&&fValue<0)||isNaN(fValue))
{
var ex=new vp.studio.Error(ERR_INVALID_COORDINATE,
null,
"setCoordPrecise: Coordinate not valid",
"coord: "+sCoord+" value:"+fValue);
ex.throw_();
}

if(m_oRect[sCoord]==fValue&&!bForce)
{
return false;
}


if(!m_bIsRotating&&bIsResizing&&m_oRect[sCoord])
{
var fScaleFactor=fValue/m_oRect[sCoord];
if(sCoord=="width")
{
me.rotation.scaleX(fScaleFactor);
}
else if(sCoord=="height")
{
me.rotation.scaleY(fScaleFactor);
}
}

m_oRect[sCoord]=fValue;

for(var i=0;i<me.boundElements.length;i++)
{
me.boundElements[i].style[sCoord]=me.getCoord(sCoord)+"px";
}

if(!m_bIsBatch&&me.eventsEnabled)
{
if(bIsResizing)
{
updateRotation();
me.onresize.fire();
}
else
{
me.onmove.fire();
}
}

return true;
};







this.setRectPrecise=function $vpfn_rWOA9i2le7dw$LqKfdO9kw271$26(oRect,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatchTemp=m_bIsBatch;
var bIsMoved=false;
var bIsResized=false;
var oOldRect={
top:m_oRect.top,
left:m_oRect.left,
width:m_oRect.width,
height:m_oRect.height
};

m_bIsBatch=true;
for(var sCoord in m_oRect)
{
if(me.setCoordPrecise(sCoord,oRect[sCoord],bForce))
{
if(sCoord=="width"||sCoord=="height")
{
bIsResized=true;
}
else
{
bIsMoved=true;
}
}
}
m_bIsBatch=bIsBatchTemp;

if(me.eventsEnabled&&!m_bIsBatch)
{
if(bIsResized||bForce)
{

var e={
oldRectPrecise:oOldRect,
newRectPrecise:m_oRect
};

updateRotation();
me.onresize.fire(e);
}
else if(bIsMoved||bForce)
{
me.onmove.fire();
}
}
};







this.getCoordPrecise=function $vpfn_Gn3HeTidGoR5QE3aVh5TEg326$27(sCoord)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_oRect[sCoord];
};





this.getRectPrecise=function $vpfn_ETBZMySLbJsMLQYw4LiffA335$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect={};
for(var sCoord in m_oRect)
{
oRect[sCoord]=m_oRect[sCoord];
}

oRect.right=oRect.left+oRect.width;
oRect.bottom=oRect.top+oRect.height;

return oRect;
};

this._getRawRect=function $vpfn_lXcgu39_gfKLef9lD8YBaw349$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_oRect;
};





this.getAspectRatio=function $vpfn_sUYDVh$81eKkrZQGsNNGJA358$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_oRect.width/m_oRect.height;
};






this.moveBy=function $vpfn_29a$Nk6bGfraQsyYmdLWcA368$18(oDelta,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.moveByPrecise(
{
top:(oDelta.top/m_fZoomFactor),
left:(oDelta.left/m_fZoomFactor)
},
bForce);
};






this.moveByPrecise=function $vpfn_P_6XH5dRNDJq4zzphVYJcg383$25(oDelta,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatchTemp=m_bIsBatch;
var bIsChanged=false;

m_bIsBatch=true;

if(me.setCoordPrecise("top",m_oRect.top+oDelta.top,bForce))
{
bIsChanged=true;
}
if(me.setCoordPrecise("left",m_oRect.left+oDelta.left,bForce))
{
bIsChanged=true;
}

m_bIsBatch=bIsBatchTemp;

if(me.eventsEnabled&&!m_bIsBatch&&(bIsChanged||bForce))
{
me.onmove.fire();
}
};






this.resizeBy=function $vpfn_L9D5hViehaPblDS3oIHGXw412$20(oDelta,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.resizeByPrecise(
{
top:(oDelta.top/m_fZoomFactor),
left:(oDelta.left/m_fZoomFactor),
width:(oDelta.width/m_fZoomFactor),
height:(oDelta.height/m_fZoomFactor)
},
bForce);
};






this.resizeByPrecise=function $vpfn_JARedH2A7DsIEE8Nuf1vAg429$27(oDelta,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatchTemp=m_bIsBatch;
var bIsChanged=false;
var oOldRect={
top:m_oRect.top,
left:m_oRect.left,
width:m_oRect.width,
height:m_oRect.height
};

m_bIsBatch=true;

if(me.setCoordPrecise("top",m_oRect.top+oDelta.top,bForce))
{
bIsChanged=true;
}
if(me.setCoordPrecise("left",m_oRect.left+oDelta.left,bForce))
{
bIsChanged=true;
}
if(me.setCoordPrecise("width",m_oRect.width+oDelta.width,bForce))
{
bIsChanged=true;
}
if(me.setCoordPrecise("height",m_oRect.height+oDelta.height,bForce))
{
bIsChanged=true;
}

m_bIsBatch=bIsBatchTemp;

if(me.eventsEnabled&&!m_bIsBatch&&(bIsChanged||bForce))
{

var e={
oldRectPrecise:oOldRect,
newRectPrecise:m_oRect
};

updateRotation();
me.onresize.fire(e);
}
};






this.rotateBy=function $vpfn_WHSkzcsZHeTFoIpkeyHjIw479$20(iDegrees,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatchTemp=m_bIsBatch;
var bIsRotatingTemp=m_bIsRotating;
m_bIsBatch=true;
m_bIsRotating=true;

if((iDegrees%360)===0&&!bForce)
{
return;
}

me.rotation.rotateBy(iDegrees);

if(me.rotation.initialWidth===0&&me.rotation.initialHeight===0)
{
me.rotation.initialWidth=m_oRect.width;
me.rotation.initialHeight=m_oRect.height;
}













var theta=((me.rotation.angleInDegrees+me.rotation.displayAngleInDegrees)*Math.PI)/180;
var sin=Math.abs(Math.sin(theta));
var cos=Math.abs(Math.cos(theta));

var width=(me.rotation.initialHeight*sin)+(me.rotation.initialWidth*cos);
var height=(me.rotation.initialHeight*cos)+(me.rotation.initialWidth*sin);
var x=m_oRect.left+((m_oRect.width-width)/2);
var y=m_oRect.top+((m_oRect.height-height)/2);

me.setRectPrecise({
top:y,
left:x,
width:width,
height:height
},
bForce);

m_bIsBatch=bIsBatchTemp;
m_bIsRotating=bIsRotatingTemp;

if(me.eventsEnabled&&!m_bIsBatch)
{
me.onrotate.fire();
me.onresize.fire();
}
};

this.rotateTo=function $vpfn_WGTk5kyWNryxtuZMtaaFZA538$20(iDegrees,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iRotateByDegrees=iDegrees-me.rotation.angleInDegrees;
if(iRotateByDegrees===0&&!bForce)
{
return;
}

me.rotateBy(iRotateByDegrees,bForce);
};

var updateRotation=function $vpfn_NKKxJzaWYgA3VTZyP5Bg_w549$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var rotation=me.rotation.angleInDegrees+me.rotation.displayAngleInDegrees;

if(rotation===0||rotation==180)
{
me.rotation.initialWidth=m_oRect.width;
me.rotation.initialHeight=m_oRect.height;
}
else if(rotation==90||rotation==270)
{
me.rotation.initialWidth=m_oRect.height;
me.rotation.initialHeight=m_oRect.width;
}
else
{

}
};






this.equals=function $vpfn_PKw0OKUm4TYqkq0eiWeaYg575$18(oCoords)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect=oCoords._getRawRect();
return(m_oRect.top==oRect.top&&
m_oRect.left==oRect.left&&
m_oRect.width==oRect.width&&
m_oRect.height==oRect.height);
};





this.copyFrom=function $vpfn_CIMTCJTQjthiSLy_ps0GoA588$20(oCoordinates)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.setRectPrecise(oCoordinates.getRectPrecise());
if(oCoordinates.rotation)
{
me.rotation=oCoordinates.rotation.clone();
}
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.CropInfo=function $vpfn_G9lgVmoMMOYvH2gAy5hB1w10$21(iTop,iLeft,iRight,iBottom)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.onchange=new vp.events.CustomEvent(this,"onchange");





this.top=iTop?iTop:0;
this.getTop=function $vpfn_kzx86ZYjCcvzF2XrikJAJw25$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.top;
};

this.setTop=function $vpfn_JUpqps5VrRqya4ipyjJLKA30$18(fValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.top=fValue;
this.onchange.fire();
};





this.left=iLeft?iLeft:0;
this.getLeft=function $vpfn_Nl9FxAmjdS$tBL4FgQO1xQ41$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.left;
};

this.setLeft=function $vpfn_Iw5xRQevKPk9DeyBjf8Osg46$19(fValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.left=fValue;
this.onchange.fire();
};





this.right=iRight?iRight:0;
this.getRight=function $vpfn_RUlpLmbicNMpgfARVerRhA57$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.right;
};

this.setRight=function $vpfn_JCR3iAy7H$KenNMTfhx24A62$20(fValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.right=fValue;
this.onchange.fire();
};





this.bottom=iBottom?iBottom:0;
this.getBottom=function $vpfn_17FjCzhYlvk8poE9J8D36w73$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.bottom;
};

this.setBottom=function $vpfn_jyJY30PxHQOI6y0AOga1sQ78$21(fValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.bottom=fValue;
this.onchange.fire();
};





this.UseCropValues=false;





this.toQueryString=function $vpfn_Gt7bS8NUyYmOnj1fPMIVnA94$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"croptop="+this.top+
"&cropleft="+this.left+
"&cropright="+this.right+
"&cropbottom="+this.bottom;
};





this.applyTo=function $vpfn_dTNsIEFeATRC_Bipoxduww106$19(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.core.applyProperties(this,oObj,["top","left","right","bottom"]);


if(oObj.onchange&&oObj.onchange.fire)
{
oObj.onchange.fire();
}
};





this.copyFrom=function $vpfn_qN1e5Idw5CBnVNzEtWIRRw121$20(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.core.applyProperties(oObj,this,["top","left","right","bottom"]);
this.onchange.fire();
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.DocumentItem=function $vpfn_IsU7vRY3RyZ5PAl6JIUT_Q11$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.type=0;





this.id="";





this.locked=false;





this.coordinates=new vp.studio.PrecisionCoordinates();





this.zIndex=0;





this.isFoil=false;





this.purposeName="";





this.metaData="";





this.headerMetaData="";





this.brandingType=BRANDING_TYPE_NONE;





this.isChrome=false;





this.onchange=new vp.events.CustomEvent(this,"onchange");





this.onunrender=new vp.events.CustomEvent(this,"onunrender");





this.getIDPrefix=function $vpfn_hoqZBpWeqRns87_TB0kWgg97$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_item_";
};






this.getUpdateXML=function $vpfn_3hy7ru8Q2kMSMdO5eE7WyA107$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"";
};





this.render=function $vpfn_1iSn9KOKAXRfO3QkAaO9Lw116$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return;
};




this.unrender=function $vpfn_cCz$LKP_zyjio11uIMNlJQ124$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return;
};






this.resetCoordinatesToImageSize=function $vpfn_kcbPvBHUk4O7vmK89GEhvA134$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return;
};




this.refresh=function $vpfn_auvLBxseztzb$HH$dmuvmg143$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return;
};





this.isGrayScale=function $vpfn_urwHJC0k8WQtZsO8rv7rDQ152$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return Editor.pageColorization==PAGE_COLORIZATION_gray;
};





this.upgrade=function $vpfn_syLoCAOomk8CCG4b0byAZA161$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateDocItem(me);
};





this.setZIndex=function(iZIndex)
{
};




this.terminate=function $vpfn_$RsRUKAU7pG9uipwFv8q9Q177$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var prop in me)
{
me[prop]=null;
}
};


this.coordinates.onrotate.addHandler(this.onchange.fire);


var onChangeHandler=function $vpfn_PvTdUQMD2y3j3NWvw27Npg189$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.setDocumentChanged(true);
};

this.onchange.addHandler(onChangeHandler);

this._getDOMElementZIndex=function $vpfn_u80OhP2FvwNzSF3guHNZXw196$32(bIsHandle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.brandingType!=BRANDING_TYPE_NONE&&
!bIsHandle)
{
return BRANDING_ZINDEX_OFFSET+me.zIndex;
}

return(bIsHandle?HANDLE_ZINDEX_OFFSET:DOCITEM_ZINDEX_OFFSET)+me.zIndex;
};






this._coreAttributes=[];






this.applyCoreAttributesTo=function $vpfn_W$3M8XSbkAg_4YPg8VrfnA219$33(oElement,bString)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ilen=me._coreAttributes.length;
for(var i=0;i<ilen;i++)
{
var sProp=me._coreAttributes[i];

var sKey=sProp;
var oValue=me[sProp];

if(bString)
{
sKey=sKey.toLowerCase();
oValue=oValue?oValue.toString():oValue;

}

oElement[sKey]=oValue;
}
};






this.applyCoordinatesTo=function $vpfn_2d$xbbZZVzTL3Nyxn5HuLQ245$30(oElement,bRotation)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect=me.coordinates.getRectPrecise();
for(var sCoord in oRect)
{

oElement[sCoord]=oRect[sCoord];
}

if(bRotation&&me.coordinates.rotation.isRotated())
{
oElement["rotate"]=me.coordinates.rotation.toString();
}
};





this.getMetaData=function $vpfn_UKU70W6rHOiWysrxix00Cw264$23(url,headerKey,updateUrlCallback,metaDataType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnCallback=function $vpfn_2qx8LBoZ$6HqA98LIwGhVQ266$25(responseText,responseHeaders)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sMetaData=null;
if(responseHeaders)
{

sMetaData=responseHeaders[headerKey];
}

if(sMetaData)
{
var oMetaData=new metaDataType(sMetaData);
if(oMetaData)
{
me.headerMetaData=oMetaData;
}
}

updateUrlCallback();
};

if(url&&headerKey)
{
vp.http.getAsync(url,fnCallback,updateUrlCallback,0);
}
};
};









vp.studio.DocumentItem.compare=function $vpfn_mFv7MvjhzFdaLea$781$bw302$33(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var itemOneIsText=DOCITEM_TEXT_TYPES.contains(oItem1.type);
var itemTwoIsText=DOCITEM_TEXT_TYPES.contains(oItem2.type);

if(itemOneIsText&&itemTwoIsText)
{

return-vp.comparer.caseSensitive(oItem1.fieldOrder,oItem2.fieldOrder);
}

else if(itemOneIsText&&!itemTwoIsText)
{
return 1;
}

else if(!itemOneIsText&&itemTwoIsText)
{
return-1;
}

else
{
return 0;
}
};








vp.studio.DocumentItem.compareZIndex=function $vpfn_Dkg5brTXubPSmnnu3$OOiw337$39(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oItem1.zIndex>oItem2.zIndex)
{
return 1;
}
else if(oItem1.zIndex<oItem2.zIndex)
{
return-1;
}
else
{
return 0;
}
};








vp.studio.DocumentItem.compareZIndexRev=function $vpfn_bCuCI$MugBrl7fe6iuZPTQ360$42(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return-1*vp.studio.DocumentItem.compareZIndex(oItem1,oItem2);
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.ComplexSizeDocumentItem=function $vpfn_odRcfj6HM1NsSG4cJYqqaQ12$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;






this.resetCoordinatesToImageSize=function $vpfn_laaQ18ScZxNWyH6NxWUKfA21$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.imageElement)
{

return;
}



if(me.imageElement.src.endsWith(VP_UI_BLANK_IMAGE))
{
return;
}

var img=me.imageElement,
rect=me.coordinates.getRect(),
angle=me.coordinates.rotation.angleInDegrees;



if(me.clearOverhangs)
{
me.clearOverhangs();
if(Editor.features.EnableStudioTextOverhangSupport)
{

var oMetaData=me.headerMetaData;
if(oMetaData)
{
me.overhangCSSRect=oMetaData;
}
else
{
me.clearOverhangs();
}
}
}

var adjustedSide=function $vpfn_lCl9uivtOtLw4MQMO9PDrg60$27(_side)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var a=(_side+angle/90)%4;

switch(a)
{
case 0:return"top";
case 1:return"right";
case 2:return"bottom";
case 3:return"left";
default:return null;
}
};

var side={top:adjustedSide(0),right:adjustedSide(1),bottom:adjustedSide(2),left:adjustedSide(3)};

var imgWidth=!me.overhangCSSRect?me.imageElement.width:me.imageElement.width-me.overhangCSSRect[side.left]-me.overhangCSSRect[side.right];
var imgHeight=me.imageElement.height;

me.coordinates.eventsEnabled=false;


if(angle===0||angle===180)
{

if(rect.height!==imgHeight)
{
me.coordinates.setCoord("height",imgHeight);
}
if(rect.width<imgWidth)
{
me.coordinates.setCoord("width",imgWidth);
}



if(angle===180&&(rect.top!==(rect.bottom-imgHeight)))
{
me.coordinates.setCoord("top",rect.bottom-imgHeight);
}

}
else if(angle===90||angle===270)
{

imgWidth=me.imageElement.width;
imgHeight=!me.overhangCSSRect?me.imageElement.height:me.imageElement.height-me.overhangCSSRect[side.left]-me.overhangCSSRect[side.right];


if(rect.width!==imgWidth)
{
me.coordinates.setCoord("width",imgWidth);
}

if(rect.height<imgHeight)
{
me.coordinates.setCoord("height",imgHeight);
}



if(angle===90&&rect.left!==(rect.right-imgWidth))
{
me.coordinates.setCoord("left",rect.right-imgWidth);
}
}
if(me.manipulator)
{
me.manipulator.refresh();
}
me.coordinates.eventsEnabled=true;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.Image=function $vpfn_$spGMFMpKOoh13nwU_IFjQ15$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.notSwappable=false;





this.isDominantImage=false;





this.isFullFoil=false;





this.frameID=0;





this.vmlFrame=new Array();





this.frameIsBehindImage=false;





this.imageAreaID=null;





this.ondblclick=new vp.events.CustomEvent(this,"ondblclick");






this._coreAttributes=vp.studio.Image._CORE_ATTRIBUTES;





this.cropInfo=null;







this.colorSchemeRef=-1;





this.colorOverrides=null;





this.thermographyNumColorsSet=null;




this.areThermographyColorsMerged=false;


var $lowResolutionWarningIcon=null;




this.thermographyColorCount=1;





this.getManipulatorElement=function $vpfn_tOUYR0z_s8gwFrFeY41D4w123$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.handleElement;
};





this.onloadstart=new vp.events.CustomEvent(this,"onloadstart");





this.onload=new vp.events.CustomEvent(this,"onload");





this.getIDPrefix=function $vpfn_Ykcr2Ure1nG_pvIRweqZ2A144$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_img_";
};




this.isDraggable=false;




this.isDroppable=false;





this.isEditableInLiteStudio=false;


this.imageMouseoverButtons=[];

this.isMouseDown=false;

this.onMouseDownHandler=function $vpfn_I9T33IcR4v0RSb6HXxtKlg170$30(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isMouseDown=true;


hideImageMouseoverButtons(e);
};

this.onMouseUpHandler=function $vpfn_i8orcgS$k9LJBxhcSVjtYg178$28(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.isMouseDown=false;


for(var iButtonIndex=me.imageMouseoverButtons.length-1;iButtonIndex>=0;iButtonIndex--)
{
me.imageMouseoverButtons[iButtonIndex].cancelShowButton=false;
}
};

this.hideImageMouseoverButton=function $vpfn_h6rO3gr7RH2jkclmvKZung189$36(oImgeMouseoverButton,e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oImgeMouseoverButton)
{
return;
}

oImgeMouseoverButton.cancelShowButton=true;
oImgeMouseoverButton.cancelHideButton=false;

if(e)
{

e=vp.events.getEvent(e);


var toElement=e.relatedTarget;



if(toElement!=oImgeMouseoverButton.element)
{
oImgeMouseoverButton.hide();
}
}
else
{
oImgeMouseoverButton.hide();
}
};


this.showImageMouseoverButton=function $vpfn_$skPOamX_IlPGb6ms_D9qA221$36(oImageMouseoverButton,e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oImageMouseoverButton||me.isMouseDown)
{
return;
}

oImageMouseoverButton.cancelShowButton=false;

oImageMouseoverButton.hideSimilarImageMouseoverButtons();


e=vp.events.getEvent(e);


var toElement=e.relatedTarget;




if(!oImageMouseoverButton.onMouseOverAddedForButton&&(toElement==oImageMouseoverButton.element))
{
oImageMouseoverButton.oninit.addHandler(function $vpfn_d5z3FCWwa4rhwgLeTOK_wg243$52()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.add(oImageMouseoverButton.element,
"mouseover",
function $vpfn_d5z3FCWwa4rhwgLeTOK_wg247$32(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}oImageMouseoverButton.cancelHideButton=true;});
});

oImageMouseoverButton.onMouseOverAddedForButton=true;
}

window.setTimeout(function $vpfn_d5z3FCWwa4rhwgLeTOK_wg253$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oImageMouseoverButton.cancelShowButton){oImageMouseoverButton.show(e);}
},100);
};





this.render=function $vpfn_Pqq07QnEJPHnpRWT8pK6dw263$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{
if(!me.notSwappable||me.restricted||Editor.features.enableNotSwappableImages)
{




me.handleElement=document.createElement("DIV");
me.handleElement.id=me.id+"_handle";
me.handleElement.style.position="absolute";

me.handleImage=document.createElement("IMG");
me.handleImage.src=BLANK_IMAGE;
me.handleImage.style.position="relative";
me.handleImage.style.width="100%";
me.handleImage.style.height="100%";

me.handleElement.appendChild(me.handleImage);
me.coordinates.boundElements.add(me.handleElement);

vp.events.add(me.handleElement,"dblclick",me.ondblclick.fire);
}

me.imageContainer=document.createElement("DIV");
me.imageContainer.id=me.id+"_container";
me.imageContainer.style.position="absolute";

me.setZIndex();

me.imageContainer.style.top="0px";
me.imageContainer.style.left="0px";


me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.zIndex=1;
me.imageElement.style.visibility="hidden";

me.coordinates.boundElements.add(me.imageElement);

me.coordinates.updateBoundElements(true);


if(me.hasFrame())
{
me.frameElement=document.createElement("IMG");
me.frameElement.id=me.id+"_frame";
me.frameElement.style.position="absolute";
me.frameElement.style.zIndex=me.frameIsBehindImage?0:2;
me.frameElement.style.visibility="hidden";
}

if(Editor.features.enableImageSmartTagsInLiteStudio
&&(me.type==DOCITEM_TYPE_PLACEHOLDER||me.type==DOCITEM_TYPE_UPLOADED_IMAGE||me.type==DOCITEM_TYPE_LIBRARY_IMAGE))
{
me.contextMenu=new vp.studio.ImageContextMenu(me);
me.smartTag=new vp.studio.SmartTag(me,"/vp/images/nns/studio/toolbar2/image.gif");
}


if((Editor.features.showEditButtonOnMouseover
||Editor.features.showRemoveButtonOnMouseover)
&&(me.type===DOCITEM_TYPE_UPLOADED_IMAGE||me.type===DOCITEM_TYPE_LIBRARY_IMAGE)
&&me.handleElement)
{


var aImageMouseoverButtons=[];


if(Editor.features.showEditButtonOnMouseover&&!Editor.features.showRemoveButtonOnMouseover)
{
var oLargeEditButton=new vp.studio.LargeEditImageButton(me);
aImageMouseoverButtons=[oLargeEditButton];
}

else
{
var oEditButton=new vp.studio.EditImageButton(me);
var oRemoveButton=new vp.studio.RemoveImageButton(me);
aImageMouseoverButtons=[oEditButton,oRemoveButton];
}


var iWidthOfUnaccountedButtons=0;
var iButtonSpacerWidth=3;

for(var i=0,l=aImageMouseoverButtons.length;i<l;i++)
{
var oButton=aImageMouseoverButtons[i];

var oCurrentImageMouseoverButton=null;
var aButtons=me.imageMouseoverButtons;


for(var j=0,m=aButtons.length;j<m;j++)
{
var sButtonName=aButtons[j].name;

if(sButtonName===oButton.buttonName)
{
oCurrentImageMouseoverButton=aButtons[sButtonName];
break;
}
}

if(!oCurrentImageMouseoverButton)
{
oCurrentImageMouseoverButton=oButton;
me.imageMouseoverButtons.push(oCurrentImageMouseoverButton);
}

var fnShowButton=function showButton(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.showImageMouseoverButton(this.button,e);
}.getClosure({button:oCurrentImageMouseoverButton});

var fnHideButton=function hideButton(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.hideImageMouseoverButton(this.button,e);
}.getClosure({button:oCurrentImageMouseoverButton});


var oElement=me.getManipulatorElement();

vp.events.add(oElement,"mouseover",fnShowButton);



vp.events.add(oElement,"mouseout",fnHideButton);


vp.events.add(oElement,"mousedown",fnHideButton);



iWidthOfUnaccountedButtons+=oCurrentImageMouseoverButton.width;
if(i!==0)
{
iWidthOfUnaccountedButtons+=iButtonSpacerWidth;
}
}
}
}

oEditor.documentArea.appendChild(me.imageContainer);

if(me.handleElement)
{
oEditor.docItemHandleArea.appendChild(me.handleElement);
}

me.imageContainer.appendChild(me.imageElement);

if(me.frameElement)
{
me.imageContainer.appendChild(me.frameElement);
}

me.refresh();

me.rendered=true;

if(me.isEditableInLiteStudio)
{
me.makeEditableInLiteStudio();
}

this.makeDraggable(oEditor);
this.makeDroppable(oEditor);
};





this.setZIndex=function $vpfn_GK1qAI1xSf8vbI8vgp23Zw448$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}

if(me.handleElement)
{
me.handleElement.style.zIndex=me._getDOMElementZIndex(true);
}
me.imageContainer.style.zIndex=me._getDOMElementZIndex();
};




this.unrender=function $vpfn_ZwD5NtZZV_i4FdfOtFc6ug465$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.rendered)
{
return;
}

if(me.droppableArea)
{
me.droppableArea.setEnabled(false);
}

if(me.draggableImage)
{
me.draggableImage.setEnabled(false);
}

if($lowResolutionWarningIcon)
{
Editor.resolutionWarningTooltipLocked.hide();
Editor.resolutionWarningTooltipUnlocked.hide();
$lowResolutionWarningIcon.remove();
}

if(me.imageElement&&me.imageElement.parentNode)
{
var container=me.imageElement.parentNode;
container.removeChild(me.imageElement);
if(container.id===(me.imageElement.id+"_container")&&container.parentNode)
{
container.parentNode.removeChild(container);
}
}

if(me.handleElement&&me.handleElement.parentNode)
{
me.handleElement.parentNode.removeChild(me.handleElement);
}

if(me.frameElement&&me.frameElement.parentNode)
{
me.frameElement.parentNode.removeChild(me.frameElement);
}

hideImageMouseoverButtons();

me.rendered=false;

me.onunrender.fire();
};




var hideImageMouseoverButtons=function hideImageMouseoverButtons(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var iButtonIndex=me.imageMouseoverButtons.length-1;iButtonIndex>=0;iButtonIndex--)
{
me.hideImageMouseoverButton(me.imageMouseoverButtons[iButtonIndex],e);
}
};hideImageMouseoverButtons._vpfn='$vpfn_e8NTtD4EeyhK0tkRsawGsw519$36';





this.getURL=function $vpfn_UwMa83e_RPadtRlWsZM9qw531$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var eImageType=vp.image.StudioDocItemTypeToImageType(me.type);
var oImage=new vp.image.EditedImage(eImageType,me.getItemID());


if(me.cropInfo&&me.cropInfo.UseCropValues)
{
oImage.cropInfo.left=me.cropInfo.getLeft();
oImage.cropInfo.top=me.cropInfo.getTop();
oImage.cropInfo.right=me.cropInfo.getRight();
oImage.cropInfo.bottom=me.cropInfo.getBottom();
}



var oPreview=new vp.image.ImagePreview(oImage);
oPreview.bestFit=false;
oPreview.exactSize=true;


var oRect=me.coordinates.getRect();
if(oRect.width>0&&oRect.height>0)
{
oPreview.previewSize.width=oRect.width;
oPreview.previewSize.height=oRect.height;
}



var oUrl=oPreview.getPreviewUrlObject();


var fZoom=me.coordinates.getZoom();
oUrl.setItem("zoom",fZoom);


if(me.coordinates.rotation.isRotated())
{
oUrl.setItem("rotation",me.coordinates.rotation.angleInDegrees);
oUrl.setItem("init_width",Math.round(me.coordinates.rotation.initialWidth*fZoom));
oUrl.setItem("init_height",Math.round(me.coordinates.rotation.initialHeight*fZoom));
oUrl.setItem("display_angle",me.coordinates.rotation.displayAngleInDegrees);
}


if(me.isGrayScale())
{
oUrl.setItem("gs",1);
}


if(typeof(Editor.substrateColor)!=="undefined"&&Editor.substrateColor)
{
oUrl.setItem("ssc",Editor.substrateColor);
}


oUrl.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);


oUrl.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);


oUrl.setItem("langid",EditorConst.languageID);



if(me.colorOverrides&&me.colorOverrides.length>0)
{
var colors=me.colorOverrides;


if(me.areThermographyColorsMerged&&me.thermographyColorCount)
{
for(var i=0;i<me.thermographyColorCount-me.colorOverrides.length;i++)
{
colors.push(me.colorOverrides[0]);
}
}
oUrl.setItem("coloroverride",colors.join(";"));
}



if(Editor.colorOverride&&Editor.colorOverrides
&&!(Editor.features.useIDGEngravingColors&&me.type==DOCITEM_TYPE_PLACEHOLDER))
{
if(Editor.colorOverrides[Editor.colorOverride])
{
oUrl.setItem("coloroverride",Editor.colorOverrides[Editor.colorOverride]);
}
}

oUrl.setItem("checkres",Editor.features.checkImageResolution);
oUrl.setItem("zoom",Editor.zoomFactor);
oUrl.setItem("productdpi",Editor.productDpi);
return oUrl.toString();
};




this.refresh=_.debounce(function $vpfn_d5z3FCWwa4rhwgLeTOK_wg635$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sNewURL=me.getURL();

var fnUpdateImageSrc=function $vpfn_U8T4C_8Hu37UB3rLhDB_iQ639$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.currentURL||me.currentURL!=sNewURL)
{
me.currentURL=sNewURL;
vp.ui.setSrcPNG(me.imageElement,sNewURL,me._onLoadHandler);

me.onloadstart.fire();

toggleImageResolutionWarning();


if(me.hasFrame())
{
var oRotation=me.coordinates.rotation;
var sFrameURL="/any/preview/image.caspx?png=1&image_type=frame"+
"&"+EditorConst.renderingTechnologyParam+"="+Editor.renderingTechnology+
"&rotation="+oRotation.angleInDegrees+
"&init_width="+Math.round(oRotation.initialWidth*me.coordinates.getZoom())+
"&init_height="+Math.round(oRotation.initialHeight*me.coordinates.getZoom())+
"&display_angle="+oRotation.displayAngleInDegrees;


if(me.cropInfo&&me.cropInfo.UseCropValues)
{
sFrameURL=sFrameURL+
"&use_crop=1"+
"&cropleft="+me.cropInfo.getLeft()+
"&croptop="+me.cropInfo.getTop()+
"&cropright="+me.cropInfo.getRight()+
"&cropbottom="+me.cropInfo.getBottom();
}

if(me.frameID>0)
{
sFrameURL=sFrameURL+"&frame_id="+me.frameID;
sFrameURL=sFrameURL+"&color_scheme_id="+Editor.colorSchemeID;
}
else
{
sFrameURL=sFrameURL+"&vml_frame=";
for(var i=0;i<me.vmlFrame.length;i++)
{
var sColor=me.vmlFrame[i].color?me.vmlFrame[i].color.toString():"#000000";
sFrameURL=sFrameURL+me.vmlFrame[i].width+";"+vp.web.urlEncode(sColor)+";";
}
}

vp.ui.setSrcPNG(me.frameElement,sFrameURL,me._onFrameLoadHandler);

me.positionFrame();
me.positionFrameRough();
}
}
};

if(me.itemTypeString.toLowerCase()==="upload"&&Editor&&Editor.isEmbroidery)
{
me.getMetaData(sNewURL,"X-Color-Override-Flags",fnUpdateImageSrc,vp.studio.StudioEmbroideryUploadMetaData);
}
else if(Editor&&Editor.features.checkImageResolution)
{
me.getMetaData(sNewURL,"X-StudioImage-Quality",fnUpdateImageSrc,vp.studio.ImagePreviewMetaData);
}
else
{
fnUpdateImageSrc();
}
},0);

var toggleImageResolutionWarning=function $vpfn_AFiH7JZB$lh_Cn9E4c9eTg709$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if($lowResolutionWarningIcon)
{
$lowResolutionWarningIcon.hide();
Editor.resolutionWarningTooltipLocked.hide();
Editor.resolutionWarningTooltipUnlocked.hide();
}

if(me.headerMetaData&&me.headerMetaData.imageQuality<=IMAGE_QUALITY_Poor)
{
if(!$lowResolutionWarningIcon)
{
constructImageResolutionWarning();
}

vp.studio.instrumentation.touchFeature(FEATURE_TwoFiveThreePhotoResolutionWarningInHolidayCardStudio);
$lowResolutionWarningIcon.show();
}
};

var constructImageResolutionWarning=function $vpfn_bLxPyd2mBvfR$3JLv2MR2g730$42()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$lowResolutionWarningIcon=$("<IMG>")
.addClass("low-resolution-warning-icon")
.srcPng("/vp/images/B11/common/icon/low-resolution-002.png")
.appendTo(me.handleElement);

var showTooltip=function $vpfn_tdGvdt_97P848gzTHrvCTg737$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var tooltip=me.locked?Editor.resolutionWarningTooltipLocked:Editor.resolutionWarningTooltipUnlocked;
tooltip.element=$lowResolutionWarningIcon[0];
tooltip.show(e);
e.stopPropagation();
e.preventDefault();
};

$lowResolutionWarningIcon.click(showTooltip);

var determinePositionAndShowTooltip=_.throttle(function $vpfn_d5z3FCWwa4rhwgLeTOK_wg748$57(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if($lowResolutionWarningIcon.is(":visible"))
{
var iconOffset=$lowResolutionWarningIcon.position();
var iconSize={width:$lowResolutionWarningIcon.width(),height:$lowResolutionWarningIcon.height()};

if(e.offsetX>=iconOffset.left&&e.offsetX<=(iconOffset.left+iconSize.width)&&
e.offsetY>=iconOffset.top&&e.offsetY<=(iconOffset.top+iconSize.height))
{
showTooltip(e);
}
}
},150);

if(me.manipulator)
{
me.manipulator.onmousedown.addHandler(determinePositionAndShowTooltip);
}
};

this.hasFrame=function $vpfn_aJkjO7cjCJGcZ3_p5tnhxg769$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.frameID!==0)||(me.vmlFrame.length>0);
};





this.setRect=function $vpfn_MLj$YUg31YF_3l93Hmxydw778$19(oRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.coordinates.setRect(oRect);

me.clearDimensions();
};





this.clearDimensions=function $vpfn_o$gAEddxIsqKxtZ2TCsFyQ789$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect=me.coordinates.getRect();

if(oRect.height===0)
{
me.imageElement.removeAttribute("height");
me.imageElement.style.height="";

if(me.handleElement)
{
me.handleElement.removeAttribute("height");
me.handleElement.style.height="";
}
}
if(oRect.width===0)
{
me.imageElement.removeAttribute("width");
me.imageElement.style.width="";
if(me.handleElement)
{
me.handleElement.removeAttribute("width");
me.handleElement.style.width="";
}
}
};






this._onLoadHandler=function $vpfn_vm2L$4ioy5JdMVMn0NMrvQ821$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.imageElement.parentNode)
{
return;
}

me.imageElement.style.visibility="visible";

me.onload.fire(e);
};






this._onFrameLoadHandler=function $vpfn_CF2yjy$7qZeBuMkpf4NdaA838$31(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.frameElement.parentNode)
{
return;
}

me.positionFrame();

me.frameElement.style.visibility="visible";
};

var m_fFrameHeightRatio=0;
var m_fFrameWidthRatio=0;


this.positionFrame=function $vpfn_s4X0Tz5dA2ptN8sFMy8nDQ854$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.frameElement||!me.frameElement.parentNode)
{
return;
}


var oRect=me.coordinates.getRect();
me._centerFrame(oRect);

var oFrameRect=
{
top:me.frameElement.offsetTop,
left:me.frameElement.offsetLeft,
width:me.frameElement.offsetWidth,
height:me.frameElement.offsetHeight
};

m_fFrameHeightRatio=oFrameRect.height/oRect.height;
m_fFrameWidthRatio=oFrameRect.width/oRect.width;
};

this.positionFrameRough=function $vpfn_AfTCytNsT55bGgcKzgCoQA877$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.frameElement||!me.frameElement.parentNode)
{
return;
}

me.frameElement.style.height=me.imageElement.offsetHeight*m_fFrameHeightRatio+"px";
me.frameElement.style.width=me.imageElement.offsetWidth*m_fFrameWidthRatio+"px";

var oRect={};
vp.ui.applyPosition(me.imageElement.style,oRect);





if(isNaN(oRect.width)||isNaN(oRect.height))
{
oRect.width=me.imageElement.offsetWidth;
oRect.height=me.imageElement.offsetHeight;
}

me._centerFrame(oRect);
};

this._centerFrame=function $vpfn_qEE9XiigQ3OeK3KBX7Yakw903$24(oRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.frameElement||!me.frameElement.parentNode)
{
return;
}

if(!isNaN(oRect.width)&&!isNaN(oRect.height))
{
me.frameElement.style.left=oRect.left-((me.frameElement.offsetWidth-oRect.width)/2)+"px";
me.frameElement.style.top=oRect.top-((me.frameElement.offsetHeight-oRect.height)/2)+"px";
}
};





this._getUpdateXMLNode=function $vpfn_mGQ4qagX8oCEGedvEkxURg921$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("image");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,true);

oNode.attributes["itemid"]=me.getItemID();
oNode.attributes["type"]=me.itemTypeString.toLowerCase();

if(me.cropInfo)
{
oNode.attributes["croptop"]=me.cropInfo.getTop();
oNode.attributes["cropleft"]=me.cropInfo.getLeft();
oNode.attributes["cropright"]=me.cropInfo.getRight();
oNode.attributes["cropbottom"]=me.cropInfo.getBottom();
oNode.attributes["use_crop"]=me.cropInfo.UseCropValues;
}

if(me.colorOverrides)
{
for(var i=0,l=me.colorOverrides.length;i<l;i++)
{
var oColorNode=new vp.xml.XMLNode("coloroverride");
oColorNode.setInnerText(me.colorOverrides[i].toString());
oNode.children.push(oColorNode);
}
}

return oNode;
};




this.getUpdateXML=function $vpfn_psMy$jU9B69Nm0rwi$q1xw957$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=me._getUpdateXMLNode();

return oNode.toString();
};






this.upgrade=function $vpfn_ZdAv94V2GAKEP0udeODH5w969$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.handleElement)
{
me.handleElement.alt="";
vp.ui.setStyleValue(me.handleElement,"cursor","");
}

oDecorator.decorateImage(me);

if(me.handleElement)
{
$(me.handleElement).unbind("click",liteStudioClickHandler);
}
};

var _liteStudioHandlersApplied=false;

var liteStudioClickHandler=function $vpfn_4XQsmrjCb7pjGz19pVuxzA987$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openChangeImageTool(me);
};




this.applyColorScheme=function $vpfn_g1tu5brb58wYXDUfIsmHSg995$28(aColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.colorSchemeRef>-1)
{
if(typeof(me.colorOverrides)!=="undefined")
{
var image=null;
if(vp.image.imageDataStorage)
{
image=vp.image.imageDataStorage.getImage(me.uploadID);
}
if(image)
{
me.thermographyColorCount=!image.thermographyColorCount?1:image.thermographyColorCount;
var thermographyColorCount=!me.thermographyNumColorsSet?me.thermographyColorCount:me.thermographyNumColorsSet;
vp.studio.thermography.setColorOverrides(me,aColors,me.colorSchemeRef,thermographyColorCount);
}
else
{

me.colorOverrides=[aColors[me.colorSchemeRef]];
}
}
me.refresh();
}
};





this.makeEditableInLiteStudio=function $vpfn_5e8kRhnB_vhTGuCAtY7BWw1026$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isAdvanced&&!_liteStudioHandlersApplied)
{
if(me.rendered)
{
if(me.handleElement)
{
$(me.handleElement).click(liteStudioClickHandler);
vp.ui.setStyleValue(me.handleElement,"cursor","pointer");
me.handleElement.title=me.handleElement.alt=JSLM_StudioChangeImageTooltip;
}
_liteStudioHandlersApplied=true;
}

me.isEditableInLiteStudio=true;
}
};

this.replaceImageWithPlaceholder=function $vpfn_33HUNIm8REtWL_jrYxqpWg1045$39(bMaintainProportions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var iImageId=Math.abs(Editor.defaultPlaceholderId);
var oImageInfo=new vp.image.ImageInfo();
var oVpImage=new vp.image.Image(vp.image.Type.Library,iImageId);


var infoCb=function $vpfn_d5z3FCWwa4rhwgLeTOK_wg1053$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oNewImageSize={top:0,left:0,width:this.oImageInfo.intrinsicWidth,height:this.oImageInfo.intrinsicHeight};



var oContainerSize={top:0,left:0,width:this.oImg.coordinates.getRectPrecise().width,height:this.oImg.coordinates.getRectPrecise().height};


if(this.iRotation&&(this.iRotation==90||this.iRotation==270))
{
oContainerSize={top:0,left:0,width:this.oImg.coordinates.getRectPrecise().height,height:this.oImg.coordinates.getRectPrecise().width};
}



var oSmartCrop=vp.image.getAutoPlacedImageCrop(oNewImageSize,oContainerSize,this.oCropInfo);


var cmd=new vp.studio.commands.ChangeImage(this.oImg,DOCITEM_TYPE_PLACEHOLDER,this.iImgItemId,oSmartCrop,null,this.iRotation);
cmd.execute();
Editor.history.add(cmd);
}
.getClosure({
oImageInfo:oImageInfo,
oImg:me,
iImgItemId:iImageId,
iRotation:null,
oCropInfo:null
});


oImageInfo.loadImageInfo(oVpImage,infoCb,infoCb);

return;
};




this.makeDraggable=function $vpfn_GiCNxJB_aG7kvi1QpQp2lw1094$25(oEditor){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isDraggable&&oEditor.features.enableDraggableUploadedImage&&me.handleElement){



$(me.handleElement).unbind("click",liteStudioClickHandler);


var oMeAsEditedImage=vp.image.convertStudioImageToEditedImage(me,oEditor);
me.draggableImage=new vp.studio.Draggable(
me.handleElement,
{
data:{
"image":oMeAsEditedImage,
"originatingDocItem":me
},
helperElement:me.imageElement,
scope:"studio"
});

if(oEditor.features.forceDraggableUploadedImage)
{
me.draggableImage.setEnabled(true);
}else
{
me.draggableImage.setEnabled(me.locked||!oEditor.isAdvanced);
}
$(me.handleElement).click(liteStudioClickHandler);
}
};




this.makeDroppable=function $vpfn_BY9mUCJSNYt0vlAvnhniNw1128$25(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isDroppable&&oEditor.features.enableDroppableImageItems&&me.handleElement)
{

me.droppableArea=new vp.studio.Droppable(
me.handleElement,
{
drop:function $vpfn_d5z3FCWwa4rhwgLeTOK_wg1136$26(e,ui)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var originatingDocItem=ui.draggable.data("originatingDocItem");
if(originatingDocItem)
{

vp.spot.track("studio_image_swap");




me.smartCropIntoContainer(
originatingDocItem,
vp.image.convertStudioImageToEditedImage(me,Editor));
}

me.smartCropIntoContainer(
me,
ui.draggable.data("image"));


me.onchange.fire();
},
scope:"studio"
});
}
};









this.smartCropIntoContainer=function $vpfn_crFITIg1q$dwPbkCFUIQYg1172$34(oImgDocItem,oEditedImage)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oImageInfo=new vp.image.ImageInfo();


var infoCb=function $vpfn_d5z3FCWwa4rhwgLeTOK_wg1177$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oNewImageSize={top:0,left:0,width:this.oImageInfo.intrinsicWidth,height:this.oImageInfo.intrinsicHeight};



var oContainerSize={top:0,left:0,width:this.oImg.coordinates.getRectPrecise().width,height:this.oImg.coordinates.getRectPrecise().height};


if(this.oEditedImage.rotation==90||this.oEditedImage.rotation==270)
{
oContainerSize={top:0,left:0,width:this.oImg.coordinates.getRectPrecise().height,height:this.oImg.coordinates.getRectPrecise().width};
}

var containerAspectRatio=oContainerSize.width/oContainerSize.height;
var newImageAspectRatio=oNewImageSize.width/oNewImageSize.height;

var oSmartCrop=null;
var editedImageCrop=this.oEditedImage.cropInfo;
var editedImageHasCrop=(editedImageCrop.top!==0)||(editedImageCrop.left!==0)||(editedImageCrop.right!==0)||(editedImageCrop.bottom!==0);

if(!editedImageHasCrop||
Math.abs(Math.round(containerAspectRatio*100)-Math.round(newImageAspectRatio*100))>=1)
{


oSmartCrop=vp.image.getAutoPlacedImageCrop(oNewImageSize,oContainerSize,this.oEditedImage.cropInfo);
}
else
{
oSmartCrop=this.oEditedImage.cropInfo;
}


var cmd=new vp.studio.commands.ChangeImage(
this.oImg,
vp.image.ImageTypeToStudioDocItemType(this.oEditedImage.type),
this.oEditedImage.id,
oSmartCrop,
null,
this.oEditedImage.rotation);
cmd.execute();
Editor.history.add(cmd);

}.getClosure({
oImageInfo:oImageInfo,
oImg:oImgDocItem,
oEditedImage:oEditedImage
});


oImageInfo.loadImageInfo(oEditedImage,infoCb,infoCb);
};


me.onchange.addHandler(
function $vpfn_d5z3FCWwa4rhwgLeTOK_wg1234$8(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.draggableImage){
var oMeAsEditedImage=vp.image.convertStudioImageToEditedImage(me,Editor);
me.draggableImage.data("image",oMeAsEditedImage);
}
});
};

vp.studio.Image._CORE_ATTRIBUTES=[
"id",
"zIndex",
"locked",
"brandingType",
"notSwappable",
"purposeName",
"isDominantImage",
"isFoil",
"isFullFoil",
"metaData",
"frameID",
"frameIsBehindImage",
"imageAreaID",
"colorSchemeRef"
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.ImageMouseoverButton=function ImageMouseoverButton(oImageItem,fnOnClickAction)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.imageItem=oImageItem;


this.buttonName;

this.src;

this.onClick=fnOnClickAction;

this.imageItemHandler=oImageItem.getManipulatorElement();

this.visible=false;

this.element=null;


this.width=73;

this.height=20;

var minWidth=73;

var minHeight=20;

var maxWidth=200;

var maxHeight=100;

this.useDefaultButtonSize=false;

var percentages=new Array(0.9,0.8,0.6,0.5,0.4,0.3,0.2,-1);

this.oninit=new vp.events.CustomEvent(this,"oninit");


this.calculateButtonSize=function $vpfn_4xl$p4UV1kHn0ttYhsPacQ53$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newHeight,newWidth;

var oImgRect=me.imageItem.coordinates.getRect();

if(isWidthInIdealLimits(me.width)&&isHeightInIdealLimits(me.height))
{
return;
}

var percentageIndex=0;
var percentage;


while(!isHeightInIdealLimits(me.height))
{
percentage=percentages[percentageIndex];

newHeight=me.height*percentage;
newWidth=me.width*percentage;

if(!isHeightInMinMaxRange(newHeight)||!isWidthInMinMaxRange(newWidth))
{
return;
}

me.width=newWidth;
me.height=newHeight;
}

percentageIndex=0;

while(!isWidthInIdealLimits(me.width))
{
percentage=percentages[percentageIndex];

newHeight=me.height*percentage;
newWidth=me.width*percentage;

if(!isHeightInMinMaxRange(newHeight)||!isWidthInMinMaxRange(newWidth))
{
return;
}

me.width=newWidth;
me.height=newHeight;
}
};


var isHeightInMinMaxRange=function $vpfn_rpdNAMdA9H4L6oKBzDq6iQ104$32(height)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(height<=maxHeight)&&(height>=minHeight);
};


var isWidthInMinMaxRange=function $vpfn_n0WLz_zZDiGE2UdkLgTFNQ110$31(width)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(width<=maxWidth)&&(width>=minWidth);
};



var isWidthInIdealLimits=function $vpfn_Xi8LHbiNrG0h37PZPdim$w117$31(width)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var imageInitialWidth=Math.round(oImageItem.coordinates.rotation.initialWidth*oImageItem.coordinates.getZoom());

var IDEAL_MULTIPLE_OF_WIDTH=0.5;

return(0<width)&&(width<=imageInitialWidth*IDEAL_MULTIPLE_OF_WIDTH);
};



var isHeightInIdealLimits=function $vpfn_ro364krqsWH3g2VyEBxtVA128$32(height)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var imageInitialHeight=Math.round(oImageItem.coordinates.rotation.initialHeight*oImageItem.coordinates.getZoom());

var IDEAL_MULTIPLE_OF_HEIGHT=0.5;

return(0<height)&&(height<=imageInitialHeight*IDEAL_MULTIPLE_OF_HEIGHT);
};


this.hideSimilarImageMouseoverButtons=function $vpfn_j794BvwWmLpu1uIupwpdsg138$44()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

for(var i=Editor.items.length-1;i>=0;i--)
{
var oItem=Editor.items[i];

if(oItem)
{
var aImageMouseoverButtons=oItem.imageMouseoverButtons;

if(aImageMouseoverButtons)
{

for(var j=aImageMouseoverButtons.length-1;j>=0;j--)
{

var oImageMouseoverButton=aImageMouseoverButtons[j];
if(oImageMouseoverButton.buttonName===me.buttonName&&oItem.id!=me.imageItem.id)
{

oImageMouseoverButton.hide();
}
}
}
}
}
};




this.hide=function $vpfn_dWx3$oBH479ykJYWRpTEow170$16(toElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.element)
{
$(me.element).hide();
me.visible=false;
}
};




this.show=function $vpfn_Nv7rvtdggehrnPvFsO8yRQ182$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if($(me.imageItemHandler).parent().length<1)
{


return;
}


if(!me.element)
{
me.element=document.createElement("IMG");
me.element.id=me.buttonName+me.imageItem.id;
me.element.src=me.buttonSrc;
vp.ui.setStyleValue(me.element,"cursor","hand");
vp.ui.setStyleValue(me.element,"z-index",100000);
vp.ui.setStyleValue(me.element,"position","absolute");

if(!me.useDefaultButtonSize)
{
me.calculateButtonSize();
}

vp.ui.setStyleValue(me.element,"height",me.height+"px");
vp.ui.setStyleValue(me.element,"width",me.width+"px");

me.height=($(me.element).height()===0)?me.height:$(me.element).height();
me.width=($(me.element).width()===0)?me.width:$(me.element).width();

vp.events.add(me.element,"click",function $vpfn_lRUaELLByQwlE0ES$t2dHg212$47(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.onClick(e);});

vp.events.add(me.element,"mouseout",function $vpfn_lRUaELLByQwlE0ES$t2dHg214$50(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

e=vp.events.getEvent(e);


var toElement=e.relatedTarget;


if(toElement!=me.imageItemHandler)
{
window.setTimeout(function $vpfn_lRUaELLByQwlE0ES$t2dHg225$38(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.hide();},100);
}
});

$(me.imageItemHandler).before(me.element);
me.oninit.fire();
}

me.hideSimilarImageMouseoverButtons();

var image=Editor.getItemByID(me.imageItem.id);
if(image)
{

var jImageItemHandler=$(me.imageItemHandler);

var iTop=jImageItemHandler.position().top+jImageItemHandler.height()/2-me.height/2;
$(me.element).css({top:iTop});
$(me.element).css({"display":"block"});

var iWidthOfUnaccountedButtons=0;
var iButtonSpacerWidth=3;
var aImageMouseoverButtons=me.imageItem.imageMouseoverButtons;
for(var iButtonIndex=aImageMouseoverButtons.length-1;iButtonIndex>=0;iButtonIndex--)
{
var oCurrentButton=aImageMouseoverButtons[iButtonIndex];

iWidthOfUnaccountedButtons+=iButtonIndex===0?
oCurrentButton.width:
oCurrentButton.width+iButtonSpacerWidth;
}

var iImageLeftPosition=jImageItemHandler.position().left;
var iImageWidth=jImageItemHandler.width();
var iLeftPositionOfFirstButton=Math.max(iImageLeftPosition+(iImageWidth-iWidthOfUnaccountedButtons)/2,0);

for(var iBtnIndex=me.imageItem.imageMouseoverButtons.length-1;iBtnIndex>=0;iBtnIndex--)
{
var oCurrentImageMouseoverBtn=me.imageItem.imageMouseoverButtons[iBtnIndex];


var iWidthOfButtonIncludingSpacer=iBtnIndex===0?
$(oCurrentImageMouseoverBtn.element).width():
$(oCurrentImageMouseoverBtn.element).width()+iButtonSpacerWidth;


iWidthOfUnaccountedButtons-=iWidthOfButtonIncludingSpacer;



var iLeftAttr=iBtnIndex===0?
iLeftPositionOfFirstButton+iWidthOfUnaccountedButtons:
iLeftPositionOfFirstButton+iWidthOfUnaccountedButtons+iButtonSpacerWidth;
$(oCurrentImageMouseoverBtn.element).css({left:iLeftAttr});
}

this.visible=true;
me.oninit.fire();
}
};
};vp.studio.ImageMouseoverButton._vpfn='$vpfn_TE5pbcTV4SV3PqWgKx4X7w14$33';

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



var EDIT_IMAGE_MOUSEOVER_BUTTON_NAME="imgEditImage_";

vp.studio.EditImageButton=function $vpfn_5FQEPcddTX92cdh4MwdW_A7$28(oImageItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;


var openEditWindow=function $vpfn_9cKUQ9OVqfRA3F5bSMREFw12$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("edit_image_button_clicked",me.imageItem.id);
me.hide();
vp.studio.ui.addAndCropImage(me.imageItem.id);
return false;
};

this.inheritFrom=vp.studio.ImageMouseoverButton;
this.inheritFrom(oImageItem,openEditWindow);

this.buttonName=EDIT_IMAGE_MOUSEOVER_BUTTON_NAME;

this.buttonSrc="/vp/images/b09/common/button/graphical/edit-overlay-03.png";

};

var LARGE_EDIT_IMAGE_MOUSEOVER_BUTTON_NAME="imgLargeEditImage_";

vp.studio.LargeEditImageButton=function $vpfn_DMNMJGxr4eh9nHKP65kRJw31$33(oImageItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.inheritFrom=vp.studio.EditImageButton;
this.inheritFrom(oImageItem);

this.buttonName=LARGE_EDIT_IMAGE_MOUSEOVER_BUTTON_NAME;

this.buttonSrc="/vp/images/b09/common/button/graphical/edit-overlay-02.png";

this.width=170;
this.height=69;

this.useDefaultButtonSize=true;

};


if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.RemoveImageButton=function $vpfn_R7oatLGLEdYH7cQVaB_t_Q11$30(oImageItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.buttonName=REMOVE_IMAGE_MOUSEOVER_BUTTON_NAME;

this.buttonSrc="/vp/images/b09/common/button/graphical/remove-overlay-01.png";


var removeImage=function $vpfn_NtqeG4pMfI4pdMndO$UdLA20$22(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.hide();


var oSelection=new vp.studio.Selection();

oSelection.add(me.imageItem,true);


var oCmd=new vp.studio.commands.Delete(oSelection);

oCmd.execute();
Editor.history.add(oCmd);

vp.studio.instrumentation.add("remove_image_button_clicked");

me.hideSimilarImageMouseoverButtons();
return false;
};

this.inheritFrom=vp.studio.ImageMouseoverButton;
this.inheritFrom(oImageItem,removeImage);

};

var REMOVE_IMAGE_MOUSEOVER_BUTTON_NAME="imgRemoveImage_";

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}







vp.studio.ImageArea=function $vpfn_NKaBJL7rdZ8OV7jUip37Qw9$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

me.id;

me.arranger;

me.imagesInOrder;




this.getUpdateXML=function $vpfn_7dY5zN7YL$pREfVPzwIcpg22$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("alterimagearea");
oNode.attributes["id"]=me.id;
oNode.attributes["arranger"]=me.arranger;

if(typeof(me.requiredNumImages)!="undefined")
{
oNode.attributes["required-num-images"]=me.requiredNumImages;
}

if(me.imagesInOrder)
{
var oChangeOrderNode=new vp.xml.XMLNode("changeorder");
for(var i=0;i<me.imagesInOrder.length;i++)
{
var oImageNode=new vp.xml.XMLNode("imageAreaImage");
oImageNode.attributes["id"]=me.imagesInOrder[i];
oChangeOrderNode.children.push(oImageNode);
}
oNode.children.push(oChangeOrderNode);
}

return oNode.toString();
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.Caricature=function $vpfn_vGq_9XJEwsMZPYqpaevEIw13$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Image;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CARICATURE;





this.caricatureID=0;





this.captionID="";





this.caption=null;


this._coreAttributes=vp.studio.Caricature._CORE_ATTRIBUTES;





this.getItemID=function $vpfn_ns_W1B_rwTuc40PNz27PvQ54$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.caricatureID;
};





this.getIDPrefix=function $vpfn_gfdDp49i7vyXU7$gGBIJEg63$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_caricature_";
};





this.getURL=function $vpfn_ca4Tkb9gXphrBkgnz1t51w72$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oQS=new vp.web.QueryString();

var oRect=me.coordinates.getRect();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem('width',oRect.width);
oQS.setItem('height',oRect.height);

oQS.setItem('caricature_id',me.caricatureID);
oQS.setItem('transparency',1);

if(vp.web.getQueryString("admin"))
{
oQS.setItem("admin",vp.web.getQueryString("admin"));
}

return'/vp/ns/caricatures/caricature_preview.aspx?'+oQS.toString();
};





this.setItemID=function $vpfn_Za7HF30raGr2i3Ja52niGA97$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.caricatureID=iItemID;
};






this.itemTypeString="Caricature";





this.hasCaption=function $vpfn_LwJah5H9YsEZrQl4rK2e9Q113$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.caption&&Editor.items.contains(me.caption);
};


var _resizeInfo=null;




this.onResizeStart=function $vpfn_4iPK$SnxZgPeUD4wrbFwEA124$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.hasCaption())
{
return;
}

var rect=me.coordinates.getRectPrecise();
var captionRect=me.caption.coordinates.getRectPrecise();

_resizeInfo={

width:rect.width,
height:rect.height,


x:(captionRect.left+captionRect.width/2)-(rect.left+rect.width/2),
y:(captionRect.top+captionRect.height/2)-(rect.top+rect.height/2)
};
};




this.onResize=function $vpfn_Eax9RGHgLD7Z$rJDfBzWBg148$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.hasCaption())
{
return;
}

var rect=me.coordinates.getRectPrecise();
var captionRect=me.caption.coordinates.getRectPrecise();

var x=(rect.width/_resizeInfo.width)*_resizeInfo.x;
var y=(rect.height/_resizeInfo.height)*_resizeInfo.y;

me.caption.coordinates.setCoordPrecise('left',x+(rect.left+rect.width/2)-(captionRect.width/2));
me.caption.coordinates.setCoordPrecise('top',y+(rect.top+rect.height/2)-(captionRect.height/2));
};






this.upgrade=function $vpfn_AgI6ANqjT9dKJX_tpo_VIQ170$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateCaricature(me);
};
};

vp.studio.Caricature._CORE_ATTRIBUTES=vp.studio.Image._CORE_ATTRIBUTES.concat([
"captionID"
]);






vp.studio.Caricature.relinkClonedItems=function $vpfn_ZnYTkRFKzbbRgc5qTeZPIQ185$41(arr)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i,j,caricature,caption;

for(i=0;i<arr.length;i++)
{
if(arr[i].type===DOCITEM_TYPE_CARICATURE)
{
caricature=arr[i];



for(j=0;j<arr.length;j++)
{
if(DOCITEM_TEXT_TYPES.contains(arr[j].type)&&
caricature.clonedFrom.captionID===arr[j].clonedFrom.id)
{



caption=arr[j];

caption.label=JSLM_CaricatureCaptionLabel;
caricature.captionID=caption.id;
caricature.caption=caption;
}
}
}
}
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CaricatureArea=function $vpfn_WZJXCF4UEuz6s2DzuD_W2Q11$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CARICATURE_AREA;






this._coreAttributes=vp.studio.CaricatureArea._CORE_ATTRIBUTES;

this.isChrome=true;





this.getUpdateXML=function $vpfn_GGRH1obkbTMKSPC5yg7O8Q40$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("caricaturearea");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,false);

return oNode.toString();
};





this.getManipulatorElement=function $vpfn_dWOG$a1IuVJ1TE2Ct$CTrg55$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};
};

vp.studio.CaricatureArea._CORE_ATTRIBUTES=
[
"maxCaricatures"
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(!vp.smartlayout)
{
vp.smartlayout={};
}







vp.smartlayout.SmartLayoutTextField=function $vpfn_t0Anp4NfOvy2a$zAK$Npcw17$38()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.TextField;
this.inheritFrom();


var inheritFrom_refresh=this.refresh;

var me=this;
this.textAreaType=Editor.features.useSmartLayoutsInAdvanced
?TEXT_AREA_TYPE_SIMPLE
:this.getTextAreaType();





this.modified=false;




this.isSmartLayout=function $vpfn_qrdGKFop6r51EXSFauazFw42$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.purposeName!=='info'&&Editor.isSmartLayout);
};





this.refresh=function()
{
};




this.refreshBaseTextField=function $vpfn_dWLT0IdVjXIJXCF3NOV$4Q58$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
inheritFrom_refresh.apply(this,arguments);
me.modified=false;
};






this.onbeforetextchange.addHandler(function $vpfn_9jKaWTE4ixbGr6Jpj0AUxw69$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isLoadComplete&&Editor.isSmartLayout)
{
me.modified=true;

vp.smartlayout.ui.showBlankStampError=true;
}
});







this.onaftertextchange.addHandler(function $vpfn_9jKaWTE4ixbGr6Jpj0AUxw85$38()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.isSmartLayout)
{
vp.smartlayout.update(false,false);
}
});






this.upgrade=function $vpfn_RqjYWfipg$KxowxJBvV6Yw99$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.restricted)
{

if(!Editor.isSmartLayout)
{
oDecorator.decorateTextField(me);
me.refresh=inheritFrom_refresh;
}
else
{
oDecorator.decorateSmartLayoutTextField(me);
}
}
};
};






vp.smartlayout.SmartLayoutTextField.anyOutOfDate=function $vpfn_je73JTsEAjHyE6fWmAtAng123$51()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=false;

var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT);
for(var i=0;i<textFields.length;i++)
{
var textField=textFields[i];
if(textField.isSmartLayout()&&textField.modified)
{
result=true;
break;
}
}

return result;
};





vp.smartlayout.SmartLayoutTextField.fieldsWithText=function $vpfn_g$dA9cWnO_w9lTMfGnPSjQ145$53()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fieldsWithText=[];

var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT);
for(var i=0;i<textFields.length;i++)
{
var textField=textFields[i];
if(textField.isSmartLayout()&&textField.hasText())
{
fieldsWithText.push(textField);
}
}

return fieldsWithText;
};





vp.smartlayout.SmartLayoutTextField.hasText=function $vpfn_DMB_x7GhSCjB0t7tqa7hIw166$46()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=false;

var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT);
for(var i=0;i<textFields.length;i++)
{
var textField=textFields[i];
if(textField.isSmartLayout()&&textField.hasText())
{
result=true;
break;
}
}

return result;
};





vp.smartlayout.SmartLayoutTextField.refreshAllBaseTextFields=function $vpfn_El7Fs0yFaIuifkrmmeLcpg188$63()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT);
for(var i=0;i<textFields.length;i++)
{
textFields[i].refreshBaseTextField();
}

vp.smartlayout.ui.showError(
vp.smartlayout.ui.showTextLengthWarning,
JSLM_SmartLayoutTextLengthWarning);


var stampIsBlank=vp.smartlayout.stampIsBlank();
vp.smartlayout.ui.setSaveEnabled(!stampIsBlank);






vp.smartlayout.ui.showError(
stampIsBlank&&!Editor.hasClickText()&&vp.smartlayout.ui.showBlankStampError,
JSLM_BlankStampWarning);
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(!vp.studio)
{
vp.studio={};
}







vp.studio.FlashTextArea=function $vpfn_I4VLBL03wUIDyIT71DHoNw15$26(bSingleLine)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.widget.TextFieldBase;
this.inheritFrom(bSingleLine);

var me=this;

var base_getValue=this.getValue;
this.getValue=function $vpfn_By6vB$NzJEwqvFv3NrGGJg26$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.plainTextToXHTML(base_getValue());
};

var base_setValue=this.setValue;
this.setValue=function $vpfn_WWiSQ9$xRGwrQtJtEQl0Fw32$20(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
base_setValue(me.XHTMLToPlainText(sXML));
};

this.setStyle=function(){};

this.setStyleSimple=function(){};
};






vp.studio.PlainTextArea.prototype.plainTextToXHTML=function $vpfn_r$ZcJJuHW7OAjFcHT$TWzQ47$53(sText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.web.xmlEncode(sText).replace(/(\r)?\n/gi,"<br />");
};






vp.studio.PlainTextArea.prototype.XHTMLToPlainText=function $vpfn_XmOT391qoC_DObu6BhEyTQ57$53(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.web.xmlDecode(sXML.replace(/\<br\s*\/\>/gi,"\r\n"));
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.TextArea=function $vpfn_u2RvoxYT53k6gKQubR1ZKw11$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_TEXTAREA;






this._coreAttributes=vp.studio.TextArea._CORE_ATTRIBUTES;





this.getUpdateXML=function $vpfn_YyD7x5K1TDWObdm3XOklEQ38$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("textarea");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,false);

return oNode.toString();
};





this.getManipulatorElement=function $vpfn__dD$f2tY7u2Bl3t3kBP4lA53$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};
};

vp.studio.TextArea._CORE_ATTRIBUTES=
[
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



var TEXT_AREA_TYPE_RICH=1;
var TEXT_AREA_TYPE_PLAIN=2;
var TEXT_AREA_TYPE_SIMPLE=3;
var TEXT_AREA_TYPE_GREEK=4;
var TEXT_AREA_TYPE_FLASH=5;








vp.studio.TextFieldBase=function $vpfn_b2xXKYH5skhiThodbxzB9A18$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

this.classRef=arguments.callee;

var me=this;





this.label="";






var cachedClickText="";
this.clickText="";





this.fieldOrder=0;





this.persist=false;





this.loaded=false;





this.align="left";





this.fontFamily="Arial";





this.fontWeight="normal";





this.fontStyle="normal";





this.fontColor=null;







this.fontSchemeRef=-1;







this.colorSchemeRef=-1;





this.isCaricatureCaption=false;





this.eventsDisabled=false;






this.textAreaType=TEXT_AREA_TYPE_PLAIN;





this.onloadstart=new vp.events.CustomEvent(this,"onloadstart");





this.onload=new vp.events.CustomEvent(this,"onload");






this.onaftertextchange=new vp.events.CustomEvent(this,"onaftertextchange");






this.onbeforetextchange=new vp.events.CustomEvent(this,"onbeforetextchange");





this.onfocusexternaltext=new vp.events.CustomEvent(this,"onfocusexternaltext");





this.onblurexternaltext=new vp.events.CustomEvent(this,"onblurexternaltext");





this.onminitoolbarclick=new vp.events.CustomEvent(this,"onminitoolbarclick");





this.onmove=new vp.events.CustomEvent(this,"onmove");





this.docElement=null;





this.externalTextElement=null;





this.externalTextField=null;





this.externalTextLabelElement=null;






this.externalTextDropDownElement=null;





this.externalTextOptionDiv=null;





this._imageURL=null;





this.overhangCSSRect={
top:0,
right:0,
bottom:0,
left:0
};

this._STYLE_MAP={
"fontStyle":"font-style",
"fontWeight":"font-weight",
"fontSize":"font-size",
"fontColor":"color",
"align":"text-align",
"fontFamily":"font-family"
};






this._coreAttributes=vp.studio.TextFieldBase._CORE_ATTRIBUTES;




this.miniToolbarContainer=null;




this.miniToolbarAnimationInterval=10;




this.miniToolbarHeight=32;




this.expanding=false;




this.shrinking=false;





this.textOptionType="";





this.textOptionId=0;





this.textOptionList=[];





this.getIDPrefix=function $vpfn_uEFNWuXLf0u0Atu3Q__a6A294$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_text_";
};


var stylesChanged=false;





this.render=function $vpfn_fILzb4xjGDIExTbpgZz3yg306$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.renderDocElement(oEditor);
me.renderExternalTextField(oEditor);
};





this.renderDocElement=function $vpfn_1zHxWZb163_Jurvk9Z8rZg316$28(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.docElementRendered)
{





me.docElementRendered=true;

loadDocElement();
oEditor.documentArea.appendChild(me.docElement);
oEditor.docItemHandleArea.appendChild(me.handleElement);
}
};





this.isBrandedField=function $vpfn_TQFvzKW8Mn8J$AS3s6qnAA337$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.brandingType!=BRANDING_TYPE_NONE;
};




this.clearOverhangs=function $vpfn_t3Dh5buwyer6tIgdWXy1aQ345$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.overhangCSSRect.top=0;
me.overhangCSSRect.right=0;
me.overhangCSSRect.left=0;
me.overhangCSSRect.bottom=0;
};





this.isWritableField=function $vpfn_2SYgDDWm$3_zWRVIiMd$2A357$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return Editor.features.isEPTemplateEdit||!me.isBrandedField();
};

this.isRestrictedField=function $vpfn_6v$jfzfC1gg760ajeMbfGA362$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.restricted&&!Editor.features.isEPTemplateEdit;
};

this.preserveClickText=function $vpfn_Yx8uyj88ckp0UhBctr$szQ367$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return Editor.features.isEPTemplateEdit;
};





this.textOptionAllowUserInput=function $vpfn_OYM8eTSu6qKCWsvFVmKV5w377$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.textOptionList.length>0)
{
return me.textOptionList[me.externalTextDropDownElement.selectedIndex].isUserInput;
}

return false;
};





this.renderExternalTextField=function $vpfn_Ez6J_7UFTxJno2uj70fHmQ391$35(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.isRestrictedField())
{
return;
}

if(!me.externalTextElementRendered)
{
loadExternalTextElement(oEditor);


if((!me.externalTextElement.parentNode||
me.externalTextElement.parentNode.nodeType!=1)&&
oEditor.textFieldsArea)
{
oEditor.textFieldsArea.appendChild(me.externalTextElement);
}

me.externalTextField.refresh();
me.externalTextElementRendered=true;
}
};




this.unrender=function $vpfn_W8O4l38k$hplLfiMSTR8LA419$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.unrenderDocElement();
me.unrenderExternalTextField();

me.onunrender.fire();
};





this.unrenderDocElement=function $vpfn_UVsrmQoAgofSMXMJ$EAgzQ431$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.docElementRendered)
{
me.docElement.parentNode.removeChild(me.docElement);
me.handleElement.parentNode.removeChild(me.handleElement);
me.docElementRendered=false;
me._imageURL=null;
}
};





this.unrenderExternalTextField=function $vpfn_DLVZ5VcXBiVKB4d56qMZ3w446$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isWritableField())
{
return;
}

if(me.externalTextElementRendered)
{
me.externalTextField.blur();
me.externalTextElement.parentNode.removeChild(me.externalTextElement);
me.externalTextElementRendered=false;
}
};





var loadDocElement=function $vpfn_c3soNfCJ7feGsau3rvdfuA465$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.docElement)
{
if(me.data.length===0)
{
me.data=me.clickText;
}


me.handleElement=document.createElement("DIV");
me.handleElement.id=me.id+"_text_handle";
me.handleElement.style.position="absolute";

me.handleElement.style.visibility="hidden";
me.handleElement.style.position="absolute";


me.handleImage=document.createElement("IMG");
me.handleImage.src=BLANK_IMAGE;
me.handleImage.style.visibility="visible";
me.handleImage.style.position="relative";


me.handleElement.appendChild(me.handleImage);
me.coordinates.boundElements.add(me.handleElement);

me.docElement=document.createElement("DIV");
me.docElement.id=me.id;
me.docElement.className="studioDocumentText";
me.docElement.style.visibility="hidden";

me.setZIndex();






if(vp.browser.isSafari||vp.browser.isMobile)
{
me.docElement.style.visibility="visible";

}


me.docElement.style.overflow="visible";
me.docElement.style.position="absolute";



me.coordinates.boundElements.add(me.docElement);
me.coordinates.updateBoundElements(true);

me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id+"_textImage";
me.imageElement.style.visibility="hidden";

me.docElement.appendChild(me.imageElement);




me.coordinates.onresize.addHandler(function $vpfn_cKgoLT_5boDbKd8_8JEJMQ528$47(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}Editor.setDocumentChanged(true);});
}

me.refresh();
};





this.setZIndex=function $vpfn_9OicdNoEGVG7Ta8OiuiH2A538$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}
me.handleElement.style.zIndex=me._getDOMElementZIndex(true);
me.docElement.style.zIndex=me._getDOMElementZIndex();

this._ieSizeRefreshHack();

};





this.getImageSrc=null;




this.refresh=function $vpfn_pJ7zviKWkrg_6cpAaVN2dw560$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.refreshDisabled)
{
return;
}





var sNewSrcToken=me.getImageSrc(true);


if(me._imageURLToken===sNewSrcToken&&me.imageElement&&me.imageElement.width>0)
{
if(me.loaded)
{

me.resetCoordinatesToImageSize();
}
return;
}

var url=me.getImageSrc();

me._imageURL=url;
me._imageURLToken=sNewSrcToken;
var fnUpdateImageSrc=function $vpfn_pERVNgybgYzY5MfmXJvQZQ588$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.onloadstart.fire();


if(me._imageURL)
{
me.loaded=false;
me.setImageSrc(onloadHandler);
}

else
{
me.imageElement.style.visibility="hidden";
me.handleImage.style.visibility="hidden";
}
};

if(url&&Editor.features.EnableStudioTextOverhangSupport)
{
me.getMetaData(url,EditorConst.studioTextMetaDataName,fnUpdateImageSrc,vp.studio.StudioTextMetaData);
}
else
{
fnUpdateImageSrc();
}
};





this.setImageSrc=function $vpfn_MudN9RsC0mQMwQfD4ux9GQ620$23(onloadHandler)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.imageElement,me._imageURL,onloadHandler);
};





var onloadHandler=function $vpfn_DKpEWKNB3of7gB58aZVMOw629$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.docElementRendered)
{
return;
}

me.resetCoordinatesToImageSize();

me.imageElement.style.visibility="visible";
me.handleImage.style.visibility="visible";

me.handleImage.style.width=me.imageElement.offsetWidth+"px";
me.handleImage.style.height=me.imageElement.offsetHeight+"px";

me._ieSizeRefreshHack();

me.loaded=true;

me.onload.fire(e);
};










this._ieSizeRefreshHack=function $vpfn_Qw3uqfYfeA$Y1QcsWgFVmA661$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.ui.browserSupportsPNG())
{
return;
}

me.docElement.style.visibility="visible";

var fnHide=function $vpfn_cKgoLT_5boDbKd8_8JEJMQ670$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.docElement.style.visibility="hidden";
}
.getClosure(me);

window.setTimeout(fnHide,1);
};




this.deleteClickText=function $vpfn_nsc72vkH7EfKMqk4qJPjZw682$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.preserveClickText())
{
me.hideClickText();
me.clickText="";
}
};




this.hideClickText=function $vpfn_y3614sBK$Wrn7jybo1xfoA694$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



if(vp.web.htmlDecode(me.data)==vp.web.htmlDecode(me.clickText)&&
me.data!==""&&
!me.persist)
{
me.setDataAndFireEvents("");
}
};




this.showClickText=function $vpfn_13cjB0_dKAgGnS3x7ojukA710$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.data=(me.data.length===0)?me.clickText:me.data;
me.refresh();
};




this.hasClickText=function $vpfn_ceP2NG8aZHKXXCCneOmsgA719$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.clickText&&me.clickText!==""&&me.data==me.clickText);
};





this.hasText=function $vpfn_fyv2HPu$gA4bx0EiLcPfYw728$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.getProcessedData().trim()!=="");
};




this.expandToolbar=function $vpfn_4deH_LKcbsrxZ_yQRPVrxA736$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnShowAni=function $vpfn_Y81bSwgzuHJVIdMCtS7rOg738$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.shrinking)
{
me.expanding=false;
return;
}

var height=parseInt(me.miniToolbarContainer.style.height);
if(height<me.miniToolbarHeight)
{
height+=6;
me.miniToolbarContainer.style.height=height+"px";
window.setTimeout(fnShowAni,me.miniToolbarAnimationInterval);
}
else
{
me.expanding=false;
}
};


var fnWait=function $vpfn_JvU9PCTclsnQ8CW0m1uCHQ761$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.shrinking)
{
window.setTimeout(fnWait,200);
}
else
{
me.expanding=true;
fnShowAni();
}
};

fnWait();
};




this.collapseToolbar=function $vpfn_SYlfNMZ3dVby4XpvPNtygw780$27(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnHideAni=function $vpfn_D_gUvHSWaagOAN_Rn8KwRg782$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var height=parseInt(me.miniToolbarContainer.style.height);
if(height>1)
{
height-=6;
me.miniToolbarContainer.style.height=height+"px";
window.setTimeout(fnHideAni,me.miniToolbarAnimationInterval);
}
else
{
me.shrinking=false;
me.expanding=false;
}
};


var fnWait=function $vpfn_JvU9PCTclsnQ8CW0m1uCHQ799$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.expanding)
{
me.shrinking=true;
window.setTimeout(fnWait,200);
}
else
{
me.shrinking=true;
fnHideAni();
}
};
fnWait();
};




this.hideToolbar=function $vpfn_3PJVackf0EtVfUskvssmXA818$23(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.miniToolbarContainer!==null)
{
me.miniToolbarContainer.style.visibility="hidden";
}
};





this.addTextOption=function $vpfn_9aXHNx_TjBQFsEI2AX7Sbg830$25(oTextOption)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.textOptionList.add(oTextOption);
};





var loadExternalTextElement=function $vpfn_T5NIxMBC$7xuXRMEyK7CIA839$34(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
cachedClickText=me.clickText;
if(!me.externalTextElement)
{
me.externalTextElement=document.createElement("DIV");


if(!me.isWritableField())
{
me.externalTextElement.style.position="absolute";
me.externalTextElement.style.visibility="hidden";
}

me.externalTextElement.id=me.id+"_textFieldContainer";
me.externalTextElement.className="studioTextFieldContainer";


$(me.externalTextElement).attr("data-purpose",me.purposeName||"new-text-field");

if(oEditor.textFieldsArea)
{
oEditor.textFieldsArea.appendChild(me.externalTextElement);
}


me.externalTextLabelElement=document.createElement("SPAN");
me.externalTextLabelElement.id=me.id+"_label";
me.externalTextLabelElement.className="studioTextFieldLabel";



var sLabel=me.label;
if(vp.web.getQueryString("pn")=="1")
{
sLabel+=" ("+me.purposeName+")";
}

me.externalTextLabelElement.appendChild(document.createTextNode(sLabel));

me.externalTextElement.appendChild(me.externalTextLabelElement);

if(me.textAreaType==TEXT_AREA_TYPE_RICH)
{
if(Editor.features.rangyRichTextEnabled)
{

if(Editor.features.isEPTemplateEdit)
{
me.externalTextFieldView=new vp.studio.TextFieldWithEditablePropertiesView({model:me,el:me.externalTextElement});
me.externalTextFieldView.render();
me.externalTextField=me.externalTextFieldView.toExternalTextField();
}
else
{
me.externalTextField=new vp.studio.richtext.TextArea({
style:{
"font-family":me.fontFamily,
"font-weight":me.fontWeight,
"font-style":me.fontStyle,
"color":me.fontColor,
"font-size":me.fontSize,
"text-align":me.align
},
ensureStylesOnContentEditable:true
});
}


me.externalTextField.onselectionchange.addHandler(function $vpfn_cKgoLT_5boDbKd8_8JEJMQ908$70(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.toolbar)
{
Editor.toolbar.refresh();
}
});
}
else
{
me.externalTextField=(Editor.features.isIFrameRichTextEnabled)?new vp.widget.RichTextArea():new vp.widget.RichTextArea2();
}

me.externalTextField.minWidth=Editor.features.externalTextFieldWidth;
me.externalTextField.maxWidth=Editor.features.externalTextFieldWidth;
}

else if(me.textAreaType==TEXT_AREA_TYPE_GREEK)
{
me.externalTextLabelElement.appendChild(document.createTextNode(": "));

var affiliationSpan=document.createElement("span");
affiliationSpan.id=me.id+"_affiliation_span";
affiliationSpan.className="greekAffiliation";
var affiliationTextNode=document.createTextNode(me.data);
affiliationSpan.appendChild(affiliationTextNode);
me.externalTextLabelElement.appendChild(affiliationSpan);
me.externalTextField=new vp.studio.GreekLetterTextArea(me.id+"_greek",affiliationTextNode);
}

else
{
me.externalTextField=new vp.studio.PlainTextArea(me.textAreaType==TEXT_AREA_TYPE_SIMPLE);

me.externalTextField.setElementStyle("padding","1px");
me.externalTextField.setElementStyle("border","1px black solid");
me.externalTextField.setElementStyle("height","18px");
me.externalTextField.setElementStyle("marginBottom","3px");
me.externalTextField.setElementStyle("styleFloat","left");
me.externalTextField.setElementStyle("cssFloat","left");
me.externalTextField.setElementStyle("width",Editor.features.externalTextFieldWidth+"px");
}

if(me.textAreaType!==TEXT_AREA_TYPE_RICH)
{
me.externalTextField.attributes.id=me.id+"_text";
me.externalTextField.attributes.name=me.id+"_text";
me.externalTextField.attributes.className=$("body").hasClass("content-box")?"studioTextField studioTextFieldBoxModel":"studioTextField";
me.externalTextField.attributes.isExternalTextField=true;
}
me.externalTextField.minHeight=18;


me.updateTextField();

if(me.textAreaType===TEXT_AREA_TYPE_RICH)
{

var element=$("<div>").css({
"border":"1px black solid",
"width":me.minWidth+"px",
"overflow":"auto",
"min-height":18+"px",
"max-height":100+"px"
}).attr({
"id":me.id+"_text",
"name":me.id+"_text",
"class":$("body").hasClass("content-box")?"studioTextField studioTextFieldBoxModel":"studioTextField"
}).get(0);

me.externalTextElement.appendChild(element);
me.externalTextField.render(element);
}
else
{
me.externalTextField.render(me.externalTextElement);
}

if(me.textOptionList.length>0)
{
me.externalTextField.disable=true;


me.externalTextOptionDiv=document.createElement("DIV");
me.externalTextOptionDiv.id=me.id+"_optionDiv";
me.externalTextOptionDiv.style.position="absolute";
document.body.appendChild(me.externalTextOptionDiv);

me.externalTextDropDownElement=document.createElement("SELECT");
me.externalTextDropDownElement.id=me.id+"_dropdown";
me.externalTextDropDownElement.className="studioTextFieldDropDown";


var iSelectedIndex=-1;
var iUserInputOptionIndex=-1;
for(var i=0;i<me.textOptionList.length;i++)
{
var option=document.createElement("OPTION");
option.value=i;
option.appendChild(document.createTextNode(me.textOptionList[i].optionText));

if(me.data===me.textOptionList[i].optionText)
{
iSelectedIndex=i;
}

if(me.textOptionList[i].isUserInput)
{
iUserInputOptionIndex=i;
}

me.externalTextDropDownElement.appendChild(option);
}


if(iSelectedIndex==-1)
{
iSelectedIndex=iUserInputOptionIndex>-1?iUserInputOptionIndex:0;
}

me.externalTextElement.appendChild(me.externalTextDropDownElement);

me.externalTextDropDownElement.selectedIndex=iSelectedIndex;
externalTextDropDownChangeHandler();

vp.events.add(me.externalTextDropDownElement,"change",externalTextDropDownChangeHandler);

}

me.externalTextField.onfocus.addHandler(externalTextFocusHandler);
me.externalTextField.onblur.addHandler(externalTextBlurHandler);

me.externalTextField.onchange.addHandler(externalTextChangeHandler);
me.externalTextField.ondelaychange.addHandler(externalTextDelayChangeHandler);



if(Editor.isFlipbook)
{


var oFlipbookTextOptions=document.createElement("DIV");
oFlipbookTextOptions.id="flipbooksTextOptions";

var oCustomizeTextContainer=document.createElement("DIV");
oCustomizeTextContainer.id="divCustomizeText";
oFlipbookTextOptions.appendChild(oCustomizeTextContainer);

var oCustomizeTextTable=document.createElement("TABLE");
oCustomizeTextTable.setAttribute("cellspacing","0");
oCustomizeTextTable.setAttribute("cellpadding","0");
oCustomizeTextTable.setAttribute("border","0");
oCustomizeTextContainer.appendChild(oCustomizeTextTable);

var oCustomizeTextTBody=document.createElement("TBODY");
oCustomizeTextTable.appendChild(oCustomizeTextTBody);

var oTr=document.createElement("TR");
oCustomizeTextTBody.appendChild(oTr);
var oTd=document.createElement("TD");
oTr.appendChild(oTd);
var oChangeFontIcon=document.createElement("IMG");
oChangeFontIcon.src="/sf/_langid-1/_/vp/images/easycards/change_font_icon.gif";
oTd.appendChild(oChangeFontIcon);

oTd=document.createElement("TD");
oTr.appendChild(oTd);
var oCustomizeTextLink=document.createElement("A");
oCustomizeTextLink.id="customizeText";
oCustomizeTextLink.href="#";
oCustomizeTextLink.onclick="return false;";
oCustomizeTextLink.innerHTML=window.JSLM_FlipbookStudioEditFontText;
oTd.appendChild(oCustomizeTextLink);

me.externalTextElement.appendChild(oFlipbookTextOptions);


vp.studio.flipbooks.toolbar.installToggle(vp.ui.get("customizeText"),'mousedown',me);
}

if(Editor.features.showClearTextLinkBelowTextField)
{
var oClearTextContainer=document.createElement("DIV");
oClearTextContainer.className="clear-text-field-container";
renderClearTextFieldLink(oClearTextContainer);
me.externalTextElement.appendChild(oClearTextContainer);
}
}
};

var renderClearTextFieldLink=function $vpfn_UguhIEqOjAchc0b84krZGA1097$35(oParent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oLink=document.createElement("A");
oLink.innerHTML=JSLM_ClearText;
oLink.href="#";
oLink.onclick="return false;";

var clearText=function $vpfn_GEMxgBdmvaahh6tRXjGgEw1104$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.externalTextField.setValue("");
me.setDataAndFireEvents(me.externalTextField.getValue());
};

vp.events.add(oLink,"click",clearText);

oParent.appendChild(oLink);
};

var toggleExternalTextFieldVisibility=function $vpfn_5sjh5Dqix0Xwo71$ErxPVA1115$44(bVisible)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var display=bVisible?"block":"none";
var border=bVisible?"1px black solid":"0px";

if(me.textAreaType===TEXT_AREA_TYPE_RICH)
{
var element=me.getActiveTextArea().$contentEditableElement;
element.parent().css({"display":display,"border":border});
}else
{
me.externalTextField.setElementStyle("display",display);
me.externalTextField.setElementStyle("border",border);
}

if(bVisible)
{
me._applyStylesToTextArea(me.externalTextField);
}
};

var externalTextDropDownChangeHandler=function $vpfn_3LbsE3Jki8qp9DA0kAFNFQ1136$44(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var selectedOption=me.textOptionList[me.externalTextDropDownElement.value];
if(selectedOption.isUserInput)
{
toggleExternalTextFieldVisibility(true);
}
else
{
var newText=selectedOption.optionText;

toggleExternalTextFieldVisibility(false);
if(newText!==me.data)
{
me.externalTextField.setValue(newText);
externalTextDelayChangeHandler();
}
}
};






this._applyStylesToTextArea=function $vpfn_qx497HMImo$B83P$MWp2Uw1161$34(oTextArea)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.textAreaType!=TEXT_AREA_TYPE_RICH&&me.textAreaType!=TEXT_AREA_TYPE_FLASH)
{
return;
}
for(var style in me._STYLE_MAP)
{
if(me[style])
{
oTextArea.setStyleSimple(me._STYLE_MAP[style],me[style],true);
}
}
};








this._applyStylesFromTextArea=function $vpfn_9EJu$6KfMhJwBaJiplngEw1183$36(oTextArea)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.textAreaType!=TEXT_AREA_TYPE_RICH&&me.textAreaType!=TEXT_AREA_TYPE_FLASH)
{
return false;
}
var bRet=false;

var textAreaStyles=oTextArea.getStyles();
for(var style in me._STYLE_MAP)
{
var val=textAreaStyles[me._STYLE_MAP[style]];
if(vp.studio.util.differsIgnoreCase(me[style],val))
{
me[style]=val;
bRet=true;
stylesChanged=true;
}
}

return bRet;
};


var externalTextFocusHandler=function $vpfn_j9ZT7baOlGsH67NyjApsZw1207$35(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.currentField!=me)
{
vp.studio.instrumentation.add("Focus_Text");

Editor.currentFieldIsExternal=true;
Editor.currentField=me;
Editor.lastField=me;

me.deleteClickText();

me.onfocusexternaltext.fire(e);
}
};


var externalTextBlurHandler=function $vpfn_UgxXD9C$ImRykOTp2BcNNA1224$34(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.currentField==me)
{
Editor.currentField=null;
Editor.currentFieldIsExternal=false;
}
me.onblurexternaltext.fire(e);
};

var externalTextChangeHandler=function $vpfn_1wCdMtqgH5uzg_RcI$FErA1234$36(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.setDocumentChanged(true);
};

var recordInitialState=function $vpfn_ZXaM76qjv27aF24jbCpTKQ1240$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.initialData=me.data;
me.initialStyle=getStyleObject(me);
};

var externalTextDelayChangeHandler=function $vpfn_ENARfD_R4SCbrb45iJqPTQ1246$41(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.eventsDisabled)
{
return;
}

var value=me.externalTextField.getValue();




if(value||(me.clickText===""))
{
me.clickText="";
me.setDataAndFireEvents(value);
}
else
{
recordInitialState();
me._applyStylesFromTextArea(me.externalTextField);
if(stylesChanged)
{
me.onchange.fire({property:"styles"});
}
me.refresh();
}
};






this.getProcessedData=function $vpfn_hXPh6USqc3FcIxmEEkbx8g1280$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(!me.persist&&me.data==me.clickText)?"":me.data;
};






this.setDataAndFireEvents=function $vpfn_aqbruOra0HBcP_sZMkCwZg1290$32(sHtml)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var e={property:"data"};
me.setData(sHtml,e);

if(e.changed)
{
me.onchange.fire(e);
me.refresh();
}
stylesChanged=false;
};







this.setData=function $vpfn_hcfL73RfhR8pI5y5QVrP6w1309$19(sHtml,oEventInfo)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
recordInitialState();


me._applyStylesFromTextArea(me.getActiveTextArea());
if(sHtml==me.data&&!stylesChanged)
{
return;
}


if(sHtml===cachedClickText)
{
me.clickText=cachedClickText;
}

fireBeforeTextChange();

var sParsedHtml=vp.studio.util.stripUnsupportedCharacters(sHtml);

if(sParsedHtml!=sHtml)
{
window.setTimeout(warnUnsupportedCharacters,100);
}

var sOriginalHtml=me.data;


me.data=sParsedHtml;


var regEx=/begin_of_the_skype_highlighting.*end_of_the_skype_highlighting/gi;
me.data=me.data.replace(regEx,"");

me.updateTextField();

if(me.externalTextField&&me.externalTextField.getOutputXMLNode)
{
me.data=vp.web.getInnerXML(me.externalTextField.getOutputXMLNode());
}

me.onaftertextchange.fire();


vp.cookies.setSubValue("AutoFillIC",me.purposeName,me.data,null,true);

if(oEventInfo)
{
oEventInfo.changed=(sOriginalHtml!=sParsedHtml||stylesChanged)?true:oEventInfo.changed;
oEventInfo.oldHTML=sOriginalHtml;
oEventInfo.newHTML=sOriginalHtml;
}
};






var recordTextChangeCommand=function $vpfn_jmwYWOo5LFpL7JvZn8YO2w1369$34(oEventInfo)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.eventsDisabled||!oEventInfo.property)
{





return;
}


if(me.initialData===null||typeof(me.initialData)=="undefined")
{
me.initialData="";
}
if(me.initialStyle===null||typeof(me.initialStyle)=="undefined")
{
me.initialStyle=getStyleObject(me);
}

var oCommand=new vp.studio.commands.ChangeText(
me,
oEventInfo.property,
me.initialData,
me.initialStyle,
me.data,
getStyleObject(me));

Editor.history.add(oCommand);

me.initialData=me.data||"";
me.initialStyle=getStyleObject(me);
};

this.onchange.addHandler(recordTextChangeCommand);




var fireBeforeTextChange=function $vpfn_1LGE_PcWizn0gtZyHoQBKA1410$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.onbeforetextchange.fire();
};


var getStyleObject=function $vpfn_DPOsCPBCFcDvi4PWl2D1RQ1416$25(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oStyle={};

for(var sProp in vp.studio.util.TEXT_PROPERTY_MAP)
{
oStyle[sProp]=oObj[sProp];
}

return oStyle;
};






this.getStyles=function $vpfn_ZTMrCIChWraX$gX96AwzGA1433$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var newStyles=getStyleObject(me);


vp.core.applyProperties(me.coordinates.getRect(),newStyles);

return newStyles;
};




var warnUnsupportedCharacters=function $vpfn_OzPbQ4g92JHptblComu6Ug1447$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
alert(JSLM_StudioUnsupportedCharactersWarning);
};




this.updateTextField=function $vpfn_oovwg3BvrrhewbzKRVapdQ1455$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sNewText=me.getProcessedData();

if(me.externalTextField&&(
(me.externalTextField.getValue()!=sNewText)))
{
me.externalTextField.setValue(sNewText,true);
}
};





this.getUpdateXML=function $vpfn_On0xNVxpVp_j4XIEk3cUHw1470$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode(me.updateXMLNodeName);
oNode.attributes["xml:space"]="preserve";
oNode.setInnerXML(me.getProcessedData());


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,true);

return oNode.toString();
};

this.getManipulatorElement=function $vpfn_BKKZyeHtS2Q_jx9rPKip6w1483$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.handleElement;
};






this.upgrade=function $vpfn_RcpqF7c8AOrIeh5g0HqLOw1493$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.isRestrictedField())
{
oDecorator.decorateTextField(me);
}
};






this.setOuterStyle=function $vpfn_TjdyiLa2_ge80g1eaNhHlw1507$25(sProperty,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.externalTextField)
{
me.externalTextField.setStyleSimple(me._STYLE_MAP[sProperty],vValue,true);
}
me[sProperty]=vValue;
};









this.setStyle=function $vpfn_tmFMNVTTigQgtckwwJ3LqQ1524$20(sProperty,vValue,bSupressEvents,bAffectSelectedTextOnly)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
bSupressEvents=bSupressEvents?true:false;
bAffectSelectedTextOnly=bAffectSelectedTextOnly?true:false;

var aCoordinateProps=["top","left","height","width"];


if(aCoordinateProps.contains(sProperty))
{
me.coordinates.setCoord(sProperty,parseInt(vValue));
}
else
{
recordInitialState();
fireBeforeTextChange();
me[sProperty]=vValue;
}

this.updateSchemeReferences(sProperty);

if(sProperty!="height"&&!bSupressEvents)
{
me.refresh();
me.onchange.fire({property:sProperty});
}
};

this.getActiveTextArea=function $vpfn_vWjkHgTebX1wHF25TqlORQ1552$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.externalTextField;
};





this.updateSchemeReferences=function $vpfn_am5Kq8rgT0x7ixHMs$hCRw1561$34(sProperty)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sProperty=="fontFamily")
{
me.fontSchemeRef=Editor.fontScheme.indexOf(me.fontFamily);
}
else if(sProperty=="fontColor"&&me.fontColor)
{


if(Editor.fieldColorScheme[me.colorSchemeRef]!=me.fontColor.toString())
{
me.colorSchemeRef=Editor.fieldColorScheme.indexOf(me.fontColor.toString());
}
}
};





this.applyColorScheme=function $vpfn_FlXhcwy8F2kj3bGnpf9bhQ1582$28(aColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.colorSchemeRef>=0)
{
me.setOuterStyle("fontColor",new vp.color.Color(aColors[me.colorSchemeRef]));
me.refresh();
}
};
};

vp.studio.TextFieldBase._CORE_ATTRIBUTES=
[
"id",
"zIndex",
"brandingType",
"label",
"purposeName",
"clickText",
"fieldOrder",
"isCaricatureCaption",
"persist",
"restricted",
"textOptionType",
"textOptionId",
"fontFamily",
"fontWeight",
"fontStyle",
"fontColor",
"fontRef",
"fontSchemeRef",
"colorSchemeRef",
"metaData"
];

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.TextField=function $vpfn_qbjCAE9QeIX4eWpBOAmHRw13$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.TextFieldBase;
this.inheritFrom();

this.mixin=vp.studio.ComplexSizeDocumentItem;
this.mixin();

this.classRef=arguments.callee;

var me=this;





this.type=DOCITEM_TYPE_TEXT;

this.itemTypeString="Text";






this.getTextAreaType=function $vpfn_bCRP$_OBkYOaFeQkXbDYwQ41$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.browser.isMobileSafari&&vp.browser.ver<4)
{
return TEXT_AREA_TYPE_SIMPLE;
}
else if(!Editor.features.isIFrameRichTextEnabled&&vp.browser.isFirefox&&vp.browser.ver<3)
{


return TEXT_AREA_TYPE_PLAIN;
}
else
{
if(Editor.features.rangyRichTextEnabled)
{
return TEXT_AREA_TYPE_RICH;
}else
{
return(Editor.isRichTextEnabled())?TEXT_AREA_TYPE_RICH:TEXT_AREA_TYPE_PLAIN;
}
}
};

this.textAreaType=this.getTextAreaType();





this.updateXMLNodeName="text";





this.fontSize=1;





this.align="left";






this._coreAttributes=vp.studio.TextField._CORE_ATTRIBUTES;

var removeWhitespaceFromXML=function $vpfn_QhtUIHzuuWrNJrT8s8cM6Q92$34(sXML)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
sXML=sXML.replace(/\s/gi,"");
sXML=sXML.replace(/\<br\/\>/gi,"");
return sXML;
};







this.getImageSrc=function $vpfn_AHHzduavJJkaYCu0$W_Xbw105$23(bGetToken)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sHTML=me.data;


if(sHTML.length===0||removeWhitespaceFromXML(sHTML).length===0||!$("<div>"+sHTML+"</div>").text())
{
return null;
}


var sDiv="<DIV style=\""+getStyleString()+"\">"+sHTML+"</DIV>";


if(Editor.maxTextSizeInCharacters&&vp.web.urlEncode(sDiv).length+2>Editor.maxTextSizeInCharacters)
{
return"/vp/images/nns/common/icons/error_icon.gif";
}

var oQS=new vp.web.QueryString();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem("png","1");
if(me.align!=="center")
{
oQS.setItem("pad","0");
}else
{


oQS.setItem("pad","1");
}
if(Editor.features.rangyRichTextEnabled)
{
oQS.setItem("pad","1");
}
oQS.setItem("ieq","0");
oQS.setItem("wss","1");
oQS.setItem("langid",EditorConst.languageID);
oQS.setItem("anyrotate",me.coordinates.rotation.angleInDegrees);

if(me.isGrayScale())
{
oQS.setItem("gs","1");
}

oQS.setItem("zoom",me.coordinates.getZoom());


if(Editor.colorOverride&&Editor.colorOverrides)
{
if(Editor.colorOverrides[Editor.colorOverride])
{
oQS.setItem("coloroverride",Editor.colorOverrides[Editor.colorOverride]);
}
}

if(vp.web.getQueryString("debugrt")=="1")
{
vp.studio.trace("---------------------");

vp.studio.trace("processed:");
vp.studio.trace(vp.web.htmlEncode(sDiv));

if(me.externalTextField&&me.externalTextField.getInternalHTML)
{
vp.studio.trace("");
vp.studio.trace("external:");
vp.studio.trace(vp.web.htmlEncode(me.externalTextField.getInternalHTML()));
}

if(me.inlineTextField&&me.inlineTextField.getInternalHTML)
{
vp.studio.trace("");
vp.studio.trace("inline:");
vp.studio.trace(vp.web.htmlEncode(me.inlineTextField.getInternalHTML()));
}
vp.studio.trace("---------------------");
}


oQS.setItem("d",sDiv);


var sPath="/any/preview/text.aspx";
var sQS=oQS.toString();
var sUrl=sPath+"?"+sQS;


try
{
if(!bGetToken)
{

sUrl=vp.http.getURLSizedForGET(sUrl,"d",null,false,true);
}
}
catch(ex)
{

return"/vp/images/nns/common/icons/error_icon.gif";
}


return sUrl+"&hc="+vp.studio.util.quickHash(sQS);
};




this.setImageSrc=function $vpfn_1rg0B6tpDscpQ2kvlhR_rA215$23(onloadHandler)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.imageElement,me._imageURL,onloadHandler);
};






var getStyleString=function $vpfn_1NlXwhertWVRKD_R3P6RTA225$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var css=new vp.web.CssString();
css.setItem("font-family",me.fontFamily);
css.setItem("font-weight",me.fontWeight||"normal");
css.setItem("font-style",me.fontStyle||"normal");
css.setItem("color",me.fontColor?me.fontColor.toString():"#000000");
css.setItem("font-size",parseInt(me.fontSize));
css.setItem("text-align",me.align||"left");



css.setItem("width",me.coordinates.rotation.isSideways()?
Math.round(me.coordinates.getCoordPrecise("height")):
Math.round(me.coordinates.getCoordPrecise("width")));

return css.toString();
};






this.getImageElementRect=function $vpfn_rFEYO5nBmuY38Q3MKCoExw249$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var img=me.imageElement,
rect=me.coordinates.getRect(),
angle=me.coordinates.rotation.angleInDegrees;

var top=rect.top,
left=rect.left;

if(angle===0||angle===180)
{


if(me.align==="center")
{
left+=(rect.width-img.width)/2;
}
else if((angle===0&&me.align==="right")||(angle===180&&me.align==="left"))
{
left+=rect.width-img.width;
}
}
else if(angle===90||angle===270)
{


if(me.align==="center")
{
top+=(rect.height-img.height)/2;
}
else if((angle===90&&me.align==="right")||(angle===270&&me.align==="left"))
{
top+=rect.height-img.height;
}
}

return{
width:img.width,
height:img.height,
top:top,
left:left,
right:left+img.width,
bottom:top+img.height
};
};






var updateAlignment=function $vpfn_87i6WmPTfbdKEYv9hrRuxQ300$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



var img=me.imageElement,
handle=me.handleImage,
rect=me.coordinates.getRect(),
angle=me.coordinates.rotation.angleInDegrees;

$(me.docElement).css("direction","");

if(angle===0||angle===180)
{


img.style.position=handle.style.position="relative";
img.style.top=handle.style.top="0px";

if(angle===180&&me.align!=="center")
{
me.docElement.style.textAlign=me.handleElement.style.textAlign=(me.align==="left")?"right":"left";
if(me.align==="left")
{
$(me.docElement).css("direction","rtl");
}
}
else if(me.align==="center")
{


me.docElement.style.textAlign=me.handleElement.style.textAlign=(angle===180)?"right":"left";
if(angle===180)
{
$(me.docElement).css("direction","rtl");
}
}
else
{
me.docElement.style.textAlign=me.handleElement.style.textAlign=me.align;
if(me.align==="right")
{
$(me.docElement).css("direction","rtl");
}
}
}
else if(angle===90||angle===270)
{


img.style.position=handle.style.position="absolute";
img.style.left=handle.style.left="0px";


if((angle===90&&me.align==="right")||(angle===270&&(me.align==="left"||me.align==="center")))
{
img.style.top=handle.style.top=(rect.height-img.height)+"px";
}
else if((angle===270&&me.align==="right")||(angle===90&&(me.align==="left"||me.align==="center")))
{
img.style.top=handle.style.top="0px";
}
}

updateOverhangs(angle,img);
};

var updateOverhangs=function $vpfn_PkZn9rPzpqvIb$AQeXeWOQ367$26(angle,img)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var adjustedSide=function $vpfn_R3iCING2PlV6eRndJVy1Yw371$27(_side)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var a=(_side+angle/90)%4;

switch(a)
{
case 0:
return"top";
case 1:
return"right";
case 2:
return"bottom";
case 3:
default:
return"left";
}
};

var side={top:adjustedSide(0),right:adjustedSide(1),bottom:adjustedSide(2),left:adjustedSide(3)};


var alignAdjustment=me.align==="right"?"right":"left";

var directionAdjustment=(alignAdjustment==="left"&&(angle===0||angle===90))||(alignAdjustment==="right"&&(angle===180||angle===270))?-1:1;

var verticalPositionAdjustment=(angle===90&&alignAdjustment==="right")||(angle===270&&alignAdjustment==="left")?me.coordinates.getRect().height-$(me.imageElement).height():0;

var adjustableSide=angle===0||angle===180?"left":"top";

var adjustmentAmount=me.overhangCSSRect[side[alignAdjustment]]*directionAdjustment+verticalPositionAdjustment;

me.imageElement.style[adjustableSide]=adjustmentAmount+"px";
};



this.onmove.addHandler(updateAlignment);
this.onload.addHandler(updateAlignment);
this.onloadstart.addHandler(updateAlignment);
};

vp.studio.TextField._CORE_ATTRIBUTES=vp.studio.TextFieldBase._CORE_ATTRIBUTES.concat([
"fontSize",
"align",
"isFoil"
]);
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




var WORDART_FOCUS_TOP_LEFT=0;
var WORDART_FOCUS_CENTER=1;
var WORDART_FOCUS_BOTTOM_RIGHT=2;







vp.studio.WordArt=function $vpfn_LJtimVA_hL9Ieg18_fgO8g16$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.TextFieldBase;
this.inheritFrom();

this.classRef=arguments.callee;

var me=this;





this.type=DOCITEM_TYPE_WORDART;

this.itemTypeString="Word Art";






this.textAreaType=TEXT_AREA_TYPE_SIMPLE;





this.updateXMLNodeName="wordart";





this.textFocus=WORDART_FOCUS_TOP_LEFT;





this.strokeColor=null;





this.strokeColorRef=-1;





this.strokeWeight=0;





this.shadowColor=null;





this.shadowColorRef=-1;





this.shadowOffsetX=0;





this.shadowOffsetY=0;





this.arcHeight=0;





this.arcRadius=0;





this.arcAngle=0;




this.isStraight=function $vpfn_yTEz77PSqbOYlDfwCzkKCg118$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!((me.arcHeight!==0)&&(me.arcRadius!==0)&&(me.arcAngle!==0));
};






this._coreAttributes=vp.studio.WordArt._CORE_ATTRIBUTES;




this.imageStandardElement=document.createElement("IMG");
this.imageStandardElement.id=me.id+"_textImageWithoutGuides";
this.imageStandardElement.style.visibility="hidden";




this.imageWithGuidesElement=null;





var baseRenderDocElement=this.renderDocElement;
this.renderDocElement=function $vpfn_CCoocXIo2mgELezRvmfjLQ147$28(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.docElementRendered)
{
baseRenderDocElement(oEditor);
me.docElement.removeChild(me.imageElement);
me.imageElement=me.imageStandardElement;
me.docElement.appendChild(me.imageElement);
}
};




this.initImageWithGuides=function $vpfn_zBkRnoqwVeP9cqXcqzCJ8Q161$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.imageWithGuidesElement)
{
me.imageWithGuidesElement=document.createElement("IMG");
me.imageWithGuidesElement.id=me.id+"_textImageWithGuides";
me.imageWithGuidesElement.style.display="none";
if(me._imageURL)
{
vp.ui.setSrcPNG(me.imageWithGuidesElement,me._imageURL+(me.isStraight()?"":"&show_guides=1"));
}
me.docElement.appendChild(me.imageWithGuidesElement);
}
};






this.showGuides=function $vpfn_UOynwbLdMGW9RebTMKUHKA181$22(bShowGuides)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.imageWithGuidesElement&&!me.isStraight())
{
me.imageElement.style.visibility="hidden";

me.imageElement=bShowGuides?me.imageWithGuidesElement:me.imageStandardElement;
me.imageStandardElement.style.display=bShowGuides?"none":"";
me.imageWithGuidesElement.style.display=bShowGuides?"":"none";

me.imageElement.style.visibility=me.getImageSrc()?"visible":"hidden";
}
};




this.setImageSrc=function $vpfn_jv6wf4MVvnwFz5g94dwAeg198$23(onloadHandler)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.imageStandardElement,me._imageURL,onloadHandler);


if(me.imageWithGuidesElement&&!me.isStraight())
{
vp.ui.setSrcPNG(me.imageWithGuidesElement,me._imageURL+"&show_guides=1",onloadHandler);
}
};







this.getImageSrc=function $vpfn_Gj1cNHz8S0jfPhIpGmfjtg215$23(bGetToken)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sHTML=me.data;

if(sHTML.trim().length===0)
{
return null;
}
else
{
var oQS=new vp.web.QueryString();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);

oQS.setItem("text",vp.web.xmlDecode(me.data));
oQS.setItem("width",Math.round(me.coordinates.getCoordPrecise("width")));
oQS.setItem("height",Math.round(me.coordinates.getCoordPrecise("height")));
oQS.setItem("zoom",me.coordinates.getZoom());

oQS.setItem("font_family",me.fontFamily);
oQS.setItem("font_weight",me.fontWeight);
oQS.setItem("font_style",me.fontStyle);
oQS.setItem("fill_color",me.fontColor?me.fontColor.toString():"#000000");
oQS.setItem("focus",me.textFocus);
oQS.setItem("format","png");
oQS.setItem("langid",EditorConst.languageID);

if(me.isGrayScale())
{
oQS.setItem("gs","1");
}

if(me.strokeColor&&me.strokeWeight>0)
{
oQS.setItem("stroke_color",me.strokeColor.toString());
oQS.setItem("stroke_weight",me.strokeWeight);
}

if(me.shadowColor)
{
oQS.setItem("shadow_color",me.shadowColor.toString());
oQS.setItem("shadow_offset_x",me.shadowOffsetX);
oQS.setItem("shadow_offset_y",me.shadowOffsetY);
}

if(me.arcHeight>0&&me.arcRadius>0&&me.arcAngle!==0)
{
oQS.setItem("arc_height",me.arcHeight);
oQS.setItem("arc_radius",me.arcRadius);
oQS.setItem("arc_angle",me.arcAngle);
}

if(me.coordinates.rotation.angleInDegrees!==0)
{
oQS.setItem("angle",me.coordinates.rotation.angleInDegrees);
if(!bGetToken)
{
oQS.setItem("init_width",me.coordinates.rotation.initialWidth);
oQS.setItem("init_height",me.coordinates.rotation.initialHeight);
}
}

if(Editor.colorOverride&&Editor.colorOverrides)
{
if(Editor.colorOverrides[Editor.colorOverride])
{
oQS.setItem("coloroverride",Editor.colorOverrides[Editor.colorOverride]);
}
}


var sPath="/any/preview/wordart.aspx";
var sQS=oQS.toString();
return sPath+"?"+sQS+"&hc="+vp.studio.util.quickHash(sQS);
}
};


};

vp.studio.WordArt._CORE_ATTRIBUTES=vp.studio.TextFieldBase._CORE_ATTRIBUTES.concat([
"strokeColor",
"strokeWeight",
"strokeColorRef",
"shadowColor",
"shadowColorRef",
"shadowOffsetX",
"shadowOffsetY",
"textFocus",
"arcHeight",
"arcRadius",
"arcAngle"
]);





vp.studio.WordArt.initialStyles={};

vp.studio.WordArt.initialStyles.SHARP_CONVEX={};
vp.studio.WordArt.initialStyles.SHARP_CONVEX.arcHeight=0.2681159;
vp.studio.WordArt.initialStyles.SHARP_CONVEX.arcRadius=1.34058;
vp.studio.WordArt.initialStyles.SHARP_CONVEX.arcAngle=125;
vp.studio.WordArt.initialStyles.SHARP_CONVEX.width=532;
vp.studio.WordArt.initialStyles.SHARP_CONVEX.height=186;
vp.studio.WordArt.initialStyles.SHARP_CONVEX.constrainProportions=true;

vp.studio.WordArt.initialStyles.CONVEX={};
vp.studio.WordArt.initialStyles.CONVEX.arcHeight=0.4660706299065421;
vp.studio.WordArt.initialStyles.CONVEX.arcRadius=4.260037071028037;
vp.studio.WordArt.initialStyles.CONVEX.arcAngle=58;
vp.studio.WordArt.initialStyles.CONVEX.width=489;
vp.studio.WordArt.initialStyles.CONVEX.height=107;
vp.studio.WordArt.initialStyles.CONVEX.constrainProportions=true;

vp.studio.WordArt.initialStyles.STRAIGHT={};
vp.studio.WordArt.initialStyles.STRAIGHT.arcAngle=0;
vp.studio.WordArt.initialStyles.STRAIGHT.arcHeight=0;
vp.studio.WordArt.initialStyles.STRAIGHT.arcRadius=0;
vp.studio.WordArt.initialStyles.STRAIGHT.width=500;
vp.studio.WordArt.initialStyles.STRAIGHT.height=80;
vp.studio.WordArt.initialStyles.STRAIGHT.constrainProportions=false;

vp.studio.WordArt.initialStyles.CONCAVE={};
vp.studio.WordArt.initialStyles.CONCAVE.arcHeight=0.4660706299065421;
vp.studio.WordArt.initialStyles.CONCAVE.arcRadius=4.260037071028037;
vp.studio.WordArt.initialStyles.CONCAVE.arcAngle=-58;
vp.studio.WordArt.initialStyles.CONCAVE.width=489;
vp.studio.WordArt.initialStyles.CONCAVE.height=107;
vp.studio.WordArt.initialStyles.CONCAVE.constrainProportions=true;

vp.studio.WordArt.initialStyles.SHARP_CONCAVE={};
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.arcHeight=0.2681159;
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.arcRadius=1.34058;
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.arcAngle=-125;
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.width=532;
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.height=186;
vp.studio.WordArt.initialStyles.SHARP_CONCAVE.constrainProportions=true;









vp.studio.WordArt.getChangeWordArtCommand=function $vpfn_dz1oGjRJyZsBhBZ5zR5d6g363$44(oStyle,oItemToBeChanged,oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oPropertyValueMap={};

if(oStyle===vp.studio.WordArt.initialStyles.SHARP_CONVEX)
{
oPropertyValueMap.arcHeight=oStyle.arcHeight;
oPropertyValueMap.arcRadius=oStyle.arcRadius;
oPropertyValueMap.arcAngle=oStyle.arcAngle;
oPropertyValueMap.height=(oItemToBeChanged.coordinates.getRect().width/oStyle.width)*oStyle.height;
oItemToBeChanged.manipulator.setConstrainProportions(oStyle.constrainProportions);
}
else if(oStyle===vp.studio.WordArt.initialStyles.CONVEX)
{
oPropertyValueMap.arcHeight=oStyle.arcHeight;
oPropertyValueMap.arcRadius=oStyle.arcRadius;
oPropertyValueMap.arcAngle=oStyle.arcAngle;
oPropertyValueMap.height=(oItemToBeChanged.coordinates.getRect().width/oStyle.width)*oStyle.height;
oItemToBeChanged.manipulator.setConstrainProportions(oStyle.constrainProportions);
}
else if(oStyle===vp.studio.WordArt.initialStyles.CONCAVE)
{
oPropertyValueMap.arcHeight=oStyle.arcHeight;
oPropertyValueMap.arcRadius=oStyle.arcRadius;
oPropertyValueMap.arcAngle=oStyle.arcAngle;
oPropertyValueMap.height=(oItemToBeChanged.coordinates.getRect().width/oStyle.width)*oStyle.height;
oItemToBeChanged.manipulator.setConstrainProportions(oStyle.constrainProportions);
}
else if(oStyle===vp.studio.WordArt.initialStyles.SHARP_CONCAVE)
{
oPropertyValueMap.arcHeight=oStyle.arcHeight;
oPropertyValueMap.arcRadius=oStyle.arcRadius;
oPropertyValueMap.arcAngle=oStyle.arcAngle;
oPropertyValueMap.height=(oItemToBeChanged.coordinates.getRect().width/oStyle.width)*oStyle.height;
oItemToBeChanged.manipulator.setConstrainProportions(oStyle.constrainProportions);
}
else
{

oStyle=vp.studio.WordArt.initialStyles.STRAIGHT;



if(!oItemToBeChanged.isStraight())
{
oPropertyValueMap.arcHeight=oStyle.arcHeight;
oPropertyValueMap.arcRadius=oStyle.arcRadius;
oPropertyValueMap.arcAngle=oStyle.arcAngle;
oPropertyValueMap.height=oItemToBeChanged.coordinates.getRect().height*oItemToBeChanged.arcHeight;
oItemToBeChanged.manipulator.setConstrainProportions(oStyle.constrainProportions);
}
}

return new vp.studio.commands.SetStyles(oSelection,oPropertyValueMap);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.LibraryImage=function $vpfn_aDXgWc6GCHFLe1GaP5cHLQ12$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.Image;
this.inheritFrom();





this.type=DOCITEM_TYPE_LIBRARY_IMAGE;





this.imageID=0;





this.getItemID=function $vpfn_hdv2p7aT9eYZzuo_W4gBIA38$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.imageID;
};





this.setItemID=function $vpfn_c3KtIv6bnAbZTCurJGA4zQ47$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.imageID=iItemID;
};






this.itemTypeString="Image";





this.cropInfo=new vp.studio.CropInfo();


this.cropInfo.onchange.addHandler(this.onchange.fire);













this.variantType=1;

this.setVariantType=function $vpfn_foDzJROo$$SikH4MRiDUpw82$26(newVariantType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.variantType!=newVariantType)
{
me.variantType=newVariantType;
me.refresh();
}
};




var _inheritFrom_getURL=this.getURL;
this.getURL=function $vpfn_MKvD$Z1V58xokYYSH8XURA95$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var baseURL=_inheritFrom_getURL();
return baseURL+"&variant_type="+me.variantType;
};




this.getUpdateXML=function $vpfn_9vp8qjEkrwKjQcrUh$UExQ104$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=me._getUpdateXMLNode();

if(me.variantType!=1)
{
oNode.attributes["variant_type"]=me.variantType;
}

return oNode.toString();
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.UploadedImage=function $vpfn_ZLn3NsbKPZmiOf$YwIUqtw12$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Image;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_UPLOADED_IMAGE;





this.uploadID=0;





this.getItemID=function $vpfn_ukpFsD8lk4vNePbneBXtcQ38$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.uploadID;
};





this.setItemID=function $vpfn_Da$U_MQZs9mqxuh2Zd91rQ47$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.uploadID=iItemID;
this.onchange.fire();
};





this.cropInfo=new vp.studio.CropInfo();


this.cropInfo.onchange.addHandler(this.onchange.fire);






this.itemTypeString="Upload";







this.droppableArea;







this.draggableImage;


this.isDraggable=true;
this.isDroppable=true;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.Logo=function $vpfn_Y5iRn1B88k01C16wpUXOyg12$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Image;
this.inheritFrom();





this.type=DOCITEM_TYPE_LOGO;





this.logoID=0;






this.isAutomaticLayout=false;


this._coreAttributes=vp.studio.Logo._CORE_ATTRIBUTES;





this.getItemID=function $vpfn_6VKIDllDrZrv_D1IkjrWmw46$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.logoID;
};

this.inheritFrom_getURL=this.getURL;




this.getURL=function $vpfn_74crB8Gsgl7FQw9rNKx7QA56$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.inheritFrom_getURL.apply(this,arguments)+
"&logo_style="+this.logoStyle+
"&image_container_focus="+this.imageContainerFocus;
};





this.setItemID=function $vpfn_lrLd98ZCdMyaYrI4$nYdXA67$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.logoID=iItemID;
};






this.itemTypeString="Logo";

};

vp.studio.Logo._CORE_ATTRIBUTES=vp.studio.Image._CORE_ATTRIBUTES.concat([
"isAutomaticLayout",
"logoStyle",
"imageContainerFocus"
]);
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.PaperEffect=function $vpfn_gOT1E99FJ6WJjRgQWPHHKg12$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Image;
this.inheritFrom();





this.type=DOCITEM_TYPE_PAPEREFFECT;





this.paperEffectID=0;





this.getItemID=function $vpfn_9ojX7v4yLDRt2ldj1$R$sQ36$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.paperEffectID;
};





this.setItemID=function $vpfn_5mjOxQ4hv9NMt4uMLNlubQ45$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.paperEffectID=iItemID;
};





this.getIDPrefix=function $vpfn_UUDOjNVbWqIBIe_GcTwLMw54$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_papereffect_";
};





this.cropInfo=new vp.studio.CropInfo();


this.cropInfo.onchange.addHandler(this.onchange.fire);






this.itemTypeString="PaperEffect";

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.PlaceHolder=function $vpfn_NwmeP5oIkePtRtObiS88jQ12$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Image;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_PLACEHOLDER;







this.placeholderType=0;





this.imageID=0;





this.getItemID=function $vpfn_GoAmhruQWfgLor1l7JwGHQ46$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.imageID;
};





this.setItemID=function $vpfn_JoqUSkZupacz3McUk_GkUA55$21(iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.imageID=iItemID;
};





this.cropInfo=new vp.studio.CropInfo();


this.cropInfo.onchange.addHandler(this.onchange.fire);






this.itemTypeString="PlaceHolder";




this.isDroppable=true;
this.isEditableInLiteStudio=true;

this.makeDroppable=function $vpfn_9aiejIdVR3ghDkI$rEgK$g82$25(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isDroppable&&oEditor.features.enableDroppableImageItems&&me.handleElement)
{
var dropHandler=function $vpfn_C2eFxOpyu0P_DYqEEDujQw86$30(e,ui)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.smartCropIntoContainer(me,ui.draggable.data("image"));

var originatingDocItem=ui.draggable.data("originatingDocItem");
if(originatingDocItem)
{
vp.studio.instrumentation.add("drag-item-to-placeholder");


if(originatingDocItem.imageAreaID)
{
var oSelection=(new vp.studio.Selection()).getState();
oSelection.add(originatingDocItem,true);
var cmd=new vp.studio.commands.Delete(oSelection);
cmd.execute();
Editor.history.add(cmd);
}
else
{
originatingDocItem.replaceImageWithPlaceholder();
}

}

me.onchange.fire();
};


me.droppableArea=new vp.studio.Droppable(me.handleElement,{drop:dropHandler,scope:"studio"});
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.Map=function $vpfn_AxF4Lfd7lbk1lqiTOkA4Mw14$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




this.inheritFrom=vp.studio.Image;
this.inheritFrom();

var me=this;






this.type=DOCITEM_TYPE_MAP;






this.itemTypeString="Map";





this.getIDPrefix=function $vpfn_VD7SOZeAK5jeggJm3lH$FQ43$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_map_";
};





this.mapData=null;





this.mapAddress=null;





this.getItemID=function $vpfn_V_PFfPqck1EMFpuJEl4Mzg64$21(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return 0;};





this.setItemID=function(iItemID){};

var base_refresh=me.refresh;



this.refresh=function $vpfn_HSWLvY$Qiv2DmWufbJL76g76$19(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.onloadstart.fire();

var oRect=me.coordinates.getRectPrecise();
var oZoom=me.coordinates.getZoom();


if(me.mapData.width!=oRect.width)
{
me.mapData.resize(oRect.width/me.mapData.width);


me.mapData.id=0;
}


me.mapData.zoom=oZoom;


vp.maps.source.updateMapPreview(
me.imageElement,
me.mapData,
me.isGrayScale(),
me._onLoadHandler);


};

var _fnBaseUpgrade=me.upgrade;





this.upgrade=function $vpfn_kw9RlOVks$C2ozSdGpdoTQ112$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateMap(me);
};




this.getUpdateXML=function $vpfn_eyl0JkRHuRxGvHp9j3COCA120$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("map");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,false);




oNode.attributes["d_id"]=me.mapData.id;
oNode.attributes["d_width"]=me.mapData.width;
oNode.attributes["d_height"]=me.mapData.height;
oNode.attributes["d_scale"]=me.mapData.scale;
oNode.attributes["d_clat"]=me.mapData.center.latitude;
oNode.attributes["d_clon"]=me.mapData.center.longitude;
oNode.attributes["d_plat"]=me.mapData.poi.latitude;
oNode.attributes["d_plon"]=me.mapData.poi.longitude;


oNode.attributes["a_id"]=me.mapAddress.id;
oNode.attributes["a_street"]=me.mapAddress.street;
oNode.attributes["a_city"]=me.mapAddress.city;
oNode.attributes["a_state"]=me.mapAddress.state;
oNode.attributes["a_postal"]=me.mapAddress.zip;
oNode.attributes["a_country"]=me.mapAddress.country;

return oNode.toString();
};
};


















if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.ComplexQrCode=function $vpfn_TCv_GGp7_3Ld0zjLjkTQAA14$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




this.inheritFrom=vp.studio.Image;
this.inheritFrom();
this.mixin=vp.studio.ComplexSizeDocumentItem;
this.mixin();
var me=this;
this.qrCode=new vp.studio.ComplexQrCode.QrCode();
this.caption=new vp.studio.ComplexQrCode.Caption();






this.type=DOCITEM_TYPE_COMPLEX_QR_CODE;






this.itemTypeString="Complex QR Code";





this.getIDPrefix=function $vpfn_fHrQeLp9mqaDQsb96VswPQ46$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_complex_qr_code_";
};





this.getItemID=function $vpfn_4VYPKpj5te7Sf2EnfnQ6$g55$21(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return 0;};





this.setItemID=function(iItemID){};

var inheritFrom_onLoadHandler=me._onLoadHandler;
this._onLoadHandler=function $vpfn_kmCTmWPDhfFJrin1q5g7Bg64$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
inheritFrom_onLoadHandler();
me.resetCoordinatesToImageSize();
};




this.refresh=function $vpfn_$Pjwnhwgb1FRaoxo4v$U1A73$19(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRect=me.coordinates.getRectPrecise();
var oZoom=me.coordinates.getZoom();
var randomNumber=(new Date()).getTime();
var minimumWidth=Editor.features.complexQrCodeMinimalWidth;

if(oRect.width<minimumWidth)
{
oRect.width=minimumWidth;
me.coordinates.setRectPrecise(oRect);
me.qrCode.width=minimumWidth;
me.caption.width=minimumWidth;
me.resetCoordinatesToImageSize();
}
else
{
me.qrCode.width=oRect.width;
me.caption.width=oRect.width;
}

me.caption.fontSize=vp.complexQrCodes.dynamicFontSize(me.caption.width);


me.zoom=oZoom;

var qrCodeUrl=vp.complexQrCodes.URL_RENDER
+"?data="+vp.complexQrCodes.cleanUrl(me.qrCode.compressedUrl)
+"&width="+Math.round(me.qrCode.width*oZoom)
+"&showerr=1"
+"&render_tech=hybridgdipwpf"
+"&caption="+encodeURIComponent("<div style=\""+vp.complexQrCodes.getStyleString(me.caption,false)+"\">"+me.caption.value+"</div>")
+"&zoom="+me.zoom
+"&break="+randomNumber;

vp.ui.setSrcPNG(me.imageElement,qrCodeUrl,me._onLoadHandler);
};






this.upgrade=function $vpfn_RwXDh78qBABmoTrWb6b1UA116$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateQrCode(me);
};




this.getUpdateXML=function $vpfn_$GpWlaTBafkQAFuMoI$_ew124$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("complexQrCode");

var oNodeQrCode=new vp.xml.XMLNode("qrCode");
var oNodeCaption=new vp.xml.XMLNode("caption");

me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,false);

oNodeQrCode.attributes["q_url"]=me.qrCode.url;
oNodeQrCode.attributes["q_compressedUrl"]=me.qrCode.compressedUrl;

oNodeCaption.attributes["c_fontSize"]=me.caption.fontSize;
oNodeCaption.attributes["c_fontStyle"]=me.caption.fontStyle;
oNodeCaption.attributes["c_fontWeight"]=me.caption.fontWeight;
oNodeCaption.attributes["c_fontFamily"]=me.caption.fontFamily;
oNodeCaption.attributes["c_fontColor"]=me.caption.fontColor.toHex();
oNodeCaption.attributes["c_textAlign"]=me.caption.textAlign;
oNodeCaption.attributes["c_value"]=me.caption.value;

oNode.children.push(oNodeQrCode);
oNode.children.push(oNodeCaption);

return oNode.toString();
};

this.equals=function $vpfn_DUkAfCn6aeOwgXBlLanLjg151$18(oComplexQrCode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.qrCode.equals(oComplexQrCode.qrCode))
{
return false;
}

if(!me.caption.equals(oComplexQrCode.caption))
{
return false;
}

return true;
};

this.clone=function $vpfn_AbtrpANbEwzMtv8Ql$lLMg166$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var complexQrCode=new vp.studio.ComplexQrCode();
complexQrCode.qrCode=this.qrCode.clone();
complexQrCode.caption=this.caption.clone();

return complexQrCode;
};
};


vp.studio.ComplexQrCode._CORE_ATTRIBUTES=[
"id",
"zIndex",
"locked",
"brandingType"
];

vp.studio.ComplexQrCode.QrCode=function $vpfn_MMFXIF91TDEfl5hxa$Fq5w184$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.url='';
this.compressedUrl='';
this.width='';

this.equals=function $vpfn_DUkAfCn6aeOwgXBlLanLjg191$18(oQrCode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.url!==oQrCode.url){return false;}
if(me.compressedUrl!==oQrCode.compressedUrl){return false;}
if(me.width!==oQrCode.width){return false;}

return true;
};

this.clone=function $vpfn_AbtrpANbEwzMtv8Ql$lLMg200$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var qrCode=new vp.studio.ComplexQrCode.QrCode();

qrCode.url=me.url;
qrCode.compressedUrl=me.compressedUrl;
qrCode.width=me.width;

return qrCode;
};
};

vp.studio.ComplexQrCode.Caption=function $vpfn_oYJNT87KfdOeYbR1hFWBxw212$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.fontSize='';
this.fontStyle='';
this.fontWeight='';
this.fontFamily='';
this.fontColor=new vp.color.Color(0,0,0);
this.textAlign='';
this.width='';
this.value='';

this.equals=function $vpfn_DUkAfCn6aeOwgXBlLanLjg224$18(oCaption)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.fontSize!==oCaption.fontSize){return false;}
if(me.fontStyle!==oCaption.fontStyle){return false;}
if(me.fontWeight!==oCaption.fontWeight){return false;}
if(me.fontFamily!==oCaption.fontFamily){return false;}
if(me.fontColor!==oCaption.fontColor){return false;}
if(me.textAlign!==oCaption.textAlign){return false;}
if(me.width!==oCaption.width){return false;}
if(me.value!==oCaption.value){return false;}

return true;
};

this.clone=function $vpfn_AbtrpANbEwzMtv8Ql$lLMg238$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var caption=new vp.studio.ComplexQrCode.Caption();

caption.fontSize=me.fontSize;
caption.fontStyle=me.fontStyle;
caption.fontWeight=me.fontWeight;
caption.fontFamily=me.fontFamily;
caption.fontColor=me.fontColor;
caption.textAlign=me.textAlign;
caption.width=me.width;
caption.value=me.value;

return caption;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.AddComplexQrCode=function $vpfn_tkBYSrKalCkUuR_L5G4PzA15$38(oComplexQrCodeContainer,oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Complex QR Code";





var _oOldItem=oItem;

var _complexQrCodeContainer=oComplexQrCodeContainer;





var _oNewItem=null;





var _oSelectionCmd=null;





var getRect=function $vpfn_kviHH4GbPjsVwWr_dNY9wQ49$18(oRect,oSize,bFit)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fWidthRatio=oRect.width/oSize.width;
var fHeightRatio=oRect.height/oSize.height;
var fRatio=bFit?Math.min(fWidthRatio,fHeightRatio):Math.max(fWidthRatio,fHeightRatio);

var oNewRect={};
oNewRect.width=oSize.width*fRatio;
oNewRect.height=oSize.height*fRatio;
oNewRect.top=oRect.top+((oRect.height-oNewRect.height)/2);
oNewRect.left=oRect.left+((oRect.width-oNewRect.width)/2);
oNewRect.right=oNewRect.left+oNewRect.width;
oNewRect.bottom=oNewRect.top+oNewRect.height;

return oNewRect;
};

var fillComplexQrCode=function $vpfn_XVJvzX6eNdC9HzwJ5SGaXg66$28(complexQrCode,complexQrCodeContainer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
complexQrCode.qrCode=fillQrCode(complexQrCodeContainer);
complexQrCode.caption=fillCaption(complexQrCodeContainer);
};

var fillQrCode=function $vpfn_m$eGgwJVmTLJNcrH$1rubQ72$21(complexQrCodeContainer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var qrCode=new vp.studio.ComplexQrCode.QrCode();
if(complexQrCodeContainer)
{
qrCode.url=complexQrCodeContainer.url;
qrCode.compressedUrl=complexQrCodeContainer.compressedUrl;
qrCode.width=vp.complexQrCodes.DEFAULT_WIDTH;

}

return qrCode;
};

var fillCaption=function $vpfn_49n5NnLO$cH6meW$QO1fHQ86$22(complexQrCodeContainer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var caption=new vp.studio.ComplexQrCode.Caption();
if(complexQrCodeContainer)
{
caption.fontSize=vp.complexQrCodes.FONT_SIZE;
caption.fontStyle=vp.complexQrCodes.FONT_STYLE;
caption.fontWeight=vp.complexQrCodes.FONT_WEIGHT;
caption.fontFamily=vp.complexQrCodes.FONT_FAMILY;
caption.fontColor=vp.complexQrCodes.FONT_COLOR;
caption.textAlign=vp.complexQrCodes.TEXT_ALIGN;
caption.value=complexQrCodeContainer.caption;
caption.width=vp.complexQrCodes.DEFAULT_WIDTH;
}

return caption;
};




this.execute=function $vpfn_U$hQqjeh7F90gLErek6d_Q107$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_oNewItem)
{
var bIsReplacingQrCode=_oOldItem&&_oOldItem.type==DOCITEM_TYPE_COMPLEX_QR_CODE;

_oNewItem=new vp.studio.ComplexQrCode();

fillComplexQrCode(_oNewItem,_complexQrCodeContainer);

if(bIsReplacingQrCode)
{



if(_oNewItem.equals(_oOldItem))
{
_oNewItem=_oOldItem;
}
}


if(bIsReplacingQrCode)
{
_oNewItem.id=_oOldItem.id;
}
else
{
Editor.assignUniqueID(_oNewItem);
}


if(_oOldItem)
{
_oNewItem.zIndex=_oOldItem.zIndex;
}
else
{
var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);
_oNewItem.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;
}


if(_oOldItem)
{
_oNewItem.locked=_oOldItem.locked;
}
else
{
_oNewItem.locked=false;
}


var oRect,oFitRect;
if(_oOldItem)
{

oFitRect=_oOldItem.coordinates.getRectPrecise();
oRect=getRect(oFitRect,{width:_oNewItem.qrCode.width,height:_oNewItem.qrCode.width},true);
_oNewItem.coordinates.setRectPrecise(oFitRect);
}
else
{

oFitRect={
left:Editor.dimensions.width/(Editor.isBrochure?3:4),
top:Editor.dimensions.height/4,
width:Editor.dimensions.width/(Editor.isBrochure?3:2),
height:Editor.dimensions.height/2
};

oRect=getRect(oFitRect,{width:_oNewItem.qrCode.width,height:_oNewItem.qrCode.width},true);
_oNewItem.coordinates.setRectPrecise(oRect);
}


_oNewItem.qrCode.width=oRect.width;


if(Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(_oNewItem);
_oSelectionCmd=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),oNewSelection);
}
}


if(_oOldItem)
{
Editor.removeItem(_oOldItem);
}
Editor.addItem(_oNewItem);
Editor.render();


if(_oSelectionCmd)
{
_oSelectionCmd.execute();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};




this.undo=function $vpfn_DGv9W2mdoV6fPmnHjpJ4DA217$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.removeItem(_oNewItem);
if(_oOldItem)
{
Editor.addItem(_oOldItem);
Editor.render();
}


if(_oSelectionCmd)
{
_oSelectionCmd.undo();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};





this.isVoid=function $vpfn_Fsy5xlzKeT09wqsuQH1hnA242$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_LfIo_cYBQ_c2yMIiceMsHA251$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);

return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;



}






if(typeof vp=="undefined")
{
var vp={};
}





if(!vp.complexQrCodes)
{
vp.complexQrCodes=function(){};
}

vp.complexQrCodes._dialog=null;
vp.complexQrCodes.URL_RENDER="/any/preview/qrcode.caspx";
vp.complexQrCodes.URL_COMPRESS="/any/preview/qrcode.caspx";
vp.complexQrCodes.URL_EDITOR="/qrcodes/editor.aspx";
vp.complexQrCodes.FONT_SIZE=10;
vp.complexQrCodes.FONT_SIZE_MAX=500;
vp.complexQrCodes.FONT_STYLE='Normal';
vp.complexQrCodes.FONT_WEIGHT='Normal';
vp.complexQrCodes.FONT_FAMILY='Arial';
vp.complexQrCodes.FONT_COLOR=new vp.color.Color(0,0,0);
vp.complexQrCodes.TEXT_ALIGN='Center';
vp.complexQrCodes.MAX_WIDTH=4000;
vp.complexQrCodes.DEFAULT_WIDTH=200;







vp.complexQrCodes.openAddDialog=function $vpfn_t1x955gBZ$6xazGx7PTXeA46$34(fnCallback,sPfid,bLocked,iProductKitId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParams={};
oParams.callback=fnCallback;
oParams.aspectratiolocked=bLocked||false;
oParams.pfid=sPfid;
oParams.productkitid=iProductKitId;

vp.complexQrCodes._openDialog(fnCallback,oParams);
};








vp.complexQrCodes.openEditDialog=function $vpfn_ykMXkjACuiJSvlFv6BDHaQ64$35(fnCallback,sPfid,oComplexQrCodeContainer,bLocked,iProductKitId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParams={};
oParams.callback=fnCallback;
oParams.complexQrCodeContainer=oComplexQrCodeContainer;
oParams.aspectratiolocked=bLocked;
oParams.pfid=sPfid;
oParams.productkitid=iProductKitId;

vp.complexQrCodes._openDialog(fnCallback,oParams);
};






vp.complexQrCodes._openDialog=function $vpfn_QnjpOVbliUZAcV39iZ6Esw81$32(fnCallback,oParams)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL(vp.complexQrCodes.URL_EDITOR);
oUrl.setItem("newcomplexqrcode",oParams.complexQrCodeContainer?"false":"true");
oUrl.setItem("pfid",oParams.pfid?oParams.pfid:"");
oUrl.setItem("product_kit_id",oParams.productkitid?oParams.productkitid:"");

if(oParams.complexQrCodeContainer)
{
oUrl.setItem("url",oParams.complexQrCodeContainer.url);
oUrl.setItem("compressedUrl",oParams.complexQrCodeContainer.compressedUrl);
oUrl.setItem("caption",oParams.complexQrCodeContainer.caption);
}


if(vp.complexQrCodes._dialog&&vp.complexQrCodes._dialog.dialogType!=DIALOG_TYPE_IFRAME)
{
vp.complexQrCodes._dialog.close();
}


if(!vp.complexQrCodes._dialog)
{
vp.complexQrCodes._dialog=new vp.dialog.IFrameDialog("ComplexQrCodeDialog",{},null);
vp.complexQrCodes._dialog.chrome=vp.dialog.chrome.Primary;

oUrl.setItem("newdialog","1");
vp.complexQrCodes._dialog.navigate(oUrl.toString());
}
else
{
vp.complexQrCodes._dialog.navigate(oUrl.toString());
vp.complexQrCodes._dialog.open();
}

vp.complexQrCodes._dialog.params=oParams;


vp.complexQrCodes._dialog.navigate(oUrl.toString());
};






vp.complexQrCodes.dynamicFontSize=function $vpfn_9gSE6_IJwvPKFwAlqmt8eA127$36(dWidth)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var defaultFontMax=vp.complexQrCodes.FONT_SIZE_MAX;
var defaultFontMin=vp.complexQrCodes.FONT_SIZE;
var defaultWidthMax=vp.complexQrCodes.MAX_WIDTH;
var defaultWidthMin=vp.complexQrCodes.DEFAULT_WIDTH;
var width=dWidth<defaultWidthMin?defaultWidthMin:dWidth;


var increment=(defaultWidthMax-defaultWidthMin)/(defaultFontMax-defaultFontMin);


var fontSize=parseInt(Math.floor((width-defaultWidthMin)/increment),10)+defaultFontMin;


return(fontSize%2===0)?fontSize:fontSize-1;
};

vp.complexQrCodes.getStyleString=function $vpfn_lbH49mTZnQW7juo_$WjAdA145$35(oCaption,bEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var css=new vp.web.CssString();
var fontSize;


if(oCaption!==null)
{
fontSize=vp.complexQrCodes.dynamicFontSize(oCaption.width);
css.setItem("font-family",oCaption.fontFamily);
css.setItem("font-weight",oCaption.fontWeight);
css.setItem("font-style",oCaption.fontStyle);
css.setItem("color",oCaption.fontColor.toHex());
css.setItem("text-align",oCaption.textAlign);
}
else
{
fontSize=vp.complexQrCodes.dynamicFontSize(vp.complexQrCodes.DEFAULT_WIDTH);
css.setItem("font-family",vp.complexQrCodes.FONT_FAMILY);
css.setItem("font-weight",vp.complexQrCodes.FONT_WEIGHT);
css.setItem("font-style",vp.complexQrCodes.FONT_STYLE);
css.setItem("color",vp.complexQrCodes.FONT_COLOR.toHex());
css.setItem("text-align",vp.complexQrCodes.TEXT_ALIGN);
}


var displayedFontSize=bEditor?(fontSize-2)/2:fontSize;
css.setItem("font-size",displayedFontSize);

return css.toString();
};

vp.complexQrCodes.validUrl=function $vpfn_5EIp5vrwQ6ulUbRi3AjeFw177$29(sUrl)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var regExp=/^(((http|https)+:)?\/\/)?([\d\w][-\d\w]{0,253}[\d\w]\.)+[\w]{2,6}(:[\d]+)?(\/([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&?([-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([-+_~.\d\w[!\/]|%[a-fA-f\d]{2,2})*)?$/;
return regExp.test(sUrl)?true:false;
};

vp.complexQrCodes.cleanUrl=function $vpfn_MZaeSUP$BV_pgvD1jPMcpA183$29(sUrl)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sUrl.length>0)
{
var regExp=/^(((http|https)+:)?\/\/).*$/;
return regExp.test(sUrl)?sUrl.trim():'http://'+sUrl.trim();
}

return'';
};


if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.CalendarGrid=function $vpfn_btGmItsl5odKCqB68Ix91w12$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CALENDAR_GRID;

this.itemTypeString="CalendarGrid";





this.month=0;





this.year=0;





this.showAllMonths=false;





this.gridStyle=-1;





this.monthNameFont="";





this.foregroundColor=null;





this.backgroundColor=null;





this.monthNameColor=null;





this.foregroundColorRef=-1;





this.backgroundColorRef=-1;





this.monthNameColorRef=-1;





this._coreAttributes=vp.studio.CalendarGrid._CORE_ATTRIBUTES;






this.getManipulatorElement=function $vpfn_yeaRfmeDBMz6BdldZYaebA107$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};





this.render=function $vpfn_x8zwGQocZKfOwp6NTEnDrg116$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{
me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.zIndex=me._getDOMElementZIndex();
me.imageElement.src=BLANK_IMAGE;

me.coordinates.boundElements.add(me.imageElement);

me.coordinates.updateBoundElements(true);



if(getYearTextField())
{

me.externalElement=document._calendarYearSelectorContainer;
me.yearSelector=document._calendarYearSelector;

if(!me.externalElement)
{
me.externalElement=document.createElement("DIV");
me.externalElement.style.marginTop="2px";
me.externalElement.style.marginBottom="4px";

me.yearSelector=document.createElement("SELECT");

var iStartYear=new Date().getFullYear();
var iEndYear=iStartYear+4;

if(me.year<iStartYear)
{
me.yearSelector.selectedIndex=me.yearSelector.options.length;
me.yearSelector.options[me.yearSelector.options.length]=new Option(me.year,me.year);
}

for(var i=iStartYear;i<iEndYear;i++)
{
me.yearSelector.options[me.yearSelector.options.length]=new Option(i,i);
if(i==me.year)
{
me.yearSelector.selectedIndex=me.yearSelector.options.length-1;
}
}

if(me.year>iEndYear)
{
me.yearSelector.options[me.yearSelector.options.length]=new Option(me.year,me.year);
me.yearSelector.selectedIndex=me.yearSelector.options.length-1;
}

me.externalElement.id="divCalendarYearSelector";
me.externalElement.innerHTML=JSLM_ICLayoutTextItemlayout_year+": ";
me.externalElement.appendChild(me.yearSelector);

document._calendarYearSelectorContainer=me.externalElement;
document._calendarYearSelector=me.yearSelector;
}



me.year=parseInt(me.yearSelector.options[me.yearSelector.selectedIndex].value);
getYearTextField().data=me.year.toString();

if(oEditor.textFieldsArea)
{
oEditor.textFieldsArea.appendChild(me.externalElement);
}
vp.events.add(me.yearSelector,"change",changeYear);
}
}

oEditor.documentArea.appendChild(me.imageElement);

me.refresh();

me.rendered=true;
};

var getYearTextField=function $vpfn_xvMothAUO9plk3TpfsNTrw203$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<Editor.items.length;i++)
{
if((DOCITEM_TYPE_WORDART==Editor.items[i].type||DOCITEM_TYPE_TEXT==Editor.items[i].type)&&Editor.items[i].purposeName=="year")
{
return Editor.items[i];
}
}

return null;
};

var changeYear=function $vpfn_AeFxxZWpLdy8dP44q4qOYg216$21(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.year=parseInt(me.yearSelector.options[me.yearSelector.selectedIndex].value);

var oYearItem=getYearTextField();

if(oYearItem)
{
oYearItem.setData(me.year.toString());
oYearItem.refresh();
}

me.refresh();
};




this.unrender=function $vpfn_nwvhB61KClDG8XfQY3_Dqg234$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.imageElement.parentNode)
{
me.imageElement.parentNode.removeChild(me.imageElement);
}

if(me.externalElement&&me.externalElement.parentNode)
{
me.externalElement.parentNode.removeChild(me.externalElement);
}

me.rendered=false;
};





this.getURL=function $vpfn_ou_s5pyArBleNFCfEHIPCw253$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oQS=new vp.web.QueryString();
var oRect=me.coordinates.getRect();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem("height",oRect.height);
oQS.setItem("width",oRect.width);
oQS.setItem("month",me.month);
oQS.setItem("year",me.year);
oQS.setItem("style",me.gridStyle);
oQS.setItem("grid_all_months",me.showAllMonths?1:0);
oQS.setItem("grid_month_name_color",me.monthNameColor?me.monthNameColor.toString():"");
oQS.setItem("grid_foreground_color",me.foregroundColor?me.foregroundColor.toString():"");
oQS.setItem("grid_background_color",me.backgroundColor?me.backgroundColor.toString():"");
oQS.setItem("month_name_font",me.monthNameFont);
oQS.setItem("language_id",Editor.docLanguageID);
oQS.setItem("trypng",1);

if(me.isGrayScale())
{
oQS.setItem("gs",1);
}

return"/any/preview/calgrid.caspx?"+oQS.toString();
};




this.refresh=function $vpfn_phg3gVFV6oKMJye4VbGHnw283$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sNewURL=me.getURL();
if(!me.currentURL||me.currentURL!=sNewURL)
{
me.currentURL=me.getURL();
vp.ui.setSrcPNG(me.imageElement,sNewURL);
}
};




this.getUpdateXML=function $vpfn_mgZ5_v5OBJ8K36PU4CqmpQ296$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("calendargrid");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,false);


if(me.monthNameColor)
{
oNode.attributes["c_monthNameColor"]=me.monthNameColor.toString();
}

if(me.foregroundColor)
{
oNode.attributes["c_foregroundColor"]=me.foregroundColor.toString();
}

if(me.backgroundColor)
{
oNode.attributes["c_backgroundColor"]=me.backgroundColor.toString();
}

return oNode.toString();
};





this.setZIndex=function $vpfn_6EGM1GJleM4JGs4bRg0LsQ327$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}



me.imageElement.style.zIndex=me._getDOMElementZIndex();
};




this.terminate=function $vpfn_gfKnIphUzlE7G6NgTqF7aA342$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement=null;
};





this.applyColorScheme=function $vpfn_TiEB7UuzeJjJaCQ8rCvItw351$28(aColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.foregroundColorRef>=0)
{
me.foregroundColor=new vp.color.Color(aColors[me.foregroundColorRef]);
}
if(me.backgroundColorRef>=0)
{
me.backgroundColor=new vp.color.Color(aColors[me.backgroundColorRef]);
}
if(me.monthNameColorRef>=0)
{
me.monthNameColor=new vp.color.Color(aColors[me.monthNameColorRef]);
}

me.refresh();
};
};

vp.studio.CalendarGrid._CORE_ATTRIBUTES=[
"id",
"zIndex",
"metaData",
"month",
"year",
"gridStyle",
"showAllMonths",
"monthNameColor",
"foregroundColor",
"backgroundColor",
"monthNameColorRef",
"foregroundColorRef",
"backgroundColorRef"
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.Arrow=function $vpfn_rirV$2hM9aloBYpFVVWIEw12$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_ARROW;

this.itemTypeString="Arrow";





this.getIDPrefix=function $vpfn_kWKPogijMYM5xnRo1d3S4A34$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_arrow_";
};





this.ondblclick=new vp.events.CustomEvent(this,"ondblclick");





this.color=null;





this._coreAttributes=vp.studio.Arrow._CORE_ATTRIBUTES;





this.render=function $vpfn_Yh6JBCHiciM3c$4BZ9eeYQ61$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{

me.handleElement=document.createElement("IMG");
me.handleElement.src=BLANK_IMAGE;
me.handleElement.id=me.id+"_handle";
me.handleElement.style.position="absolute";
me.coordinates.boundElements.add(me.handleElement);

vp.events.add(me.handleElement,"dblclick",me.ondblclick.fire);

me.imageContainer=document.createElement("DIV");
me.imageContainer.id=me.id+"_container";
me.imageContainer.style.position="absolute";

me.setZIndex();

me.imageContainer.style.top=0;
me.imageContainer.style.left=0;


me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.zIndex=1;
me.imageElement.style.visibility="hidden";

me.coordinates.boundElements.add(me.imageElement);

me.coordinates.updateBoundElements(true);
}

oEditor.documentArea.appendChild(me.imageContainer);
oEditor.docItemHandleArea.appendChild(me.handleElement);

me.imageContainer.appendChild(me.imageElement);

me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_JL7X7BYWrX6xr36S6y3xGg113$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.imageContainer.parentNode)
{
vp.ui.removeFromDOM(me.imageContainer);
}

if(me.handleElement.parentNode)
{
vp.ui.removeFromDOM(me.handleElement);
}

me.rendered=false;
};






var onLoadHandler=function $vpfn_anrti0$OqoHqb7pgPOVMGg133$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.imageElement.parentNode)
{
return;
}


vp.ui.applyPosition(me.coordinates.getRect(),me.imageElement.style);

me.imageElement.style.visibility="visible";
};





this.getURL=function $vpfn_8MZzJOewMHJ_piEKxTaS9g150$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oQS=new vp.web.QueryString();
var oRect=me.coordinates.getRect();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem("height",oRect.height);
oQS.setItem("width",oRect.width);
oQS.setItem("fill_color",me.color?me.color.toString():"#000000");
oQS.setItem("format","png");
oQS.setItem("angle",me.coordinates.rotation.angleInDegrees);

if(me.isGrayScale())
{
oQS.setItem("gs",1);
}

var sPath="/any/preview/arrow.caspx";
return sPath+"?"+oQS.toString();
};




this.refresh=function $vpfn_s8R7Jfmy4nbqRbFXdOpEhw174$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sNewURL=me.getURL();
if(!me.currentURL||me.currentURL!=sNewURL)
{
me.currentURL=me.getURL();
vp.ui.setSrcPNG(me.imageElement,sNewURL,onLoadHandler);
}
};





this.getManipulatorElement=function $vpfn_KougRzF763P0mX0R$4QDnQ188$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.handleElement;
};




this.getUpdateXML=function $vpfn_Dhe3K$bA8aLpGtsqdtRb0g196$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("arrow");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,true);

return oNode.toString();
};





this.setZIndex=function $vpfn_ErWhA9wPq2H06JNdCJnRXg211$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}

if(me.handleElement)
{
me.handleElement.style.zIndex=me._getDOMElementZIndex(true);
}
me.imageContainer.style.zIndex=me._getDOMElementZIndex();
};






this.upgrade=function $vpfn_EgiBVClw6ZWO9lsVz6aHmw230$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateArrow(me);
};




this.terminate=function $vpfn_36wUP1SDCoW8hf8SbL2R8w238$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement=null;
};

};

vp.studio.Arrow._CORE_ATTRIBUTES=[
"id",
"zIndex",
"color"
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.ShapeLayer=function $vpfn_AmhdJss0X3RUWdePAltfwQ11$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_SHAPE_LAYER;

this.itemTypeString="Shape Group";

this.shapes=[];

this.addShape=function $vpfn_dRL0uSYFefp3Ufz0VD0UoQ31$20(oShape)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.shapes.add(oShape);
oShape.shapeLayer=me;
};




this.render=function $vpfn_$POB9BluhhZdL1MUqPfCvA40$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{
me.zIndex=getHighestZIndex();

me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.visibility="hidden";

me.setZIndex();


me.coordinates.setRectPrecise(
{
top:0,
left:0,
width:Editor.dimensions.width,
height:Editor.dimensions.height
}
);
me.coordinates.boundElements.add(me.imageElement);
me.coordinates.updateBoundElements(true);
}

oEditor.documentArea.appendChild(me.imageElement);


vp.events.add(me.imageElement,"mousedown",vp.studio.util.cancelEventAndBlur);

me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_MV5k7$wllQi$x_O4YwX1Lg84$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.parentNode.removeChild(me.imageElement);
me.onunrender.fire();
};




this.refresh=function $vpfn_xFoLQf9l0_gbian_QzJ5vg93$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.imageElement,me.getURL(),me._onLoadHandler);
me.coordinates.updateBoundElements();
};

var _bSortComplete=false;





this.getURL=function $vpfn_4JmP00o8WjDIor2CFiOMog105$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!_bSortComplete)
{
me.shapes.sort(vp.studio.DocumentItem.compareZIndexRev);
_bSortComplete=true;
}

var aData=[];
for(var i=0;i<me.shapes.length;i++)
{
aData.add("("+me.shapes[i].getCompactData().join("_")+")");
}

var sData=aData.join("");

var oQS=new vp.web.QueryString();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem("zoom",Editor.zoomFactor);



if(Editor.pageNumber==2&&Editor.page2PFID)
{
oQS.setItem("pf_id",Editor.page2PFID);
}
else
{
oQS.setItem("pf_id",Editor.PFID);
}

if(me.isGrayScale())
{
oQS.setItem("mode","g");
}


if(Editor.colorOverride&&Editor.colorOverrides)
{
if(Editor.colorOverrides[Editor.colorOverride])
{
oQS.setItem("coloroverride",Editor.colorOverrides[Editor.colorOverride]);
}
}


oQS.setItem("elem",sData);


var sPath="/any/preview/shape.caspx";



for(var s=0;s<me.shapes.length;s++)
{
if(me.shapes[s].pathDataStorageId)
{
sPath="/vp/ns/shapepreviewbig.aspx";
}
}


var sQS=oQS.toString();
var sUrl=sPath+"?"+sQS;


try
{

return vp.http.getURLSizedForGET(sUrl,"elem",null,false,true);
}
catch(ex)
{

return"/vp/images/nns/common/icons/error_icon.gif";
}
};





this.getManipulatorElement=function $vpfn_oIvo5hcWUer0H3YvQoyGPw189$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};





this._onLoadHandler=function $vpfn_2$0zjZ0In30jQxbXmnjk7g198$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.style.visibility="visible";
};





this.setZIndex=function $vpfn_pcjdfbQzi2$aYOc9D89uLA207$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}

me.imageElement.style.zIndex=me._getDOMElementZIndex();

if(iZIndex)
{
var diff=iZIndex-getHighestZIndex();

for(var i=0;i<me.shapes.length;i++)
{
me.shapes[i].setZIndex(me.shapes[i].zIndex+diff);
}
}
};





var getHighestZIndex=function $vpfn_75DMt6eBnyeK2S25C7NGGw231$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var z=-1000000;

for(var i=0;i<me.shapes.length;i++)
{
if(me.shapes[i].zIndex>z)
{
z=me.shapes[i].zIndex;
}
}

return z;
};





this.getLowestZIndex=function $vpfn_qijAdrQyYJqGkvSGTRlnxA250$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var z=me.zIndex;

for(var i=0;i<me.shapes.length;i++)
{
if(me.shapes[i].zIndex<z)
{
z=me.shapes[i].zIndex;
}
}

return z;
};






this.setLowestZIndex=function $vpfn_6vSUNG6cvjOAQmdoUaXqgQ270$27(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var diff=iZIndex-me.getLowestZIndex();
me.setZIndex(me.zIndex+diff);
};

this.ungroup=function $vpfn_xzV7nIfXatF4MB0dxlnpZw276$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.shapes.length;i++)
{
me.shapes[i].shapeLayer=null;
me.shapes[i].render(Editor);

if(vp.studio.Decorator)
{
me.shapes[i].upgrade(vp.studio.Decorator);
}
}

me.shapes=[];
Editor.notifyShapesChanged();
Editor.removeItem(me);
};

this.applyColorScheme=function $vpfn_G6uShMslY3CeR6weDn1T0A294$28(aColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.shapes.length;i++)
{
me.shapes[i].applyColorScheme(aColors,true);
}

me.refresh();
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.Shape=function $vpfn_FfnsuYEHDboQh2THzTPbvw11$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_SHAPE;

this.shapeLayer=null;

this.fillColorRef=-1;

this.fillColor=null;

this.fillColor2Ref=-1;

this.fillColor2=null;

this.strokeColorRef=-1;

this.strokeColor=null;

this.strokeWeight=0;

this.strokeOpacity=1;

this.opacity=1;

this.opacity2=1;

this.locked=true;

this.ondblclick=new vp.events.CustomEvent(this,"ondblclick");




this.render=function $vpfn_HhdT21im_iR8A58Mf8RS5Q56$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.shapeLayer!==null)
{
return;
}

if(me.rendered)
{
return;
}

if(!me.imageElement)
{

me.handleElement=document.createElement("IMG");
me.handleElement.src=BLANK_IMAGE;
me.handleElement.id=me.id+"_handle";
me.handleElement.style.position="absolute";

me.coordinates.boundElements.add(me.handleElement);

vp.events.add(me.handleElement,"dblclick",me.ondblclick.fire);

me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.visibility="hidden";

me.setZIndex();

me.coordinates.updateBoundElements(true);
}

oEditor.documentArea.appendChild(me.imageElement);
oEditor.docItemHandleArea.appendChild(me.handleElement);




me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_1gBA0fSFtT5l0V5aPO1Zrg105$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.shapeLayer!==null)
{
return;
}

me.imageElement.parentNode.removeChild(me.imageElement);
me.handleElement.parentNode.removeChild(me.handleElement);
me.onunrender.fire();

me.rendered=false;
};




this.refresh=function $vpfn_fnq1ZlNKvdk$Wh3L3IZsLg122$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.shapeLayer!==null)
{
return;
}

vp.ui.setSrcPNG(me.imageElement,me.getURL(),me._onLoadHandler);
me.coordinates.updateBoundElements();
this.positionImage();

};





this.getURL=function $vpfn_w_aZodlZfiCdf6Q9nX36DQ139$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sData=me.getCompactData().join("_");

var oQS=new vp.web.QueryString();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem(EditorConst.embroideryParam,Editor.isEmbroidery);
oQS.setItem("nopadding","1");
oQS.setItem("zoom",Editor.zoomFactor);

if(me.isGrayScale())
{
oQS.setItem("mode","g");
}


if(Editor.colorOverride&&Editor.colorOverrides)
{
if(Editor.colorOverrides[Editor.colorOverride])
{
oQS.setItem("coloroverride",Editor.colorOverrides[Editor.colorOverride]);
}
}


oQS.setItem("elem",sData);


var sPath="/any/preview/shape.caspx";



if(me.pathDataStorageId)
{
sPath="/vp/ns/shapepreviewbig.aspx";
}


var sQS=oQS.toString();
var sUrl=sPath+"?"+sQS;


try
{

return vp.http.getURLSizedForGET(sUrl,"elem",null,false,true);
}
catch(ex)
{

return"/vp/images/nns/common/icons/error_icon.gif";
}
};

this.getUpdateXML=function $vpfn_xb_FqGU$p5tABvylrbgnxw193$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("shape");

oNode.attributes["id"]=me.id;
oNode.attributes["zindex"]=me.zIndex;
oNode.attributes["fillcolorref"]=me.fillColorRef;
oNode.attributes["fillcolor2ref"]=me.fillColor2Ref;
oNode.attributes["strokecolorref"]=me.strokeColorRef;
oNode.attributes["locked"]=me.locked;

if(me.isFoil)
{
oNode.attributes["isFoil"]=me.isFoil;
}
oNode.attributes["data"]=me.getCompactData().join("_");

return oNode.toString();
};





this.getManipulatorElement=function $vpfn_KG9AMn35LEwERjW3JFr5MA217$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.handleElement;
};






this.getCompactData=function $vpfn_Ts99oZnBmw5MZz0FJMc7tQ227$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aData=[];
aData.add(me.typeString);

var oRect=me.coordinates.getRectPrecise();

aData.add(oRect.left);
aData.add(oRect.top);
aData.add(oRect.width);
aData.add(oRect.height);

aData.add(me.fillColor?me.fillColor.toString().replace("#",""):"");
aData.add(me.fillColor2?me.fillColor2.toString().replace("#",""):"");
aData.add(me.opacity);
aData.add(me.opacity2);
aData.add(me.strokeColor?me.strokeColor.toString().replace("#",""):"");
aData.add(me.strokeWeight);
aData.add(me.strokeOpacity);

var oRotation=me.coordinates.rotation;
aData.add(oRotation.angleInDegrees);
aData.add(oRotation.initialWidth);
aData.add(oRotation.initialHeight);

return aData;
};





this._onLoadHandler=function $vpfn_1keCOxCiuW0inNPdplcplw259$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.style.visibility="visible";
me.positionImage();
};

var m_fImageHeightRatio=0;
var m_fImageWidthRatio=0;

this.positionImage=function $vpfn_XZs40_YQn15$lJySIfZ8oQ268$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var oRect=me.coordinates.getRect();
me._centerImage(oRect);

var oImageRect=
{
top:me.imageElement.offsetTop,
left:me.imageElement.offsetLeft,
width:me.imageElement.offsetWidth,
height:me.imageElement.offsetHeight
};

m_fImageHeightRatio=oImageRect.height/oRect.height;
m_fImageWidthRatio=oImageRect.width/oRect.width;
};

this.positionImageRough=function $vpfn_6_Hap$WhejyQ0uqUi0ZStg287$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.style.height=me.handleElement.offsetHeight*m_fImageHeightRatio+"px";
me.imageElement.style.width=me.handleElement.offsetWidth*m_fImageWidthRatio+"px";

var oRect={};
vp.ui.applyPosition(me.handleElement.style,oRect);





if(isNaN(oRect.width)||isNaN(oRect.height))
{
oRect.width=me.handleElement.offsetWidth;
oRect.height=me.handleElement.offsetHeight;
}

me._centerImage(oRect);
};

this._centerImage=function $vpfn_BlZcCQz_Fy7vNbyzhAykWw308$24(oRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!isNaN(oRect.width)&&!isNaN(oRect.height))
{
me.imageElement.style.left=oRect.left-((me.imageElement.offsetWidth-oRect.width)/2)+"px";
me.imageElement.style.top=oRect.top-((me.imageElement.offsetHeight-oRect.height)/2)+"px";
}
};





this.setZIndex=function $vpfn_mGqsA4$s8i2dPe8namsfyQ321$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}

if(me.shapeLayer!==null)
{
return;
}

me.handleElement.style.zIndex=me._getDOMElementZIndex(true);
me.imageElement.style.zIndex=me._getDOMElementZIndex();
};





this.upgrade=function $vpfn_4wllh4q7sESgj7xY4LUVbA341$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
oDecorator.decorateShape(me);
}
};






this.applyColorScheme=function $vpfn_45KoYwYzFiqRbBcz6DXY8w354$28(aColors,bForce)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.shapeLayer&&!bForce)
{
return;
}

if(me.fillColorRef>=0)
{
me.fillColor=new vp.color.Color(aColors[me.fillColorRef]);
}
if(me.fillColor2Ref>=0)
{
me.fillColor2=new vp.color.Color(aColors[me.fillColor2Ref]);
}
if(me.strokeColorRef>=0)
{
me.strokeColor=new vp.color.Color(aColors[me.strokeColorRef]);
}

me.refresh();
};
};

vp.studio.Shape._CORE_ATTRIBUTES=
[
"id",
"zIndex",
"fillColorRef",
"fillColor",
"fillColor2Ref",
"fillColor2",
"strokeColorRef",
"strokeColor",
"strokeWeight",
"strokeOpacity",
"opacity",
"opacity2",
"locked",
"isFoil"
];
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.Line=function $vpfn_fQ2Y0oUg3KZKFjeWgjre3w11$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Shape;
this.inheritFrom();
this.classRef=arguments.callee;

var me=this;






this._coreAttributes=vp.studio.Line._CORE_ATTRIBUTES;





this.type=DOCITEM_TYPE_LINE;

this.itemTypeString="Line";





this.typeString="l";


var _iYOffset=10;

var base_getCompactData=this.getCompactData;





this.getCompactData=function $vpfn_cHzTRUQ4XNMwyzKgGL_KmA52$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=base_getCompactData();

var rect=me.coordinates.getRectPrecise();

if(me.coordinates.rotation.angleInDegrees%180===0)
{
arr.add(0);
arr.add(_iYOffset);
arr.add(rect.width);
arr.add(_iYOffset);
}
else
{
arr.add(_iYOffset);
arr.add(0);
arr.add(_iYOffset);
arr.add(rect.height);
}

return arr;
};





this.getIDPrefix=function $vpfn_mw6oUN1doH4gSMTWSbGASQ80$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_line_";
};

};

vp.studio.Line._CORE_ATTRIBUTES=vp.studio.Shape._CORE_ATTRIBUTES;
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.Oval=function $vpfn_f$gip$gnmPTOL70FDE3N1Q11$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Shape;
this.inheritFrom();
this.classRef=arguments.callee;

var me=this;






this._coreAttributes=vp.studio.Oval._CORE_ATTRIBUTES;





this.type=DOCITEM_TYPE_OVAL;

this.itemTypeString="Oval";





this.typeString="o";





this.getIDPrefix=function $vpfn_Zzx5ZMWsn28PWsOTQLjTig47$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_oval_";
};
};

vp.studio.Oval._CORE_ATTRIBUTES=vp.studio.Shape._CORE_ATTRIBUTES;
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.Rectangle=function $vpfn_xv6xyh268Qov2oTgdGWbGQ11$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Shape;
this.inheritFrom();
this.classRef=arguments.callee;

var me=this;






this._coreAttributes=vp.studio.Rectangle._CORE_ATTRIBUTES;





this.type=DOCITEM_TYPE_RECTANGLE;

this.itemTypeString="Rectangle";





this.typeString="r";





this.fillType=RECTANGLE_FILL_TYPE_Normal;





this.fillDirection=GRADIENT_FILL_DIRECTION_Left;





this.patternImageID=0;





this.cornerRadius=0;

var base_getCompactData=this.getCompactData;





this.getCompactData=function $vpfn_b_COeczrE6lX7ODwsH8k7Q73$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=base_getCompactData();

arr.add(me.fillType);
arr.add(me.fillDirection);
arr.add(me.patternImageID);
arr.add(me.cornerRadius);

return arr;
};





this.getIDPrefix=function $vpfn_baNK3_JC9sacTpKLBWfDfQ89$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_rect_";
};
};

vp.studio.Rectangle._CORE_ATTRIBUTES=vp.studio.Shape._CORE_ATTRIBUTES.concat([
"fillType",
"fillDirection",
"patternImageID"
]);
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.PathShape=function $vpfn_xJDWfIiA9Vt0IMt49NksIQ11$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Shape;
this.inheritFrom();
this.classRef=arguments.callee;

var me=this;






this._coreAttributes=vp.studio.PathShape._CORE_ATTRIBUTES;





this.type=DOCITEM_TYPE_PATH_SHAPE;

this.itemTypeString="Shape";





this.typeString="p";





this.coordSizeWidth=0;





this.coordSizeHeight=0;





this.pathData=null;





this.pathDataStorageId=null;

var base_getCompactData=this.getCompactData;





this.getCompactData=function $vpfn_Ug0oeG5vnEldDCLEuCtWUA73$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=base_getCompactData();

arr.add(me.coordSizeWidth);
arr.add(me.coordSizeHeight);
arr.add(me.pathDataStorageId);
arr.add(me.pathData.replace(/\,/gi,"."));

return arr;
};





this.getIDPrefix=function $vpfn_fmrNrNx7FDq79zTr2VQRrg89$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_shape_";
};
};

vp.studio.PathShape._CORE_ATTRIBUTES=vp.studio.Shape._CORE_ATTRIBUTES.concat([
"coordSizeWidth",
"coordSizeHeight",
"pathDataStorageId",
"pathData"
]);










vp.studio.PathShape.getPathForStarburst=function $vpfn_uB$OY38TvxhYR9wPjEsZ7w111$42(iPoints,fPointHeight,iRotation,iCoordWidth,iCoordHeight)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(iPoints<2||fPointHeight===0)
{
return"";
}



var r=1.5-fPointHeight;


var angleIncrement=(360/(2*iPoints))*(Math.PI/180);
var rotationRadian=iRotation%360*(Math.PI/180);

var pointLocations=new Array(iPoints*2);


var i=0;
for(i=0;i<iPoints;i++)
{
pointLocations[2*i]=new Array(2);
pointLocations[2*i+1]=new Array(2);

pointLocations[2*i][0]=r*Math.sin(2*i*angleIncrement+rotationRadian);
pointLocations[2*i][1]=r*Math.cos(2*i*angleIncrement+rotationRadian);

pointLocations[2*i+1][0]=(r+fPointHeight)*Math.sin((2*i+1)*angleIncrement+rotationRadian);
pointLocations[2*i+1][1]=(r+fPointHeight)*Math.cos((2*i+1)*angleIncrement+rotationRadian);
}


for(i=0;i<iPoints*2;i++)
{

pointLocations[i][0]+=(r+fPointHeight);
pointLocations[i][1]+=(r+fPointHeight);


pointLocations[i][0]*=iCoordWidth/((r+fPointHeight)*2);
pointLocations[i][1]*=iCoordHeight/((r+fPointHeight)*2);

pointLocations[i][0]=Math.round(pointLocations[i][0]);
pointLocations[i][1]=Math.round(pointLocations[i][1]);
}


var path=new Array(1);
path[0]="m"+pointLocations[0][0].toString()+"."+pointLocations[0][1].toString();
path.push("l"+pointLocations[1][0].toString()+"."+pointLocations[1][1].toString());

for(i=2;i<iPoints*2;i++)
{
path.push("."+pointLocations[i][0].toString()+"."+pointLocations[i][1].toString());
}

path.push("xe");

return path.join("");

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CutShape=function $vpfn_y6dpYidcCWKNwZaiUAvSSg11$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CUT_SHAPE;

this.shapeLayer=null;

this.cutType=null;






this.getCompactData=function $vpfn_w3qkNYnYl48mZu1w2ugoOA36$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aData=[];
aData.add(me.typeString);

var oRect=me.coordinates.getRectPrecise();

aData.add(oRect.left);
aData.add(oRect.top);
aData.add(oRect.width);
aData.add(oRect.height);

aData.add(me.cutType);

var oRotation=me.coordinates.rotation;
aData.add(oRotation.angleInDegrees);
aData.add(oRotation.initialWidth);
aData.add(oRotation.initialHeight);

return aData;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CutOval=function $vpfn_9_9FzpIG0X0IFDWX3QzarQ11$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.CutShape;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CUT_OVAL;

this.typeString="o";

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CutRectangle=function $vpfn_KucXwGqATNP7I9uPcPOGAw11$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.CutShape;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CUT_RECTANGLE;

this.typeString="r";

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CutPathShape=function $vpfn_Ot$TSZwfHkuwyynM55gCrA11$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.CutShape;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CUT_PATH_SHAPE;

this.typeString="p";

var base_getCompactData=this.getCompactData;





this.getCompactData=function $vpfn_UTYZY_qh4BLujUFHeOpPig35$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=base_getCompactData();

arr.add(me.coordSizeWidth);
arr.add(me.coordSizeHeight);
arr.add(me.pathDataStorageId);
arr.add(me.pathData.replace(/\,/gi,"."));

return arr;
};

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.CutShapeLayer=function $vpfn_pZ0$ZuTejk$xVvSHGobOWg11$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_CUT_SHAPE_LAYER;

this.itemTypeString="Cut Shape Group";

this.shapes=[];

this.addShape=function $vpfn_aJBzm410v_mhXt467Qhd_Q31$20(oShape)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.shapes.add(oShape);
oShape.shapeLayer=me;
};




this.render=function $vpfn_3JZClLDNINlFKudTIJc0mg40$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{
me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.visibility="hidden";
me.imageElement.style.zIndex=PRODUCT_OVERLAY_ZINDEX_OFFSET;


me.coordinates.setRectPrecise(
{
top:0,
left:0,
width:Editor.dimensions.width,
height:Editor.dimensions.height
}
);
me.coordinates.boundElements.add(me.imageElement);
me.coordinates.updateBoundElements(true);
}

oEditor.documentArea.appendChild(me.imageElement);


vp.events.add(me.imageElement,"mousedown",vp.studio.util.cancelEventAndBlur);

me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_OGToSxacVe0dkvts2tX8oA81$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.parentNode.removeChild(me.imageElement);
me.onunrender.fire();
};




this.refresh=function $vpfn_ixJQOAvGdh9RVk4X9LeH$g90$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.imageElement,me.getURL(),me._onLoadHandler);
me.coordinates.updateBoundElements();
};

var _bSortComplete=false;





this.getURL=function $vpfn_vfYJ930vOIrWJiuDics7Og102$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!_bSortComplete)
{
me.shapes.sort(vp.studio.DocumentItem.compareZIndexRev);
_bSortComplete=true;
}

var aData=[];
for(var i=0;i<me.shapes.length;i++)
{
aData.add("("+me.shapes[i].getCompactData().join("_")+")");
}

var sData=aData.join("");

var oQS=new vp.web.QueryString();
oQS.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oQS.setItem("zoom",Editor.zoomFactor);


oQS.setItem("page",Editor.pageNumber);



if(Editor.pageNumber==2&&Editor.page2PFID)
{
oQS.setItem("pf_id",Editor.page2PFID);
}
else
{
oQS.setItem("pf_id",Editor.PFID);
}


oQS.setItem("elem",sData);


var sPath="/any/preview/customcut.caspx";
var sQS=oQS.toString();
var sUrl=sPath+"?"+sQS;


try
{

return vp.http.getURLSizedForGET(sUrl,"elem",null,false,true);
}
catch(ex)
{

return"/vp/images/nns/common/icons/error_icon.gif";
}
};





this.getManipulatorElement=function $vpfn_v3Ogr9coO9uGyq7NMCf3FA162$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};





this._onLoadHandler=function $vpfn_Wl_be5E5IENX5Jswl5pX6w171$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement.style.visibility="visible";
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.ProductLayer=function $vpfn_vZTaPVQ1SWo_9rETfZrs1g10$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

var me=this;





this.id="";





this.type=null;





this.usePadding=false;





this.isChrome=true;





this.attributes={};





this._zIndex=0;





this.viewType;





this.unzoomedLeftOffset=0;

this.widthMultiplier=1;




this.render=function $vpfn_nG1IbsXzE8a0vSETUqQkFQ73$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.docElement)
{
me.docElement=document.createElement("IMG");
me.docElement.id=me.id;
me.docElement.style.position="absolute";
me.docElement.style.zIndex=me._zIndex;
me.docElement.style.visibility="hidden";

var width=Editor.useSceneOnCanvas?Editor.sceneDimensions.width:Editor.dimensions.width;
var height=Editor.useSceneOnCanvas?Editor.sceneDimensions.height:Editor.dimensions.height;

me.coordinates.setRectPrecise(
{
top:0,
left:me.unzoomedLeftOffset,
width:width*me.widthMultiplier,
height:height
}
);
me.coordinates.boundElements.add(me.docElement);
me.coordinates.updateBoundElements(true);
}

oEditor.documentAreaContainer.insertBefore(me.docElement,oEditor.documentArea);


vp.events.add(me.docElement,"mousedown",vp.events.cancelEvent);

me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_JylQglpqgL519$PCTbRsYQ116$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.docElement.parentNode.removeChild(me.docElement);
me.rendered=false;
};




this.refresh=function $vpfn_GEq2xBSO19GypvOMD6WN8A125$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.setSrcPNG(me.docElement,me.getURL(),me._onLoadHandler);

me.coordinates.updateBoundElements();
};





this.getURL=function $vpfn_Z7s9aUDCK4vOtgXI715rNg136$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL("/vp/ns/livepreview.aspx");
oUrl.setItem("border",0);
oUrl.setItem("nofold",1);
oUrl.setItem("nopad",me.usePadding?0:1);
oUrl.setItem("nossr",1);
oUrl.setItem("png",1);
oUrl.setItem("chrome",1);
oUrl.setItem("pf_id",Editor.PFID);
oUrl.setItem("page",Editor.pageNumber);
oUrl.setItem("width",me.coordinates.getCoord("width"));
oUrl.setItem("u",new Date().valueOf());
oUrl.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oUrl.setItem("ssc",Editor.substrateColor);

if(me.viewType)
{
oUrl.setItem("vt",me.viewType);
}
else
{
oUrl.setItem("vt",1);
}

for(var sProp in me.attributes)
{
oUrl.setItem(sProp,vp.web.urlEncode(me.attributes[sProp]));
}

if(Editor.docID>0)
{
oUrl.setItem("doc_id",Editor.docID);
}

return oUrl.toString();
};






this.getManipulatorElement=function $vpfn_C$W4_i5HBk7HdwetTyzq9w179$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return null;
};





this._onLoadHandler=function $vpfn_Q7Qz4g0Zz6mG6NzrL315bQ188$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.docElement.style.visibility="visible";
};
};





vp.studio.ProductOverlay=function $vpfn_ZvgWbO8hSt_gnIbENfNWxA198$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductLayer;
this.inheritFrom();

var me=this;





this.id="product_overlay";





this.type=DOCITEM_TYPE_PRODUCT_OVERLAY;





this._zIndex=1;
};





vp.studio.ProductUnderlay=function $vpfn_vsPDwG_MnA2WtV13P3p9vg231$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductLayer;
this.inheritFrom();

var me=this;





this.id="product_underlay";





this.type=DOCITEM_TYPE_PRODUCT_UNDERLAY;





this._zIndex=0;

var inheritFrom_getURL=this.getURL;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}







vp.studio.SafetyMarginOverlay=function $vpfn_r8FKiU_HypKqiFli1JvnVg9$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductOverlay;
this.inheritFrom();

var me=this;





this.id="safety_margin_overlay";





this.getURL=function $vpfn_p_fETWNiCG4ap017Cw2h1w29$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var Url=new String("/any/preview/shape.caspx?render_tech=HybridGdipWpf&emb=0&pf_id={0}&nopadding=0&zoom={1}&elem=o_{2}_{3}_{4}_{5}_FFFFFF_FFFFFF_0_0_000000.FFFFFF.4.4_1_1_0_383.714702336869_240.53088045469536");
Url=Url.format(Editor.PFID,Editor.zoomFactor,Editor.frameRects.safeArea.left,Editor.frameRects.safeArea.top,Editor.frameRects.safeArea.width,Editor.frameRects.safeArea.height);
var oUrl=new vp.web.URL(Url);
return oUrl.toString();
};

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.SubstrateColorUnderlay=function $vpfn_xem9gHzL$UrkZVUXJRE5kQ10$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductUnderlay;
this.inheritFrom();

var me=this;





this.id="substrate_color_underlay";




this.render=function $vpfn_jE$L79RzK2qykLXh1Tx29g29$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.docElement)
{
me.docElement=document.createElement("DIV");
me.docElement.id=me.id;
me.docElement.style.position="absolute";
me.docElement.style.zIndex=me._zIndex;

me.coordinates.setRectPrecise(
{
top:0,
left:me.unzoomedLeftOffset,
width:Editor.dimensions.width*me.widthMultiplier,
height:Editor.dimensions.height
}
);
me.coordinates.boundElements.add(me.docElement);
me.coordinates.updateBoundElements(true);
}

oEditor.documentAreaContainer.insertBefore(me.docElement,oEditor.documentArea);


vp.events.add(me.docElement,"mousedown",vp.events.cancelEvent);

me.refresh();

me.rendered=true;
};





this.refresh=function $vpfn_frWLgHEUM8SptNpNvMC1sw69$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSubstrateVariant=Editor.substrateVariants[Editor.substrateColor];
me.docElement.style.backgroundColor=(!oSubstrateVariant||oSubstrateVariant.isLight)?"#FFFFFF":oSubstrateVariant.hexValue;
me.coordinates.updateBoundElements();
};





this.getURL=function $vpfn_Dpuqmq6vUJ1yAt6pWesfLw80$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"";
};

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.GridOverlay=function $vpfn_hzWOngL3L2c07BVsryxP$g10$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductOverlay;
this.inheritFrom();

var me=this;

var inheritFrom_refresh=this.refresh;





this.type=DOCITEM_TYPE_GRID_OVERLAY;





this.isChrome=true;





this.majorColor="a0a0a0";





this.minorColor="555555";





var bIsHidden=true;


var editor=null;




this.render=function $vpfn_$HjzKYDB060FzckBgYf$TA58$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.docElement)
{
me.docElement=document.createElement("IMG");
me.docElement.id="grid_overlay";
me.docElement.style.position="absolute";
me.docElement.style.zIndex=GRID_OVERLAY_ZINDEX_OFFSET;
me.docElement.style.visibility=bIsHidden?"hidden":"visible";

me.coordinates.setRectPrecise(
{
top:0,
left:0,
width:Editor.dimensions.width,
height:Editor.dimensions.height
}
);
me.coordinates.boundElements.add(me.docElement);
me.coordinates.updateBoundElements(true);


oEditor.onregenerate.addHandler(onRegenerateHandler);


vp.events.add(me.docElement,"mousedown",vp.studio.util.cancelEventAndBlur);
}

editor=oEditor;

oEditor.documentArea.appendChild(me.docElement);

me.refresh();
me.rendered=true;
};




this.unrender=function $vpfn_xLC1FMlKd3218M$qXWUeSQ102$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.rendered=false;
me.docElement.parentNode.removeChild(me.docElement);
};




var onRegenerateHandler=function $vpfn_tvrsW1ZNUAPSm7L$n1Po5Q111$30(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
editor.addItem(me);
me.render(editor);
};





this.isHidden=function $vpfn_rBzv1WpH67g$BJQM7TlLdQ121$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return bIsHidden;
};




this.show=function $vpfn_2LKoX00Sf4gDCuKYviQjxQ129$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
bIsHidden=false;
me.docElement.style.visibility="visible";
me.refresh();

vp.studio.instrumentation.add("Grid-showing");
};




this.hide=function $vpfn_86jBqoz5n9k7eunSNcD8bg141$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
bIsHidden=true;
me.docElement.style.visibility="hidden";

vp.studio.instrumentation.add("Grid-hiding");
};

this.refresh=function $vpfn_rKQK3mdfAyj8r7Y6zRfc1A149$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!bIsHidden)
{
inheritFrom_refresh();
}
};





this.getURL=function $vpfn_AabtD8vd5N2etTGenKVgRA161$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sUrl="/vp/ns/gridlineswebservice.aspx?"+
"&pf_id="+Editor.PFID+
"&zoom="+Editor.zoomFactor+
"&color1="+this.majorColor+
"&color2="+this.minorColor;
return sUrl;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}






if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}





vp.studio.ui=function(){};





vp.studio.ui.saveButtonClick=function $vpfn_083oefYIwhp0qEkDVjSJ4A28$31(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.save(false,true);
};





vp.studio.ui.save=function $vpfn_jcSySgUV6W9nEl2knIS9fQ37$20(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.generateDocumentName();

var fnSave=(Editor.features.isEPTemplateEdit&&Editor.docID<=0)?Editor.saveAsEnterprisePartnerTemplate:Editor.save;
Editor.asyncManager.start(fnSave,fnCallback);
};





vp.studio.ui.saveToPortfolio=function $vpfn_3zSlAMLGz7o48RgE3mQbJg50$31(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.generateDocumentName();

Editor.asyncManager.start(Editor.saveToPortfolio,fnCallback);
};

vp.studio.ui.saveAsEnterprisePartnerTemplate=function $vpfn_E9uXvG$40zqakCqdNX1J$w58$47(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncManager.start(Editor.saveAsEnterprisePartnerTemplate,fnCallback);
};








vp.studio.ui.validateApprovalCheckBox=function $vpfn_lursEnE_ZuvWwJow_JsKyQ70$40(sWarningMsg)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bValidated=true;

var oCheckBox=document.getElementById("approvalCheckBox");
if(oCheckBox!==null&&!oCheckBox.checked)
{
if(vp.studio.instrumentation)
{
vp.studio.instrumentation.add("Approval Validation Failed");
}

if(sWarningMsg!==null&&typeof(sWarningMsg)!="undefined")
{
alert(sWarningMsg);
}
else
{
vp.dialog.get("approvalAlertErrorMessage").open();
oCheckBox.focus();
}

bValidated=false;
}


return bValidated;
};






vp.studio.ui.isThisLastPageInStudio=function $vpfn_nHXr_XXmcFoZZnoFdGBoEw104$38()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.pageNumber==1&&
(Editor.getPageInfo(2).comboId||Editor.getPageInfo(2).icParts))
{
return false;
}

if(Editor.isFoldedThreePageProduct)
{
if(Editor.pageNumber==2||Editor.pageNumber==3)
{
return true;
}
}

return(Editor.pageNumber==1&&!Editor.isTwoPageMode)||
Editor.pageNumber==Editor.numberOfDocumentPages;
};







vp.studio.ui.disableDocumentValidation=false;






vp.studio.ui.showValidationErrorsDialog=function $vpfn_R6PsIL5vkMYyMktLMXks2g138$42(callback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!callback){
callback=function(){
};
}

if(Editor.validationErrorData!==null){
vp.validation.showError(callback);
}else{

callback();
}
};





vp.studio.ui.saveAndValidate=function $vpfn_aUNUAYSv$G3Qy1cPHlgYXQ156$31(fnGoNext)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!fnGoNext)
{
fnGoNext=function(){};
}

if(!vp.studio.ui.disableDocumentValidation)
{

Editor.setDocumentChanged(true);
}




var fnCallback=function $vpfn_A3bONO1SyYY$TIAP7$hHoQ172$21(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.hideProgressBar();

vp.studio.ui.showValidationErrorsDialog(fnGoNext);
};

vp.studio.ui.save(fnCallback);
};





vp.studio.ui.forceGoToMPSO=function $vpfn_S7MyxT0huuvDhSq1MTIQpw185$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sQsParams="goPostStudio=1";

vp.web.setUrlHashData("clearcache",1);

if(Editor.shopperKitId>0){
sQsParams=sQsParams+"&shopper_kit_id="+Editor.shopperKitId;
}
var fnGoNext=function $vpfn_IArdFTAlE6ulT48IkW9b7g194$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.goToPage(1,sQsParams);
};

vp.studio.ui.saveAndValidate(fnGoNext);
};




vp.studio.ui.validateAndGoNext=function $vpfn_bmmh3gh5ye0UmGdmTZXT0A205$33(pageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sQsParams="";

var isLastPage=vp.studio.ui.isThisLastPageInStudio();

if(isLastPage)
{
sQsParams="goPostStudio=1";


vp.web.setUrlHashData("clearcache",1);

if(Editor.shopperKitId>0)
{
sQsParams=sQsParams+"&shopper_kit_id="+Editor.shopperKitId;
}

if(!vp.studio.ui.validatePlaceholders())
{
return;
}
}


if(Editor.isStamp&&!vp.smartlayout.ui.validateStamp())
{
return;
}

if(!vp.studio.ui.validateApprovalCheckBox())
{
return;
}

var fnGoNext=function $vpfn_IArdFTAlE6ulT48IkW9b7g240$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.shopperKitId>0&&Editor.isInKitMode)
{
if(sQsParams&&(sQsParams.length>0))
{
sQsParams=sQsParams+"&";
}
sQsParams=sQsParams+"shopper_kit_id="+Editor.shopperKitId+"&is_kit_mode="+Editor.isInKitMode;
}

if(Editor.isFacebookHolidayCardPathEnabled)
{
Editor.goToFacebookPage();
}
else if(Editor.showBacksideGallery)
{
Editor.goToBacksideGallery();
}
else
{
Editor.goToPage(pageNumber,sQsParams);
}
};

vp.studio.ui.saveAndValidate(fnGoNext);
};





vp.studio.ui.saveAndCheckForTypo=function $vpfn_zSnOw5vPMUi2vpN8x2zwWA272$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.typoValidationRequestedByUser=true;

var fnGoNext=function $vpfn_IArdFTAlE6ulT48IkW9b7g276$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
alert(JSLM_SpellCheckComplete);
};

if(vp.studio.instrumentation)
{
vp.studio.instrumentation.add("typocheck");
}

vp.studio.ui.saveAndValidate(fnGoNext);
};





vp.studio.ui.validatePlaceholders=function $vpfn_MapeF4_bvgRt549CxXztNA293$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bValidate=true;

if(vp.studio.ui.disableDocumentValidation)
{
return true;
}

if(Editor.placeholdersExistOnOtherPages&&!(Editor.pageNumber==2&&Editor.isFoldedThreePageProduct))
{
bValidate=false;
}
else
{

var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(Editor.items[i].type==DOCITEM_TYPE_PLACEHOLDER)
{
bValidate=false;
}
}
}

if(!bValidate&&!Editor.cancelMessageDisabled)
{
alert(JSLM_StudioPlaceholderInDocWarning);
return false;
}

return true;
};

vp.studio.ui.changePage=function $vpfn_yZf0IlF9TkvDzkV6mUxYsg328$26(iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.changePageTimer)
{
clearTimeout(Editor.changePageTimer);
}
var callback=function $vpfn_3H9Ya_vtXx85yDx7q6vWkw334$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.changePage(iPageNumber);
};
Editor.changePageTimer=window.setTimeout(callback,100);
};






vp.studio.ui.goToPage=function $vpfn_hqUtnfFc_1OspNTJkjUyRQ346$24(iPageNumber,sExtraQSParams){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
trackPageNavigationClick(iPageNumber);


if(iPageNumber==2&&Editor.showBacksideGallery){
Editor.save(Editor.goToBacksideGallery,false,false,false);
}
else{
Editor.asyncActions.goToPage(iPageNumber,sExtraQSParams);
}

};

var trackPageNavigationClick=function $vpfn_kYmevrAFiki2HLKuToLUVA359$31(iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var data="";
if(iPageNumber==1)
{
data="GoToFrontsideClicked";
}
else if(iPageNumber==2)
{
data="GoToBacksideClicked";
}
else
{
data="GoToPage"+iPageNumber+"Clicked";
}
vp.studio.instrumentation.add(data);
};

var toggleDisplayOnArrayElements=function $vpfn_Sicqoyjai7yaQtg8nj8IeA377$35(aElements,sDisplay)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var iArrayIndex=0;iArrayIndex<aElements.length;iArrayIndex++)
{
var oElement=vp.ui.get(aElements[iArrayIndex]);
if(oElement)
{
oElement.style.display=sDisplay;
}
}
};




vp.studio.ui.upgradeToAdvanced=function $vpfn_e09DQN0_5XE7ljz_ZL6uyg392$33(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



var oButton=document.getElementById("divAdvancedButton");
if(!oButton)
{
oButton=document.getElementById("divAdvancedButtonDesignTips");
}
if(!oButton)
{
oButton=$(".advanced-editing-callout")[0];
}



if(oButton&&!Editor.cartItemId)
{
oButton.style.display="none";



oButton.style.visibility="hidden";
}


var aDisplayBlockElementIds=new Array("divEditorPageSelector",
"divOptionalOptions",
"divOptionalOptionsHeading",
"divSaveButton",
"divOrderPDFProofButton",
"divSmartLayoutTopSpacer",
"divLayersLink",
"divDesignTipsButtons",
"divStudioHubBonusOfferAdvancedHeader"
);

toggleDisplayOnArrayElements(aDisplayBlockElementIds,"block");


var aDisplayBlankElementIds=new Array(
"tdNeedAssistance"
);
toggleDisplayOnArrayElements(aDisplayBlankElementIds,"");

var oSectionTitle=document.getElementById("spnSectionTitle");
var oSectionTitleAdvanced=document.getElementById("spnSectionTitleAdvanced");
if(oSectionTitle&&oSectionTitleAdvanced)
{
vp.ui.expandAndCollapse(oSectionTitleAdvanced,oSectionTitle);
}

var oClearTextButton=document.getElementById("clearDefaultTextButton");
if(oClearTextButton)
{
vp.ui.setStyle(oClearTextButton,{"float":"left"});
}

if(typeof(fnCallback)=="function")
{
var fnCallbackWrapper=function $vpfn_GRrTHO_nLwJl2nC_INFBdA453$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
fnCallback();
Editor.onupgradecomplete.removeHandler(fnCallbackWrapper);
};

Editor.onupgradecomplete.addHandler(fnCallbackWrapper);
}

Editor.upgradeToAdvanced();
};





vp.studio.ui.addCopyLibrary=function $vpfn_W0asM2preYiHBAYKa3201Q469$30(iDefaultCategoryId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var upgradeCompletedCallback=function $vpfn_ltsTMKbd4A6v6DLvuKTVhA471$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.decorate(vp.studio.CopyLibrary.Decorator);
if(iDefaultCategoryId>0)
{
Editor.showProgressBar();
Editor.getCopyEntriesByIndustry(iDefaultCategoryId,Editor.hideProgressBar);
}
};

if(Editor.isAdvanced)
{
upgradeCompletedCallback();
}
else
{
Editor.onupgradecomplete.addHandler(upgradeCompletedCallback);
}
};




vp.studio.ui.openMarketingTipsDialog=function $vpfn_b2AkIYhHFUOjMhziq05ZFA494$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDialog=new vp.dialog.PopupDialog(
"marketingTips",
{top:0,left:0,width:500,height:700},
"/studio/marketing-tips.aspx",
false);

oDialog.scrollable=true;
oDialog.resizable=true;
oDialog.open();

vp.studio.instrumentation.add("open-marketing-tips-dialog");
};




vp.studio.ui.openGalleryDialog=function $vpfn_d958E0s3U0XLMka_zhSrsg512$33(iProductGroupId,iDefaultCategoryId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("open-gallery-pop");

var oUrl=new vp.web.URL("/gallery-pop.aspx");
oUrl.setItem("pf_id",Editor.galleryExtendedPfId);
oUrl.setItem("pg",iProductGroupId);
oUrl.setItem("xnav","switchStudioDesign");

var iCallbackId=vp.win.createCallbackHandler(Editor.asyncActions.changeCombo);
oUrl.setItem("callback_id",iCallbackId);

if(iDefaultCategoryId&&iDefaultCategoryId>0)
{
oUrl.setItem("category_id",iDefaultCategoryId);
}

vp.dialog.IFrameDialog.open(
"chooseDesign",
JSLM_StudioChooseAnotherDesignLink,
oUrl.toString(),
vp.dialog.chrome.Primary,
950,
600,
{scrollType:DIALOG_SCROLL_TYPE_NO});

};





vp.studio.ui.changeBacksideColor=function $vpfn_Xir$4fBl2F4ksrZdoO_ltg544$35(sValue,bRegenUI)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.changeBacksideColor(sValue,bRegenUI);
};





vp.studio.ui.changePageColorization=function $vpfn_RGhPAzmUBPnKevVgLV7Wgw553$38(sValue,bRegenUI,fnCallback,iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.changePageColorization(sValue,bRegenUI,fnCallback,iPageNumber);
};





vp.studio.ui.getBacksideRadioGroup=function $vpfn_sW$KyxKnL0$117jMZ1ea_w562$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.forms.getRadioGroup("radBackside");
};















vp.studio.ui.showBackSideGallery=function $vpfn_1tIu5IYPyJTxaZPOIBOaMQ581$35(iDocPageNum,galleryOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("openbacksidegallery");

galleryOptions=galleryOptions||{};

var oURL=new vp.web.URL(EditorConst.backsideGalleryURL);

var iCallbackId=0;
if(galleryOptions.warningText)
{
var fnCallback=function $vpfn_A3bONO1SyYY$TIAP7$hHoQ592$25(sComboHash,iComboId,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(confirm(galleryOptions.warningText))
{
vp.studio.ui.selectBackside(sComboHash,iComboId,oOptions);
}
};

iCallbackId=vp.win.createCallbackHandler(fnCallback);
}
else
{
iCallbackId=vp.win.createCallbackHandler(vp.studio.ui.selectBackside);
}

oURL.setItem("callback_id",iCallbackId);

if(typeof(galleryOptions.showColorOptions)!==undefined)
{
oURL.setItem("show_color_options",galleryOptions.showColorOptions);
}
else
{
oURL.setItem("show_color_options",iDocPageNum!=Editor.pageNumber);
}


oURL.setItem("document_page",iDocPageNum);


if(Editor.getPageInfo(iDocPageNum).pfid)
{
oURL.setItem("pf_id",Editor.getPageInfo(iDocPageNum).pfid);
}


oURL.setItem("ssc",Editor.substrateColor);


oURL.setItem("mini",galleryOptions.miniPreviewVersion?"1":"0");



var oGroup=vp.studio.ui.getBacksideRadioGroup();
if(galleryOptions.showGrayscaleGallery||(oGroup&&vp.forms.getValue(oGroup)==="gray"))
{

oURL.setItem("color_options","grayscale");
}


if(Editor.singleProductBundleId>0)
{
oURL.setItem("spb_id",Editor.singleProductBundleId);
}

if(Editor.pageNumber===1)
{


oURL.removeItem("combo_id");
oURL.removeItem("combo");

if(Editor.comboID>0)
{
oURL.setItem("combo_id",Editor.comboID);
}
else
{
oURL.setItem("combo",Editor.icParts);
}

oURL.setItem("dominant_image_id",Editor.dominantImageID);
oURL.setItem("image_list",Editor.imageList);
oURL.setItem("font_scheme_id",Editor.fontSchemeID);
oURL.setItem("color_scheme_id",Editor.colorSchemeID);
}

if(Editor.enterprisePartnerTemplateID>0)
{
oURL.setItem("ep_template_id",Editor.enterprisePartnerTemplateID);
}


return vp.dialog.IFrameDialog.open("backsideGallery",EditorConst.backsideGalleryTitle,oURL.toString(),vp.dialog.chrome.Primary,800,600,{scrollType:DIALOG_SCROLL_TYPE_NO});
};





vp.studio.ui.selectBackside=function $vpfn_SevH6kAB6i4SQm_vHSzTwQ683$30(sComboHash,iComboId,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


Editor.backsideMiniPreviewColor=oOptions.color;

if(sComboHash||iComboId)
{
if(oOptions.page!=Editor.pageNumber)
{
vp.studio.ui.changePageContent(oOptions.page,sComboHash,iComboId,oOptions);
vp.analytics.logAction("backside-pop");
}
else
{


Editor.asyncActions.changeCombo(sComboHash,iComboId,oOptions);
vp.analytics.logAction("backside-view-designs");
}

if(iComboId===Editor.comboID||sComboHash===Editor.icParts)
{

vp.studio.instrumentation.add("Studio_user_selected_front_as_back");
}




if(oOptions.page==Editor.pageNumber
&&iComboId===Editor.comboID
&&sComboHash===Editor.icParts)
{

if((typeof(oOptions.color)!="undefined")&&oOptions.color!=Editor.pageColorization)
{
Editor.changePageColorization(oOptions.color);
}
}
}

if(Editor.features.backsideSelectorGoToBackside&&oOptions.page!=Editor.pageNumber)
{

var fnGoToDesiredPage=function $vpfn_iLOlK3f2jMELrVWMP9NURQ728$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.goToPage(this.iDocPage,oOptions.extraQSParams);
}
.getClosure(
{
iDocPage:oOptions.page
});

window.setTimeout(fnGoToDesiredPage,1);
}
};














vp.studio.ui.changePageContent=function $vpfn_UaShZkqZGoW6xsgeLf3iXw754$33(iPageNumber,sIcParts,sComboID,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnExec=function $vpfn_q26qSFRP$GqHMbx3RDC4YA756$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sComboID!==null)
{
Editor.getPageInfo(iPageNumber).comboId=sComboID;
}
if(sIcParts!==null)
{
Editor.getPageInfo(iPageNumber).icParts=sIcParts;
}

var sPreviewSrc="";
if(oOptions)
{
if(oOptions.color)
{
Editor.getPageInfo(iPageNumber).miniPreviewColor=oOptions.color;
}
if(oOptions.categoryId)
{
Editor.getPageInfo(iPageNumber).categoryId=oOptions.categoryId;
}
if(oOptions.languageId)
{
Editor.getPageInfo(iPageNumber).comboLanguageId=oOptions.languageId;
}

sPreviewSrc=oOptions.previewUrl;
}
Editor.getPageInfo(iPageNumber).previewSrc=sPreviewSrc;
Editor.getPageInfo(iPageNumber).setByUser=true;
Editor.setDocumentChanged(true);
var imgBacksidePreview=document.getElementById("imgBacksidePreview");
if(imgBacksidePreview)
{
imgBacksidePreview.src=sPreviewSrc;
}
var oTitle=document.getElementById("backsideSelectorTitle");
if(oTitle)
{
oTitle.innerHTML=oTitle.getAttribute("selected-title");
}

if(oOptions.callback)
{
oOptions.callback();
}
};

window.setTimeout(fnExec,1);
};

vp.studio.ui.getImageReplacementSmartCrop=function $vpfn_PMhUaDJgj5_81Fe_2z2iJg808$44(oOrigImage,oNewImage,oNewImageInfo)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNewImage.type!==DOCITEM_TYPE_UPLOADED_IMAGE&&oNewImage.type!==DOCITEM_TYPE_LIBRARY_IMAGE)
{
return null;
}


var oNewImageSize={top:0,
left:0,
width:oNewImageInfo.intrinsicWidth,
height:oNewImageInfo.intrinsicHeight
};


var oContainerSize={top:0,
left:0,
width:oOrigImage.coordinates.getRectPrecise().width,
height:oOrigImage.coordinates.getRectPrecise().height
};

var iRotation=oNewImage.coordinates.rotation.angleInDegrees;


if(iRotation&&(iRotation==90||iRotation==270))
{
oContainerSize={top:0,
left:0,
width:oOrigImage.coordinates.getRectPrecise().height,
height:oOrigImage.coordinates.getRectPrecise().width
};
}


var oSmartCrop=vp.image.getAutoPlacedImageCrop(oNewImageSize,oContainerSize,oNewImage.cropInfo);

return oSmartCrop;
};















vp.studio.ui.addOrReplaceImage=function $vpfn_xQgcGMexbCynxlOrHnlDsA861$33(sContainerId,eImageType,iImageId,fAspectRatio,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
switch(eImageType)
{
case vp.image.Type.Library:
case vp.image.Type.Upload:
var isImageValid=true;


if(!Editor.photosUploadSupportedFeatures.allowPhotoUploads){
var image=vp.image.imageDataStorage.getImage(iImageId,eImageType);
isImageValid=!(image&&image.isPhoto);
}

if(isImageValid){

vp.studio.ui.addAndCropImage(sContainerId,eImageType==vp.image.Type.Library?"image":"upload",iImageId,fAspectRatio);
}else{
var dialog=vp.dialog.get("photosNotAllowedErrorDialog");
if(dialog){
dialog.open();
}
}
break;
case vp.image.Type.Logo:

vp.studio.ui.addOrReplaceLogo(sContainerId,iImageId);
break;
case vp.image.Type.Caricature:

vp.studio.ui.addCaricature(iImageId,sName?sName:"");
break;
default:
throw"vp.studio.ui.addOrReplaceImage: unknown image type";
}
};

vp.studio.ui.addOrReplaceImage2=function $vpfn_xsPPPnYOTYfFbFDhKCGWYQ898$34(sContainerId,iDocItemType,iImageId,oCropInfo,vExtraData,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
switch(iDocItemType)
{
case DOCITEM_TYPE_LIBRARY_IMAGE:
case DOCITEM_TYPE_UPLOADED_IMAGE:
if(sContainerId)
{
vp.studio.ui.changeImage(
sContainerId,
iDocItemType,
iImageId,
oCropInfo,
vExtraData,
iRotationAngle);
}
else
{
vp.studio.ui.addImage(
iDocItemType,
iImageId,
oCropInfo,
vExtraData,
iRotationAngle);
}
break;
case DOCITEM_TYPE_LOGO:

vp.studio.ui.addOrReplaceLogo(sContainerId,iImageId);
break;
case DOCITEM_TYPE_CARICATURE:

vp.studio.ui.addCaricature(
iImageId,
vExtraData?vExtraData:"");
break;
default:
throw"vp.studio.ui.addOrReplaceImage: unknown image type";
}
};

vp.studio.ui.openMyImagesDialog=function openMyImages()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var warning=window.onbeforeunload;
window.onbeforeunload=null;

var uploadCallback=function upCallback(iImageId,iDocItemType,oCropInfo,iRotation)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("pbcUploadTest:prevImage");


vp.studio.ui.replaceFullBleedImage(iImageId,iDocItemType,oCropInfo,iRotation);


window.onbeforeunload=warning;
};uploadCallback._vpfn='$vpfn_NxlUUdrkYAPDk8HWbLv9Uw945$25';

vp.upload.openMyImages(uploadCallback,null,null);
};vp.studio.ui.openMyImagesDialog._vpfn='$vpfn_E_lnJS3DwNE5VxBfl3Jo4Q939$34';





vp.studio.ui.replaceFullBleedImageFromUpload=function replaceFullBleedImageFromUpload(oUploadResult)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oUploadResult.cancel)
{

}
else if(oUploadResult.error)
{

vp.upload.showErrorDialog(oUploadResult);
}
else if(oUploadResult.success)
{

vp.studio.instrumentation.add("pbcUploadTest:upload");

vp.studio.ui.replaceFullBleedImage(oUploadResult.success.images[0].id,DOCITEM_TYPE_UPLOADED_IMAGE);
}
};vp.studio.ui.replaceFullBleedImageFromUpload._vpfn='$vpfn_NQ7aXzp45T$zj9m6qM4klg963$47';








vp.studio.ui.replaceFullBleedImage=function $vpfn_VoW8ed3nwgmujXkS$5OZwA990$37(iImageId,iDocItemType,oCropInfo,iRotation)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(typeof(iDocItemType)=="undefined")
{
iDocItemType=DOCITEM_TYPE_UPLOADED_IMAGE;
}


var currentImage;
var aPlaceholders=Editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER);

if(aPlaceholders)
{

for(var iPlaceholderIndex=0,l=aPlaceholders.length;iPlaceholderIndex<l;iPlaceholderIndex++)
{

if(aPlaceholders[0].id)
{
currentImage=aPlaceholders[0];
break;
}
}
}


if(!currentImage)
{
var aUploads=Editor.getItemsByType(DOCITEM_TYPE_UPLOADED_IMAGE);
if(aUploads)
{

for(var iUploadsIndex=0,t=aUploads.length;iUploadsIndex<t;iUploadsIndex++)
{

if(aUploads[0].id)
{
currentImage=aUploads[0];
break;
}
}
}
}

if(currentImage)
{
vp.studio.ui.addOrReplaceImage(currentImage.id,vp.image.StudioDocItemTypeToImageType(iDocItemType),iImageId,oCropInfo,null,iRotation);
}
};






vp.studio.ui.addOrReplaceLogo=function $vpfn_Ritq5cLCOla4hTl0WG0iOw1046$32(sImgId,iImgItemId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oImg=null;
if(sImgId)
{
oImg=Editor.getItemByID(sImgId);
}

if(oImg)
{
vp.studio.ui.changeImage(oImg.id,DOCITEM_TYPE_LOGO,iImgItemId,null,null);
}
else
{
vp.studio.ui.addImage(DOCITEM_TYPE_LOGO,iImgItemId,null,1);
}
};







vp.studio.ui.addOrReplaceMap=function $vpfn_0z9f6Zo8mD6H2KvcXl449w1070$31(sId,oMapData,oMapAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oItem=sId?Editor.getItemByID(sId):null;


var oCmd=new vp.studio.commands.AddMap(oMapData,oMapAddress,oItem);




Editor.history.add(oCmd);
oCmd.execute();
};






vp.studio.ui.openMapDialog=function $vpfn_$h5JvFlh$kCCSMkrRZRGFw1090$29(sId,oHostDialog)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oImage=sId?Editor.getItemByID(sId):null;


var sPfid=Editor.PFID;

var iProductKitId=Editor.productKitId>0?Editor.productKitId:Editor.singleProductBundleId;


var fnMapCb=function $vpfn_iLOlK3f2jMELrVWMP9NURQ1101$18(oMapData,oMapAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.addOrReplaceMap(this.img?this.img.id:null,oMapData,oMapAddress);
}.getClosure({img:oImage});


if(oImage&&oImage.type===DOCITEM_TYPE_MAP)
{

vp.maps.openEditDialog(oHostDialog,fnMapCb,sPfid,oImage.mapData,oImage.mapAddress,oImage.locked,iProductKitId);
}
else if(oImage&&DOCITEM_IMAGE_TYPES.contains(oImage.type))
{

vp.maps.openAddDialog(oHostDialog,fnMapCb,sPfid,oImage.coordinates.getAspectRatio(),oImage.locked,iProductKitId);
}
else
{

vp.maps.openAddDialog(oHostDialog,fnMapCb,sPfid,null,null,iProductKitId);
}


vp.studio.instrumentation.add("openmapdialog");
};






vp.studio.ui.openComplexQrCodeDialog=function $vpfn_zg_kKO_1V3125Fo6wvgFdQ1132$39(sId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oImage=sId?Editor.getItemByID(sId):null;


var sPfid=Editor.PFID;

var iProductKitId=Editor.productKitId>0?Editor.productKitId:Editor.singleProductBundleId;


var fnQrCodeCb=function $vpfn_iLOlK3f2jMELrVWMP9NURQ1143$21(oComplexQrCode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.addOrReplaceQrCode(this.img?this.img.id:null,oComplexQrCode);
}.getClosure({img:oImage});


if(oImage&&oImage.type===DOCITEM_TYPE_COMPLEX_QR_CODE)
{
var complexQrCodeContainer={};
complexQrCodeContainer.url=oImage.qrCode.url;
complexQrCodeContainer.compressedUrl=oImage.qrCode.compressedUrl;
complexQrCodeContainer.caption=oImage.caption.value;

vp.complexQrCodes.openEditDialog(fnQrCodeCb,sPfid,complexQrCodeContainer,oImage.locked,iProductKitId);
}
else if(oImage&&DOCITEM_IMAGE_TYPES.contains(oImage.type))
{

vp.complexQrCodes.openAddDialog(fnQrCodeCb,sPfid,oImage.coordinates.getAspectRatio(),oImage.locked,iProductKitId);
}
else
{

vp.complexQrCodes.openAddDialog(fnQrCodeCb,sPfid,null,null,iProductKitId);
}


vp.studio.instrumentation.add("opencomplexqrcodedialog");
};






vp.studio.ui.addOrReplaceQrCode=function $vpfn_zGhS5kWUGD9gZUW5elnExg1178$34(sId,oComplexQrCode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oItem=sId?Editor.getItemByID(sId):null;


var oCmd=new vp.studio.commands.AddComplexQrCode(oComplexQrCode,oItem);


Editor.history.add(oCmd);
oCmd.execute();
};

vp.studio.ui.openEditArrowDialog=function $vpfn_f20URj5LXDKt_yJtJLCVAA1190$35(oArrow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDialog=new vp.dialog.IFrameDialog(
"ArrowDialog",
{width:400,height:200},
null);
oDialog.options.title=oArrow&&oArrow.id?JSLM_StudioArrowEditorDialogTitleEditExisting:JSLM_StudioArrowEditorDialogTitleCreateNew;
oDialog.chrome=vp.dialog.chrome.Primary;

var sUrl="/vp/ns/studio/arrow_editor.aspx";
if(oArrow)
{
if(oArrow.id)
{
sUrl+="?id="+oArrow.id;
}
else
{
sUrl+="?from="+oArrow;
}
}
oDialog.open(sUrl);

vp.studio.instrumentation.add("openarrowdialog");
};

vp.studio.ui.addArrow=function $vpfn_Py25KsCKY$OxN0YyCEHAIA1216$24(vColor,iRotationAngle,oExistingArrow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oColor=new vp.color.Color(vColor);

var fnCreateCommand;

if(oExistingArrow)
{
fnCreateCommand=function $vpfn_mSSZC4posjcNuvlgc1omlg1225$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new vp.studio.commands.ChangeArrow(oExistingArrow,oColor,iRotationAngle);
};
}
else
{
fnCreateCommand=function $vpfn_mSSZC4posjcNuvlgc1omlg1232$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new vp.studio.commands.AddArrow(oColor,iRotationAngle);
};
}

var fnAction=function $vpfn_UBzpnzldqRWCtAkkQJrTsQ1238$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCmd=fnCreateCommand();
Editor.history.add(oCmd);
oCmd.execute();
};



if(!Editor.isAdvanced)
{
vp.studio.ui.upgradeToAdvanced(fnAction);
}
else
{
fnAction();
}
};

vp.studio.ui.changeTable=function $vpfn_hb1SSDbhXY_vqBzJwIyCXw1257$27(oTable,oPropertyMap,iDocItemWidth)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCmd;
if(iDocItemWidth)
{


oCmd=new vp.studio.commands.CompoundCommand();

var oSubCommand=new vp.studio.commands.ChangeTable(oTable,oPropertyMap);
oCmd.commands.add(oSubCommand);

var oOriginalRect=oTable.coordinates.getRectPrecise();
var oNewRect=vp.core.shallowCopy(oOriginalRect);
oNewRect.width=iDocItemWidth;

oSubCommand=new vp.studio.commands.Resize(oTable,oOriginalRect,oNewRect);
oCmd.commands.add(oSubCommand);
}
else
{
oCmd=new vp.studio.commands.ChangeTable(oTable,oPropertyMap);
}

Editor.history.add(oCmd);
oCmd.execute();
};

vp.studio.ui.openEditTableDialog=function $vpfn_ml0D53pIdFrbRDVX4cA9Zg1285$35(oTable,sTabId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL("/sales/studio/dialogs/tableeditor.aspx");

if(oTable)
{
oUrl.setItem("table_id",oTable.id);
}
if(sTabId)
{
oUrl.setItem("tab_id",sTabId);
}

vp.dialog.IFrameDialog.open(
"TableDialog",
JSLM_StudioTableEditor_DialogTitle,
oUrl.toString(),
vp.dialog.chrome.Primary,
800,550,
{contentLeftMargin:0,contentRightMargin:2}
);

vp.studio.instrumentation.add("opentabledialog");
};

vp.studio.ui.openChangeImageDialog=null;





vp.studio.ui.openChangeImageTool=function $vpfn_g50HUZ5eyNztAyYB271d4Q1316$35(oImage,iTabIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("openchangeimagetool");


if(oImage&&oImage.type===DOCITEM_TYPE_PLACEHOLDER&&oImage.placeholderType===PLACEHOLDER_TYPE_ComplexQrCode)
{
vp.studio.ui.openMapDialog(oImage.id);
return;
}

if(vp.dialogs&&vp.dialogs.proxybase)
{
var oDialog=vp.dialogs.proxybase.getProxy("addImageProxy");
if(oDialog)
{
oDialog.imageDataMode=true;
oDialog.bIsSignedIn=Editor.isUserLoggedIn;


oDialog.parameters.showCaricatures=!oImage;

oDialog.parameters.showLogos=Editor.features.showLogoUploads;

oDialog.callback=function $vpfn_seYhgFjw0DkyMwzgTaQEbw1340$31(oSelectedImage)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!Editor.isUserLoggedIn)
{
Editor.isUserLoggedIn=oDialog.bIsSignedIn;
}

if(oSelectedImage=="addmap")
{

vp.studio.ui.openMapDialog(oImage?oImage.id:null);
}
else
{
var sContainerId=oImage?oImage.id:null;
vp.studio.ui.addOrReplaceImage(sContainerId,oSelectedImage.type,oSelectedImage.id,null,null);
}
};

oDialog.launchDialog(iTabIndex||0);
return;
}
}

var oQS=new vp.web.QueryString();
oQS.setItem("pf_id",Editor.PFID);

if(Editor.features.hideImagePopupLibraryLink)
{
oQS.setItem("nolibrary",1);
}

if(oImage)
{

if(oImage.cropInfo&&oImage.type!==DOCITEM_TYPE_PLACEHOLDER)
{
oQS.append(oImage.cropInfo.toQueryString());
oQS.setItem("rcok","yes");
}

oQS.setItem("type",oImage.type);
oQS.setItem("imgId",oImage.getItemID());

var oRect=oImage.coordinates.getRectPrecise();
oQS.setItem("container_aspect_ratio",oRect.width/oRect.height);


oQS.setItem("ph",oImage.id);


oQS.setItem("rotation",oImage.coordinates.rotation.angleInDegrees/90);
oQS.setItem("display_angle_in_degrees",oImage.coordinates.rotation.displayAngleInDegrees);

oQS.setItem("existing","true");
}



oQS.setItem("ib","yes");
oQS.setItem("ibs","yes");
oQS.setItem("nologo",(Editor.features.showLogoUploads)?0:1);

oQS.setItem("uploadcallback",vp.win.createCallbackHandler(vp.studio.ui.addImage2Wrapper));

vp.studio.ui.openDialog(
"ImageLibraryDialog",
"",
"/vp/ns/addimage2.aspx?"+oQS.toString(),
vp.dialog.chrome.Primary,
440,
340);
};

vp.studio.ui.addImage2Wrapper=function $vpfn_6XoWDqLAjVts_5kc0lpq5Q1415$32(imageId,imageType,uploaderDialog,placeholderId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
uploaderDialog.close();
vp.studio.ui.addAndCropImage(placeholderId,imageType,imageId);
};

vp.studio.ui.openCopyLibraryDialog=function $vpfn_JIuuFqUNiysS65LHnxiJwg1421$37(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL("/sales/studio/dialogs/copylibrary.aspx");

if(oDocItem)
{
oUrl.setItem("doc_item_purpose",oDocItem.purposeName);

oUrl.setItem("doc_item_label",DOCITEM_TEXT_TYPES.contains(oDocItem.type)?oDocItem.label:"Text");
}

var aPurposeNames=Editor.getCopyLibraryDocItems().map(function $vpfn_iLOlK3f2jMELrVWMP9NURQ1432$60(oItem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return oItem.purposeName;});
oUrl.setItem("all_items",aPurposeNames.join(","));

vp.dialog.IFrameDialog.open(
"CopyLibraryDialog",
JSLM_StudioWritingWizardDialogTitle,
oUrl.toString(),
vp.dialog.chrome.Tabbed,
820,550);

vp.studio.instrumentation.add("opencopylibrarydialog");
};




vp.studio.ui.openDialog=function $vpfn_AgLxvc8EiU_KbuSSr2UVDA1448$26(sName,sTitle,sURL,oSkin,iWidth,iHeight,oOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL(sURL);
oUrl.setItem("nopop","1");

return vp.dialog.IFrameDialog.open(sName,sTitle,oUrl.toString(),oSkin,iWidth,iHeight,oOptions);
};

vp.studio.ui.openShapePropertiesWin=function $vpfn_P_Fix5Tl6MAEj_G0sl7Fjg1456$38(oShape)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isCCTAgent)
{

vp.studio.instrumentation.add("openchangeshape");

var oQS=new vp.web.QueryString();
oQS.setItem("shape_id",oShape.id);

vp.win.openCentered("/vp/ns/studio/shape_editor.aspx?"+oQS.toString(),"_blank",400,370,true,true);
}
};





function ChooseCaricature(iItemID,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var fnExec=function $vpfn_iLOlK3f2jMELrVWMP9NURQ1478$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.addCaricature(this.itemID,this.name);
}
.getClosure(
{
itemID:iItemID,
name:sName
}
);

window.setTimeout(fnExec,1);
}ChooseCaricature._vpfn='$vpfn_lgmbZz1dgtnWzxCDPiZHLg1474$0';






vp.studio.ui.addCaricature=function $vpfn_ZMp6Bwys8l4FaaN52ijMWw1497$29(iItemID,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addcaricature");

var oCmd=new vp.studio.commands.AddCaricature(iItemID,sName);
oCmd.execute();
Editor.history.add(oCmd);
};









vp.studio.ui.addImage=function $vpfn_Y57bhWRWhIGcwo2PEVEydg1514$24(iDocItemType,iItemID,oCropInfo,fAspectRatio,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addimage-type"+iDocItemType);

var oCmd=new vp.studio.commands.AddImage(iDocItemType,iItemID,oCropInfo,fAspectRatio,iRotationAngle);
oCmd.execute();
Editor.history.add(oCmd);

return oCmd.image;
};

vp.studio.ui.addImageCropped=function $vpfn_uSySao16j4vNXDLL4j6zkQ1525$31(cropResult)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCmd;
if(cropResult.destination)
{
var oImg=Editor.getItemByID(cropResult.destination);
oCmd=new vp.studio.commands.ChangeImage(oImg,
cropResult.ImageType,
cropResult.ImageId,
cropResult.Crop,
cropResult.AspectRatio,
cropResult.Rotation);
}
else
{
oCmd=new vp.studio.commands.AddImage(cropResult.ImageType,cropResult.ImageId,cropResult.Crop,cropResult.AspectRatio,cropResult.Rotation);
}
oCmd.execute();
Editor.history.add(oCmd);
};







vp.studio.ui.changeShapeProperties=function $vpfn_2ZSjOJF_AXXf9kGgw1HZow1552$37(oShape,oPropertyMap,iRotatedByInDegrees)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("changeShapeProperties");

var oCompoundCmd=new vp.studio.commands.CompoundCommand();
var oCmd=new vp.studio.commands.ChangeProperties(oShape,oPropertyMap);
oCompoundCmd.commands.add(oCmd);
if(iRotatedByInDegrees!==0)
{
oCmd=new vp.studio.commands.Rotate(oShape,iRotatedByInDegrees);
oCompoundCmd.commands.add(oCmd);
}

oCompoundCmd.execute();
Editor.history.add(oCompoundCmd);

};






vp.studio.ui.addLine=function $vpfn_3fQ4sHE38zpjEoOudXgPSQ1575$23(vFillColor,fOpacity)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addline");

var oLine=new vp.studio.Line();
oLine=vp.studio.ui.initializeShape(oLine,vFillColor,fOpacity);


oLine.strokeWeight=1;

oLine.coordinates.setRectPrecise({
top:(Editor.dimensions.height-20)/2,
left:(Editor.dimensions.width-300/Editor.zoomFactor)/2,
width:300/Editor.zoomFactor,
height:20
});

vp.studio.ui.addShapeToDocument(oLine);
};






vp.studio.ui.addRectangle=function $vpfn_Jp7bqZ$hEWK1UWZQgSEg5Q1600$28(vFillColor,fOpacity)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addrect");

var oRect=new vp.studio.Rectangle();
oRect=vp.studio.ui.initializeShape(oRect,vFillColor,fOpacity);

vp.studio.ui.addShapeToDocument(oRect);
};






vp.studio.ui.addOval=function $vpfn_wbqYhFW3YEcYLWnh5CClhQ1615$23(vFillColor,fOpacity)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addoval");

var oOval=new vp.studio.Oval();
oOval=vp.studio.ui.initializeShape(oOval,vFillColor,fOpacity);

vp.studio.ui.addShapeToDocument(oOval);
};






vp.studio.ui.addStarburst=function $vpfn_ohnZciLJcTzgklxcZd8SFw1630$28(vFillColor,iPoints,iPointHeight,iRotation)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("addstarburst");

var oStarburst=new vp.studio.PathShape();
oStarburst.coordSizeWidth=1000;
oStarburst.coordSizeHeight=1000;
oStarburst.pathData=vp.studio.PathShape.getPathForStarburst(
iPoints,iPointHeight,iRotation,oStarburst.coordSizeWidth,oStarburst.coordSizeHeight);

oStarburst=vp.studio.ui.initializeShape(oStarburst,vFillColor,1.0);

var shapeDim=
Editor.dimensions.width>Editor.dimensions.height?
Editor.dimensions.height/2:
Editor.dimensions.width/2;
oStarburst.coordinates.setRectPrecise({
top:(Editor.dimensions.height-shapeDim)/2,
left:(Editor.dimensions.width-shapeDim)/2,
width:shapeDim,
height:shapeDim
});

vp.studio.ui.addShapeToDocument(oStarburst);
};








vp.studio.ui.initializeShape=function $vpfn_qBXu79ebVvkW5MTFWPB_MA1663$31(oShape,vColor,fOpacity)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(vColor)=="undefined")
{
vColor="#FFFFFF";
}
vColor=new vp.color.Color(vColor);
var iColorRef=Editor.colorScheme.indexOf(vColor.toString());

if(typeof(fOpacity)=="undefined")
{
fOpacity=1;
}

oShape.opacity=fOpacity;
oShape.opacity2=fOpacity;
oShape.locked=false;
oShape.fillColor=vColor;
oShape.fillColorRef=iColorRef;
oShape.fillColor2=vColor;
oShape.fillColor2Ref=iColorRef;
oShape.strokeColor=vColor;
oShape.strokeColorRef=iColorRef;
var shapeWidth=Editor.dimensions.width/2;
var shapeHeight=Editor.dimensions.height/2;
oShape.coordinates.setRectPrecise({
top:(Editor.dimensions.height-shapeHeight)/2,
left:(Editor.dimensions.width-shapeWidth)/2,
width:shapeWidth,
height:shapeHeight
});

return oShape;
};





vp.studio.ui.addShapeToDocument=function $vpfn_kZhOtxbL_4PpEgXsh847JA1702$34(oShape)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.assignUniqueID(oShape);

var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);
aImageTypes.append(DOCITEM_SHAPE_TYPES);

oShape.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;

var oSelection=new vp.studio.Selection();
oSelection.add(oShape);

var oCmd=new vp.studio.commands.Create(oSelection);
oCmd.isOffset=true;
oCmd.execute();
Editor.history.add(oCmd);

};














vp.studio.ui.getCropToolURL=function $vpfn_aUBPWXN3Jp6IXi4dSk8VqQ1735$30(iImageID,vImgType,sContainerID,oCropInfo,fContainerAspectRatio,iRotationIndex,fDisplayAngleInDegrees,bShouldDisplayMaintainProportions,fnRotationHandler){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



var iImgType;
if(typeof(vImgType)=="string"){
iImgType=vImgType=="image"?DOCITEM_TYPE_LIBRARY_IMAGE:DOCITEM_TYPE_UPLOADED_IMAGE;
}
else if(typeof(vImgType)=="number"){
iImgType=vImgType;
}

var cropToolUrl=new vp.web.URL("/vp/ns/crop_tool_page.aspx");

cropToolUrl.setItem("imgId",iImageID);
cropToolUrl.setItem("type",iImgType);
cropToolUrl.setItem("skin","1");
cropToolUrl.setItem("ph",encodeURIComponent(sContainerID));
cropToolUrl.setItem("pf_id",Editor.PFID);

if(iRotationIndex){
cropToolUrl.setItem("rotation",iRotationIndex);
}

if(oCropInfo){
cropToolUrl.setItem("croptop",oCropInfo.top);
cropToolUrl.setItem("cropleft",oCropInfo.left);
cropToolUrl.setItem("cropbottom",oCropInfo.bottom);
cropToolUrl.setItem("cropright",oCropInfo.right);
}

if(fContainerAspectRatio){
cropToolUrl.setItem("container_aspect_ratio",fContainerAspectRatio);
}

if(fDisplayAngleInDegrees){
cropToolUrl.setItem("display_angle_in_degrees",fDisplayAngleInDegrees);
}

if(Editor&&Editor.isFlipbook){
bShouldDisplayMaintainProportions=false;
}

if(bShouldDisplayMaintainProportions!=undefined){
if(bShouldDisplayMaintainProportions){
cropToolUrl.setItem("sdmp","true");
}
else{
cropToolUrl.setItem("sdmp","false");
}
}

if(fnRotationHandler&&typeof fnRotationHandler=="function"){
var iRotateHandler=vp.win.createCallbackHandler(fnRotationHandler);
cropToolUrl.setItem("rchange_handler_id",iRotateHandler);
}

if(Editor.features.isDragAndDropImageEditingEnabled){
cropToolUrl.setItem("skin","1");
}


var iChangeImageHandler=vp.win.createCallbackHandler(
function $vpfn_iLOlK3f2jMELrVWMP9NURQ1798$8(sContainerID,iNewUploadId){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.changeImage(sContainerID,this.iImgType,iNewUploadId);
}.getClosure(
{
"iImgType":iImgType
})
);
cropToolUrl.setItem("change_image_handler_id",iChangeImageHandler);

return cropToolUrl.toString();
};







vp.studio.ui.addAndCropImage=function $vpfn_G2IOfreSs3nndJrqoh$Z2Q1816$31(sImgId,sImgType,iImgItemId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!window.cropDialog)
{
throw new Error("Crop dialog is not present on page");
}

var iImgType=sImgType;
if(sImgType&&typeof(sImgType)=="string")
{
iImgType=sImgType=="image"?DOCITEM_TYPE_LIBRARY_IMAGE:DOCITEM_TYPE_UPLOADED_IMAGE;
}

var oImg=null;
if(sImgId)
{
oImg=Editor.getItemByID(sImgId);
}

vp.studio.instrumentation.add("opencroptool");

if(oImg)
{
window.cropDialog.changeParameters({
ImageId:iImgItemId?iImgItemId:oImg.getItemID(),
ImageType:iImgType?vp.controls.cropDialog.convertImageType(iImgType).toString():vp.controls.cropDialog.convertImageType(oImg.itemTypeString.toLowerCase()).toString(),
CropTop:!iImgItemId?oImg.cropInfo.top:0,
CropRight:!iImgItemId?oImg.cropInfo.right:0,
CropBottom:!iImgItemId?oImg.cropInfo.bottom:0,
CropLeft:!iImgItemId?oImg.cropInfo.left:0,
AspectRatio:oImg.coordinates.getAspectRatio(),
Rotation:!iImgItemId?oImg.coordinates.rotation.angleInDegrees:0,
destinationId:oImg.id,
DisableUnlocking:oImg.locked||Editor.isFlipbook?true:false
});
window.cropDialog.open(vp.studio.ui.addImageCropped);
}
else
{
window.cropDialog.changeParameters({ImageId:iImgItemId,ImageType:vp.controls.cropDialog.convertImageType(iImgType).toString()});
window.cropDialog.open(vp.studio.ui.addImageCropped);
}
};




vp.studio.ui.showFoilPreview=function $vpfn_1pRKafln8WzM2y_rVPueiQ1863$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("openfoilpreview");

Editor.asyncActions.showFoilPreview();
};




vp.studio.ui.openOrderProofWin=function $vpfn_5dYC0w0k0JOpSHHXKRgx3g1873$33(bAutoOrder)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("StudioDesignOptions_orderPDF_openDialog");


var sOrderProofUrl="http://"+document.location.hostname+"/vp/ns/studio_orderproof.aspx?kit_mode="+(Editor.isInKitMode?"true":"false");
if(bAutoOrder)
{
sOrderProofUrl+="&op=true";
}


if(!Editor.isUserLoggedIn)
{
vp.studio.instrumentation.add("orderproof-login");

Editor.asyncActions.login(null,sOrderProofUrl);
}


else
{
vp.studio.ui.openDialog("orderProofWin","",sOrderProofUrl,vp.dialog.chrome.Primary,450,250);
}
};








vp.studio.ui.applyCrop=function $vpfn_DKe_CxdLNUDCXHMusCkNXA1906$25(sImgID,oCropInfo,oDeltaPercentRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("applycrop");

var oImg=Editor.getItemByID(sImgID);

var oCmd=new vp.studio.commands.Crop(oImg,oCropInfo,oDeltaPercentRect);
oCmd.execute();
Editor.history.add(oCmd);
};







vp.studio.ui.rotate=function $vpfn_JyBTDQgVMxHx56N_PBFXrw1923$22(sImgID,bClockwise)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("rotate");

var oImg=Editor.getItemByID(sImgID);
var iDegrees=bClockwise?90:-90;

var oCmd=new vp.studio.commands.Rotate(oImg,iDegrees);
oCmd.execute();
Editor.history.add(oCmd);
};










vp.studio.ui.changeImage=function $vpfn_cJidLK5u_ORQBMp4t3Lumg1944$27(sImgID,iDocItemType,iItemID,oCropInfo,oDeltaPercentRect,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("changeimage-type"+iDocItemType);




var oImg=Editor.getItemByID(sImgID);

if(oImg)
{


if(Editor.isFullBleed&&oDeltaPercentRect)
{
var oImageInfo=new vp.image.ImageInfo();


var infoCb=function $vpfn_iLOlK3f2jMELrVWMP9NURQ1962$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oNewImageSize={top:0,
left:0,
width:this.oImageInfo.intrinsicWidth,
height:this.oImageInfo.intrinsicHeight
};


var oContainerSize={top:0,
left:0,
width:this.oImg.coordinates.getRectPrecise().width,
height:this.oImg.coordinates.getRectPrecise().height
};


if(this.iRotation&&(this.iRotation==90||this.iRotation==270))
{
oContainerSize={top:0,
left:0,
width:this.oImg.coordinates.getRectPrecise().height,
height:this.oImg.coordinates.getRectPrecise().width
};
}


var oSmartCrop=vp.image.getAutoPlacedImageCrop(oNewImageSize,oContainerSize,this.oCropInfo);



var cmd=new vp.studio.commands.ChangeImage(this.oImg,
this.iDocumentItemType,
this.iImgItemId,
oSmartCrop,
null,
this.iRotation);
cmd.execute();
Editor.history.add(cmd);
}
.getClosure({
oImageInfo:oImageInfo,
oImg:oImg,
iDocumentItemType:iDocItemType,
iImgItemId:iItemID,
iRotation:iRotationAngle,
oCropInfo:oCropInfo
});


var oVpImage=new vp.image.Image(vp.image.StudioDocItemTypeToImageType(iDocItemType),iItemID);


oImageInfo.loadImageInfo(oVpImage,infoCb,infoCb);

return oImageInfo.image;
}
else
{



var oCmd=new vp.studio.commands.ChangeImage(oImg,
iDocItemType,
iItemID,
oCropInfo,
Editor.isFlipbook?null:oDeltaPercentRect,
iRotationAngle);
oCmd.execute();
Editor.history.add(oCmd);

if(Editor.isFlipbook&&oDeltaPercentRect)
{
Editor.regenerateEditorArea();
}

return oCmd.image;
}
}
};







vp.studio.ui.setSubstrateColor=function $vpfn_Yt49VFtQ5m8V8cmlP_08sA2049$33(sColor,oEvent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.substrateColor!=sColor)
{
if(Editor.changeSubstrateColor(sColor))
{

Editor.asyncManager.start(
function $vpfn_iLOlK3f2jMELrVWMP9NURQ2057$16(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.save(fnCallback,false,true,false,true);
},
function $vpfn_iLOlK3f2jMELrVWMP9NURQ2061$16(fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.refreshMiniPreview();
if(window.BacksideMiniPreviewWidget)
{
window.BacksideMiniPreviewWidget.refreshPreview();
var oTitle=document.getElementById("backsideSelectorTitle");
oTitle.innerHTML=oTitle.getAttribute("selected-title");
}
if(Editor.ComboSelector)
{
Editor.ComboSelector.Refresh();
}
});
}
else if(oEvent||document.all)
{
vp.events.cancelEvent(oEvent);
}
}
};







vp.studio.ui.changeColorOverride=function $vpfn_CJnHPq7Qx$8hqY2kcsMhXA2089$35(iColor,oEvent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor&&Editor.colorOverride&&Editor.colorOverride!=iColor)
{
if(Editor.changeColorOverride(iColor))
{
if(Editor.substrateColor&&Editor.colorOverrideSubstrateMap)
{
var substrateColor=null;
for(var i in Editor.colorOverrideSubstrateMap)
{
if(Editor.colorOverrideSubstrateMap[i]==parseInt(iColor))
{
substrateColor=parseInt(i);
break;
}
}
if(substrateColor!==null)
{
Editor.substrateColor=substrateColor;
Editor.refresh();
}
}

var callback=function $vpfn_3H9Ya_vtXx85yDx7q6vWkw2113$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return Editor.ComboSelector&&Editor.ComboSelector.Refresh();
};

Editor.asyncManager.start(function $vpfn_iLOlK3f2jMELrVWMP9NURQ2118$38(fnCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}Editor.save(fnCallback,false,true,false);},callback);
}
else if(oEvent||document.all)
{
vp.events.cancelEvent(oEvent);
}
}
};





vp.studio.ui._getShowPreviewData=function $vpfn_oPI66qlGhQuaPTgeLyFo_Q2131$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isEmbroidery)
{
return{
url:"/studio/zoomed-view-larger.aspx?width=400",
dialogSize:{width:540,height:580}
};
}

return{
url:"/vp/ns/cart/viewlargerdoc.aspx?show_backside=false&width=600&height=600",
dialogSize:{width:680,height:660}
};
};




vp.studio.ui._showPreviewURL=new vp.web.URL("/vp/ns/cart/viewlargerdoc.aspx?show_backside=false&width=600&height=600");



vp.studio.ui.showPreview=function $vpfn_8m$Xype8uHF98tjsSW7WOg2154$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL(vp.studio.ui._getShowPreviewData().url);
oURL.setItem("page_id",Editor.pageNumber);
vp.studio.ui.showPreviewHelper(oURL);
};





vp.studio.ui.showPreviewForMugs=function $vpfn_KkuIZsG7pFjzdjYBoWjc3A2165$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=vp.studio.ui._showPreviewURL;

if(Editor.pageNumber>1&&!oURL.getItem("3drollangle"))
{
oURL.setItem("3drollangle",90);
}
if(!oURL.getItem("page_id"))
{
oURL.setItem("page_id",Editor.pageNumber);
}
vp.studio.ui.showPreviewHelper(oURL);
};

vp.studio.ui.showPreviewHelper=function $vpfn_O61gzTQ9mrYUNtm0jUrxAg2180$33(oURL)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.docID!==0)
{
oURL.setItem("doc_id",Editor.docID);
}
else
{
var sMiniPreview=Editor.getMiniPreviewUrlFromExisting(oURL);

if(sMiniPreview)
{
oURL=new vp.web.URL(sMiniPreview);
}
else if(Editor.icParts)
{
oURL.setItem("combo",Editor.icParts);
oURL.setItem("pfid",Editor.PFID);
}

}

var dialogSize=vp.studio.ui._getShowPreviewData().dialogSize;

var fnCallback=function $vpfn_A3bONO1SyYY$TIAP7$hHoQ2205$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDialog=vp.dialog.IFrameDialog.open(
"viewLarger",
JSLM_ViewLargerPopupTitle,
oURL.toString(),
vp.dialog.chrome.Primary,
dialogSize.width,
dialogSize.height,
{scrollType:DIALOG_SCROLL_TYPE_NO});
};

Editor.asyncManager.start(Editor.save,fnCallback);
};




vp.studio.refreshMiniPreview=function $vpfn_KzAF8h0XSBdbVsXwcphQbA2223$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window.setTimeout(vp.studio._refreshMiniPreviewThread,100);
};




vp.studio._refreshMiniPreviewThread=function $vpfn_AXiESMIZ0tTu5wKHCZJ3cA2231$38()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!Editor||!Editor.documentInitialState)
{




return;
}

var oMiniPreview=document.getElementById("studioMiniPreviewImage");
if(!oMiniPreview)
{

return;
}



if(Editor.PFID===null)
{
return;
}




var oOldUrl=new vp.web.URL(oMiniPreview.src);

var oNewUrl=Editor.getMiniPreviewUrlFromExisting(oOldUrl);


if(typeof(oNewUrl)=="undefined"||null===oNewUrl){

return;
}





oMiniPreview.src=oNewUrl.toString();
};





vp.studio.ui._textSelectionId=null;





vp.studio.ui._textSelectionBookmark=null;




vp.studio.ui.saveTextSelection=function $vpfn_5RhD74ceOIhuU8ZWPE5L8w2291$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var field=Editor.getCurrentField();

if(field&&field.textAreaType===TEXT_AREA_TYPE_RICH)
{
vp.studio.ui._textSelectionId=field.id;

var richTextField=(field.inlineActive)?
field.inlineTextField:
field.externalTextField;

vp.studio.ui._textSelectionBookmark=richTextField.createBookmark();
}
};





vp.studio.ui.restoreTextSelection=function $vpfn_hpF$hxgtyuFaNIMu9XWuSA2311$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fieldId=vp.studio.ui._textSelectionId;
if(fieldId)
{
var field=Editor.getItemByID(fieldId);
if(field)
{
var richTextField=(field.inlineActive)?
field.inlineTextField:
field.externalTextField;

richTextField.restoreFromBookmark(vp.studio.ui._textSelectionBookmark);
}
}

vp.studio.ui._textSelectionId=null;
vp.studio.ui._textSelectionBookmark=null;
};





vp.studio.ui.insertChar=function $vpfn_StRzZvTpFvO$zvKQYyDSsQ2335$26(sChar,range)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oTextArea;
var oTextField;
if(Editor.selection.isTextRange())
{
oTextField=Editor.selection.selectedTextField;
oTextArea=oTextField.inlineTextField;
}
else if(Editor.currentField)
{
oTextField=Editor.currentField;
oTextArea=Editor.currentField.externalTextField;
}
else if(Editor.lastField)
{
oTextField=Editor.lastField;
oTextArea=Editor.lastField.externalTextField;
}

if(oTextArea&&oTextArea.pasteInto)
{
oTextArea.pasteInto(sChar,range);
}
};




vp.studio.ui.initDefaultTextButton=function $vpfn_lq3PBOBfwXKcY$5I1B416A2364$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isLoadComplete)
{
vp.studio.ui.updateDefaultTextButton();
}
else
{
Editor.oninitialrender.addHandler(vp.studio.ui.updateDefaultTextButton);
}

Editor.ondocumentchange.addHandler(vp.studio.ui.updateDefaultTextButton);
};




vp.studio.ui.clearDefaultText=function $vpfn_BaWO4031hr11G5aRlgiwoQ2381$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("cleardefaulttext");

Editor.deleteClickText();
};





vp.studio.ui.updateDefaultTextButton=function $vpfn_02FOPM4xWdIZzs7o0WaXvw2392$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var bIsClickTextVisible=false;

var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
var oItem=Editor.items[i];
if(DOCITEM_TEXT_TYPES.contains(oItem.type)&&oItem.clickText&&oItem.clickText.length>0&&oItem.data==oItem.clickText)
{
bIsClickTextVisible=true;
break;
}
}

if(Editor.features.showUpdatedJPStudio&&document.getElementById("clearDefaultTextLinkEnabled"))
{
vp.ui.expandAndCollapse(
bIsClickTextVisible?"clearDefaultTextLinkEnabled":"clearDefaultTextLinkDisabled",
bIsClickTextVisible?"clearDefaultTextLinkDisabled":"clearDefaultTextLinkEnabled");
}else
{
var clearDefaultTextButtonName="clearDefaultTextButton";

var removeSampleTextElement=$("#removeSampleText");
if(bIsClickTextVisible){
if(removeSampleTextElement.length){

if(removeSampleTextElement.is(":hidden")){
removeSampleTextElement.show();

removeSampleTextElement.nextAll(".verticalDivider:hidden").first().show();
}
}else{

vp.ui.enableTextButton(clearDefaultTextButtonName);
}
}else{
if(removeSampleTextElement.length){
if(removeSampleTextElement.is(":visible")){
removeSampleTextElement.hide();

removeSampleTextElement.nextAll(".verticalDivider:visible").first().hide();
}
}else{

vp.ui.disableTextButton(clearDefaultTextButtonName);
}
}
}
};





vp.studio.ui.setNextButtonEnabled=function $vpfn_gj0GgG4h7dpyjPZEtYDNWQ2449$36(bEnabled)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var btn='imgNextButton';
var btnDisabled='imgNextButtonDisabled';


if(document.getElementById(btn)&&document.getElementById(btnDisabled))
{
if(bEnabled)
{
vp.ui.expandAndCollapse(btn,btnDisabled);
}
else
{
vp.ui.expandAndCollapse(btnDisabled,btn);
}
}
};






vp.studio.ui.preventEditorSelection=function $vpfn_b$XAyHGF0O6m23gNxVJhkQ2473$38(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnCancel=function $vpfn_v62UhqRtO7f8HdU_EBAVYw2474$19(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
if(e.target&&e.target.tagName&&e.target.className)
{
var cancelEventBubble=false;
if(e.target.tagName&&e.target.tagName=="BODY")
{
cancelEventBubble=true;
}
else if(e.target.className&&
(e.target.className.indexOf("page-content-outer-container")>=0||e.target.className.indexOf("page-outer-container")>=0))
{
cancelEventBubble=true;
}
if(cancelEventBubble)
{
vp.studio.util.cancelEventAndBlur(e);
}
}
};

vp.events.add(document,"mousedown",fnCancel);
};

vp.events.addOnDOMLoadHandler(vp.studio.ui.preventEditorSelection);




vp.studio.ui._updateScrollandZoomAreas=function $vpfn_1YxUdxShdiK7obf0DVfMKw2503$41()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oScrollArea=document.getElementById('divStudioDocumentScrollArea');
var oScrollAreaPlaceholder=document.getElementById('divStudioDocumentScrollAreaPlaceholder');

if(oScrollAreaPlaceholder)
{
if(Editor.rulerEnabled)
{
oScrollAreaPlaceholder.style.height=document.getElementById("divStudioDocumentAreaContainer").offsetHeight+18+"px";
}
else
{
oScrollAreaPlaceholder.style.height=oScrollArea.offsetHeight+'px';
}
}




var jPageSelectorArea=$("#divPageSelectorArea");

if(jPageSelectorArea[0])
{
jPageSelectorArea.css("height",oScrollArea.offsetHeight);
}


var oZoomArea=document.getElementById('divStudioDocumentZoomArea');

if(Editor.useSceneOnCanvas)
{
oZoomArea.style.width=Math.round(Editor.sceneDimensions.width*Editor.zoomFactor)+'px';
}
else
{
oZoomArea.style.width=Editor.rulerEnabled?Math.round(Editor.dimensions.width*Editor.zoomFactor+18)+'px':Math.round(Editor.dimensions.width*Editor.zoomFactor)+'px';
}
};




vp.studio.ui.viewLarger=function $vpfn_6OqbFAypvXZDgba65MLN2Q2547$26(bLarger)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("viewlarger");

if(bLarger)
{
Editor.zoomMax();
document.getElementById("spnViewLargerLink").style.display="none";
document.getElementById("spnViewSmallerLink").style.display="";
}
else
{
Editor.zoomMin();
document.getElementById("spnViewSmallerLink").style.display="none";
document.getElementById("spnViewLargerLink").style.display="";
}
};





vp.studio.ui.processDisabledButtonEvent=function $vpfn_n439kFwDJiuPFGDguLYlgw2569$42(e,sButtonId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


switch(sButtonId)
{
case"Bold":
case"Italic":
case"JustifyLeft":
case"JustifyCenter":
case"JustifyRight":
case"ColorPicker":
case"FontSize":
case"FontSelector":
case"BulletedList":
case"NumberedList":
var pop=new vp.studio.InactiveToolBarPop(Editor);
pop.show(e);
break;
default:
break;
}
};




vp.studio.ui.initSaveForLaterButton=function $vpfn_G5yo0SU8mDf5xs_IAxroew2596$38()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!Editor.isSmartLayout)
{


Editor.ondocumentchange.addHandler(vp.studio.ui.updateSaveForLaterButton);
}
};




vp.studio.ui.updateSaveForLaterButton=function $vpfn_k_ZAzsmI7NWAt_AQL_T5iw2609$40()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.enableTextButton("saveForLaterButton");
};




vp.studio.ui.saveForLater=function $vpfn_HWekDt_gCFtodN_d7e1mqg2617$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.save(false,true);

var fnDisable=function $vpfn_dxcPd3CMHVz08eALsr2DvA2621$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.disableTextButton("saveForLaterButton");
};
window.setTimeout(fnDisable,500);
};





vp.studio.ui.setClearAllClickTextOnFocus=function $vpfn_M$tBZT9vNpZ2coy9HyaKxA2632$43()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnClickHandler=function $vpfn_3h0qlR1A0NYmttGN5_V3dg2634$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.deleteClickText();

var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(DOCITEM_TEXT_TYPES.contains(Editor.items[i].type))
{
Editor.items[i].onfocusexternaltext.removeHandler(arguments.callee);
}
}
};

var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(DOCITEM_TEXT_TYPES.contains(Editor.items[i].type))
{
Editor.items[i].onfocusexternaltext.addHandler(fnClickHandler);
}
}
};





vp.studio.ui.openLayersWin=function $vpfn_695kScnulHllZ5eRde3$Uw2662$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("openlayers");

vp.win.open("/vp/ns/studio/layers.aspx","layersWin","width=350,height=650,resizable=yes,scrollbars=yes");
};







vp.studio.ui.lockItem=function $vpfn_RB6HH1kHSabDMCsJbK5YPA2675$24(oDocItem,bLock)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();
oSelection.add(oDocItem,true);
var oCmd=new vp.studio.commands.Lock(oSelection,bLock);
oCmd.execute();
Editor.history.add(oCmd);
};






vp.studio.ui.selectItem=function $vpfn_aIbS8M8FI4tNN$ImMbT2jQ2689$26(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();
oSelection.add(oDocItem,true);
var oCmd=new vp.studio.commands.ChangeSelection(Editor.selection,oSelection);
oCmd.execute();
Editor.history.add(oCmd);
};





vp.studio.ui.swapZIndexes=function $vpfn_vJOyG2HA3VBCvDpBocaMUQ2702$28(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCmd=new vp.studio.commands.SwapZIndex(oItem1,oItem2);
oCmd.execute();
Editor.history.add(oCmd);
};










vp.studio.ui.showInlineDialog=function $vpfn_65pmjGTCqUvoB3F_P59eqw2718$32(sURL,sName,sTitle,iWidth,iHeight)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDialog=new vp.dialog.IFrameDialog(sName,{width:iWidth,height:iHeight},sURL);
oDialog.chrome=vp.dialog.chrome.Primary;

oDialog.options.title=sTitle;



oDialog.open(sURL);
return oDialog;
};









vp.studio.ui.showInlineWarningDialog=function $vpfn_j8Bs9f7boAca_mwKhnN_vg2739$39(sURL,sName,sTitle,sIconUrl)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oDialog=new vp.dialog.IFrameDialog(sName,{width:430,height:380},sURL);
oDialog.chrome=vp.dialog.chrome.Primary;
oDialog.options.title=sTitle;
oDialog.options.iconUrl=sIconUrl;
oDialog.open(sURL);
Editor.ValidationWin=oDialog;
return oDialog;
};

vp.studio.ui.showInlineTypoCheckerDialog=function $vpfn_Fgd0YqywUib_F99$gfdzJQ2751$43(sURL,sName,bVisible)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDialog=new vp.dialog.IFrameDialog(sName,{width:430,height:380},sURL);
oDialog.chrome=vp.dialog.chrome.Primary;
oDialog.options.title=JSLM_CheckForTypoButtonText_0;
oDialog.options.iconUrl="/vp/images/nns/common/icons/spell_check_icon.gif";
oDialog.open(sURL);
Editor.ValidationWin=oDialog;
return oDialog;
};




vp.studio.ui.changeArranger=function $vpfn_GMLqXFuM7zRFH8sYKRfJlw2765$30(iArrangerId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCommand=new vp.studio.commands.ChangeCollageArranger(iArrangerId);
Editor.history.add(oCommand);
oCommand.execute();
};





vp.studio.ui.showOnUpgrade=function $vpfn_DJ4GEPzgyeGAGgOG7eIRWg2776$29(vElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!Editor.isAdvanced)
{
if(vp.ui.get(vElement))
{
vp.ui.collapse(vElement);
vp.ui.hide(vElement);
}

Editor.onupgradestart.addHandler(function $vpfn_iLOlK3f2jMELrVWMP9NURQ2787$42()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.ui.get(vElement))
{
vp.ui.show(vElement);
}
});
}
};




vp.studio.ui.openVideoDialog=function $vpfn_B7HrEsWwgoO3C6w09DIt0w2800$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL("/sales/studio/dialogs/youtubevideodialog.aspx");
oUrl.setItem("video_key",Editor.studioVideoLinkUrlType);

vp.dialog.IFrameDialog.open("VideoDialog","Video",oUrl.toString(),
vp.dialog.chrome.Primary,611,423,{scrollType:DIALOG_SCROLL_TYPE_NO});
};






vp.studio.ui.refreshPageImageOnDocChange=function $vpfn_97S8OwMuhJoz8CoIZ7m1Jw2814$43(iPageNum,sImageElementId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnOnDocChangeHandler=function $vpfn_KFuZuoPeYyz4qzC1wJPVSA2816$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.pageNumber===iPageNum)
{
var img=vp.ui.get(sImageElementId);

var imgSrc=new vp.web.URL(img.src);
imgSrc.setItem('rndm',Math.random());

img.src=imgSrc.toString();
}
};

Editor.ondocumentchange.addHandler(fnOnDocChangeHandler);
};











vp.studio.ui.setLivePreviewPaginatorImgSrc=function $vpfn_elbpi1mTWmJO6Fa09Hx_qQ2842$45(sImgSrcUrl,sImgElementId,iPageNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var imgElement=vp.ui.get(sImgElementId);

if(imgElement)
{
imgElement.src=sImgSrcUrl;
vp.studio.ui.refreshPageImageOnDocChange(iPageNumber,sImgElementId);
}
};

vp.studio.ui.changeNumberOfCollageImages=function $vpfn_adR4N1gqoPZhRIhTdJDKHA2853$43(iNumberOfImages)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.spot.trackWithQueryString("studio_collage_set_num_photos","num="+iNumberOfImages);

var oCmd=new vp.studio.commands.ChangeNumberOfImagesInCollage(iNumberOfImages);
Editor.history.add(oCmd);
oCmd.execute();
};




vp.studio.ui.changeBacksideGalleryUrlPfid=function $vpfn_oTF02r4TuUu7nsl8pFznmQ2865$44(sPfid)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL(EditorConst.backsideGalleryURL);
oUrl.setItem("pf_id",sPfid);
EditorConst.backsideGalleryURL=oUrl.toString();
};





vp.studio.ui.duplicateThisDesign=function duplicateThisDesign(iProductKitId,sRedirectUrl)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

Editor.isInKitMode=true;


if(Editor.docID>0)
{
Editor.kitDocumentId=Editor.docID;
}
else
{

if(!Editor.kitPrimaryComboId)
{
Editor.kitPrimaryComboId=Editor.comboID;
}


if(!Editor.kitPrimaryComboId&&!Editor.kitPrimaryComboHash)
{
Editor.kitPrimaryComboHash=Editor.ICParts;
}
}


if(!Editor.kitPrimaryPfId)
{
Editor.kitPrimaryPfId=Editor.PFID;
Editor.kitPfIdList=Editor.PFID.toString();
}


if(!Editor.productKitId)
{
if(iProductKitId)
{
Editor.productKitId=iProductKitId;
}
}


Editor.duplicateThisDesign=true;

var fnRedirect=function redirect()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

window.onbeforeunload=null;

if(typeof(sRedirectUrl)=="undefined")
{
Editor.goToStudioHub();
}
else
{
window.location=sRedirectUrl;
}
};fnRedirect._vpfn='$vpfn_CmJtoYbek6AtgFq7ENbMng2920$21';


vp.studio.instrumentation.add("duplicateThisDesignInStudio-clicked");
Editor.save(fnRedirect,false,false,false);
};vp.studio.ui.duplicateThisDesign._vpfn='$vpfn_jcp9Zg2aqecU8CVZqgyT4g2876$35';




vp.studio.ui.showLayoutOptions=function $vpfn_Ub_R9F8NXWGDSrdeBWlbtw2943$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL("/studio/combo-layout-selector.aspx");
oURL.setItem("pf_id",Editor.PFID);
oURL.setItem("combo",Editor.icParts);
oURL.setItem("page",Editor.pageNumber);
oURL.setItem("color_scheme_id",Editor.colorSchemeID);
oURL.setItem("mode",1);
var oDialog=vp.dialog.IFrameDialog.open("dlgChangeLayout",'',oURL.toString(),vp.dialog.chrome.Primary,520,620);
vp.studio.instrumentation.add("changecombolayout");
};




vp.studio.ui.setRepositoryComboChangeHandler=function $vpfn_5cXOVxvStaPznMB3GVM4KA2958$47(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(window.ImageRepository&&window.ImageRepository.backgroundSelector)
{
var changeCombo=function $vpfn_rODPEoq7qxHrK5BSjezxxg2962$26(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.changeCombo("",e.comboId);
};

window.ImageRepository.backgroundSelector.currentComboId=Editor.comboID;
window.ImageRepository.backgroundSelector.oncomboselected.addHandler(changeCombo);
window.ImageRepository.backgroundSelector.onpreviouscomboselected.addHandler(changeCombo);
}
};





vp.studio.ui.getStudioCookie=function $vpfn_w_UUDLiqAIh5wmiEbyv8xw2977$31(studioCookieType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.cookies.getSubValue("studio",studioCookieType);
};






vp.studio.ui.setStudioCookie=function $vpfn_Od3i6EJU55or7JphJRd2ow2987$31(studioCookieType,value)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.cookies.setSubValue("studio",studioCookieType,value);
};





vp.studio.ui.showFontDropdownTooltip=function $vpfn_gCSq4QrE7Qd0tVyH3fLG6Q2996$39(oElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.studio.ui.getStudioCookie(STUDIO_COOKIE_FontDropdownTooltip))
{
var jDiv=$("<div>")
.append(
$("<h3>")
.html(JSLM_FontDropdownTooltip_0)
.css("margin","2px 0"))
.append(JSLM_FontDropdownTooltip_1)
.css("text-align","left");

var oTooltip=new vp.widget.RichTooltip(oElement,jDiv.get(0));

oTooltip.setBehavior(TOOLTIP_BEHAVIOR_HIDE_CUSTOM);
oTooltip.renderingStrategy=vp.widget.RichTooltip.renderingStrategies.LeftAndOffsetBelow;
oTooltip.show({});
vp.studio.ui.setStudioCookie(STUDIO_COOKIE_FontDropdownTooltip,true);
}
};





vp.studio.ui._assignEditorEvents=function $vpfn_DANMms6GWCqY$tRbxHuojw3021$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(window.Editor&&window.Editor.isAssrStudio)
{
var fnInit=function $vpfn_JHN6288QD$6SM_gMk6gMcA3025$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.features.hideAllClickTextOnInitialClick)
{
vp.studio.ui.setClearAllClickTextOnFocus();
}

vp.studio.ui._updateScrollandZoomAreas();




var oBelowEditorContainer=document.getElementById("divBelowDocument");
if(oBelowEditorContainer)
{
var width=Math.max(Editor.documentVisualSize.width,$(oBelowEditorContainer).width());

oBelowEditorContainer.style.width=Math.min(
width,
vp.ui.getWidth("divStudioDocumentContainerArea"))+
"px";


oBelowEditorContainer.style.display="block";
}
};

if(Editor.isLoadComplete)
{
fnInit();
}
else
{
Editor.oninitialrender.addHandler(fnInit);
}

Editor.onzoom.addHandler(vp.studio.ui._updateScrollandZoomAreas);
Editor.onupgradecomplete.addHandler(vp.studio.ui._updateScrollandZoomAreas);
}
};

vp.studio.ui.toggleRuler=function $vpfn_HpT7K6X_cOx$TrkMzPEBiA3066$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.rulerEnabled)
{
$(".ruler").toggle();
$("#rulerControl").toggleClass("show");
}
};

vp.studio.ui.openPhotoFilterDialog=function $vpfn_4lCpQfsbEa0XH0MV8F8wkg3075$37(oImgItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oImgItem)
{
window.photoFilterDialog.changeParameters({
ContainerId:oImgItem.id,
ImageId:oImgItem.getItemID(),
ImageType:1,
CropTop:oImgItem.cropInfo.top,
CropRight:oImgItem.cropInfo.right,
CropBottom:oImgItem.cropInfo.bottom,
CropLeft:oImgItem.cropInfo.left
});

vp.studio.instrumentation.add("open-photofilterdialog");

window.photoFilterDialog.open();
}
};

vp.studio.ui.initializeSampleBrandingToggle=function $vpfn_lR6RVs$1Wlac1cJHdesPNg3095$46()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oTooltip=new vp.widget.RichTooltip($(".sample-branding-container").get(0),$(".sample-branding-message").get(0));


oTooltip.skin=vp.widget.RichTooltip.skins.Message;
oTooltip.renderingStrategy=vp.widget.RichTooltip.renderingStrategies.Above;

var item,$brandedImageContainer;

for(var i=0,l=Editor.items.length;i<l;i++)
{
item=Editor.items[i];
if(item.brandingType)
{
$brandedImageContainer=$(item.imageContainer);
$brandedImageContainer.hide();
break;
}
}

$("#sampleBrandingCheckbox").change(function $vpfn_iLOlK3f2jMELrVWMP9NURQ3116$40(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if($(this).is(":checked"))
{
$brandedImageContainer.show();
}
else
{
$brandedImageContainer.hide();
}
});
};

vp.studio.ui.initializeMailMaskToggle=function $vpfn_wOTkPuoi3U8ZtOZ2o$wfuw3128$40()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var toggleMailMaskOverlay=function $vpfn_CqHu7P9IZnbPiaoBjFHPdg3130$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.toggleMailMaskOverlay($("#checkboxMailMaskToggle").filter(":checked").length>0);
};

$(document).ready(function $vpfn_iLOlK3f2jMELrVWMP9NURQ3135$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$("#checkboxMailMaskToggle").change(toggleMailMaskOverlay);

$("#divMailMaskToggleContainer a").click(function $vpfn_iLOlK3f2jMELrVWMP9NURQ3139$49()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.dialog.get("mailMaskInfo").open();
return false;
});
});

if(Editor.isLoadComplete)
{
toggleMailMaskOverlay();
}

Editor.onrender.addHandler(toggleMailMaskOverlay);

};

vp.events.addOnDOMLoadHandler(vp.studio.ui._assignEditorEvents);

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


vp.define("vp.studio.instrumentation");

vp.studio.instrumentation.isDebuggingOn=vp.web.getQueryString("debuglog");





vp.studio.instrumentation.features=[];

vp.studio.instrumentation.addLogInfo=function $vpfn_znJLgFEpjpSW8C$ZT1dR9w14$39(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oNode.attributes["name"]&&!oNode.attributes["nolog"])
{
if(oNode.attributes["property"])
{
vp.studio.instrumentation.add(oNode.attributes["name"]+"_"+oNode.attributes["property"]);
}
else
{
vp.studio.instrumentation.add(oNode.attributes["name"]);
}
}
};





vp.studio.instrumentation.add=function $vpfn_SOpfgp$$5aXjFCs0vnVLlQ33$32(val)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.studio.instrumentation.isDebuggingOn)
{
window.console.log(val);
}

if(!vp.analytics.Logger.exists("studio"))
{
vp.analytics.Logger.configure("studio",{param:"studio",url:"/vp/ns/studio_logger.aspx"});
}

vp.analytics.Logger.setInfo("pf_id",window.Editor?Editor.PFID:"");
vp.analytics.Logger.add("studio",val);
};






vp.studio.instrumentation.addCommand=function $vpfn_zy_glkqrID2KfWFqjiSjnQ54$39(sType,oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=oCommand.getInfo();
oInfo.attributes["event"]=sType.replace(/^onbefore/g,"").replace(/^on/g,"");

if(oCommand.doesntAffectDocument)
{
oInfo.attributes["nolog"]=1;
}

vp.studio.instrumentation.addLogInfo(oInfo);
};





vp.studio.instrumentation.addError=function $vpfn_goW910y69_SdgXVWfJW0uQ71$37(sMessage)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add(sMessage);
};







vp.studio.instrumentation.getTextChangeChildNodes=function $vpfn_WWo3fLV_JShPWTZeFm_Few82$52(sNewData,sOldData)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oFromNode=new vp.xml.XMLNode("from");
oFromNode.setInnerXML(sOldData);
var oToNode=new vp.xml.XMLNode("to");
oToNode.setInnerXML(sNewData);

return[oFromNode,oToNode];
};






vp.studio.instrumentation.touchFeature=function $vpfn_4nHXSarrKhvUps12VWb6zw97$41(iFeatureId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.studio.instrumentation.features.contains(iFeatureId))
{
vp.studio.instrumentation.features.push(iFeatureId);

if(!vp.analytics.Logger.exists("studio"))
{
vp.analytics.Logger.configure("studio",{param:"studio",url:"/vp/ns/studio_logger.aspx"});
}
vp.analytics.Logger.setInfo("pf_id",window.Editor?Editor.PFID:"");
vp.analytics.Logger.setInfo("msr",iFeatureId.toString());
}
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}







vp.studio.CommandHistory=function $vpfn_p5KdfPi1af1oJBFcJxgQsQ9$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





var m_arrStack=[];





var m_iCurrentIndex=-1;





this.onadd=new vp.events.CustomEvent(this,"onadd");





this.onundo=new vp.events.CustomEvent(this,"onundo");





this.onbeforeundo=new vp.events.CustomEvent(this,"onbeforeundo");





this.onredo=new vp.events.CustomEvent(this,"onredo");





this.onbeforeredo=new vp.events.CustomEvent(this,"onbeforeredo");





this.add=function $vpfn_nwhGUvk2ylghLwHnAA7kvQ59$15(oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oCommand.isVoid())
{
return;
}

m_iCurrentIndex++;
m_arrStack[m_iCurrentIndex]=oCommand;
m_arrStack=m_arrStack.slice(0,m_iCurrentIndex+1);

fireEvent("onadd",oCommand);
};





this.replaceCurrent=function $vpfn_hA3__YzEWJdROXorOOhA7Q77$26(oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_arrStack[m_iCurrentIndex]=oCommand;
};







var fireEvent=function $vpfn_kIwaqX3cb30_a_k9CzIljw88$20(sEvent,oCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me[sEvent])
{
var e={};
e.command=oCommand;
me[sEvent].fire(e);

if(vp.web.getQueryString("debughistory"))
{
vp.studio.trace("----------------------------------");
vp.studio.trace(sEvent+": "+oCommand.commandName);
for(var sProp in oCommand)
{
switch(typeof(oCommand[sProp]))
{
case"string":
case"number":
case"boolean":
vp.studio.trace("<span style=\"font-weight:bold; font-size:12px;\">"+sProp+"</span>:"+vp.web.htmlEncode(oCommand[sProp]));
break;
default:
break;
}
}
}
}
};





this.isMoreUndo=function $vpfn_7o66ZAUINlckLSP5p_kxDA121$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_iCurrentIndex>=0;
};





this.isMoreRedo=function $vpfn_NGarxBOf3OKyl_tN2bzU9w130$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_iCurrentIndex<m_arrStack.length-1;
};




this.undo=function $vpfn_S1ioelnSUAw8w$1CHxCm7Q138$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isMoreUndo())
{
vp.studio.instrumentation.add("Undo");

var oCommand=m_arrStack[m_iCurrentIndex];

fireEvent("onbeforeundo",oCommand);

oCommand.undo();
m_iCurrentIndex--;

fireEvent("onundo",oCommand);

if(window.Editor&&Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};




this.redo=function $vpfn_Bi$cRqfwFoIaGmF0VM$Vrg163$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isMoreRedo())
{
vp.studio.instrumentation.add("Redo");

m_iCurrentIndex++;

var oCommand=m_arrStack[m_iCurrentIndex];

fireEvent("onbeforeredo",oCommand);
oCommand.execute();
fireEvent("onredo",oCommand);

if(window.Editor&&Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};





this.getCurrentCommand=function $vpfn_i8CAJ$DS5r9OaCjOLe$oCQ188$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(m_arrStack[m_iCurrentIndex])
{
return m_arrStack[m_iCurrentIndex];
}
};




this.clear=function $vpfn_JOGSjTx8H1Y$jgq$RKbN3g199$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_arrStack=[];
m_iCurrentIndex=-1;
};

this.trace=function $vpfn_7_bMpTiz1HySAb0IlaI9jQ205$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.trace("History");
vp.studio.trace("-------");
vp.studio.trace("Current index: "+m_iCurrentIndex);
for(var i=0;i<m_arrStack.length;i++)
{
var sCurrent="";
if(i==m_iCurrentIndex)
{
sCurrent=" (Current)";
}
vp.studio.trace(i+": "+m_arrStack[i].commandName+sCurrent);
}
};

this.getStack=function $vpfn_4whHPb5GqNholmdpZIHfyQ221$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_arrStack;
};

this.getCurrentIndex=function $vpfn_XoxV8tbjlAsv6hI7UpeY2w226$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_iCurrentIndex;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.Selection=function $vpfn_$mHVg8rBVhO71RvmzGquow12$22(aInit)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





var m_arr=aInit||[];






this.add=function $vpfn__a4xYqFLtfnRMfE$BxS8ZQ27$15(oDocItem,bAllowLocked)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!m_arr.contains(oDocItem)&&(bAllowLocked||!oDocItem.locked))
{
me.setTextRange(null);
m_arr.add(oDocItem);
}
};






this.addRange=function $vpfn_2pB1JFjs4n1uW3mumz1vqw41$20(oSelection,bAllowLocked)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<oSelection.getLength();i++)
{
me.add(oSelection.getItem(i),bAllowLocked);
}
};






this._getIndexFromDocItemOrIndex=function $vpfn_skQjVhePym$JPGZGeHOOtQ54$39(oDocItemOrIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iIndex=(typeof oDocItemOrIndex=="number")?oDocItemOrIndex:m_arr.indexOf(oDocItemOrIndex);
return m_arr[iIndex]?iIndex:-1;
};





this.remove=function $vpfn_fhwZ7YWVfTfS4TqLW07PHw64$18(oDocItemOrIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iIndex=me._getIndexFromDocItemOrIndex(oDocItemOrIndex);
if(m_arr[iIndex])
{
m_arr.remove(iIndex);
}
};





this.clear=function $vpfn_HuFWABo9qIDXto0J3qvpLg77$17(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isTextRange())
{
me.selectedTextField=null;
}
else
{
m_arr=[];
}
};





this.getArray=function $vpfn_ZASiqDTyVyh$QTQsfNID7w93$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=[];
for(var i=0;i<m_arr.length;i++)
{
arr.add(m_arr[i]);
}

return arr;
};





this.cloneItems=function $vpfn_lytyzlMImXG$OhitoLziSQ108$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i,
item,
arr=[];

for(i=0;i<m_arr.length;i++)
{
item=m_arr[i].clone();
Editor.assignUniqueID(item,arr);
Editor.assignUniqueLabel(item,arr);

arr.push(item);
}

vp.studio.Caricature.relinkClonedItems(arr);

return new vp.studio.Selection(arr);
};





this.getState=function $vpfn_SSXtckZZf9$cgZp5FcIemA132$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();
oSelection.setState(me);
return oSelection;
};





this.setState=function $vpfn_Iy8_rJjQNEkXpv2aThXJow143$20(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_arr=oSelection.getArray();

if(oSelection.isTextRange())
{
me.selectedTextField=oSelection.selectedTextField;
}
};






this.isSelected=function $vpfn_zS7uGBcCxgSnstRY_RkQKA158$22(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_arr.contains(oDocItem);
};





this.getLength=function $vpfn_UkrWO9mnlpAnVFUUXk1EDw167$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_arr.length;
};






this.getItem=function $vpfn_HE_fYNBl2KkFXC9uI97Qkw177$19(iIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return m_arr[iIndex];
};

var runMethodOnChildren=function $vpfn_2$WLQ67Uil8H8m7VZMoeQw182$30(sMethodName,oArg1,oArg2,oArg3)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<m_arr.length;i++)
{
m_arr[i][sMethodName](oArg1,oArg2,oArg3);
}
};

var runMethodOnChildrenCoords=function $vpfn_s3Bcj8GklDGAH_h3Wu6SaQ190$36(sMethodName,oArg1,oArg2,oArg3)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<m_arr.length;i++)
{
m_arr[i].coordinates[sMethodName](oArg1,oArg2,oArg3);
}
};





this.moveBy=function $vpfn_rxm4hk3Dy5SPoZRmQAApLg202$18(oDelta)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
runMethodOnChildrenCoords("moveBy",oDelta);
};





this.moveByPrecise=function $vpfn_MioYvboAeb0EaTQYtlX_yA211$25(oDelta)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
runMethodOnChildrenCoords("moveByPrecise",oDelta);
};






this.isEqual=function $vpfn_83ncKsbgEd3AZKZhmRDA8w221$19(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oSelection.isTextRange()!=me.isTextRange())
{
return false;
}

if(!me.isTextRange())
{
if(oSelection.getLength()!=me.getLength())
{
return false;
}

for(var i=0;i<m_arr.length;i++)
{
if(m_arr[i]!=oSelection.getItem(i))
{
return false;
}
}
}

return true;
};





this.isTextRange=function $vpfn_sHHuf3CKm_OE8MZ5oB$anQ251$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.selectedTextField?true:false;
};

this.onsettextrange=new vp.events.CustomEvent(this,"onsettextrange");





this.setTextRange=function $vpfn_Cf8stU18kmpkaNsSGb24dQ262$24(oTextField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var e={};

if(oTextField)
{
me.clear();
me.selectedTextField=oTextField;

e.selectedTextField=me.selectedTextField;
m_arr.add(oTextField);
e.isSet=true;

me.onsettextrange.fire(e);
}
else
{
if(me.selectedTextField)
{
e.selectedTextField=me.selectedTextField;
e.isSet=false;

me.selectedTextField=null;

me.onsettextrange.fire(e);
}
}


};




this.clearTextRange=function $vpfn_4RYuw6RaYx_KYYAN2zk3Vw296$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.setTextRange(null);
};






this.getStyleArray=function $vpfn_0mfGiNRpTV0Zunj_pxfZZQ306$25(sPropertyName,bNonRecursive)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var arr=[];

if(me.isTextRange()&&!Editor.features.rangyRichTextEnabled)
{

}
else
{
var aCoordinateProperties=["top","left","width","height"];

for(var i=0;i<m_arr.length;i++)
{
var oItem=m_arr[i];
if(aCoordinateProperties.contains(sPropertyName))
{
arr.add(oItem.coordinates.getCoord(sPropertyName));
}
else
{


if(oItem.type==DOCITEM_TYPE_TEXT&&
oItem.textAreaType==TEXT_AREA_TYPE_RICH&&
oItem.externalTextField)
{
var vVal;
var sProp=vp.studio.util.getCssStyleFromTextProperty(sPropertyName);
if(bNonRecursive)
{
vVal=oItem.externalTextField.getStyleSimple(sProp);
}
else
{
vVal=oItem.externalTextField.getStyle(sProp);
}

arr.add(vVal);
}
else
{
arr.add(oItem[sPropertyName]);
}
}
}
}

return arr;
};





this.isEmpty=function $vpfn_RlGWqPHP3HGrEqFE$Wto6Q361$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.getLength()===0&&!me.isTextRange();
};






this.containsType=function $vpfn_FJLQ37TZPPoiIj2wb2$5bw371$24(iDocItemType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<m_arr.length;i++)
{
if(m_arr[i].type==iDocItemType)
{
return true;
}
}

return false;
};





this.getInfo=function $vpfn_pz_z8iLcqpVzevBpvU2rZw388$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.isTextRange())
{
return"textrange:{"+me.selectedTextField.id+":"+me.selectedTextField.data+"}";
}
else
{
var aOut=[];
for(var i=0;i<m_arr.length;i++)
{
aOut.add(m_arr[i].id);
}

return"{"+aOut.join(",")+"}";
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.SelectionManager=function $vpfn_YoL91hy0ZjzWHcF746g26Q12$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.Selection;
this.inheritFrom();

var me=this;

var _bIsBatch=false;
var _bEnableEvents=true;
var _oInitialSelection=null;






this.isHistoryEnabled=true;


var base_add=this.add;
var base_remove=this.remove;




this.onchange=new vp.events.CustomEvent(this,"onchange");







var onSelectHandler=function $vpfn_Zi6DXmh9Cl1iMNVWSxUXrQ48$26(oItem,e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bEnableEvents)
{
return true;
}

e=vp.events.getEvent(e);

me.startBatch();


if(!e.ctrlKey&&!e.shiftKey&&!me.isSelected(oItem))
{
me.clear();
}

if(me.isTextRange())
{

if(!e.ctrlKey&&!e.shiftKey)
{
me.clearTextRange();
}
else
{
var oField=me.selectedTextField;
me.clearTextRange();
me.add(oField);
}
}

if(!me.isSelected(oItem))
{
me.add(oItem);
}

me.endBatch();

return true;
};






var onDeselectHandler=function $vpfn_2AHIXq9f0p8OQpzC1jD$0g95$28(oItem,e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bEnableEvents)
{
return true;
}

if(me.isSelected(oItem))
{
me.remove(oItem);
return true;
}
else
{
return false;
}
};





this.listenForEvents=function $vpfn_oePlNO9KqoKze8bVse9BHQ117$27(oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var onSelect=function $vpfn_NDCKzLoeKf60g2vGr8IXUA119$23(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
onSelectHandler(this,e);
}
.getClosure(oItem);

oItem.manipulator.onselect.addHandler(onSelect);

var onDeselect=function $vpfn_NDCKzLoeKf60g2vGr8IXUA127$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return onDeselectHandler(this,e);
}
.getClosure(oItem);

oItem.manipulator.ondeselect.addHandler(onDeselect);
};




this.startBatch=function $vpfn_kcHJBaww0QCWfPsCqQwIpA139$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_bIsBatch)
{
_bIsBatch=true;
_oInitialSelection=me.getState();
return true;
}

return false;
};




this.endBatch=function $vpfn_Ox_7vf6Ie46DnlEbJRUGeA154$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bIsBatch=false;

if(me.isHistoryEnabled&&_oInitialSelection)
{
var oCmd=new vp.studio.commands.ChangeSelection(_oInitialSelection,me.getState());
Editor.history.add(oCmd);
}

Editor.toolbar.refreshWithDelay();


var e={};
e.selection=me;
me.onchange.fire(e);

_oInitialSelection=null;
};





this.add=function $vpfn_wXKr$99h_B4QCGX3jX7DqA178$15(oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatch=_bIsBatch;
if(!bIsBatch)
{
me.startBatch();
}

if(oItem.manipulator)
{
base_add(oItem,enableSelection(oItem));

if(!oItem.manipulator.selected)
{
_bEnableEvents=false;
oItem.manipulator.select();
_bEnableEvents=true;
}
}

if(!bIsBatch)
{
me.endBatch();
}
};









var enableSelection=function $vpfn_MwwprlZPy3cfyBerSleF1Q212$26(oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!oItem.locked)
{
return true;
}
if((oItem.type==DOCITEM_TYPE_TEXT||oItem.type==DOCITEM_TYPE_WORDART)&&
!Editor.isAnEnterprisePartnerTemplate())
{
return true;
}
return false;
};





this.remove=function $vpfn_S$kJxcg0csXIsqY4EJSs8w230$18(oDocItemOrIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatch=_bIsBatch;
if(!bIsBatch)
{
me.startBatch();
}

var iIndex=me._getIndexFromDocItemOrIndex(oDocItemOrIndex);
var oItem=me.getItem(iIndex);

base_remove(iIndex);

if(oItem&&oItem.manipulator.selected)
{
_bEnableEvents=false;
oItem.manipulator.deselect();
_bEnableEvents=true;
}

if(!bIsBatch)
{
me.endBatch();
}
};




this.clear=function $vpfn_15CC9ysNTYbiFWCwtGhtTw259$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.clearExcept(null);
};





this.clearExcept=function $vpfn_Tak_800rx1hU8MPMP$_ymA268$23(oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsBatch=_bIsBatch;
if(!bIsBatch)
{
me.startBatch();
}

var arr=me.getArray();
for(var i=0;i<arr.length;i++)
{
if(arr[i]!=oItem)
{
me.remove(arr[i]);
}
}

if(!bIsBatch)
{
me.endBatch();
}
};





this.setState=function $vpfn_1O8ubrrVhjyS1exQGNkVCw295$20(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oSelection.isTextRange())
{
me.setTextRange(oSelection.selectedTextField);
}
else
{
var bIsBatch=_bIsBatch;
if(!bIsBatch)
{
me.startBatch();
}

me.clear();
var arr=oSelection.getArray();
for(var i=0;i<arr.length;i++)
{
me.add(arr[i]);
}

if(!bIsBatch)
{
me.endBatch();
}
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.StateDetector=function $vpfn_9i5zzNKQcpzR0WcIX5inmg11$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;






this.isDisabled=function $vpfn_inpmLbscUPIuWbV3TEu5MA20$22(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.supportedTypes.length===0)
{
return me.supportsTextRanges||oSelection.isEmpty();
}


for(var i=0;i<me.supportedTypes.length;i++)
{
if(oSelection.containsType(me.supportedTypes[i]))
{
return false;
}
}

return true;
};

this.supportsTextRanges=false;

this.supportedTypes=[];

this.isSupportedType=function $vpfn_SlkDA$BRkG$xdqArUAsSRQ43$27(iDocItemType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.supportedTypes.length===0)
{
return true;
}
else
{
return me.supportedTypes.indexOf(iDocItemType)!=-1;
}
};
};








vp.studio.ValueStateDetector=function $vpfn_cRZN4dGVXLaDJnEN$RxXCw63$31(sProperty)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.StateDetector;
this.inheritFrom();





this.property=sProperty;







this.getValue=function $vpfn_lZYDvnJyOmpzGYqnT$Q2iw85$20(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oSelection.isTextRange()&&!Editor.currentFieldIsExternal)
{
if(me.isSupportedType(oSelection.selectedTextField.type))
{
if(oSelection.selectedTextField.textAreaType==TEXT_AREA_TYPE_RICH)
{
return oSelection.selectedTextField.inlineTextField.getSelectionStyle(
vp.studio.util.getCssStyleFromTextProperty(me.property));
}
else
{
return oSelection.selectedTextField[me.property];
}
}
else
{
return null;
}
}
else
{
var arr=oSelection.getStyleArray(me.property);
var sLastValue=null;

for(var i=0;i<arr.length;i++)
{

if(me.isSupportedType(oSelection.getItem(i).type))
{
var sValue=(arr[i]||"").toString();
if(sLastValue===null)
{
sLastValue=sValue;
}
else if(sLastValue!=sValue)
{
return null;
}
}
}


return sLastValue;
}
};
};

var STATE_COMPLEX=2;
var STATE_ON=1;
var STATE_OFF=0;










vp.studio.MultiStateDetector=function $vpfn_$v0ttbgMf$CsDrkCciHWBA147$31(sProperty,sOnValue,sOffValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.StateDetector;
this.inheritFrom();





this.property=sProperty;





this.onValue=sOnValue;





this.offValue=sOffValue;







this.getState=function $vpfn_f$T971kpyoipg8cBj4XP6A181$20(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oSelection.isTextRange())
{
var vValue;
if(oSelection.selectedTextField.textAreaType==TEXT_AREA_TYPE_RICH)
{
vValue=oSelection.selectedTextField.inlineTextField.getSelectionStyle(vp.studio.util.getCssStyleFromTextProperty(me.property));
}
else
{
vValue=oSelection.selectedTextField[me.property];
}

return vValue==me.onValue?STATE_ON:STATE_OFF;
}
else
{
var bOneOnValue=false;
var bOneOffValue=false;

var arr=oSelection.getStyleArray(me.property);

for(var i=0;i<arr.length;i++)
{

if(me.isSupportedType(oSelection.getItem(i).type))
{
if(arr[i]==me.onValue)
{
bOneOnValue=true;
}
else
{
bOneOffValue=true;
}

if(bOneOnValue&&bOneOffValue)
{
return STATE_COMPLEX;
}
}
}

return bOneOnValue?STATE_ON:STATE_OFF;
}
};
};


if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.Toolbar=function $vpfn_zTFcTcZoTiUDO_lzLXXvyw10$20(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.element=null;





var Editor=oEditor;





this.items=[];





this.seperators=[];





this.breaks=[];





this.cssClass="studioToolbar";





this.parentCssClass="studioToolbarContainer";

this.onclick=new vp.events.CustomEvent(this,"onclick");





this.addItem=function $vpfn_1Y84xdruKEABRZ_TVFJtFg62$19(oButton)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.features.richTextEnabled||Editor.features.rangyRichTextEnabled||!oButton.requiresRichText)
{
me.items.add(oButton);
}
};




this.render=function $vpfn_JLMP3AoapO3DEroT7DDwiQ73$18(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oOuter=oParentElement;
oOuter.className=me.parentCssClass;


var oDiv=document.createElement("DIV");
oDiv.className=me.cssClass;
oDiv.style.width="100%";
oOuter.style.width="100%";

oOuter.appendChild(oDiv);


me.element=oDiv;
me.outerElement=oOuter;

for(var i=0;i<me.items.length;i++)
{
me.items[i].render(me,me.element);

if(me.seperators.contains(i))
{
me.element.appendChild(me.renderSeperator());
}

if(me.breaks.contains(i))
{
me.element.appendChild(me.renderBreak());
}
}
me.element.appendChild(me.renderBreak());

oOuter.dontBlurManipulator=true;
oDiv.dontBlurManipulator=true;

me.refresh();
};




this.refresh=function $vpfn_LCbawuAmrBd2b6nioFQACQ116$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=me.items.length;
for(var i=0;i<iLen;i++)
{
me.items[i].refresh();
}
};

var _iRefreshDelayTimer=null;

this.refreshWithDelay=function $vpfn_qf7E5vavZACLCJ6U8x8uJg127$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iRefreshDelayTimer!==null)
{
clearTimeout(_iRefreshDelayTimer);
}

_iRefreshDelayTimer=window.setTimeout(me.refresh,100);
};

this.renderSeperator=function $vpfn_hG1a9pi2sQ3m_Pdsaw2d7g137$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oImg=document.createElement("IMG");
oImg.className="studioToolbarItem";
oImg.style.marginTop="4px";


if(Editor.features.useFullWidthToolbar||Editor.features.use1024Width)
{
oImg.style.marginLeft="8px";
oImg.style.marginRight="8px";
}
else
{
oImg.style.marginLeft="2px";
oImg.style.marginRight="2px";
}

oImg.style.height="16px";
oImg.src="/vp/images/nns/studio/toolbar2/seperator.gif";
return oImg;
};

this.addSeperator=function $vpfn_m4y5IXiDdgpSllGHl9el$w160$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.seperators.add(me.items.length-1);
};

this.addBreak=function $vpfn_BNT1ED6ovz9dXhZSt8DYSQ165$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.breaks.add(me.items.length-1);
};

this.renderBreak=function $vpfn_WsP9YdqfkAcm_jAwezOdug170$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oBR=document.createElement("BR");
oBR.style.clear="left";
return oBR;
};
};





vp.studio.Toolbar.getToolbar=function $vpfn_ChVh4n7yQ7FgKTL_7LDhKQ182$31(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oEditor.features.enableFloatingToolbar)
{
vp.events.add(window,"scroll",vp.studio.Toolbar.positionFloatingToolbar);
};

if(oEditor.features.useSectionedToolbar)
{
return new vp.studio.SectionedToolbar(oEditor);
}
else
{
return new vp.studio.Toolbar(oEditor);
}
};




vp.studio.Toolbar.positionFloatingToolbar=function $vpfn_KwXqXeHd1ke_w5a8Lovffw202$44(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oToolbarContainer=vp.ui.get("divStudioToolbarOuterContainer");

var oToolbarContainerRect=vp.ui.getRect(oToolbarContainer);
var iToolbarHeight=oToolbarContainerRect.height;

var iScrollOffset=vp.ui.getScrollOffset().top;
var oContainer=document.getElementById("divStudioEditor");
var oContainerRect=vp.ui.getRect(oContainer);
var iContainerTop=oContainerRect.top;

var iContainerHeight=oContainerRect.height;

if(iScrollOffset>iContainerTop)
{

if(oToolbarContainer.height>vp.ui.getViewportSize().height)
{
return;
}

var bReachBottom=iScrollOffset+iToolbarHeight-iContainerTop+10>=iContainerHeight;

if(vp.browser.isIE)
{


if(bReachBottom)
{
oToolbarContainer.style.top=Math.round(iContainerHeight-iToolbarHeight)+"px";
}
else
{
oToolbarContainer.style.top=Math.round(iScrollOffset-iContainerTop)+"px";
}
}
else
{
var $toolbarContainer=$(oToolbarContainer);

if(bReachBottom)
{
$toolbarContainer.removeClass("toolbar-fixed");
oToolbarContainer.style.top=Math.round(iContainerHeight-iToolbarHeight)+"px";
}
else
{
if(!$toolbarContainer.hasClass("toolbar-fixed"))
{
$toolbarContainer.addClass("toolbar-fixed").width(oToolbarContainerRect.width).css("top","0px");

if(Editor.features.enableStylizedToolbar)
{
oToolbarContainer.style.padding="0px";
$toolbarContainer.css("padding","0px");
}

}
}
}
}
else
{
$(oToolbarContainer).removeClass("toolbar-fixed");
oToolbarContainer.style.top="0px";
}

};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.SectionedToolbar=function $vpfn_kSqhr0R6ZHtSeaqqZ9DETA10$29(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.element=null;





var Editor=oEditor;





var _sections={};

_sections[TOOLBAR_SECTION_Basic]=[];
_sections[TOOLBAR_SECTION_Text]=[];
_sections[TOOLBAR_SECTION_Insert]=[];
_sections[TOOLBAR_SECTION_Advanced]=[];

var _sectionInfo={};


if(Editor.features.enableStylizedToolbar)
{
if(Editor.IsExtendedToolbarEnabled)
{
_sectionInfo[TOOLBAR_SECTION_Basic]={paddingRight:15,
label:JSLM_StudioToolbarSectionBasic
};
_sectionInfo[TOOLBAR_SECTION_Text]={paddingRight:15,
label:JSLM_StudioToolbarSectionText
};
_sectionInfo[TOOLBAR_SECTION_Insert]={paddingRight:15,
label:JSLM_StudioToolbarSectionInsert
};
_sectionInfo[TOOLBAR_SECTION_Advanced]={paddingRight:15,
label:JSLM_StudioToolbarSectionAdvanced
};
}
else
{
_sectionInfo[TOOLBAR_SECTION_Basic]={paddingRight:0,
label:JSLM_StudioToolbarSectionBasic
};
_sectionInfo[TOOLBAR_SECTION_Text]={paddingRight:0,
label:JSLM_StudioToolbarSectionText
};
_sectionInfo[TOOLBAR_SECTION_Insert]={paddingRight:0,
label:JSLM_StudioToolbarSectionInsert
};
_sectionInfo[TOOLBAR_SECTION_Advanced]={paddingRight:0,
label:JSLM_StudioToolbarSectionAdvanced
};
}
}
else
{
_sectionInfo[TOOLBAR_SECTION_Basic]={paddingRight:14,
label:JSLM_StudioToolbarSectionBasic
};
_sectionInfo[TOOLBAR_SECTION_Text]={paddingRight:22,
label:JSLM_StudioToolbarSectionText
};
_sectionInfo[TOOLBAR_SECTION_Insert]={paddingRight:7,
label:JSLM_StudioToolbarSectionInsert
};
_sectionInfo[TOOLBAR_SECTION_Advanced]={paddingRight:0,
label:JSLM_StudioToolbarSectionAdvanced
};
}

this.onclick=new vp.events.CustomEvent(this,"onclick");

var _sLastSection;





this.addItem=function $vpfn_zKHZ7OXbn5FoAZs6AVGIBw97$19(oButton,sSection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.features.richTextEnabled||Editor.features.rangyRichTextEnabled||!oButton.requiresRichText)
{
if(!_sections[sSection])
{
throw new Error("The toolbar section '"+sSection+"' doesn't exist.");
}

_sLastSection=sSection;

_sections[sSection].add(oButton);
}
};




this.render=function $vpfn_2qJ3fo96_JwuaLG9xs5CJw115$18(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.features.enableStylizedToolbar)
{
renderStylizedToolbar(oParentElement);
}

else
{
renderDefaultToolbar(oParentElement);
}
};

var renderStylizedToolbar=function $vpfn_YPrFP3TKH55aTyrNnVzKOA128$32(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oToolbarOuterContainer=vp.ui.get("divStudioToolbarOuterContainer");
if(oToolbarOuterContainer)
{

oToolbarOuterContainer.style.height=Editor.isCCTAgent?"120px":"90px";

if(!Editor.IsExtendedToolbarEnabled)
{
oToolbarOuterContainer.style.width="100%";
}

}


var oOuter=oParentElement;
oOuter.className="studioStylizedToolbarContainer";


var oDiv=document.createElement("DIV");
oDiv.className="studioStylizedSectionedToolbar";

oDiv.style.width="100%";
oOuter.style.width="100%";

oOuter.appendChild(oDiv);

me.element=oDiv;
me.outerElement=oOuter;

var bFirstItem=true;




var iWidthOfAllSections=0;


var iNumberOfSections=0;



var aNumberOfRows=new Array();
var iNumberOfRowsSectionIndex=0;
var sSectionIdConstant="divStudioToolbarSection";

for(var sSection in _sections)
{

if(_sections[sSection].length===0)
{
continue;
}


iNumberOfSections++;

var oSectionDiv=document.createElement("DIV");
oSectionDiv.className="studioStylizedToolbarSectionContainer";
oSectionDiv.id=sSectionIdConstant+iNumberOfSections;

if(Editor.IsExtendedToolbarEnabled)
{
oSectionDiv.style.marginLeft="6px";
}


var aCurrentSectionWidths=new Array();
var currentRow=0;

aCurrentSectionWidths[currentRow]=0;

if(bFirstItem)
{

bFirstItem=false;
}
else
{
oSectionDiv.style.paddingLeft="2px";


var oDivider=document.createElement("DIV");
oDivider.className="studioToolbarSectionDivider";
me.element.appendChild(oDivider);
iWidthOfAllSections+=vp.ui.getWidth(oDivider);
aCurrentSectionWidths[currentRow]=2;
}

me.element.appendChild(oSectionDiv);

var oLabelContainer=document.createElement("DIV");
oLabelContainer.className="studioToolbarSectionLabel";
oLabelContainer.innerHTML=_sectionInfo[sSection].label;

oSectionDiv.appendChild(oLabelContainer);

var aItems=_sections[sSection];

for(var i=0;i<aItems.length;i++)
{
if((typeof(aItems[i].visible)!=="undefined")&&!aItems[i].visible)
{
continue;
}

if(aItems[i].render)
{
aItems[i].render(me,oSectionDiv);



if(vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc]&&
vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc][EditorConst.languageID])
{

aCurrentSectionWidths[currentRow]+=
vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc][EditorConst.languageID].width-2;
}
else if(aItems[i].element&&aItems[i].element.width)
{
aCurrentSectionWidths[currentRow]+=aItems[i].element.width-2;
}
else
{
if(aItems[i].imageSrc)
{
aCurrentSectionWidths[currentRow]+=aItems[i].width-2;
}
else
{
aCurrentSectionWidths[currentRow]+=aItems[i].width;
}
}
}
else
{
oSectionDiv.appendChild(aItems[i]);


if(aItems[i].nodeName=="BR")
{

if(i+1<aItems.length)
{
currentRow++;

if(bFirstItem)
{
aCurrentSectionWidths[currentRow]=0;
}
else
{
aCurrentSectionWidths[currentRow]=2;
}
}
}

else if(!aItems[i].width)
{
aCurrentSectionWidths[currentRow]+=0;
}
else
{
aCurrentSectionWidths[currentRow]+=aItems[i].width;
}
}
}


var iLongestRowWidth=0;
for(var row=0;row<aCurrentSectionWidths.length;row++)
{
if(aCurrentSectionWidths[row]>iLongestRowWidth)
{
iLongestRowWidth=aCurrentSectionWidths[row];
}


aNumberOfRows[iNumberOfRowsSectionIndex]=row+1;
}


iNumberOfRowsSectionIndex++;

var iActualRowWidth=iLongestRowWidth+_sectionInfo[sSection].paddingRight;


iWidthOfAllSections+=iActualRowWidth;


oSectionDiv.style.width=iActualRowWidth+"px";
}

var oHelpContainer;
var oHelpButton;


if(Editor.showHelpButtonInToolbarCorner)
{
oHelpContainer=document.createElement("DIV");
oHelpContainer.className="studioStylizedToolbarHelpCornerContainer";
oHelpContainer.title=JSLM_StudioToolbarHelpButtonTooltip;

oHelpButton=document.createElement("IMG");
oHelpButton.src=vp.ui.imageUrl("/vp/images/b09/common/bullet/help-02.png");
oHelpButton.id="studioStylizedToolbarHelpCornerButton";
vp.ui.setStyleValue(oHelpButton,"cursor","pointer");

vp.events.add(oHelpButton,"click",function $vpfn_lD2jpQgDjIkKX57LcxfvlA338$48(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Studio_ClickToolbarButtonHelp");
vp.win.openCentered("/vp/ns/studio/learn_how.aspx","studioHelpWin",500,600,true,true);
});

oHelpContainer.appendChild(oHelpButton);

me.element.appendChild(oHelpContainer);
}
else
{
oHelpContainer=document.createElement("DIV");
oHelpContainer.className="studioStylizedToolbarHelpContainer";
oHelpContainer.title=JSLM_StudioToolbarHelpButtonTooltip;

oHelpButton=document.createElement("IMG");
oHelpButton.src=vp.ui.imageUrl("/vp/images/b09/common/bullet/help-02.png");
oHelpButton.id="studioStylizedToolbarHelpButton";
oHelpButton.verticalAlign="middle";
vp.ui.setStyleValue(oHelpButton,"cursor","pointer");

vp.events.add(oHelpButton,"click",function $vpfn_lD2jpQgDjIkKX57LcxfvlA360$48(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Studio_ClickToolbarButtonHelp");
vp.win.openCentered("/vp/ns/studio/learn_how.aspx","studioHelpWin",500,600,true,true);
});

oHelpContainer.appendChild(oHelpButton);

me.element.appendChild(oHelpContainer);

var oHelpDivider=document.createElement("DIV");
oHelpDivider.className="studioToolbarHelpSectionDivider";
vp.ui.setStyleValue(oHelpDivider,"float","right");
me.element.appendChild(oHelpDivider);
}

oOuter.dontBlurManipulator=true;
oDiv.dontBlurManipulator=true;

me.refresh();
};

var renderDefaultToolbar=function $vpfn_Rtn65Ccqm$kEYBiXGXutLQ382$31(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oToolbarOuterContainer=vp.ui.get("divStudioToolbarOuterContainer");
if(oToolbarOuterContainer&&!Editor.IsExtendedToolbarEnabled)
{
oToolbarOuterContainer.style.height="76px";
}


var oOuter=oParentElement;
oOuter.className="studioToolbarContainer";
oOuter.style.backgroundColor="#B3B3B3";


var oDiv=document.createElement("DIV");
oDiv.className="studioSectionedToolbar";
oDiv.style.width="100%";
oOuter.style.width="100%";

oOuter.appendChild(oDiv);

me.element=oDiv;
me.outerElement=oOuter;

var oLeftCap=document.createElement("DIV");
oLeftCap.className="studioSectionedToolbarLeftCap";
me.element.appendChild(oLeftCap);

var bFirstItem=true;




var iWidthOfAllSections=0;


var iNumberOfSections=0;



var aNumberOfRows=new Array();
var iNumberOfRowsSectionIndex=0;
var sSectionIdConstant="divStudioToolbarSection";

for(var sSection in _sections)
{

iNumberOfSections++;
var oSectionDiv=document.createElement("DIV");
oSectionDiv.className="studioToolbarSectionContainer";

oSectionDiv.id=sSectionIdConstant+iNumberOfSections;

if(Editor.IsExtendedToolbarEnabled)
{
oSectionDiv.style.marginLeft="6px";
}

if(bFirstItem)
{
bFirstItem=false;
}
else
{
var oDivider=document.createElement("DIV");
oDivider.className="studioToolbarSectionDivider";
me.element.appendChild(oDivider);
iWidthOfAllSections+=vp.ui.getWidth(oDivider);
}

me.element.appendChild(oSectionDiv);

var oLabelContainer=document.createElement("DIV");
oLabelContainer.className="studioToolbarSectionLabel";
oLabelContainer.innerHTML=_sectionInfo[sSection].label;

oSectionDiv.appendChild(oLabelContainer);


var aCurrentSectionWidths=new Array();
var currentRow=0;


aCurrentSectionWidths[currentRow]=0;

var aItems=_sections[sSection];

for(var i=0;i<aItems.length;i++)
{
if(aItems[i].render)
{
aItems[i].render(me,oSectionDiv);



if(vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc]&&
vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc][EditorConst.languageID])
{

aCurrentSectionWidths[currentRow]+=
vp.studio.toolbarImages.sizeDict[aItems[i].imageSrc][EditorConst.languageID].width;
}
else if(aItems[i].element&&aItems[i].element.width)
{
aCurrentSectionWidths[currentRow]+=aItems[i].element.width;
}
else
{
aCurrentSectionWidths[currentRow]+=aItems[i].width;
}
}
else
{
oSectionDiv.appendChild(aItems[i]);


if(aItems[i].nodeName=="BR")
{

if(i+1<aItems.length)
{
currentRow++;

aCurrentSectionWidths[currentRow]=0;
}
}

else if(!aItems[i].width)
{
aCurrentSectionWidths[currentRow]+=parseInt(aItems[i].style.width);
}
else
{
aCurrentSectionWidths[currentRow]+=aItems[i].width;
}
}
}


var iLongestRowWidth=0;
for(var row=0;row<aCurrentSectionWidths.length;row++)
{
if(aCurrentSectionWidths[row]>iLongestRowWidth)
{
iLongestRowWidth=aCurrentSectionWidths[row];
}


aNumberOfRows[iNumberOfRowsSectionIndex]=row+1;
}


iNumberOfRowsSectionIndex++;

var iActualRowWidth=iLongestRowWidth+_sectionInfo[sSection].paddingRight;


iWidthOfAllSections+=iActualRowWidth;


oSectionDiv.style.width=iActualRowWidth+"px";
}


var oHelpContainer=document.createElement("DIV");
oHelpContainer.className="studioToolbarHelpContainer";
oHelpContainer.title=JSLM_StudioToolbarHelpButtonTooltip;
vp.ui.setStyleValue(oHelpContainer,"cursor","pointer");

var oHelpLabel=document.createElement("DIV");
oHelpLabel.innerHTML=JSLM_StudioToolbarSectionHelp;
oHelpLabel.id="studioToolbarHelpLabel";
oHelpContainer.appendChild(oHelpLabel);

vp.events.add(oHelpContainer,"click",function $vpfn_lD2jpQgDjIkKX57LcxfvlA557$47(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("Studio_ClickToolbarButtonHelp");
vp.win.openCentered("/vp/ns/studio/learn_how.aspx","studioHelpWin",500,600,true,true);
});

me.element.appendChild(oHelpContainer);

var oHelpDivider=document.createElement("DIV");
oHelpDivider.className="studioToolbarHelpSectionDivider";
vp.ui.setStyleValue(oHelpDivider,"float","right");
me.element.appendChild(oHelpDivider);


var oRightCap=document.createElement("DIV");
oRightCap.className="studioSectionedToolbarRightCap";
me.element.appendChild(oRightCap);

oOuter.dontBlurManipulator=true;
oDiv.dontBlurManipulator=true;


distributeEmptySpace(oHelpContainer,oRightCap,iNumberOfSections,iWidthOfAllSections,sSectionIdConstant);

me.refresh();
};




this.refresh=function $vpfn_5_$$MCotb40ov1P8ZHvq7w587$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var sSection in _sections)
{
var aItems=_sections[sSection];
for(var i=0;i<aItems.length;i++)
{
if(aItems[i].refresh)
{
aItems[i].refresh();
}
}
}
};

var _iRefreshDelayTimer=null;

this.refreshWithDelay=function $vpfn_ujPIK1FtPgpEGw$FDJyP1w604$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iRefreshDelayTimer!==null)
{
clearTimeout(_iRefreshDelayTimer);
}

_iRefreshDelayTimer=window.setTimeout(me.refresh,100);
};

this.addBreak=function $vpfn_0DZkfmS7YuNUz3k2S4tFWw614$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_sLastSection)
{
_sections[_sLastSection].add(renderBreak());
}
};

var renderBreak=function $vpfn_yWNKcSFjOahk97qiqzN$Mg622$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oBR=document.createElement("BR");
oBR.style.clear="left";
return oBR;
};

this.addSeperator=function $vpfn_qqTQuAdoTPiRRzuS889v4g629$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_sLastSection)
{
_sections[_sLastSection].add(renderSeperator());
}
};

var renderSeperator=function $vpfn_ABcbJPK7HghxBweGW0752g637$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oDiv=document.createElement("DIV");

if(Editor.features.enableStylizedToolbar)
{
oDiv.style.width="2px";
oDiv.className="studioStylizedToolbarItem";
}
else
{
oDiv.style.width="7px";
oDiv.className="studioToolbarItem";
}

return oDiv;
};

var distributeEmptySpace=function $vpfn_c5xObbe3$Bf9G56Jk$g7iw655$31(oHelpContainer,oRightCap,iNumberOfSections,iWidthOfAllSections,sSectionIdConstant)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iToolbarExtendedWidth=vp.ui.getRect('divStudioToolbar').width;


if(iToolbarExtendedWidth<=0)
{
iToolbarExtendedWidth=920;
}



var iToolbarWidth=Editor.IsExtendedToolbarEnabled?iToolbarExtendedWidth:680;


var iHelpWidth=vp.ui.getWidth(oHelpContainer);
var iRightCapWidth=vp.ui.getWidth(oRightCap);
var iBufferSpace=Editor.IsExtendedToolbarEnabled?50:30;


var iEmptyToolbarWidth=iToolbarWidth-iWidthOfAllSections-iRightCapWidth-iHelpWidth-iBufferSpace;

if(iEmptyToolbarWidth>=iNumberOfSections)
{

var iAdditionalSectionWidth=Math.floor(iEmptyToolbarWidth/iNumberOfSections);


for(var iSectionNumber=1;iSectionNumber<=iNumberOfSections;iSectionNumber++)
{
var oSectionElement=vp.ui.get(sSectionIdConstant+iSectionNumber);
oSectionElement.style.width=vp.ui.getWidth(oSectionElement)+iAdditionalSectionWidth+"px";
}

}
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.Table=function $vpfn_DkQ1dG3VNBL8p0zK1UMFfA12$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.DocumentItem;
this.inheritFrom();

this.mixin=vp.studio.ComplexSizeDocumentItem;
this.mixin();

var me=this;





this.type=DOCITEM_TYPE_TABLE;

this.itemTypeString="Table";





this.getIDPrefix=function $vpfn_lsZnZAvuTBNugI2p4bFInw37$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"vpls_table_";
};





this.ondblclick=new vp.events.CustomEvent(this,"ondblclick");






this.styleIndex=1;





this.fontFamily="Arial";





this.fontSize=20;





this.fontWeight="normal";





this.fontStyle="normal";





this.fontColor=new vp.color.Color("#000000");






this.borderColor=new vp.color.Color("#000000");





this.opacity=100;








this.align=TEXT_ALIGN_Left;





this.content=new vp.studio.TableContent(4,3);





this._coreAttributes=vp.studio.Table._CORE_ATTRIBUTES;




this.setStyle=function $vpfn_m8igVm9o7DsNDGn3ILP9Eg122$20(sProperty,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me[sProperty]===vValue)
{
return;
}

recordInitialState();

me.setOuterStyle(sProperty,vValue);

me.refresh();
recordTextChangeCommand(sProperty);
};





this.setContent=function $vpfn_C5nEyc46VdQwgf8ldL2_0w141$22(oContent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
recordInitialState();
this.setData(oContent);
me.refresh();
recordTextChangeCommand("data");
};

me.initialContent="";
me.initialStyles={};



this.setOuterStyle=function $vpfn_xfcOi96vVEIi8KVA38fuMg154$25(sProperty,vValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me[sProperty]=vValue;

if(sProperty==="align")
{
if((typeof(vValue)).toLowerCase()==="string")
{
$(me.content._columns).each(function $vpfn_j2p6jknINUhfad7pt9Cyfg162$44(index,column){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
column.align=vValue;
});
}
else
{
$(me.content._columns).each(function $vpfn_j2p6jknINUhfad7pt9Cyfg168$44(i){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.align=vValue[i];
});
}
}
};





this.setData=function $vpfn_2uo7Dy5JPm5yNIMhbq$A2w179$19(oContent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.content=oContent;

var aAlign=[];
var sAlign=TEXT_ALIGN_Left;

for(var i=0;i<oContent._columns.length;i++)
{
aAlign.add(oContent._columns[i].align);
if(sAlign&&aAlign[i]!==sAlign)
{
sAlign="";
}
}

me.align=sAlign?sAlign:aAlign;
};




var recordInitialState=function $vpfn_k06A4gcLa8bupw3DQJPSdQ201$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.initialContent=me.content;
me.initialStyle=getStyleObject(me);
};




var getStyleObject=function $vpfn_GIX7teV0DjDqUekTjDQ5HQ210$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oStyle={};
for(var sProp in vp.studio.util.TEXT_PROPERTY_MAP)
{
oStyle[sProp]=me[sProp];
}
return oStyle;
};





var recordTextChangeCommand=function $vpfn_IsK6d6LRIPS_Ks8xPzD_qw224$34(property)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCommand=new vp.studio.commands.ChangeText(
me,
property,
me.initialContent,
me.initialStyle,
me.content,
getStyleObject(me));

Editor.history.add(oCommand);

me.initialData=me.content||"";
me.initialStyle=getStyleObject();
};





this.render=function $vpfn_uiHb_L0wSiQ9isJvSc06zw244$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

if(!me.imageElement)
{

me.handleElement=document.createElement("IMG");
me.handleElement.src=BLANK_IMAGE;
me.handleElement.id=me.id+"_handle";
me.handleElement.style.position="absolute";
me.coordinates.boundElements.add(me.handleElement);

vp.events.add(me.handleElement,"dblclick",me.ondblclick.fire);

me.imageContainer=document.createElement("DIV");
me.imageContainer.id=me.id+"_container";
me.imageContainer.style.position="absolute";

me.setZIndex();

me.imageContainer.style.top=0;
me.imageContainer.style.left=0;


me.imageElement=document.createElement("IMG");
me.imageElement.id=me.id;
me.imageElement.style.position="absolute";
me.imageElement.style.zIndex=1;
me.imageElement.style.visibility="hidden";

me.coordinates.boundElements.add(me.imageElement);

me.coordinates.updateBoundElements(true);
}

oEditor.documentArea.appendChild(me.imageContainer);
oEditor.docItemHandleArea.appendChild(me.handleElement);

me.imageContainer.appendChild(me.imageElement);

me.refresh();

me.rendered=true;
};




this.unrender=function $vpfn_xtwlmBI3d60GhlWxScm6Ng296$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.imageContainer.parentNode)
{
vp.ui.removeFromDOM(me.imageContainer);
}

if(me.handleElement.parentNode)
{
vp.ui.removeFromDOM(me.handleElement);
}

me.rendered=false;
};






var onLoadHandler=function $vpfn_I32O03uZPy6Tf6SuvdZWmQ316$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.imageElement.parentNode)
{
return;
}

me.resetCoordinatesToImageSize();

vp.ui.applyPosition(me.coordinates.getRect(),me.imageElement.style);

me.imageElement.style.visibility="visible";
};





this.getPreviewURL=function $vpfn_mmhf7Ea2EIz9Qg_PIhF$KA334$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL("/any/preview/table.caspx");
var oRect=me.coordinates.getRect();
oUrl.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);
oUrl.setItem("height",oRect.height);
oUrl.setItem("width",oRect.width);
oUrl.setItem("zoom",me.coordinates.getZoom());


var oCoreAttrs={};
me.applyCoreAttributesTo(oCoreAttrs,true);
for(var sAttr in oCoreAttrs)
{
oUrl.setItem(sAttr,oCoreAttrs[sAttr].toString());
}

var sUpdateXml=me.content.getXML();
oUrl.setItem("table_xml",sUpdateXml);
if(me.isGrayScale())
{
oUrl.setItem("gs",1);
}

if(vp.web.getQueryString("debugrt")=="1")
{
vp.studio.trace("---------------------");

vp.studio.trace("table xml:");
vp.studio.trace(vp.web.htmlEncode(sUpdateXml));

vp.studio.trace("---------------------");
}


try
{

return vp.http.getURLSizedForGET(oUrl,"table_xml",null,false,true);
}
catch(ex)
{

return"/vp/images/nns/common/icons/error_icon.gif";
}
};




this.refresh=function $vpfn_eYmn2AVkiHPNccGbB4ExDw384$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sNewURL=me.getPreviewURL();
if(!me.currentURL||me.currentURL!=sNewURL)
{
me.currentURL=sNewURL;
vp.ui.setSrcPNG(me.imageElement,sNewURL,onLoadHandler);
}
};





this.getManipulatorElement=function $vpfn_Qrriu9xgPjQ77vAJwqKjgw398$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.handleElement;
};




this.getUpdateXML=function $vpfn_0bFVJXZ050Ik8O1QS64Lyw406$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("vptable-wrapper");


me.applyCoreAttributesTo(oNode.attributes,true);
me.applyCoordinatesTo(oNode.attributes,true);

oNode.children.add(me.content.getXML());
return oNode.toString();
};





this.setZIndex=function $vpfn_ljIjX2TS5jncNuKBN8_t6w422$21(iZIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(iZIndex)!="undefined")
{
me.zIndex=iZIndex;
}

if(me.handleElement)
{
me.handleElement.style.zIndex=me._getDOMElementZIndex(true);
}
me.imageContainer.style.zIndex=me._getDOMElementZIndex();
};






this.upgrade=function $vpfn_7IOLayaZeUuqVx$X2dGSeA441$19(oDecorator)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oDecorator.decorateTable(me);
};




this.terminate=function $vpfn_30iUwFNizwMZtl$70mQiTw449$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.imageElement=null;
};

};

vp.studio.TableContent=function $vpfn_yz6donJKWJ1cCHDH$iGY2g456$25(iRow,iColumn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this._columns=[];





this._cells=[];





this.numRows=iRow?iRow:2;





this.numColumns=iColumn?iColumn:2;

var init=function $vpfn_y5an5uUtuKjK_jvjPxSRRg484$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.reset(me.numRows,me.numColumns);
};






this.getCell=function $vpfn_s59ITfMxDPxQm3$Gh6vL4A494$19(iRow,iColumn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me._cells[iRow][iColumn];
};







this.setCell=function $vpfn_WJueLqyCNX7IshLyPgCe$g505$19(iRow,iColumn,oCellContent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me._cells[iRow][iColumn]=oCellContent;
};





this.getColumn=function $vpfn_7vc5zwW1M2X_AfhFz1jwuQ514$21(iColumn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me._columns[iColumn];
};







this.reset=function $vpfn_PEah6voBAm8omWyggmOEhg525$17(iRows,iColumns)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.numRows=iRows;
me.numColumns=iColumns;

var i,j;
me._columns=[];
var iColWidth=100;
for(i=0;i<me.numColumns;i++)
{
me._columns[i]=new vp.studio.TableColumn();
me._columns[i].width=iColWidth;
}

me._cells=[];
for(i=0;i<me.numRows;i++)
{
me._cells[i]=[];
for(j=0;j<me.numColumns;j++)
{
me._cells[i][j]="";
}
}
};

var getCellContentXMLNode=function $vpfn_nfrTz8wvgFfT1fB6Gnxk7w550$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oContentNode=new vp.xml.XMLNode("vprows");
for(var i=0;i<me.numRows;i++)
{
var oRowNode=new vp.xml.XMLNode("vprow");
for(var j=0;j<me.numColumns;j++)
{
var oCellNode=new vp.xml.XMLNode("vpcell");
oCellNode.setInnerXML(me._cells[i][j]);
oRowNode.children.add(oCellNode);
}
oContentNode.children.add(oRowNode);
}

return oContentNode;
};

var getColumnPropertiesXMLNode=function $vpfn_$yeMJ5Cn3Meu1ScZ_$InhQ568$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oColumnsNode=new vp.xml.XMLNode("vpcols");
for(var i=0;i<me.numColumns;i++)
{
oColumnsNode.children.add(me._columns[i].getXML());
}
return oColumnsNode;
};




this.getXML=function $vpfn_GjsNd26l_E8vLtnRj6o_Nw581$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("vptable");
oNode.children.add(getColumnPropertiesXMLNode());
oNode.children.add(getCellContentXMLNode());

return oNode;
};






this.clone=function $vpfn_$BX4doiFDaDMlrE7bz1LPQ595$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oClone=new vp.studio.TableContent(this.numRows,this.numColumns);
var i;

for(i=0;i<this.numColumns;i++)
{
oClone._columns[i]=this._columns[i].clone();
}

for(i=0;i<this.numRows;i++)
{
oClone._cells[i]=this._cells[i].clone();
}

return oClone;

};

init();
};


vp.studio.TableContent.prototype.toString=function $vpfn_IUUUbercbL_Eu1tn3ctd2g618$44()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.getXML().toString();
};





vp.studio.TableColumn=function $vpfn_SjmM_8JgBjZo2QiLMDrhfQ627$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.width=100;





this.align=TEXT_ALIGN_Left;





this.getXML=function $vpfn_GjsNd26l_E8vLtnRj6o_Nw647$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNode=new vp.xml.XMLNode("vpcol");
oNode.attributes["width"]=me.width;
oNode.attributes["align"]=me.align;
return oNode;
};





this.clone=function $vpfn_$BX4doiFDaDMlrE7bz1LPQ659$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oClone=new vp.studio.TableColumn();
oClone.width=this.width;
oClone.align=this.align;

return oClone;
};
};

vp.studio.Table._CORE_ATTRIBUTES=[
"id",
"zIndex",
"purposeName",
"styleIndex",
"fontFamily",
"fontSize",
"fontWeight",
"fontStyle",
"fontColor",
"borderColor",
"opacity"
];

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


vp.studio.ListConverter={};

vp.studio.ListConverter.ORDERED_LIST="orderedList";
vp.studio.ListConverter.UNORDERED_LIST="unorderedList";




vp.studio.ListConverter.convertToList=function $vpfn_h_Sh6htRPWJby6hLmOxUGQ12$40(oXmlNode,sListType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oRootStyles=vp.studio.ListConverter._getCssStyles(oXmlNode);
oXmlNode.setAttribute("style","");
var aListItems=vp.studio.ListConverter._convertToListItem(oXmlNode,new vp.web.CssString(""));

var sTagName=sListType===vp.studio.ListConverter.ORDERED_LIST?"OL":"UL";
var oListNode=oXmlNode.ownerDocument.createElement(sTagName);
oListNode.setAttribute("style",oRootStyles.toString());
for(var i=0,l=aListItems.length;i<l;i++)
{
oListNode.appendChild(aListItems[i]);
}

return oListNode;
};

vp.studio.ListConverter._convertToListItem=function $vpfn_gwbmSBT61VJHpWBoQrV66g29$45(oNode,oInheritedStyles)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sTagName=oNode.tagName?oNode.tagName.toUpperCase():"";
if(oNode.nodeType===3||sTagName==="BR"||sTagName==="SPAN")
{
return null;
}
var iNumChild=oNode.childNodes.length;
var oCurrentStyle=vp.studio.ListConverter._getCssStyles(oNode);



if(oInheritedStyles&&oCurrentStyle)
{
for(var style in oInheritedStyles.items)
{
if(!oCurrentStyle.items[style])
{
oCurrentStyle.setItem(style,oInheritedStyles.items[style]);
}
}
}

var aRecursiveListItems=[];
var aReturnListItems=[];
for(var i=0,l=oNode.childNodes.length;i<l;i++)
{
aRecursiveListItems[i]=vp.studio.ListConverter._convertToListItem(oNode.childNodes[i],oCurrentStyle);
}

var oCurrentListOfNodes=[];

var iListItemArrayIndex=0;
var iChildNodeIndex=0;
while(oNode.childNodes.length>iChildNodeIndex)
{
if(oNode.childNodes[iChildNodeIndex].tagName==="BR")
{
oNode.removeChild(oNode.childNodes[iChildNodeIndex]);
if(oCurrentListOfNodes.length>0)
{
aReturnListItems.add(vp.studio.ListConverter._createListItem(oCurrentListOfNodes,oCurrentStyle));
oCurrentListOfNodes=[];
iChildNodeIndex=0;
}
}
else if(aRecursiveListItems[iListItemArrayIndex])
{
oNode.removeChild(oNode.childNodes[iChildNodeIndex]);
aReturnListItems.append(aRecursiveListItems[iListItemArrayIndex]);
}
else
{
oCurrentListOfNodes.add(oNode.childNodes[iChildNodeIndex]);
iChildNodeIndex++;
}
iListItemArrayIndex++;
}

if(oCurrentListOfNodes.length>0)
{
aReturnListItems.add(vp.studio.ListConverter._createListItem(oCurrentListOfNodes,oCurrentStyle));
}

return aReturnListItems;
};

vp.studio.ListConverter._getCssStyles=function $vpfn_1x2ziJ9l7u1xl5srOUod4g96$40(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0,l=oNode.attributes.length;i<l;i++)
{
if(oNode.attributes[i].nodeName.toLowerCase()==="style")
{
return new vp.web.CssString(oNode.attributes[i].value);
}
}
return null;
};

vp.studio.ListConverter._createListItem=function $vpfn_4corFutcglMrLlZplV7RGA108$42(aNodes,oStyles)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oNewListItem=aNodes[0].ownerDocument.createElement("LI");
if(oStyles)
{
oNewListItem.setAttribute("style",oStyles.toString());
}

for(var i=0,l=aNodes.length;i<l;i++)
{
oNewListItem.appendChild(aNodes[i]);
}

return oNewListItem;
};


vp.studio.ListConverter.removeTopLevelList=function $vpfn_bVWXH1LipMpZ$hMJHm6U3w126$45(oXmlNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oXmlNode.childNodes.length===1&&oXmlNode.childNodes[0].tagName)
{
var sTagName=oXmlNode.childNodes[0].tagName.toUpperCase();

if(sTagName==="OL"||sTagName==="UL")
{
var oListNode=oXmlNode.childNodes[0];

var oNodeStyle=vp.studio.ListConverter._getCssStyles(oXmlNode);
var oListStyle=vp.studio.ListConverter._getCssStyles(oListNode);
if(oListStyle)
{
if(!oNodeStyle)
{
oNodeStyle=new vp.web.CssString("");
}
for(var style in oListStyle.items)
{
oNodeStyle.setItem(style,oListStyle.items[style]);
}
}
oXmlNode.setAttribute("style",oNodeStyle.toString());

var iChildLength=oListNode.childNodes.length;

while(iChildLength>0)
{
var oChildNode=oListNode.childNodes[0];
if(oChildNode.tagName&&oChildNode.tagName.toUpperCase()==="LI")
{
var oNode=oXmlNode.ownerDocument.createElement("SPAN");
var sStyle=oChildNode.getAttribute("style");
if(sStyle)
{
oNode.setAttribute("style",sStyle);
}
while(oChildNode.childNodes.length>0)
{
oNode.appendChild(oChildNode.childNodes[0]);
}

oXmlNode.appendChild(oNode);
if(iChildLength>1)
{

oXmlNode.appendChild(oXmlNode.ownerDocument.createElement("BR"));
}
oListNode.removeChild(oChildNode);
iChildLength=oListNode.childNodes.length;
}
}

oXmlNode.removeChild(oListNode);
}
}

return oXmlNode;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.ToolbarButton=function $vpfn_ZgW$Vaf5coIL0rcZ5Dd1cQ13$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.buttonID=null;





this.imageSrc=null;






this.stateDetector=null;





this.isMultiState=false;

this.isDisabledBecauseFontStyleNotSupported=false;





this.element=null;





this.width=21;





if(Editor.features.enableStylizedToolbar)
{
this.height=27;
}
else
{
this.height=20;
}





this.tooltipText="";





this.requiresRichText=false;






this.linkedTextField=null;





this.visible=true;






this.linkedTextArea=null;

this.onbuttonclick=new vp.events.CustomEvent(this,"onbuttonclick");





this.colors={
border:"#08246b",
rollover:"#dfdfdf",
selected:"#dfdfdf",
selectedRollover:"#b6bdd2"
};

this.toolbar=null;





this.render=function $vpfn_JSiDerK1U3smmmo2przLnA120$18(oToolbar,oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.toolbar=oToolbar;

if(me.visible)
{
if(Editor.features.enableStylizedToolbar)
{
renderStylizedToolbarButton(oParentElement);
}
else
{
renderDefaultToolbarButton(oParentElement);
}
}
};

var renderStylizedToolbarButton=function $vpfn_gIRZTseWAlUyd7brohN9Rg137$38(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element=document.createElement("IMG");
me.element.className="studioStylizedToolbarItem";
if(me.buttonID)
{
me.element.id='toolbarButton_'+me.buttonID;
}
me.element.unselectable="on";

var sImgSrc=me.imageSrc;

vp.ui.setImageSrcSprite(me.element,sImgSrc,true);

if(me.width>0)
{
me.element.width=me.width;
}
else
{
me.element.removeAttribute("width");
}

me.element.height=me.height;
me.element.style.marginLeft="-1px";
me.element.style.marginRight="-1px";
me.element.title=me.tooltipText;

vp.events.add(me.element,"click",me.onclick);
vp.events.add(me.element,"mousedown",me.onmousedown);
vp.events.add(me.element,"mouseover",me.rollover);
vp.events.add(me.element,"mouseout",me.rollout);

oParentElement.appendChild(me.element);
};

var renderDefaultToolbarButton=function $vpfn_Zr$GgwcrIvr0hARD3U2lPA173$37(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.borderElement=document.createElement("DIV");
me.borderElement.className="studioToolbarItem";

if(Editor.features.enableStylizedToolbar)
{
me.borderElement.style.margin="0px";
}
else if(Editor.IsExtendedToolbarEnabled)
{
me.borderElement.style.margin="2px 4px 3px 4px";
}
else
{
me.borderElement.style.margin="2px 0px 3px 0px";
}
me.borderElement.unselectable="on";

me.element=document.createElement("IMG");
me.element.className="studioToolbarImage";
if(me.buttonID)
{
me.element.id='toolbarButton_'+me.buttonID;
}

if(me.width>0)
{
me.element.width=me.width;
}
else
{
me.element.removeAttribute("width");
}

me.element.height=me.height;
me.element.title=me.tooltipText;

var sImgSrc=me.imageSrc;
if(sImgSrc.indexOf("/")!==0&&sImgSrc.indexOf("http")!==0)
{
sImgSrc="/vp/images/nns/studio/toolbar2/sprite/"+sImgSrc;
}
vp.ui.setImageSrcSprite(me.element,sImgSrc,true);

vp.events.add(me.element,"click",me.onclick);
vp.events.add(me.element,"mousedown",me.onmousedown);
vp.events.add(me.element,"mouseover",me.rollover);
vp.events.add(me.element,"mouseout",me.rollout);

oParentElement.appendChild(me.borderElement);
me.borderElement.appendChild(me.element);
};




this.renderWithoutToolbar=function $vpfn_DK3bLbtZax_3oNyA$_weEA230$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return;
};





this.rollover=function $vpfn__C2dqRR_kY7rwFEFZkII9Q239$20(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window.status=me.tooltipText;
me.isRollover=true;
me.redraw();
};





this.rollout=function $vpfn_h64MSabUSeb4OjZVLGm9hA250$19(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window.status="";
me.isRollover=false;
me.redraw();
};






this.onclick=function $vpfn_NgxVhT6jvsDC4U6hmC0uAQ262$19(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.studio.instrumentation.add("Studio_ClickToolbarButton"+me.buttonID);

if(me.disabled)
{
if(this.linkedTextField!==null&&!me.isDisabledBecauseFontStyleNotSupported)
{

vp.studio.ui.processDisabledButtonEvent(e,me.buttonID);
}
return;
}

var oCommand;


if(me.createCommand)
{
oCommand=me.createCommand();
}
else
{

var sFinalValue=me.stateDetector.onValue;
if(me.stateDetector.offValue&&(me.state==STATE_ON||me.state==STATE_COMPLEX))
{
sFinalValue=me.stateDetector.offValue;
}

if(Editor.features.rangyRichTextEnabled)
{
vp.studio.commands.RichText.createAndExecute(me.stateDetector.property,me.stateDetector.onValue);
}
else
{
oCommand=new vp.studio.commands.SetStyle(me.getSelection().getState(),me.stateDetector.property,sFinalValue);
}
}

if(oCommand)
{
oCommand.execute();
Editor.history.add(oCommand);
}
me.refresh();

me.onbuttonclick.fire(e);
};






this.onmousedown=function(e)
{

};

var _oCachedSelection=null;






this.getSelection=function $vpfn_$vvdaHLTD2ikhehwljD2UQ330$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.linkedTextField)
{
if(!_oCachedSelection)
{
_oCachedSelection=new vp.studio.Selection();

if(me.linkedTextArea)
{
_oCachedSelection.setTextRange(me.linkedTextField);
}
else
{
_oCachedSelection.add(me.linkedTextField);
}
}

return _oCachedSelection;
}
else
{
return Editor.selection;
}
};




this.refresh=function $vpfn_ffNMKFaNN0Ae49VNevMkxA359$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.stateDetector)
{
me.disabled=false;
return;
}

var oSelection=me.getSelection();


if(me.stateDetector.isDisabled(oSelection))
{
me.disabled=true;
me.isDisabledBecauseFontStyleNotSupported=false;
}
else
{
me.disabled=false;

if(me.isMultiState)
{
if(me.stateDetector.property=="fontWeight"||me.stateDetector.property=="fontStyle")
{
if(!vp.studio.font.getFontSupportsStyle(me.stateDetector.property,oSelection))
{
me.disabled=true;
me.isDisabledBecauseFontStyleNotSupported=true;
if(me.stateDetector.property=="fontWeight")
{
me.element.title=window.JSLM_FontStyleBoldNotSupported;
}
else
{
me.element.title=window.JSLM_FontStyleItalicNotSupported;
}
}
else
{
me.isDisabledBecauseFontStyleNotSupported=false;
me.element.title=me.tooltipText;
me.state=me.stateDetector.getState(oSelection);
}
}
else if(Editor.features.rangyRichTextEnabled&&(me.stateDetector.property=="font-weight"||me.stateDetector.property=="font-style"))
{

var fontStyle=(new vp.studio.richtext.ValueStateDetector("font-family")).getValue();
me.disabled=!vp.studio.font._getFontSupportsStyle(fontStyle,me.stateDetector.property==="font-weight",me.stateDetector.property==="font-style");
me.isDisabledBecauseFontStyleNotSupported=me.disabled;
if(me.disabled)
{
me.element.title=me.stateDetector.property==="font-weight"?JSLM_FontStyleBoldNotSupported:JSLM_FontStyleItalicNotSupported;
}
else
{
me.element.title=me.tooltipText;
me.state=me.stateDetector.getState(oSelection);
}
}
else
{
var state=me.stateDetector.getState(oSelection);



if(!state&&me.stateDetector.property==="text-align"&&me.stateDetector.onValue==="left")
{
var textAlign=(new vp.studio.richtext.ValueStateDetector(me.stateDetector.property)).getValue();
state=!textAlign;
}
me.state=state;
}
}
}

me.redraw();
};




var showBorder=function $vpfn_QOUkm3EFhmYanueLGaTN0w441$21(bShow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.borderElement&&me.borderElement.style)
{



me.borderElement.style.backgroundColor=bShow?me.colors.border:"";
}
};




this.redraw=function $vpfn_x$Z8WwOb3K4ERa4nJCFz9A455$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.element)
{




return;
}

var bIsOn=(me.state==STATE_ON||me.state==STATE_COMPLEX)&&!me.disabled;


var sStatus="";
if(me.disabled)
{
sStatus="disabled";
}
else if(bIsOn)
{
sStatus="selected";
}
else if(me.isRollover)
{
sStatus="rollover";
}
me.element.setAttribute("status",sStatus);

if(Editor.features.enableStylizedToolbar)
{
stylizedRedraw(bIsOn);
}
else
{
defaultRedraw(bIsOn);
}
};

var stylizedRedraw=function $vpfn_qexHGSnx$831$qxuHBOeyg494$25(bIsOn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sImgSrc=me.imageSrc;

if(me.disabled&&me.disabledImageSrc)
{
sImgSrc=me.disabledImageSrc;
}
else if(bIsOn&&me.selectedImageSrc)
{
sImgSrc=me.selectedImageSrc;
}
else if(me.isRollover&&me.mouseoverImageSrc)
{
sImgSrc=me.mouseoverImageSrc;
}

vp.ui.setImageSrcSprite(me.element,sImgSrc,true);
};

var defaultRedraw=function $vpfn_2LEoXRq$ZzyyirjhDvdhDA514$24(bIsOn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

showBorder(me.isRollover||bIsOn);

if(me.disabled)
{
showBorder(false);
me.element.style.backgroundColor="";

vp.ui.setOpacity(me.element,0.5);

return;
}

vp.ui.setOpacity(me.element,1);


var sBgColor="";
if(me.isRollover&&bIsOn)
{
sBgColor=me.colors.selectedRollover;
}
else if(me.isRollover)
{
sBgColor=me.colors.rollover;
}
else if(bIsOn)
{
sBgColor=me.colors.selected;
}

me.element.style.backgroundColor=sBgColor;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.ToolbarMenu=function $vpfn_lTkTgdGXWBZ9nKH0dzmCpg10$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.buttonID=null;





this.property=null;






this.stateDetector=null;

this.menuWidth=0;

this.width=0;

this.menu=null;





this.toolbar=null;




this.render=function $vpfn_O3rxLpkgBUMLSV25V3XBnA48$18(oToolbar,oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.toolbar=oToolbar;

me.element=document.createElement("DIV");
me.element.id="div"+me.buttonID;
me.element.className=Editor.features.enableStylizedToolbar?"studioStylizedToolbarItem":"studioToolbarItem";
me.element.style.padding=0;
me.element.unselectable="on";
me.element.style.width=me.width+"px";
me.element.style.height="20px";

vp.events.add(me.element,"mousedown",onClickHandler);

if(oParentElement)
{
oParentElement.appendChild(me.element);
}

var menuElement=document.createElement("DIV");
menuElement.style.margin=Editor.IsExtendedToolbarEnabled?"3px 4px 3px 8px":"3px 4px 3px 0px";
if(Editor.features.enableStylizedToolbar)
{
menuElement.style.margin="3px 1px 3px 0px";
}
menuElement.style.width=(me.width-(Editor.IsExtendedToolbarEnabled?12:1))+"px";
me.element.appendChild(menuElement);

me.menu=new vp.widget.RichMenu(menuElement);

if(me._transformSelectedItemHTML)
{
me.menu.transformSelectedItemHTML=me._transformSelectedItemHTML;
}

me.menu.menuHeight=300;
me.menu.menuWidth=me.menuWidth;
me.menu.onchange.addHandler(onChangeHandler);

var oItems=me._getOptions();
for(var i=0;i<oItems.length;i++)
{
me._addOption(oItems[i].key,oItems[i].value);
}
};

var onChangeHandler=function $vpfn_YiTjxcCX0mPOacM2N9z$Nw94$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me._onChangeHandler(me.menu.getValue());
};

var onClickHandler=function $vpfn_uuFWNBXPlGNGInnn4kRWaw99$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.menu.isEnabled())
{
vp.studio.ui.processDisabledButtonEvent(e,me.buttonID);
}
else
{
me._onClickHandler(e);
}
};




this.refresh=function $vpfn_XYZNMRlYd5dr6xUdWWu3SA115$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.stateDetector.isDisabled(Editor.selection))
{
me.menu.setEnabled(false);
}
else
{
me.menu.setEnabled(true);
var sValue=me.stateDetector.getValue(Editor.selection);

if(!sValue)
{
sValue="";
}



if((Editor.features.rangyRichTextEnabled||sValue)&&!me.setValue(sValue))
{
this._onSelectedItemNotFound(sValue);
}
}
};

this._transformSelectedItemHTML=null;


this.setValue=function $vpfn_s6KY0QU7HLkle5KRGpwBeA144$20(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.menu.setValue(sValue);
};

this._onSelectedItemNotFound=function(sValue)
{
};







this._getOptions=function()
{
};

this._addOption=function $vpfn_t6OM9w4_wQw0bcECfd$QyQ163$22(sKey,sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.menu.addOption(sKey,sValue);
};




this._onChangeHandler=function(sSelectedValue)
{
};




this._onClickHandler=function(e)
{
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.ListBase=function $vpfn_hw7fslIxqxDE3axggF2Xjg12$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();





this.property="";





this.listType="";





this.isMultiState=true;





this.requiresRichText=true;





this.stateDetector=null;

this._init=function $vpfn_gb3P8so3LJLeGoU8_WVKiw52$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.stateDetector=new vp.studio.richtext.MultiStateDetector(me.property);
me.stateDetector.supportedTypes=[DOCITEM_TYPE_TEXT];
me.stateDetector.supportsTextRanges=true;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.ImageFactory={};







vp.studio.ImageFactory.createImage=function $vpfn_hMDSV0zZfr6$To0r7leWQw18$37(iDocItemType,iItemID,fAssignID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oImage;

if(iDocItemType==DOCITEM_TYPE_LIBRARY_IMAGE)
{
oImage=new vp.studio.LibraryImage();
}
else if(iDocItemType==DOCITEM_TYPE_UPLOADED_IMAGE)
{
oImage=new vp.studio.UploadedImage();
}
else if(iDocItemType==DOCITEM_TYPE_LOGO)
{
oImage=new vp.studio.Logo();
}
else if(iDocItemType==DOCITEM_TYPE_PLACEHOLDER)
{
oImage=new vp.studio.PlaceHolder();
}

oImage.setItemID(iItemID);

if(fAssignID)
{
fAssignID(oImage);
}

return oImage;
};








vp.studio.ImageFactory.convertImage=function $vpfn_DyX_WX9XqLb1GGW0DURz1Q56$38(oImage,iDocItemType,iItemID)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNewImage=vp.studio.ImageFactory.createImage(iDocItemType,iItemID);


oImage.applyCoreAttributesTo(oNewImage,false);


oNewImage.coordinates.copyFrom(oImage.coordinates);

if(oNewImage.cropInfo&&oImage.cropInfo)
{
oImage.cropInfo.applyTo(oNewImage.cropInfo);
oNewImage.cropInfo.UseCropValues=oImage.cropInfo.UseCropValues;
}

if(oImage.isEditableInLiteStudio)
{
oNewImage.makeEditableInLiteStudio();
}

return oNewImage;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}





var FONT_STYLE_REGULAR=0;
var FONT_STYLE_BOLD=1;
var FONT_STYLE_ITALIC=2;
var FONT_STYLE_BOLD_ITALIC=4;





var FONT_STYLE_INDEX=1;
var FONT_LOCALIZED_NAME_INDEX=2;
var FONT_NAME_INDEX=0;
var FONT_IC_FONT_ID_INDEX=3;






vp.studio.font=function(){};





vp.studio.font.getLocalizedFontName=function $vpfn_VCuFn0PfCKJ41V0kXabZqQ32$38(sFontName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fontList=window.FontList;
for(var i=0;i<window.FontList.length;i++)
{
if(sFontName.toLowerCase()==fontList[i][FONT_NAME_INDEX].toLowerCase())
{
return fontList[i][FONT_LOCALIZED_NAME_INDEX];
}
}
return sFontName;
};






vp.studio.font.getFontSupportsStyle=function $vpfn_ByeMCFRzL3GtSxXaekTpTg50$38(sProperty,oSelection){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



var oBoldStateDetector=new vp.studio.MultiStateDetector("fontWeight",true,false);
var oItalicStateDetector=new vp.studio.MultiStateDetector("fontStyle",true,false);
var oFontStateDetector=new vp.studio.ValueStateDetector("fontFamily");
oFontStateDetector.supportedTypes=DOCITEM_FONT_ENABLED_TYPES;
oFontStateDetector.supportsTextRanges=true;

var isBold=oBoldStateDetector.getState(oSelection);
var isItalic=oItalicStateDetector.getState(oSelection);
var fontName=oFontStateDetector.getValue(oSelection);


if(sProperty=="fontWeight")
{
isBold=!isBold;
}
else if(sProperty=="fontStyle")
{
isItalic=!isItalic;
}

return vp.studio.font._getFontSupportsStyle(fontName,isBold,isItalic);
};







vp.studio.font._getFontSupportsStyle=function $vpfn_fcwZrI9dJ0PNvol4aynY0g83$39(sFontName,bBold,bItalic)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sFontName===null)
{
return true;
}
var iCode=vp.studio.font._getFontStyleCode(bBold,bItalic);

var fontList=window.FontList;
for(var i=0;i<window.FontList.length;i++)
{
if(sFontName.toLowerCase()==fontList[i][FONT_NAME_INDEX].toLowerCase())
{
return(fontList[i][FONT_STYLE_INDEX]&iCode)==iCode;
}
}
return false;

};






vp.studio.font._getFontStyleCode=function $vpfn_Kp2U6fufc8RNZyzckDJJ5g108$35(bBold,bItalic)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(bBold)
{
if(bItalic)
{
return FONT_STYLE_BOLD_ITALIC;
}
else
{
return FONT_STYLE_BOLD;
}
}
else if(bItalic)
{
return FONT_STYLE_ITALIC;
}

return FONT_STYLE_REGULAR;
};






vp.studio.font.getFontImage=function $vpfn_2Q_jm7SV1QZKTEKkFBp0Gw135$30(sFontName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"/vp/images/b09/studio/fonts/"+sFontName.replace(/\s/gi,"").toLowerCase()+".gif";
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(!vp.studio)
{
vp.studio={};
}







vp.studio.GreekLetterTextArea=function $vpfn_W3M7HNiME0_dwjMyb1SvsA17$32(id,affiliationTextNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.widget.TextArea;
this.inheritFrom(true);

var me=this;

var greekAlphabet=["\u0391",
"\u0392",
"\u0393",
"\u0394",
"\u0395",
"\u0396",
"\u0397",
"\u0398",
"\u0399",
"\u039A",
"\u039B",
"\u039C",
"\u039D",
"\u039E",
"\u039F",
"\u03A0",
"\u03A1",
"\u03A3",
"\u03A4",
"\u03A5",
"\u03A6",
"\u03A7",
"\u03A8",
"\u03A9"];

var greekAlphabetEnglish=["Alpha",
"Beta",
"Gamma",
"Delta",
"Epsilon",
"Zeta",
"Eta",
"Theta",
"Iota",
"Kappa",
"Lambda",
"Mu",
"Nu",
"Xi",
"Omicron",
"Pi",
"Rho",
"Sigma",
"Tau",
"Upsilon",
"Phi",
"Chi",
"Psi",
"Omega"];





this.element=null;





this.id=id;





this.popupElement=null;





this.bSelectorVisible=false;

var base_setValue=this.setValue;




this.setValue=function $vpfn_CI_Oh6UFXwmPWMdP7V3wwA106$20(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var chars=sValue.split("");


for(var i=0;i<3;i++)
{
if(chars[i])
{
me["input"+i].selectedIndex=1+greekAlphabet.indexOf(chars[i]);
}
else
{
me["input"+i].selectedIndex=0;
}
}


setFieldValue(sValue);
};





var setFieldValue=function $vpfn_MscH4bPCPc159tspMgD_DQ132$24(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

base_setValue(sValue);

if(affiliationTextNode)
{
affiliationTextNode.nodeValue=sValue;
}
};




var updateValue=function $vpfn_IkhiLeDbUVDT$3UG2jwjpg146$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sValue=me.input0.options[me.input0.selectedIndex].value+
me.input1.options[me.input1.selectedIndex].value+
me.input2.options[me.input2.selectedIndex].value;

setFieldValue(sValue);
me.onchange.fire();
me.ondelaychange.fire();
};

var base_render=this.render;




this.render=function $vpfn_TYXdZhsdjCPVgVCZEq8Chg162$18(oParent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
base_render(me.element);
oParent.appendChild(me.element);
};




var toggle=function $vpfn_KbqOFtA_FhtyeiviToBLBA171$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.popupElement.style.display=="none")
{
me.showGreekPopup();
}else{
me.closePopup();
}
};




this.closePopup=function $vpfn_hvpEC55ymrvzweAZQa5pQg184$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.popupElement.style.display="none";
me.isFocused=false;
me.onblur.fire();
};

this.showGreekPopup=function $vpfn_z2HNt0CcP4wpsQGMNjNJqg191$26(top,left)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.popupElement.style.display="block";

var oRect=vp.ui.getRect(me.element);
me.popupElement.style.top=oRect.bottom-1+'px';
me.popupElement.style.left=oRect.left+'px';

if("number"==(typeof top))
{
me.popupElement.style.top=top+'px';
}

if("number"==(typeof left))
{
me.popupElement.style.left=left+'px';
}

me.isFocused=true;
me.onfocus.fire();
};

var base_setElementStyle=this.setElementStyle;


this.setStyle=function(){};
this.setStyleSimple=function(){};
this.setElementStyle=function(){};




var init=function $vpfn_ZGdK_0UH4X1OvRZuPYpI9w223$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



base_setElementStyle("display","none");


me.element=document.createElement("div");

var image=document.createElement("img");
image.src="/vp/images/nns/studio/Greek_Button.gif";
image.id=me.id+"_button";
image.className="greekButton";
image.onclick=toggle;
me.element.appendChild(image);

var greekLink=document.createElement("a");
greekLink.id=me.id+"_link";
greekLink.className="greekButton";
greekLink.onclick=toggle;

greekLink.style.marginLeft="5px";
greekLink.appendChild(document.createTextNode(JSLM_SelectGreekLetters));
me.element.appendChild(greekLink);


me.popupElement=document.createElement("div");
me.popupElement.className="greekTextPopup";
me.popupElement.id=me.id+"_text_popup";


var closeDiv=document.createElement("div");
closeDiv.className="closeDiv";
var closeLink=document.createElement("a");
closeLink.className="closeLink";
closeLink.appendChild(document.createTextNode(JSLM_stampsDone));
closeDiv.appendChild(closeLink);
vp.events.add(closeLink,"click",me.closePopup);
me.popupElement.appendChild(closeDiv);


var textDiv=document.createElement("div");

var header=document.createElement("h2");
vp.ui.addClass(header,"greekTextPopupHeader");
header.appendChild(document.createTextNode(JSLM_SelectGreekLetters));
textDiv.appendChild(header);

var paragraph=document.createElement("p");
paragraph.appendChild(document.createTextNode(JSLM_GreekTextInstructions));
vp.ui.setStyleValue(paragraph,"margin","1px");
textDiv.appendChild(paragraph);
me.popupElement.appendChild(textDiv);


for(var i=0;i<3;i++)
{
var currentDiv=document.createElement("div");
currentDiv.className="greekDropdownDiv";
me.popupElement.appendChild(currentDiv);


var input=document.createElement("select");
input.id=me.id+"_select_"+i;
input.style.display="block";
input.style.marginLeft="auto";
input.style.marginRight="auto";


var option=document.createElement("option");
option.appendChild(document.createTextNode("none"));
option.value="";
input.appendChild(option);


for(var j=0;j<greekAlphabet.length;j++)
{
option=document.createElement("option");
option.value=greekAlphabet[j];
option.appendChild(document.createTextNode(greekAlphabetEnglish[j]));
input.appendChild(option);
}

me["input"+i]=input;
input.onchange=updateValue;

currentDiv.appendChild(input);
}

me.popupElement.style.display="none";
document.body.appendChild(me.popupElement);




vp.events.add(document,'mousedown',function $vpfn_odq6kgO8SnFIgf1v4BSPTg319$45(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
if(vp.events.getEventData(e,'smartLayoutFontSelectorClicked')!==me)
{
me.closePopup();
}
});
vp.events.add(me.popupElement,'mousedown',function $vpfn_odq6kgO8SnFIgf1v4BSPTg326$52(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
vp.events.setEventData(e,'smartLayoutFontSelectorClicked',me);
});
vp.events.add(me.element,'mousedown',function $vpfn_odq6kgO8SnFIgf1v4BSPTg330$47(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
vp.events.setEventData(e,'smartLayoutFontSelectorClicked',me);
});
};

init();
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.MailMaskOverlay=function $vpfn_MzehO9jn0pI54pdEbQg_Pg10$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ProductOverlay;
this.inheritFrom();

var me=this;





this.type=DOCITEM_TYPE_MAIL_MASK;

var $container=null;
var $tooltip=null;
var $floatingToolbar=null;

var base_render=this.render;




this.render=function $vpfn_CIbnreYrthM2wvNj2jtJYQ35$18(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.rendered)
{
return;
}

base_render(oEditor);
me.docElement.style.visibility="visible";

$tooltip=$(".mail-mask-tooltip").show();
if($tooltip.length>0)
{
var oTooltip=new vp.widget.RichTooltip($(".mail-mask-tooltip-rollover-area")[0],$tooltip.remove()[0]);
oTooltip.skin=vp.widget.RichTooltip.skins.Message;
oTooltip.width=330;
oTooltip.setBehavior(TOOLTIP_BEHAVIOR_SHOW_ON_CLICK);
oTooltip.renderingStrategy=vp.widget.RichTooltip.renderingStrategies.Above;
}

$floatingToolbar=$(".mail-mask-floating-bar").css({bottom:"75px",right:"50px"}).show();

if($floatingToolbar.length>0)
{
$container=$("<div>")
.appendTo(me.docElement.parentElement)
.append(me.docElement)
.append($floatingToolbar);

$floatingToolbar.find(".close-icon").click(function $vpfn_XAL2Vvbf1kdRS2Dx7jdaOw64$55()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oTooltip.hide();

$tooltip.remove();
$tooltip=$();
$floatingToolbar.remove();
$floatingToolbar=$();
});
}
else
{
$container=$(me.docElement);
}
};



this.unrender=function $vpfn_SRCsScdFTIEM4Z_tVnbylA82$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

$floatingToolbar.appendTo(document.body).hide();
$tooltip.appendTo(document.body).hide();
$container.remove();
me.rendered=false;
};

this.toggle=function $vpfn_e3yVIeZPOXo8vI4KAhFdQg91$18(bShow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
bShow?$container.show():$container.hide();
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.BoldButton=function $vpfn_V3SRnH4BSs$PTOzsk6aRmQ11$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();





this.buttonID='Bold';





if(Editor.features.enableStylizedToolbar)
{
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/bold.png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/bold_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/bold_select.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/bold_dis.png");
this.width=27;
}
else
{
this.imageSrc="bold.gif";
}





this.tooltipText=JSLM_StudioToolbarBold;





this.isMultiState=true;





if(Editor.features.rangyRichTextEnabled){
this.stateDetector=new vp.studio.richtext.MultiStateDetector("font-weight","bold","normal");
}
else{
this.stateDetector=new vp.studio.MultiStateDetector("fontWeight","bold","normal");
}

this.stateDetector.supportedTypes=DOCITEM_FONT_ENABLED_TYPES;
this.stateDetector.supportsTextRanges=true;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}














vp.studio.ChangeCurveButton=function $vpfn_oEMonC9XBgAV3bPMfcWyCA16$30(iCurveType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();
var me=this;





this.buttonID="ChangeCurve"+iCurveType;





if(Editor.features.enableStylizedToolbar)
{
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/curve"+iCurveType+".png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/curve"+iCurveType+"_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/curve"+iCurveType+"_selected.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/curve"+iCurveType+"_dis.png");
this.width=27;
}
else
{
this.imageSrc="changeCurve"+iCurveType+".gif";
}





this.tooltipText="Change Text Curve";
switch(iCurveType)
{
case 1:
this.tooltipText=JSLM_StudioContextMenuMediumCurveDown;
break;
case 2:
this.tooltipText=JSLM_StudioContextMenuLightCurveDown;
break;
case 5:
this.tooltipText=JSLM_StudioContextMenuMediumCurveUp;
break;
case 4:
this.tooltipText=JSLM_StudioContextMenuLightCurveUp;
break;
case 3:
default:
this.tooltipText=JSLM_StudioContextMenuStraightCurve;
break;
}





this.isMultiState=false;

this.createCommand=function $vpfn_eDwy2GCcra$l5E_hONX2AQ79$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oSelection=me.getSelection().getState();
var oItem=oSelection.selectedTextField;

var oStyle=null;

switch(iCurveType)
{
case 1:
oStyle=vp.studio.WordArt.getChangeWordArtCommand(vp.studio.WordArt.initialStyles.SHARP_CONVEX,oItem,oSelection);
break;
case 2:
oStyle=vp.studio.WordArt.getChangeWordArtCommand(vp.studio.WordArt.initialStyles.CONVEX,oItem,oSelection);
break;
case 5:
oStyle=vp.studio.WordArt.getChangeWordArtCommand(vp.studio.WordArt.initialStyles.SHARP_CONCAVE,oItem,oSelection);
break;
case 4:
oStyle=vp.studio.WordArt.getChangeWordArtCommand(vp.studio.WordArt.initialStyles.CONCAVE,oItem,oSelection);
break;
case 3:
default:
oStyle=vp.studio.WordArt.getChangeWordArtCommand(vp.studio.WordArt.initialStyles.STRAIGHT,oItem,oSelection);
break;
}

if(oStyle===null)
{
throw new Error("ChangeCurveButton: curve type isn't set");
}

return oStyle;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.ItalicButton=function $vpfn_XvgasTfldKiV$rMH2uZMvA11$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();





this.buttonID='Italic';





if(Editor.features.enableStylizedToolbar){
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/italic.png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/italic_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/italic_select.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/italic_dis.png");
this.width=27;
}
else{
this.imageSrc="italic.gif";
}





this.tooltipText=JSLM_StudioToolbarItalic;





this.isMultiState=true;






if(Editor.features.rangyRichTextEnabled){
this.stateDetector=new vp.studio.richtext.MultiStateDetector("font-style","italic","normal");
}
else
{
this.stateDetector=new vp.studio.MultiStateDetector("fontStyle","italic","normal");
}

this.stateDetector.supportedTypes=DOCITEM_FONT_ENABLED_TYPES;
this.stateDetector.supportsTextRanges=true;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.SpecialCharactersButton=function $vpfn_JnglGlS7930mj9XoCeV_TQ10$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();





this.buttonID='SpecialCharacters';





if(Editor.features.enableStylizedToolbar)
{
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/special_chars.png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/special_chars_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/special_chars_select.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/special_chars_dis.png");
this.width=27;
}
else
{
this.imageSrc="special_chars.gif";
}





this.tooltipText=JSLM_StudioToolbarSpecialChars;





this.dialogTitle=JSLM_SpecialCharactersClick;





var range=null;
this.createCommand=function $vpfn_4z3ziY3S_A_fpNgFso4veA58$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}






if(!Editor.features.rangyRichTextEnabled)
{

vp.studio.ui.saveTextSelection();
}else
{
range=rangy.getSelection().getAllRanges()[0];
}

var oURL=new vp.web.URL("/vp/ns/special_chars_tool.aspx");
oURL.setItem("callback_id",vp.win.createCallbackHandler(insertChar));

vp.studio.ui.openDialog(
"specialChars",
this.dialogTitle,
oURL.toString(),
vp.dialog.chrome.Primary,
420,
360);

return new vp.studio.commands.Null();
};

var insertChar=function $vpfn_EXsX$Z_gLlOwX31corn_rQ89$21(sChar)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!Editor.features.rangyRichTextEnabled)
{
vp.studio.ui.restoreTextSelection();
}
vp.studio.ui.insertChar(sChar,range);
};






this.stateDetector=new vp.studio.StateDetector();
this.stateDetector.isDisabled=function $vpfn_HVL5OUYUxv9$AKOBWNjw1g104$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!Editor.currentField&&!Editor.selection.isTextRange();
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.FontSizeIncreaseButton=function $vpfn_mmHAlohfmVc4u2Gom4f$ow11$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();

var me=this;





this.buttonID='FontSizeIncrease';





if(Editor.features.enableStylizedToolbar)
{
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_increase.png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_increase_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_increase_select.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_increase_dis.png");
this.width=27;
}
else
{
this.imageSrc="font_larger.gif";
}





this.tooltipText=JSLM_StudioFontSizeIncreaseButton;





this.isMultiState=false;

this.createCommand=function $vpfn_N4FX7ewF9YF6B2GY_4Ctgg56$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oSelection=me.getSelection();
var oItem=oSelection.getItem(0);

if(oItem.type==DOCITEM_TYPE_TEXT)
{
var iNewSize=oItem.fontSize;

for(var i=0;i<Editor.availableFontSizes.length;i++)
{
var iSize=Editor.availableFontSizes[i]*2;
if(iSize>oItem.fontSize)
{
iNewSize=iSize;
break;
}
}

return new vp.studio.commands.SetStyle(oSelection,"fontSize",iNewSize);
}
else if(oItem.type==DOCITEM_TYPE_WORDART)
{
var styles={};
var relativeDifference=0.1;
styles.height=oItem.coordinates.getRect().height*(1+relativeDifference);
styles.width=oItem.coordinates.getRect().width*(1+relativeDifference);
return new vp.studio.commands.SetStyles(oSelection,styles);
}
};





this.stateDetector=new vp.studio.ValueStateDetector("fontSize");
this.stateDetector.supportedTypes=DOCITEM_TEXT_TYPES;
this.stateDetector.supportsTextRanges=false;

var base_stateDetector_isDisabled=this.stateDetector.isDisabled;
this.stateDetector.isDisabled=function $vpfn_Xv3RCWgUf2qNYbCsA7EU$w97$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=me.getSelection();

if(base_stateDetector_isDisabled(oSelection))
{
return false;
}


var oItem=oSelection.getItem(0);

if(oItem.type==DOCITEM_TYPE_TEXT)
{
return oItem.fontSize>=(Editor.availableFontSizes[Editor.availableFontSizes.length-1]*2);
}else
{
return false;
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.FontSizeDecreaseButton=function $vpfn_ec5wZEv7RY3toN3s7BJN8A11$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.inheritFrom=vp.studio.ToolbarButton;
this.inheritFrom();

var me=this;





this.buttonID='FontSizeDecrease';





if(Editor.features.enableStylizedToolbar)
{
this.imageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_decrease.png");
this.mouseoverImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_decrease_over.png");
this.selectedImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_decrease_select.png");
this.disabledImageSrc=vp.ui.imageUrl("/vp/images/b09/studio/toolbar-button/text_decrease_dis.png");
this.width=27;
}
else
{
this.imageSrc="font_smaller.gif";
}





this.tooltipText=JSLM_StudioFontSizeDecreaseButton;





this.isMultiState=false;




var wordArtRelativeDifference=0.1;

this.createCommand=function $vpfn_ny3OGGiu5u1eqrz13_y9tA61$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oSelection=me.getSelection();
var oItem=oSelection.getItem(0);

if(oItem.type==DOCITEM_TYPE_TEXT)
{


var iNewSize=Math.max(oItem.fontSize,Editor.availableFontSizes[0]*2);

for(var i=Editor.availableFontSizes.length-1;i>=0;i--)
{
var iSize=Editor.availableFontSizes[i]*2;
if(iSize<oItem.fontSize)
{
iNewSize=Editor.availableFontSizes[i]*2;
break;
}
}

return new vp.studio.commands.SetStyle(oSelection,"fontSize",iNewSize);
}
else if(oItem.type==DOCITEM_TYPE_WORDART)
{
var styles={};
styles.height=oItem.coordinates.getRect().height/(1+wordArtRelativeDifference);
styles.width=oItem.coordinates.getRect().width/(1+wordArtRelativeDifference);
return new vp.studio.commands.SetStyles(oSelection,styles);
}
};





this.stateDetector=new vp.studio.ValueStateDetector("fontSize");
this.stateDetector.supportedTypes=DOCITEM_TEXT_TYPES;
this.stateDetector.supportsTextRanges=false;

var base_stateDetector_isDisabled=this.stateDetector.isDisabled;
this.stateDetector.isDisabled=function $vpfn_BONjrb0OXaSpX9h3j_Figw103$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=me.getSelection();

if(base_stateDetector_isDisabled(oSelection))
{
return false;
}


var oItem=oSelection.getItem(0);

if(oItem.type==DOCITEM_TYPE_TEXT)
{
return oItem.fontSize<=(Editor.availableFontSizes[0]*2);
}
else if(oItem.type==DOCITEM_TYPE_WORDART)
{

return((oItem.coordinates.getRect().height/(1+wordArtRelativeDifference))<1)||
((oItem.coordinates.getRect().width/(1+wordArtRelativeDifference))<1);
}
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.SetStyle=function $vpfn_MXVdYG5A$exgVQVAc3xI6w15$30(oSelection,sProperty,vFinalValueOrArray)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Set Style";





this.selection=oSelection;





this.property=sProperty;





this.initialValues=oSelection.getStyleArray(sProperty,true);





this.initialTextValues=null;






var getTextArray=function $vpfn_k54cYZ_s2jbLULdxp6Odxg54$23(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aData=[];

if(oSelection.isTextRange())
{
aData[0]=oSelection.selectedTextField.data;
}
else
{
for(var i=0;i<oSelection.getLength();i++)
{
aData[i]=oSelection.getItem(i).data;
}
}

return aData;
};

this.initialTextValues=getTextArray(this.selection);





this.finalTextValues=null;






this.initialHeights=null;

if(sProperty=="fontSize")
{
this.initialHeights=oSelection.getStyleArray("height");
}





this.finalValues=null;

if(vp.core.isArray(vFinalValueOrArray))
{
this.finalValues=vFinalValueOrArray;
}
else
{
this.finalValues=[];
if(this.selection.isTextRange())
{
this.finalValues[0]=vFinalValueOrArray;
}
else
{
for(var i=0;i<this.selection.getLength();i++)
{
this.finalValues[i]=vFinalValueOrArray;
}
}
}




this.execute=function $vpfn_sJfdg4HymqICR_ybyIyRgg122$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



if(me.selection.isTextRange()&&!me.finalTextValues)
{
var oTextField=me.selection.selectedTextField;
me.initialValues=[oTextField[me.property]];

var bAffectSelectedTextOnly=oTextField.textAreaType==TEXT_AREA_TYPE_RICH;
oTextField.setStyle(me.property,me.finalValues[0],false,bAffectSelectedTextOnly);
}
else
{
var arr=me.selection.getArray();

for(var i=0;i<arr.length;i++)
{
if(arr[i].setStyle)
{
arr[i].setStyle(me.property,me.finalValues[i],true);

var sValue;

arr[i].refresh();
arr[i].onchange.fire({property:me.property});
}
}
}

if(!me.finalTextValues)
{
me.finalTextValues=getTextArray(me.selection);
}

if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};




this.undo=function $vpfn_erdKpZT_5xkwdFQh28OUkg167$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.selection.isTextRange()&&me.selection.selectedTextField.textAreaType==TEXT_AREA_TYPE_RICH)
{
me.selection.selectedTextField.setStyle(me.property,me.initialValues[0],true);
me.selection.selectedTextField.setData(me.initialTextValues[0]);
me.selection.selectedTextField.refresh();
}
else
{

var arr=me.selection.getArray();
for(var i=0;i<arr.length;i++)
{
if(arr[i].setStyle)
{


if(DOCITEM_TEXT_TYPES.contains(arr[i].type)&&arr[i].textAreaType==TEXT_AREA_TYPE_RICH)
{
arr[i].setOuterStyle(me.property,me.initialValues[i]);
arr[i].setData(me.initialTextValues[i]);

arr[i].refresh();
}
else
{

arr[i].setStyle(me.property,me.initialValues[i]);
}

if(me.initialHeights)
{
arr[i].setStyle("height",me.initialHeights[i]);
}
}
}
}


if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};





this.isVoid=function $vpfn_MFcjJfCQhVvNbt4vFEnyPQ217$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.isRichTextEnabled())
{
return me.selection.isTextRange();
}
else
{

if(me.initialValues.length!=me.finalValues.length)
{
return false;
}
for(var i=0;i<me.initialValues.length;i++)
{
var sInit=(me.initialValues[i]||"").toString();
var sFinal=(me.finalValues[i]||"").toString();
if(sInit!=sFinal)
{
return false;
}
}
return true;
}
};





this.getInfo=function $vpfn_fqwu36IE5gsTGiB0fvg6gA248$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(this.selection);
oInfo.setItem("property",this.property);
oInfo.setArray("initial",this.initialValues);
oInfo.setArray("final",this.finalValues);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.SetStyles=function $vpfn_UXKVmOUXO_RS2CqIWpTAXQ15$31(oSelection,oPropertyValueMap)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Set Styles";





this.selection=oSelection;





this.propertyValueMap=oPropertyValueMap;




var aItems=me.selection.getArray();





this.initialValues=[];

for(var i=0;i<aItems.length;i++)
{
me.initialValues[i]={};
for(var sProperty in oPropertyValueMap)
{

var aCoordinateProps=["top","left","height","width"];
if(aCoordinateProps.contains(sProperty))
{
me.initialValues[i][sProperty]=aItems[i].coordinates.getRect()[sProperty];
}else{
me.initialValues[i][sProperty]=aItems[i][sProperty];
}
}
}




this.execute=function $vpfn_6zcac8p0Yf$pn0kQTWETuw67$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<aItems.length;i++)
{
if(aItems[i].setStyle)
{
for(var sProperty in me.propertyValueMap)
{
aItems[i].setStyle(sProperty,me.propertyValueMap[sProperty],true);
}

aItems[i].refresh();
}
}

if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};




this.undo=function $vpfn_nuJ2_SEyFXtoP5bq0shutw91$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<aItems.length;i++)
{
if(aItems[i].setStyle)
{
for(var sProperty in me.initialValues[i])
{
aItems[i].setStyle(sProperty,me.initialValues[i][sProperty],true);
}

aItems[i].refresh();
}
}
};





this.isVoid=function $vpfn_ke8CsRWDnrQ8s6KrxMkhjg111$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<aItems.length;i++)
{
for(var sProperty in oPropertyValueMap)
{
var finalValue=me.initialValues[i][sProperty];


var aCoordinateProps=["top","left","height","width"];
if(aCoordinateProps.contains(sProperty))
{
finalValue=aItems[i].coordinates.getRect()[sProperty];
}else{
finalValue=aItems[i][sProperty];
}


if(finalValue!=me.initialValues[i][sProperty])
{
return false;
}
}
}

return true;
};





this.getInfo=function $vpfn_Lnq5IezLTLNjMLelrWVAKw143$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(this.selection);
oInfo.setItem("propertyValueMap",me.propertyValueMap);
oInfo.setArray("initialValues",this.initialValues);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.ChangeFontScheme=function $vpfn_fYZoDXfdOCUm0gVV7ltsDQ15$38(iFontSchemeID,aSchemeFontNames)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Change Font Scheme";





this.selection=new vp.studio.Selection();

this.fontSchemeID=iFontSchemeID;

this.fontScheme=aSchemeFontNames;

this.initialFontSchemeID=-1;

this.initialFontScheme=null;

var aFinalValues=[];


var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(DOCITEM_TEXT_TYPES.contains(Editor.items[i].type))
{
if(Editor.items[i].fontSchemeRef!=-1)
{
aFinalValues.add(aSchemeFontNames[Editor.items[i].fontSchemeRef]);
this.selection.add(Editor.items[i],true);
}
}
}


var _oSetStyleCommand=new vp.studio.commands.SetStyle(this.selection,"fontFamily",aFinalValues);




this.execute=function $vpfn_w0TEi3VWqmWRdtHtQCsa8A61$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.initialFontScheme)
{
me.initialFontSchemeID=Editor.fontSchemeID;
me.initialFontScheme=Editor.fontScheme;
}

Editor.fontSchemeID=me.fontSchemeID;
Editor.fontScheme=me.fontScheme;
_oSetStyleCommand.execute();
};




this.undo=function $vpfn_6ChWA4cf0Ce8r5YxIe4CsQ77$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.fontSchemeID=me.initialFontSchemeID;
Editor.fontScheme=me.initialFontScheme;

_oSetStyleCommand.undo();
if(vp.studio.FontSchemePicker)
{
vp.studio.FontSchemePicker.changeFontSchemeSelection(me.initialFontSchemeID,me.initialFontScheme);
}
};





this.isVoid=function $vpfn_mUISTjfpvr4lyRYxcLZGeA93$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.initialFontSchemeID==me.fontSchemeID;
};





this.getInfo=function $vpfn_OAaLE5YNve4A76b5GczAhA102$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("fontSchemeID",this.fontSchemeID);
oInfo.setArray("fontScheme",this.fontScheme);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.ChangeText=function $vpfn_DR2YyNO73qO6ndC8SZGF7Q15$32(oDocItem,sProperty,sInitialData,oInitialStyle,sFinalData,oFinalStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

if(sProperty===null||typeof(sProperty)=="undefined")
{
throw new Error("vp.studio.commands.ChangeText: sProperty is null or undefined.");
}

if(sInitialData===null||typeof(sInitialData)=="undefined")
{
throw new Error("vp.studio.commands.ChangeText: sInitialData is null or undefined.");
}

if(oInitialStyle===null||typeof(oInitialStyle)=="undefined")
{
throw new Error("vp.studio.commands.ChangeText: oInitialStyle is null or undefined.");
}





this.commandName=CMD_CHANGE_TEXT;





this.docItem=oDocItem;





this.property=sProperty;





this.initialData=sInitialData;





this.finalData=sFinalData;





this.initialStyle=oInitialStyle;





this.finalStyle=oFinalStyle;




this.execute=function $vpfn_yY6MpmcVWvm9ZPTMmEdI_A79$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sProp;

if(me.finalStyle)
{
for(sProp in vp.studio.util.TEXT_PROPERTY_MAP)
{
me.docItem.setOuterStyle(sProp,me.finalStyle[sProp]);
}
}

me.docItem.setData(me.finalData);

me.docItem.refresh();
};




this.undo=function $vpfn_W8CYDtjbh9gWpScGHL8HNQ99$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var sProp in vp.studio.util.TEXT_PROPERTY_MAP)
{
me.docItem.setOuterStyle(sProp,me.initialStyle[sProp]);
}

me.docItem.setData(me.initialData);

me.docItem.refresh();
};





this.isVoid=function $vpfn_QqXwX4T57_nrqN3C$$5jzg115$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(me.initialData==me.finalData)&&_.isEqual(me.initialStyle,me.FinalStyle);
};





this.getInfo=function $vpfn_0Kce5ifjpgGyO_H1ztkXZA124$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("property",me.property);
oInfo.setItem("docitem",me.docItem.id);

oInfo.children=vp.studio.instrumentation.getTextChangeChildNodes(me.finalData,me.initialData);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.Null=function $vpfn_8Fv$AgUVWuJeMTZgQUAu0Q11$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Null";




this.execute=function()
{
};




this.undo=function()
{
};





this.isVoid=function $vpfn_ZZuG2Mr9JD5zC0dgYxo52Q39$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return true;
};





this.getInfo=function $vpfn_tl9V$W8m3AmAKlORxeUSNw48$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new vp.studio.LogInfo(me.commandName);
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.CompoundCommand=function $vpfn_jdhOnUTodKlJx8bKAOW0MA12$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Compound Command";





this.commands=[];

for(var i=0;i<arguments.length;i++)
{
this.commands.add(arguments[i]);
}




this.execute=function $vpfn_uZ95sZl3xKUrTKXsEZBMcA36$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.commands.length;i++)
{
if(!me.commands[i].isVoid())
{
me.commands[i].execute();
}
}
};




this.undo=function $vpfn_rAoFn7J1rXfsSSVLPpVTVA50$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=me.commands.length-1;i>=0;i--)
{
if(!me.commands[i].isVoid())
{
me.commands[i].undo();
}
}
};





this.isVoid=function $vpfn_xP0jYDSQvFUtKPdFU6C2Wg65$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.commands.length;i++)
{
if(!me.commands[i].isVoid())
{
return false;
}
}

return true;
};





this.getInfo=function $vpfn_ON8Io67bcGiCV1yvL7HO5Q82$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);

for(var i=0;i<me.commands.length;i++)
{
if(!me.commands[i].isVoid())
{
oInfo.children.add(me.commands[i].getInfo());
}
}

return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}
















vp.studio.commands.ChangeImage=function $vpfn_1PAuhL0TMZv78xPCnLoc5Q18$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.commandName="Change/Crop Image";

this.cropCommand=null;

this.selectionCommand=null;

var initialize=function $vpfn_up74yuGhEikZo$M8NwavlA28$21(oImage,iDocItemType,iItemID,oCropInfo,oDeltaPercentRect,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.originalImage=oImage;
me.originalItemID=oImage.getItemID();
me.originalDocItemType=oImage.type;
me.originalRotationAngle=oImage.coordinates.rotation.angleInDegrees;
me.originalIsFoil=oImage.isFoil;
me.originalIsFullFoil=oImage.isFullFoil;
me.originalRect=oImage.coordinates.getRect();


me.newItemID=iItemID;
me.newDocItemType=iDocItemType;
me.newCropInfo=null;
me.newRotationAngle=0;
me.newImage=null;


me.deltaPercentRect=null;


me.isImageTypeChange=false;
me.shouldChangeRotation=false;


if(me.newDocItemType!=me.originalDocItemType)
{
me.newImage=vp.studio.ImageFactory.convertImage(me.originalImage,me.newDocItemType,me.newItemID);
me.isImageTypeChange=true;
}
else
{
me.newImage=me.originalImage;
}


if(oCropInfo)
{
me.newCropInfo=new vp.studio.CropInfo();
me.newCropInfo.copyFrom(oCropInfo);
}
else
{

if(me.newDocItemType===DOCITEM_TYPE_LIBRARY_IMAGE||me.newDocItemType===DOCITEM_TYPE_UPLOADED_IMAGE)
{
var oImageInfo=vp.image.imageDataStorage.getImage(me.newItemID,vp.image.StudioDocItemTypeToImageType(me.newDocItemType));
var oSmartCrop=vp.studio.ui.getImageReplacementSmartCrop(me.originalImage,me.newImage,oImageInfo);
me.newCropInfo=oSmartCrop;
}
}


if(oDeltaPercentRect)
{
me.deltaPercentRect={};
vp.core.applyProperties(oDeltaPercentRect,me.deltaPercentRect,["top","left","height","width"]);
}


if(typeof(iRotationAngle)=="undefined"&&me.newItemID!=me.originalItemID)
{
iRotationAngle=0;
}

else if(typeof(iRotationAngle)=="undefined"&&this.newItemID===this.originalItemID&&this.originalRotationAngle>0)
{
iRotationAngle=oImage.coordinates.rotation.angleInDegrees;
}

this.newRotationAngle=iRotationAngle;


me.shouldChangeRotation=typeof(this.newRotationAngle)!=="undefined"&&this.newRotationAngle!=this.originalRotationAngle;
};




this.execute=function $vpfn_o9rMs8XrQyvUkA8cfq5yoQ108$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(me.isImageTypeChange||(me.newItemID!=me.originalItemID))
{
me.newImage.isFoil=false;
me.newImage.isFullFoil=false;
}


me.newImage.setItemID(me.newItemID);


me.newImage.frameID=me.originalImage.frameID;
me.newImage.vmlFrame=me.originalImage.vmlFrame;


me.newImage.colorOverrides=me.originalImage.colorOverrides;
me.newImage.colorSchemeRef=me.originalImage.colorSchemeRef;


var locationInImageArea=-1;
if(me.originalImage.imageAreaID)
{

locationInImageArea=Editor.imageAreas[0].imagesInOrder.indexOf(me.originalImage.id);
}

if(me.isImageTypeChange)
{
Editor.removeItem(me.originalImage);


if(me.newImage.cropInfo&&me.newCropInfo)
{
me.newImage.cropInfo.copyFrom(me.newCropInfo);
}

Editor.addItem(me.newImage);

Editor.render();


if(locationInImageArea>-1)
{
Editor.imageAreas[0].imagesInOrder.splice(locationInImageArea,0,me.newImage.id);
}
}
else
{
if(locationInImageArea>-1)
{
Editor.imageAreas[0].imagesInOrder[locationInImageArea]=me.newImage.id;
}
}


if(me.shouldChangeRotation)
{
me.newImage.coordinates.rotateTo(me.newRotationAngle);
}



var restoreSelection=function $vpfn_IzRj4Y$TJdsqySbd7Kihww172$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.selectionCommand&&Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(me.newImage);
me.selectionCommand=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),oNewSelection);
}
if(me.selectionCommand)
{
me.selectionCommand.execute();
Editor.toolbar&&Editor.toolbar.refreshWithDelay();
}
};



if(me.newDocItemType!==DOCITEM_TYPE_LIBRARY_IMAGE&&me.newDocItemType!==DOCITEM_TYPE_UPLOADED_IMAGE)
{


me.newImage.coordinates.setRect(me.originalImage.coordinates.getRect());
restoreSelection();
}
else
{

var oImageData=vp.image.imageDataStorage.getImage(me.newItemID,vp.image.StudioDocItemTypeToImageType(me.newImage.type));

var dNewWidth=oImageData.width;
var dNewHeight=oImageData.height;

if(me.newCropInfo)
{
dNewWidth=dNewWidth*(1-(parseFloat(me.newCropInfo.left)+parseFloat(me.newCropInfo.right)));
dNewHeight=dNewHeight*(1-(parseFloat(me.newCropInfo.top)+parseFloat(me.newCropInfo.bottom)));
}


if(me.newRotationAngle&&(me.newRotationAngle==90||me.newRotationAngle==270))
{
var dTempWidth=dNewWidth;
dNewWidth=dNewHeight;
dNewHeight=dTempWidth;
}




var iMaxImageLen=Math.max(me.originalRect.width,me.originalRect.height);


var iNewLeft=me.originalRect.left;
var iNewTop=me.originalRect.top;

var oNewRect,iWidth,iHeight;
if(me.newImage.locked)
{
iWidth=me.originalRect.width;
iHeight=me.originalRect.height;
oNewRect={
top:iNewTop,
left:iNewLeft,
width:iWidth,
height:iHeight
};


if(Math.abs(dNewWidth/dNewHeight-iWidth/iHeight)>0.03)
{
vp.instrumentation.logError("Potential stretching detected");
}
}
else
{

var dNewAspectRatioSize=dNewWidth/dNewHeight;


iWidth=Math.min(iMaxImageLen,(Editor.dimensions.width*Editor.zoomFactor)-iNewLeft);
iHeight=Math.min(iMaxImageLen,(Editor.dimensions.height*Editor.zoomFactor)-iNewTop);

oNewRect=vp.ui.getRectWithAspectRatio({width:iWidth,height:iHeight},dNewAspectRatioSize);
oNewRect.left=iNewLeft;
oNewRect.top=iNewTop;
}

me.newImage.coordinates.setRect(oNewRect);

if(me.newCropInfo)
{
if(!me.cropCommand)
{
me.cropCommand=new vp.studio.commands.Crop(me.newImage,me.newCropInfo,me.deltaPercentRect);
}

me.cropCommand.execute();
}
else
{
me.newImage.refresh();
}

restoreSelection();
}
};




this.undo=function $vpfn_ghQm1MnNpoaleOnzs7ZeWw283$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var locationInImageArea=-1;


if(me.newImage.imageAreaID)
{

locationInImageArea=Editor.imageAreas[0].imagesInOrder.indexOf(me.newImage.id);
}

if(me.isImageTypeChange)
{
Editor.removeItem(me.newImage);
Editor.addItem(me.originalImage);
Editor.render();

if(locationInImageArea>-1)
{
Editor.imageAreas[0].imagesInOrder.splice(locationInImageArea,0,me.originalImage.id);
}
}
else
{
me.newImage.setItemID(me.originalItemID);
me.newImage.coordinates.rotateTo(me.originalRotationAngle);
me.newImage.isFoil=me.originalIsFoil;
me.newImage.isFullFoil=me.originalIsFullFoil;

if(me.cropCommand)
{
me.cropCommand.undo();
}
if(locationInImageArea>-1)
{
Editor.imageAreas[0].imagesInOrder[locationInImageArea]=me.originalImage.id;
}
}

if(me.selectionCommand)
{
me.selectionCommand.undo();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};





this.isVoid=function $vpfn_vwtReBDDs1ILOQbHgwiXyQ336$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_qMebbj_jSKpysJkAxx3T8w345$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("originalType",me.originalDocItemType);
oInfo.setItem("originalItemID",me.originalItemID);
oInfo.setItem("newType",me.newDocItemType);
oInfo.setItem("newItemID",me.newItemID);
return oInfo;
};


initialize.apply(this,arguments);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.Crop=function $vpfn_Z58qpwc8wNAyH18hKqaaEw13$26(oImage,oCropInfo,oDeltaPercentRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Crop";





this.image=oImage;





this.cropInfo=new vp.studio.CropInfo();
this.cropInfo.copyFrom(oCropInfo);





this.deltaPercentRect=null;

if(oDeltaPercentRect)
{
this.deltaPercentRect={};
vp.core.applyProperties(oDeltaPercentRect,this.deltaPercentRect,["top","left","height","width"]);
}

var m_oOriginalCropInfo=new vp.studio.CropInfo();
m_oOriginalCropInfo.copyFrom(this.image.cropInfo);

var m_oOriginalRect=this.image.coordinates.getRectPrecise();
var m_oOriginalUseCrop=this.image.cropInfo.UseCropValues;




this.execute=function $vpfn_xXhtMY7JhCb0jworAaWmuw57$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.cropInfo.applyTo(me.image.cropInfo);

me.image.cropInfo.UseCropValues=true;































me.image.refresh();
};




this.undo=function $vpfn_P3A9HP3ZsXR5KEpV$G4mpQ99$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_oOriginalCropInfo.applyTo(me.image.cropInfo);
me.image.cropInfo.UseCropValues=m_oOriginalUseCrop;
me.image.coordinates.setRectPrecise(m_oOriginalRect,true);

me.image.refresh();
};





this.isVoid=function $vpfn_lrXB9Yc_Qj7v6rWdH8wqMg112$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_tqLXlniad7P0rTRqs6gylA121$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("image",this.image.id);
oInfo.setCropInfo(this.cropInfo);
oInfo.setRect(this.deltaPercentRect,"delta");
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.commands.ChangeCollageArranger=function $vpfn_w5F7DV8hyJXby1MFsa22BQ14$43(iArrangerId,bShouldNotRegenerate)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.shouldRegenerate=!bShouldNotRegenerate;





this.commandName="ChangeCollageArranger: "+iArrangerId;





this.initialArranger;
if(Editor.imageAreas[0])
{
this.initialArranger=Editor.imageAreas[0].arranger;
}





this.newArranger=iArrangerId;




this.execute=function $vpfn_GkyxzlTsbZzQDo8NUIcDmg45$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(me.isVoid())
{
return;
}

Editor.imageAreas[0].arranger=me.newArranger;

if(me.shouldRegenerate)
{
Editor.regenerateEditorArea();
}
};




this.undo=function $vpfn_tgFlzTOrY95VzsWbJ6pETQ65$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(me.isVoid())
{
return;
}

Editor.imageAreas[0].arranger=me.initialArranger;

if(me.shouldRegenerate)
{
Editor.regenerateEditorArea();
}
};





this.isVoid=function $vpfn_CR4x3gECr1IRKkqnXIJ1Mg86$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(!Editor.imageAreas[0]||(me.initialArranger==me.newArranger));
};





this.getInfo=function $vpfn_m51d3vGYnEck0vFekceoHA95$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("type",this.newArranger);
return oInfo;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.ChangeNumberOfImagesInCollage=function $vpfn_ukMFpjEW34USxiqr_Rp_Dw11$51(iNumImages)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="ChangeNumberOfImagesInCollage";


var originalNumImages=Editor.imageAreas[0]&&Editor.imageAreas[0].requiredNumImages;

var newNumImages=iNumImages;




this.execute=function $vpfn_VZRiUtOPnB_OdB8ccnkJFg29$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.isVoid())
{
return;
}

Editor.imageAreas[0].requiredNumImages=newNumImages;

Editor.regenerateEditorArea();
};




this.undo=function $vpfn_3_QdRJPOdlXThdgJ1ItcBA44$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.isVoid())
{
return;
}

Editor.imageAreas[0].requiredNumImages=originalNumImages;

Editor.regenerateEditorArea();
};





this.isVoid=function $vpfn_hqt0Q3ockaR_LhXnplixhw60$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(!Editor.imageAreas[0]||(originalNumImages==newNumImages));
};





this.getInfo=function $vpfn_fn3QzXUWli$pStgXfO9cKw69$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.ChangeColorScheme=function $vpfn_ogM0f6dwJe0pdBSHCgR4NQ12$39(iColorSchemeID,aSchemeColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Change Color Scheme";

this.colorSchemeID=iColorSchemeID;

this.colorScheme=aSchemeColors;

this.initialColorSchemeID=-1;

this.initialColorScheme=null;




this.execute=function $vpfn_YNnuo7D62dytV3UG$7FcIA33$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.initialColorScheme)
{
me.initialColorSchemeID=Editor.colorSchemeID;
me.initialColorScheme=Editor.colorScheme;
}

Editor.changeColorScheme(me.colorSchemeID,me.colorScheme);
};




this.undo=function $vpfn_Q0Jt8dmosrJkON2J2PK0Gg47$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.changeColorScheme(me.initialColorSchemeID,me.initialColorScheme);
};





this.isVoid=function $vpfn_gbW24ZZuJJ0QB_FIjh4wmA56$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.initialColorScheme==me.colorScheme;
};





this.getInfo=function $vpfn_UqIeqALlj77ud8yPHWZnGw65$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("colorSchemeID",this.colorSchemeID);
oInfo.setArray("colorScheme",this.colorScheme);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.ChangeColorSchemeRef=function $vpfn_zrn1i83VQbovVo4ghWslOA12$42(oSelection,iColorSchemeRef)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Change Color Scheme Ref";

this.selection=oSelection;

this.colorSchemeRef=iColorSchemeRef;

this.initialValues={};




this.execute=function $vpfn_ANNNM6YLJo4boJoV5RkOAw31$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0,l=me.selection.getLength();i<l;i++)
{
var oItem=me.selection.getItem(i);

if(oItem.applyColorScheme)
{
me.initialValues[oItem.id]=oItem.colorSchemeRef;
oItem.colorSchemeRef=me.colorSchemeRef;
oItem.applyColorScheme(Editor.colorScheme);
}
}
};




this.undo=function $vpfn_79N4zbauMMdTPB9XLlt4Rw49$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0,l=me.selection.getLength();i<l;i++)
{
var oItem=me.selection.getItem(i);
if(oItem.applyColorScheme)
{
oItem.colorSchemeRef=me.initialValues[oItem.id];
oItem.applyColorScheme(Editor.colorScheme);
}
}

me.initialValues={};
};





this.isVoid=function $vpfn_0VDnPnGdLK$WbpRSjINi8w68$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_a9k_M9uGRtFUU5dPG821vg77$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("colorSchemeID",this.colorSchemeID);
oInfo.setArray("colorScheme",this.colorScheme);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.AddFacebookLink=function $vpfn_L08kgH5B2b2KrvAoE43p$w11$37(fieldName,fieldText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Facebook Link";





this.fieldName=fieldName;





this.fieldText=fieldText;





this.fieldConstructor=vp.studio.TextField;

this.execute=function $vpfn_sYCoA5ak5A4KfY9aM6GY3g39$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var addFacebookLink=function $vpfn_$uTP1DJTapQ0mKExmk73cw41$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTextFieldCommand=new vp.studio.commands.AddTextField();
me.addNewImageCommand=new vp.studio.commands.AddNewImage(DOCITEM_TYPE_LIBRARY_IMAGE,377252,null,1,0);
me.addTextFieldCommand.baseField={label:getUniqueTextFieldID(me.fieldName),data:me.fieldText};


me.addTextFieldCommand.execute();
var textFieldSize=me.addTextFieldCommand.field.coordinates.getRect();

var imageRect={};

imageRect.width=imageRect.height=vp.studio.addFacebookLink.standardHeight;
imageRect.top=textFieldSize.top;
imageRect.left=textFieldSize.left-vp.studio.addFacebookLink.standardHeight-(vp.studio.addFacebookLink.standardHeight/10);

me.addNewImageCommand.execute();

me.addNewImageCommand.image.coordinates.setRect(imageRect);
me.addNewImageCommand.image.refresh();

if(Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(me.addTextFieldCommand.field);
oNewSelection.add(me.addNewImageCommand.image);

var selectionCommand=new vp.studio.commands.ChangeSelection(
Editor.selection.getState(),oNewSelection);

selectionCommand.execute();
Editor.toolbar.refreshWithDelay();
}
};
addFacebookLink();
};

this.undo=function $vpfn_FyB17gwunkE_yC9UT2a88Q78$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTextFieldCommand.undo();
me.addNewImageCommand.undo();
};

this.isVoid=function $vpfn_XcZWIXKighijPvZkumkayA84$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};

this.getInfo=function $vpfn_EbiZnf9zKUmgb4DF32Dqhw89$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
return oInfo;
};

var getUniqueTextFieldID=function $vpfn_iAdLpFiHl5$9EEenqy1HnA95$31(textFieldBaseName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var id=0;

while(true)
{
var textFieldName=id===0?textFieldBaseName:textFieldBaseName+" "+id;
var bFound=false;

for(var i=0;i<Editor.items.length;i++)
{
if(DOCITEM_TEXT_TYPES.contains(Editor.items[i].type)&&Editor.items[i].label==textFieldName)
{
bFound=true;
break;
}
}

if(!bFound)
{
return textFieldName;
}

id++;
}
return textFieldBaseName;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.Move=function $vpfn_HXF353XlSSRwtGMBzc_cUA11$26(oSelection,oDelta)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Move";





this.selection=oSelection;





this.delta={
top:oDelta.top/Editor.zoomFactor,
left:oDelta.left/Editor.zoomFactor
};




this.execute=function $vpfn_JdHyqGRjIj0TSrh2MJn_6A39$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.selection.moveByPrecise(me.delta);
};




this.undo=function $vpfn_ZzPsYFO7NjRAIlvbzHONWQ47$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oNegativeDelta={
top:-me.delta.top,
left:-me.delta.left
};

me.selection.moveByPrecise(oNegativeDelta);
};





this.isVoid=function $vpfn_D7WzMx9p83dNhQhFlwBdeA61$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.selection.isTextRange())
{
return true;
}

me.delta.width=me.delta.width?me.delta.width:0;
me.delta.height=me.delta.height?me.delta.height:0;

return(me.delta.top===0&&
me.delta.left===0&&
me.delta.width===0&&
me.delta.height===0);
};





this.getInfo=function $vpfn_lbZXi_UjnXpDK1VDN5_oPw81$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(this.selection);
oInfo.setRect(this.delta,"delta");
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.Resize=function $vpfn_ZGiI11P3r2YV8jk7C2ECKw12$28(oItem,oStartRect,oEndRect)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Resize";





this.item=oItem;





this.startRect=oStartRect;





this.endRect=oEndRect;




this.execute=function $vpfn_QDySIjWLXI5_O5ElUxnSrg43$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.item.coordinates.setRectPrecise(me.endRect);
};




this.undo=function $vpfn_42ult5lEkD4HHssiFMKNFw51$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.item.coordinates.setRectPrecise(me.startRect);
};





this.isVoid=function $vpfn_QDR2q$nGNVzQieIXGf0aZA60$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.startRect==me.endRect;
};





this.getInfo=function $vpfn_Y3SgDMVYwWXozI0frUGIBg69$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("id",me.item.id);
oInfo.setRect(me.startRect,"start");
oInfo.setRect(me.endRect,"end");
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(!vp.studio.commands)
{
vp.studio.commands={};
}








vp.studio.commands.Rotate=function $vpfn_w7WCH$B278Vb7fVNFCW9GQ26$28(oItem,iDegrees)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Rotate";





this.item=oItem;





this.degrees=iDegrees;




this.execute=function $vpfn_FeppeBZ8vToax6cu5ZO1fw51$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.item.coordinates.rotateBy(me.degrees);
};




this.undo=function $vpfn_ukrGTMe78oJmgUhbBAmIAw59$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.item.coordinates.rotateBy(-me.degrees);
};





this.isVoid=function $vpfn_c88RKfjaCXkQdGGHWQWZDA68$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.degrees===0;
};





this.getInfo=function $vpfn_qeYwend1gmLIWnSY5UNNiQ77$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem('id',me.item.id);
oInfo.setItem('degrees',me.degrees);
return oInfo;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.Create=function $vpfn_Zj3sx5fycHrwr7laDWFinA11$28(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Create/Copy";





this.selection=oSelection;

this.changeSelectionCommand=null;




this.execute=function $vpfn_A8$RGVTECb9diu2AA$Ej0w32$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.changeSelectionCommand)
{
me.changeSelectionCommand=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),me.selection);
}


if(!me.isOffset)
{
me.selection.moveBy({top:10,left:10});
me.isOffset=true;
}

Editor.addItems(me.selection);

me.changeSelectionCommand.execute();

Editor.refresh();

};




this.undo=function $vpfn_LDBUYPWPujH07u$S9MU9IA57$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.changeSelectionCommand.undo();
Editor.removeItems(me.selection);
Editor.refresh();
};





this.isVoid=function $vpfn_DZbCvpMPLrQGQHD45NBKRA68$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.selection.isEmpty();
};





this.getInfo=function $vpfn_UmMNotVXwRrlwdrKwbBpnw77$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(this.selection);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.Delete=function $vpfn_QVop_pv43qvoR01kssPocg13$28(oSelection,sWarningDialogId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Delete";





this.selection=oSelection;

this.warningDialogId=sWarningDialogId;




this.execute=function $vpfn_3nkP2FoleRjgNAmFJyYUkQ34$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(me.warningDialogId)!=="undefined")
{
var dialog=vp.dialog.get(me.warningDialogId);
if(dialog)
{
dialog.open();
vp.dialog.centerCurrent();
return;
}
}

if(Editor.selection)
{
Editor.selection.isHistoryEnabled=false;
Editor.selection.clear();
Editor.selection.isHistoryEnabled=true;
}

if(Editor.features.replaceImageWithPlaceholderOnDelete
&&Editor.defaultPlaceholderId
&&me.selection.getLength()==1
&&DOCITEM_IMAGE_TYPES.contains(me.selection.getItem(0).type)
&&me.selection.getItem(0).imageAreaID)
{
me.selection.getItem(0).replaceImageWithPlaceholder();
}

Editor.removeItems(me.selection);
Editor.refresh();

if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};




this.undo=function $vpfn_4jtF$sZgqcwb5rSlJ2VDlg75$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.addItems(me.selection);

if(Editor.selection)
{
Editor.selection.isHistoryEnabled=false;
Editor.selection.setState(me.selection);
Editor.selection.isHistoryEnabled=true;
}

Editor.refresh();

if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};





this.isVoid=function $vpfn_mwIpM7iSmknASef7NCQRTw98$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.selection.isEmpty();
};





this.getInfo=function $vpfn_VlQe$8bIqjvvf5ho19mAow107$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(me.selection);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.ChangeSelection=function $vpfn_9yNmv7pubqej$gadF4PhKA12$37(oInitial,oFinal)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName=CMD_CHANGE_SELECTION;

this.doesntAffectDocument=true;





this.initialSelection=oInitial;





this.finalSelection=oFinal;




this.execute=function $vpfn_xsvDqR7A6vVGcLBXR193AA39$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
apply(me.finalSelection);
};




this.undo=function $vpfn_TTTlhqKEcaFCjVy1yJflmw47$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
apply(me.initialSelection);
};





this.isVoid=function $vpfn_SHgaOz5rAD0GTv7PyBrDRQ56$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return true;

};





var apply=function $vpfn_cfa0li7eHKbHhzflZ7MoBg66$16(oSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.selection.isHistoryEnabled=false;
Editor.selection.setState(oSelection);
Editor.selection.isHistoryEnabled=true;
};





this.getInfo=function $vpfn_BwRyMpHzW_duywWMs32x1Q77$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(this.initialSelection,"init");
oInfo.setSelection(this.finalSelection,"final");
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}

















vp.studio.commands.AddField=function $vpfn_AIfDqPMTNQLqU$CHxItgUg19$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Field";





this.field=null;




this.baseField=null;





this.fieldConstructor=null;





this.defaultClickText=JSLM_StudioTextFieldDefaultText;





this.customizeField=function $vpfn_U87q1TuEICJJ67XkTJJ9mA56$26(oField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return;
};




this.execute=function $vpfn_5Qqx8mwULDH7aECG4IUsww65$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.field)
{
me.field=createNewField();
if(me.baseField)
{
$.extend(me.field,me.baseField);
}
}

Editor.addItem(me.field);
Editor.render();

if(!me.changeSelectionCommand&&Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(me.field);

me.changeSelectionCommand=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),oNewSelection);
me.changeSelectionCommand.execute();
}
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};

var isOverlappingField=function $vpfn_8hxiLGrqo2mSJ142sYe1_w93$29(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oItem1.type==oItem2.type)
{
var oRect1=oItem1.coordinates.getRectPrecise();
var oRect2=oItem2.coordinates.getRectPrecise();




if(Math.round(oRect1.top)==Math.round(oRect2.top)&&
Math.round(oRect1.left)==Math.round(oRect2.left))
{
return true;
}
}

return false;
};




this.undo=function $vpfn_Rc2Pk$C$6TfgttqGYE9stg116$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.changeSelectionCommand.undo();
Editor.removeItem(me.field);
};





this.isVoid=function $vpfn_6hZRLxC5JCmnhlTCdngxMg126$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_XmUA2T$GlfDecMyXC0wgJA135$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new vp.studio.LogInfo(me.commandName);
};

var createNewField=function $vpfn_lPboHcFW7wv_Gt7sXUTk4g140$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newField=new me.fieldConstructor();
Editor.assignUniqueID(newField);
newField.zIndex=Editor.getMaxProperty([],"zIndex")+1;

newField.fieldOrder=Editor.getMaxProperty([DOCITEM_TYPE_TEXT],"fieldOrder",true)-1;

var iMinWidth;
var DEFAULT_MINIMUM_WIDTH=200;




if(Editor.dimensions.width<DEFAULT_MINIMUM_WIDTH)
{
var HORIZONTAL_PADDING=20;

if(Editor.dimensions.width>2*HORIZONTAL_PADDING)
{


iMinWidth=Editor.dimensions.width-HORIZONTAL_PADDING;
}else
{


iMinWidth=Editor.dimensions.width;
}
}else
{
iMinWidth=DEFAULT_MINIMUM_WIDTH;
}

var iWidth=parseInt(Math.max(Editor.dimensions.width/3,iMinWidth));

var oRect={top:0,left:0,width:iWidth,height:20};
oRect.left=Math.round((Editor.dimensions.width/2)-(oRect.width/2));
oRect.top=Math.round((Editor.dimensions.height/2)-(oRect.height/2)-20);

newField.coordinates.setRectPrecise(oRect);
newField.clickText=me.defaultClickText;
newField.data=newField.clickText;


var sDefaultFont="Arial";
if(Editor.fontScheme&&Editor.fontScheme.length>0)
{
sDefaultFont=Editor.fontScheme[0];
}


var sDefaultColor="#000000";
if(Editor.colorScheme&&Editor.colorScheme.length>2)
{
sDefaultColor=Editor.colorScheme[2];
}
if(Editor.isEmbroidery)
{
var aColor=Editor.embroideryThreadColors[Editor.embroideryThreadColors.length-1];
sDefaultColor=aColor[aColor.length-1];
}
var oDefaultColor=new vp.color.Color(sDefaultColor);

newField.fontFamily=Editor.getMostCommonTextProperty("fontFamily",sDefaultFont);
newField.fontSchemeRef=Editor.fontScheme.indexOf(newField.fontFamily);

newField.fontColor=Editor.getMostCommonTextProperty("fontColor",oDefaultColor);
newField.colorSchemeRef=Editor.colorScheme.indexOf(newField.fontColor.toString());

newField.label=Editor.getUniqueTextFieldLabel();

me.customizeField(newField);


var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
if(isOverlappingField(Editor.items[i],newField))
{
oRect=newField.coordinates.getRect();
oRect.top=oRect.top+10;
oRect.left=oRect.left+10;
newField.coordinates.setRect(oRect);
}
}


if(oRect.top<0)
{
oRect.top=0;
newField.coordinates.setRect(oRect);
}
return newField;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.commands.AddTextField=function $vpfn_T6G9GOsbh3_BHlIr9wOsag11$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.commands.AddField;
this.inheritFrom();





this.commandName="Add Text";





this.fieldConstructor=vp.studio.TextField;





this.customizeField=function $vpfn_D4LwYxsjc__vJdo9mCbG7A37$26(oTextField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var DOCUMENT_SIZE_DEFAULT_TEXT_SIZE_RATIO=0.05;
var iMaxDimensionSize=Math.max(Editor.dimensions.width,Editor.dimensions.height);
var iFontSize=Math.round(iMaxDimensionSize*DOCUMENT_SIZE_DEFAULT_TEXT_SIZE_RATIO);
oTextField.fontSize=Editor.getMostCommonTextProperty("fontSize",iFontSize);
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.AddWordArt=function $vpfn_QT$ObLEMWI_nt8XaMNrv2g12$32(iType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.commands.AddField;
this.inheritFrom();





this.commandName="Add WordArt";





this.fieldConstructor=vp.studio.WordArt;





this.customizeField=function $vpfn_dSXDcXOvKn5o8LUYOC$_Cw38$26(oWordArt)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styles=vp.studio.WordArt.initialStyles.STRAIGHT;
switch(iType)
{
case 1:
styles=vp.studio.WordArt.initialStyles.SHARP_CONVEX;
break;
case 2:
styles=vp.studio.WordArt.initialStyles.CONVEX;
break;
case 4:
styles=vp.studio.WordArt.initialStyles.CONCAVE;
break;
case 5:
styles=vp.studio.WordArt.initialStyles.SHARP_CONCAVE;
break;
case 3:
default:
styles=vp.studio.WordArt.initialStyles.STRAIGHT;
break;
}
var oRect=oWordArt.coordinates.getRect();
oWordArt.arcHeight=styles.arcHeight;
oWordArt.arcRadius=styles.arcRadius;
oWordArt.arcAngle=styles.arcAngle;
oRect.width=styles.width;
oRect.height=styles.height;

oRect.left=Math.round((Editor.dimensions.width/2)-(oRect.width/2));
oRect.top=Math.round((Editor.dimensions.height/8)-(oRect.height/8));
oWordArt.coordinates.setRect(oRect);
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}















vp.studio.commands.AddImage=function $vpfn_vZw0IXxFO$QbHxCHYi0cag17$30(iDocItemType,iItemID,oCropInfo,fAspectRatio,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Image";





this.image=null;





this.type=iDocItemType;





this.itemID=iItemID;





this.aspectRatio=fAspectRatio;

this.rotationAngle=iRotationAngle;





this.cropInfo=null;
if(oCropInfo)
{
this.cropInfo=new vp.studio.CropInfo();
this.cropInfo.copyFrom(oCropInfo);
}

var m_oSelectionCommand=null;







var m_aCommandHistory=[];




this.execute=function $vpfn_EqPDC8JeqCg_iU_tQ6FoeA77$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.image)
{
me.image=vp.studio.ImageFactory.createImage(me.type,me.itemID);

if(me.image.cropInfo&&me.cropInfo)
{
me.cropInfo.applyTo(me.image.cropInfo);
me.image.cropInfo.UseCropValues=true;
}

Editor.assignUniqueID(me.image);

var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);

me.image.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;

var oRect=vp.ui.getRectWithAspectRatio(Editor.dimensions,me.aspectRatio);

me.image.coordinates.setRect(oRect);
}



var oPlaceholderToReplace=getDominantOrTopmostImagePlaceholder(Editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER));


if(oPlaceholderToReplace&&(me.type===DOCITEM_TYPE_UPLOADED_IMAGE||me.type===DOCITEM_TYPE_LIBRARY_IMAGE))
{


var oImageInfo=new vp.image.ImageInfo();
var oVpImage=new vp.image.Image(vp.image.StudioDocItemTypeToImageType(me.type),me.itemID);


var infoCb=function $vpfn_qdJ9pDmPpdPCpTriq5e6fQ114$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oSmartCrop=vp.studio.ui.getImageReplacementSmartCrop(this.oOrigImg,this.oNewImg,this.oImageInfo);



var cmd=new vp.studio.commands.ChangeImage(this.oOrigImg,
this.oNewImg.type,
this.iItemID,
oSmartCrop,
null,
this.iRotation);
cmd.execute();


this.aCommandHistory.push(cmd);
}
.getClosure({
oImageInfo:oImageInfo,
oOrigImg:oPlaceholderToReplace,
oNewImg:me.image,
iItemID:me.itemID,
iRotation:me.image.coordinates.rotation.angleInDegrees,
aCommandHistory:m_aCommandHistory
});


oImageInfo.loadImageInfo(oVpImage,infoCb,infoCb);
}
else
{
var cmd=new vp.studio.commands.AddNewImage(me.type,me.itemID,me.cropInfo,me.aspectRatio,me.rotationAngle);
cmd.execute();

m_aCommandHistory.push(cmd);
}





if(!m_oSelectionCommand&&Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(me.image);

m_oSelectionCommand=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),oNewSelection);
}
if(m_oSelectionCommand)
{
m_oSelectionCommand.execute();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};




var getDominantOrTopmostImagePlaceholder=function $vpfn_B5j3dPKC9YD8qAgokiU2AA176$47(aPlaceholders)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!aPlaceholders)
{
return null;
}

var oDominantOrTopmostPlaceholder=null;



for(var i=0;i<aPlaceholders.length;i++)
{
if(aPlaceholders[i].placeholderType===PLACEHOLDER_TYPE_Image)
{

if(aPlaceholders[i].isDominantImage)
{
oDominantOrTopmostPlaceholder=aPlaceholders[i];
break;
}


if(oDominantOrTopmostPlaceholder&&aPlaceholders[i].zIndex>oDominantOrTopmostPlaceholder.zIndex)
{
oDominantOrTopmostPlaceholder=aPlaceholders[i];
}
}
}

return oDominantOrTopmostPlaceholder;
};





this.undo=function $vpfn_EdSIjkp13I0XhuLgFs9vBA213$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var commandToUndo=m_aCommandHistory.pop();


commandToUndo.undo();
};





this.isVoid=function $vpfn_xHpF0QM6by0$LAmx9fy6ag226$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_KlJDaRfYzBPPXvdJH9rMqA235$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("type",this.type);
oInfo.setItem("itemID",this.itemID);
oInfo.setItem("aspectratio",this.aspectRatio);
oInfo.setCropInfo(this.cropInfo);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.commands.AddMap=function $vpfn_SttwQkUl9LRshS_LgbgJTg14$28(oMapData,oMapAddress,oItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Map";





var _oOldItem=oItem;





var _oNewMap=null;





var _oSelectionCmd=null;




var getRect=function $vpfn_VD2UmxIwBktJxVLJzUGapw45$18(oRect,oSize,bFit)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fWidthRatio=oRect.width/oSize.width;
var fHeightRatio=oRect.height/oSize.height;
var fRatio=bFit?Math.min(fWidthRatio,fHeightRatio):Math.max(fWidthRatio,fHeightRatio);

var oNewRect={};
oNewRect.width=oSize.width*fRatio;
oNewRect.height=oSize.height*fRatio;
oNewRect.top=oRect.top+((oRect.height-oNewRect.height)/2);
oNewRect.left=oRect.left+((oRect.width-oNewRect.width)/2);
oNewRect.right=oNewRect.left+oNewRect.width;
oNewRect.bottom=oNewRect.top+oNewRect.height;

return oNewRect;
};




this.execute=function $vpfn_88$s$rkMxnxjoXcITkEpBw65$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_oNewMap)
{

var bIsReplacingMap=_oOldItem&&_oOldItem.type==DOCITEM_TYPE_MAP;

_oNewMap=new vp.studio.Map();


_oNewMap.mapData=oMapData;
_oNewMap.mapAddress=oMapAddress;

if(bIsReplacingMap)
{



if(oMapData.equals(_oOldItem.mapData))
{
_oNewMap.mapData=_oOldItem.mapData;
}
if(oMapAddress.equals(_oOldItem.mapAddress))
{
_oNewMap.mapAddress=_oOldItem.mapAddress;
}
}


if(bIsReplacingMap)
{
_oNewMap.id=_oOldItem.id;
}
else
{
Editor.assignUniqueID(_oNewMap);
}


if(_oOldItem)
{
_oNewMap.zIndex=_oOldItem.zIndex;
}
else
{
var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);
_oNewMap.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;
}


if(_oOldItem)
{
_oNewMap.locked=_oOldItem.locked;
}
else
{
_oNewMap.locked=false;
}


var oRect,oFitRect;
if(_oOldItem)
{

oFitRect=_oOldItem.coordinates.getRectPrecise();
oRect=getRect(oFitRect,oMapData,true);
}
else
{

oFitRect={
left:Editor.dimensions.width/(Editor.isBrochure?3:4),
top:Editor.dimensions.height/4,
width:Editor.dimensions.width/(Editor.isBrochure?3:2),
height:Editor.dimensions.height/2
};
oRect=getRect(oFitRect,oMapData,true);
}
_oNewMap.coordinates.setRectPrecise(oRect);

var fPageItemAspect=oRect.width/oRect.height;
_oNewMap.mapData.width=fPageItemAspect*_oNewMap.mapData.height;


if(Editor.selection)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(_oNewMap);
_oSelectionCmd=new vp.studio.commands.ChangeSelection(Editor.selection.getState(),oNewSelection);
}
}


if(_oOldItem)
{
Editor.removeItem(_oOldItem);
}
Editor.addItem(_oNewMap);
Editor.render();


if(_oSelectionCmd)
{
_oSelectionCmd.execute();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};




this.undo=function $vpfn_pOpyZyKyBEgwG9kHZOyzEA180$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}






if(_oOldItem&&_oOldItem.type==DOCITEM_TYPE_MAP)
{
_oOldItem.mapData.id=0;
_oOldItem.mapAddress.id=0;
}


Editor.removeItem(_oNewMap);
if(_oOldItem)
{
Editor.addItem(_oOldItem);
Editor.render();
}


if(_oSelectionCmd)
{
_oSelectionCmd.undo();
if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
}
};





this.isVoid=function $vpfn_jmcfdyT6cP0NLr5l2DWB1w217$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(_oOldItem&&_oOldItem.type==DOCITEM_TYPE_MAP)
{

var bSameData=oMapData.equals(_oOldItem.mapData);
var bSameAddress=oMapAddress.equals(_oOldItem.mapAddress);


if(bSameData&&bSameAddress)
{
return true;
}
}
return false;
};





this.getInfo=function $vpfn_DvNo598nmICi3$cR3SbKmw239$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);

return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}













vp.studio.commands.AddNewImage=function $vpfn_I9utnEHjsQXA1rklrQAyAQ15$33(iDocItemType,iItemID,oCropInfo,fAspectRatio,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add New Image";





this.image=null;





this.baseImage=null;





this.type=iDocItemType;





this.itemID=iItemID;





this.aspectRatio=fAspectRatio;

this.rotationAngle=iRotationAngle;

this.shouldChangeRotation=typeof(iRotationAngle)!=="undefined"&&iRotationAngle!==0;





this.cropInfo=null;
if(oCropInfo)
{
this.cropInfo=new vp.studio.CropInfo();
this.cropInfo.copyFrom(oCropInfo);
}




this.execute=function $vpfn_hINI2sS_arY4sNovBbr4FQ73$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.image)
{
me.image=createImage();
if(me.baseImage)
{
$.extend(me.image,me.baseImage);
}
}


Editor.addItem(me.image);
Editor.render();
};




this.undo=function $vpfn_N2s1Z0HloNaKx$poN3bwaQ92$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.removeItem(me.image);
};





this.isVoid=function $vpfn_EMEC_cCmnhiI6KDOpIt6bA101$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_FLZTxHN4C6vjzCYisYqdNw110$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("type",this.type);
oInfo.setItem("itemID",this.itemID);
oInfo.setItem("aspectratio",this.aspectRatio);
oInfo.setCropInfo(this.cropInfo);
return oInfo;
};

var createImage=function $vpfn_tpyk6SrEokgvrc9yVUPv$A120$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newImage=vp.studio.ImageFactory.createImage(me.type,me.itemID);

if(newImage.cropInfo&&me.cropInfo)
{
me.cropInfo.applyTo(newImage.cropInfo);
newImage.cropInfo.UseCropValues=true;
}

Editor.assignUniqueID(newImage);

var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);


if(me.shouldChangeRotation)
{
newImage.coordinates.rotateTo(me.rotationAngle);
}

newImage.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;

var oImageRect=null;
oImageRect=vp.core.shallowCopy(Editor.dimensions);

oImageRect.width/=Editor.isBrochure?3:2;
oImageRect.height/=2;
oImageRect=vp.ui.getRectWithAspectRatio(oImageRect,me.aspectRatio);
oImageRect.left=(Editor.dimensions.width-oImageRect.width)/2;
oImageRect.top=(Editor.dimensions.height-oImageRect.height)/2;

newImage.coordinates.setRect(oImageRect);
return newImage;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.AddCaricature=function $vpfn_rvgz5qzyHT4O7GCCwE883Q12$35(iItemID,sName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Caricature";





this.itemID=iItemID;

var m_oImage=null;
var m_oTextField=null;
var m_oSelectionCommand=null;



var m_iTextFieldHeight=20;





var isCaption=function $vpfn_5smMzodwxn_ARUtV4yUq3w40$20(item)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return item.isCaricatureCaption;
};





var createImage=function $vpfn_LhdX1QU0Im7d8hzVFBMC$w49$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var img=new vp.studio.Caricature();
img.setItemID(me.itemID);

Editor.assignUniqueID(img);



var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);

img.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;





var height=Editor.getMostCommonCoordinate(DOCITEM_TYPE_CARICATURE,"height",-1);
if(height===-1)
{





var editorZoomDimensions={
width:(Editor.dimensions.width*Editor.zoomFactor)/2,
height:(Editor.dimensions.height*Editor.zoomFactor)/2
};

height=vp.ui.getRectWithAspectRatio(
editorZoomDimensions,EditorConst.caricatureAspectRatio).height;



height-=(m_iTextFieldHeight*2);
}

var oRect={
top:0,
left:0,
height:height,
width:height*EditorConst.caricatureAspectRatio
};

img.coordinates.setZoom(Editor.zoomFactor);
img.coordinates.setRect(oRect);

return img;
};







var createCaption=function $vpfn_l13EfLuVq0tGUIziytQR0g107$24(oCaricature)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var caption=new vp.studio.TextField();
caption.isCaricatureCaption=true;

Editor.assignUniqueID(caption);
caption.zIndex=Editor.getMaxProperty([],"zIndex")+1;

caption.fieldOrder=Editor.getMaxProperty([DOCITEM_TYPE_TEXT],"fieldOrder",true)-1;



var caricatureRect=oCaricature.coordinates.getRect();

var textRect={
top:caricatureRect.top+caricatureRect.height,
left:caricatureRect.left,
width:0,
height:m_iTextFieldHeight
};

textRect.width=Editor.getMostCommonCoordinate(DOCITEM_TYPE_TEXT,
"width",caricatureRect.width,false,isCaption);

textRect.left-=(textRect.width-caricatureRect.width)/2;

caption.coordinates.setZoom(Editor.zoomFactor);
caption.coordinates.setRect(textRect);

caption.clickText="";
caption.data=sName;


var sDefaultFont="Arial";
if(Editor.fontScheme&&Editor.fontScheme.length>0)
{
sDefaultFont=Editor.fontScheme[0];
}


var sDefaultColor="#000000";
if(Editor.colorScheme&&Editor.colorScheme.length>2)
{

sDefaultColor=(new vp.color.Color(Editor.colorScheme[2])).toHex();
}


var DOCUMENT_SIZE_DEFAULT_TEXT_SIZE_RATIO=0.05;
var iMaxDimensionSize=Math.max(Editor.dimensions.width,Editor.dimensions.height);
var iDefaultFontSize=Math.round(iMaxDimensionSize*DOCUMENT_SIZE_DEFAULT_TEXT_SIZE_RATIO);





caption.fontFamily=Editor.getMostCommonTextProperty("fontFamily","",false,isCaption);
if(caption.fontFamily==="")
{
caption.fontFamily=Editor.getMostCommonTextProperty("fontFamily",sDefaultFont);
}

caption.fontColor=Editor.getMostCommonTextProperty("fontColor",null,false,isCaption);
if(caption.fontColor===null)
{
caption.fontColor=Editor.getMostCommonTextProperty("fontColor",new vp.color.Color(sDefaultColor));
}

caption.fontSize=Editor.getMostCommonTextProperty("fontSize",-1,false,isCaption);
if(caption.fontSize===-1)
{
caption.fontSize=Editor.getMostCommonTextProperty("fontSize",iDefaultFontSize);
}

caption.colorSchemeRef=Editor.colorScheme.indexOf(caption.fontColor.toString());
caption.fontSchemeRef=Editor.fontScheme.indexOf(caption.fontFamily);

caption.label=JSLM_CaricatureCaptionLabel;
caption.align="center";

return caption;
};




this.execute=function $vpfn_gkKSFYYlN5T$ESqUWyBA3Q193$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!m_oImage)
{
m_oImage=createImage();
}

if(!m_oTextField)
{
m_oTextField=createCaption(m_oImage);
}

m_oImage.captionID=m_oTextField.id;
m_oImage.caption=m_oTextField;

Editor.addItem(m_oImage);
Editor.addItem(m_oTextField);
Editor.render();


if(!m_oSelectionCommand)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(m_oImage);
oNewSelection.add(m_oTextField);

m_oSelectionCommand=new vp.studio.commands.ChangeSelection(
Editor.selection.getState(),oNewSelection);
}

m_oSelectionCommand.execute();
Editor.toolbar.refreshWithDelay();
};




this.undo=function $vpfn_haFOGT7hkGY2CHGpg4TBgA230$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_oSelectionCommand.undo();
Editor.removeItem(m_oImage);
Editor.removeItem(m_oTextField);
};





this.isVoid=function $vpfn_TnX3KOtRpve4N3vd0ib0SQ241$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_DuMr1TJZ7T1jGGmCw8eq6w250$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("itemID",this.itemID);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.Align=function $vpfn_9ZX2eR9UO2L0Y1KsZ9c81w13$27(oSelection,sDirection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Align: "+sDirection;





this.selection=oSelection;





this.initialRects=[];

for(var i=0;i<oSelection.getLength();i++)
{
this.initialRects.add(oSelection.getItem(i).coordinates.getRectPrecise());
}





this.direction=sDirection;

var getRectWithRotation=function $vpfn_A2ssvj2MikGbelPsbKRE9w46$30(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return{
top:oObj.coordinates.getCoordPrecise("top"),
left:oObj.coordinates.getCoordPrecise("left"),
width:oObj.coordinates.getCoordPrecise(oObj.coordinates.rotation.isRotated()?"height":"width"),
height:oObj.coordinates.getCoordPrecise(oObj.coordinates.rotation.isRotated()?"width":"height")
};
};




this.execute=function $vpfn_4I9DU439UQvXLMx5vLhlbw59$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aItems=me.selection.getArray();
var fMax=null;
var fMin=null;
var oRect=null;

for(var i=0;i<aItems.length;i++)
{
var fCurrent;
oRect=getRectWithRotation(aItems[i]);

switch(me.direction)
{
case"left":
fCurrent=oRect.left;
break;
case"center":
fCurrent=oRect.left+(oRect.width/2);
break;
case"right":
fCurrent=oRect.left+oRect.width;
break;
case"top":
fCurrent=oRect.top;
break;
case"middle":
fCurrent=oRect.top+(oRect.height/2);
break;
case"bottom":
fCurrent=oRect.top+oRect.height;
break;
default:
break;
}

if(!fMax||fCurrent>fMax)
{
fMax=fCurrent;
}

if(!fMin||fCurrent<fMin)
{
fMin=fCurrent;
}
}

var fAverage=(fMin+fMax)/2;

for(i=0;i<aItems.length;i++)
{
oRect=getRectWithRotation(aItems[i]);

switch(me.direction)
{
case"left":
aItems[i].coordinates.setCoordPrecise("left",fMin);
break;
case"right":
aItems[i].coordinates.setCoordPrecise("left",fMax-oRect.width);
break;
case"center":
aItems[i].coordinates.setCoordPrecise("left",fAverage-(oRect.width/2));
break;
case"top":
aItems[i].coordinates.setCoordPrecise("top",fMin);
break;
case"bottom":
aItems[i].coordinates.setCoordPrecise("top",fMax-oRect.height);
break;
case"middle":
aItems[i].coordinates.setCoordPrecise("top",fAverage-(oRect.height/2));
break;
default:
break;
}
}
};




this.undo=function $vpfn_ATmKS9WZ1SoA7S4VQRLhEg141$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<oSelection.getLength();i++)
{
oSelection.getItem(i).coordinates.setRectPrecise(me.initialRects[i]);
}
};





this.isVoid=function $vpfn_tJV9zFsZAFi6DucIZsm$Cg153$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_2_L9ihbY8FrgnvEx02diCg162$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("type",this.direction);
oInfo.setSelection(this.selection);
return oInfo;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.Lock=function $vpfn_WLNgG3Nj6Se7Qzs$I8M1_w13$26(oSelection,bLock)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Lock";





this.selection=oSelection.getState();

for(var i=0;i<this.selection.getLength();i++)
{
if(!this.selection.getItem(i).lock)
{
this.selection.remove(i);
i--;
}
}





this.doLock=bLock;




this.execute=function $vpfn_NV6_$OqkgLZrxXpRmqYHPA47$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.doLock?lock():unlock();
};




this.undo=function $vpfn_kBj5h$gRhfW_Z1m1zJ5vEw55$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.doLock?unlock():lock();
};

var lock=function $vpfn_P836_JrbpTQjKu0VeQ1vJA60$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.selection.isHistoryEnabled=false;

for(var i=0;i<me.selection.getLength();i++)
{
var oItem=me.selection.getItem(i);
Editor.selection.remove(oItem);
oItem.lock(true);
}

Editor.selection.isHistoryEnabled=true;

};

var unlock=function $vpfn_CFdV1QlzNp8zMT5_QTCPGQ75$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.selection.isHistoryEnabled=false;

for(var i=0;i<me.selection.getLength();i++)
{
var oItem=me.selection.getItem(i);
oItem.lock(false);
Editor.selection.add(oItem);
}

Editor.selection.isHistoryEnabled=true;
};





this.isVoid=function $vpfn_c9u$1ZFL1rc8edQimbGwog93$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_z9G0uvfg5fpYS751pkSWkg102$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(me.selection);
oInfo.setItem("lock",me.doLock);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.Swappable=function $vpfn_WotlBi8ad$nVsHvzoNqDeA12$31(oSelection,bSwappable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Swappable";





this.selection=oSelection.getState();





this.doSwappable=bSwappable;




this.execute=function $vpfn_Yi5txFekD1AE8sJxCEElaw37$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.doSwappable?swappable():notSwappable();
};




this.undo=function $vpfn_7HoGm3f$8srM$Qiqz64C5w45$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.doSwappable?notSwappable():swappable();
};

var swappable=function $vpfn_V2oxSS5e$NptRNC2Df2w9A50$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.selection.getLength();i++)
{
var oItem=me.selection.getItem(i);
if(typeof(oItem.notSwappable)==='boolean')
{
oItem.notSwappable=true;
}
}

};

var notSwappable=function $vpfn_fFbbRlDMqbq1uaS1g6GzXA63$23()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.selection.getLength();i++)
{
var oItem=me.selection.getItem(i);
if(typeof(oItem.notSwappable)==='boolean')
{
oItem.notSwappable=false;
}
}
};





this.isVoid=function $vpfn_ud3CEmBWQFFBzkJaBbRVMw79$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_0vRHmB_iAAMtQQWbqINJew88$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.EnableStretching=function $vpfn_aZxhUkZ1kobwwfQuJPYbLw13$38(oSelection,bEnable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="EnableStretching";





this.selection=oSelection.getState();

for(var i=0;i<this.selection.getLength();i++)
{
if(!DOCITEM_IMAGE_TYPES.contains(this.selection.getItem(i).type))
{
this.selection.remove(i);
i--;
}
}





this.enable=bEnable;




this.execute=function $vpfn_vnuqQma6dNf3hE549XhvFg47$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
enableStretching(me.enable);
};




this.undo=function $vpfn_xLw9kt3DO1r_E36uAGt7Yw55$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
enableStretching(!me.enable);
};

var enableStretching=function $vpfn_q9YQHnNEZbu9Zpf1yjGGEA60$27(bEnable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.selection.isHistoryEnabled=false;

for(var i=0;i<me.selection.getLength();i++)
{
var oItem=me.selection.getItem(i);
oItem.manipulator.setConstrainProportions(!bEnable);
}

Editor.selection.isHistoryEnabled=true;

};





this.isVoid=function $vpfn_eOYjShBE$Vxabk$Yq6YLsw78$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_7afCB7xKQ6W0mQisMHBkmw87$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setSelection(me.selection);
oInfo.setItem("enableStretching",me.enable);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}















vp.studio.commands.SwapZIndex=function $vpfn_iamLhiKoLPM_KgW4Jy4lEg17$32(oItem1,oItem2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Swap zIndex";

this.item1=oItem1;

this.item2=oItem2;




this.execute=function $vpfn_5f05X1Pwtk52b7S5DHKnmw34$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.item1.type==DOCITEM_TYPE_SHAPE_LAYER||
me.item2.type==DOCITEM_TYPE_SHAPE_LAYER)
{



var shapes,item;




if(me.item1.type==DOCITEM_TYPE_SHAPE_LAYER)
{
shapes=me.item1;
item=me.item2;
}
else
{
shapes=me.item2;
item=me.item1;
}

var itemIdx=item.zIndex;

if(shapes.zIndex>item.zIndex)
{
item.setZIndex(shapes.zIndex);
shapes.setLowestZIndex(itemIdx);
}
else if(shapes.zIndex<item.zIndex)
{
item.setZIndex(shapes.getLowestZIndex());
shapes.setZIndex(itemIdx);
}
}
else
{


var iItem1Index=me.item1.zIndex;
me.item1.setZIndex(me.item2.zIndex);
me.item2.setZIndex(iItem1Index);
}
};




this.undo=function $vpfn_UbZ2r5x2GQMLn6P6SGGLbA84$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.execute();
};





this.isVoid=function $vpfn_zYx1aGb48$Lgwhpbhds3aQ93$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_yCoI5vQNNFT9M1i6RjpaOw102$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("item1",this.item1.id);
oInfo.setItem("item2",this.item2.id);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.ChangeProperties=function $vpfn_X0vBtnBYwrWFU5mjM1tPTQ12$38(oItem,oPropertyMap)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Change Properties";





this.item=oItem;





this.propertyMap={};

for(var sProp in oPropertyMap)
{
this.propertyMap[sProp]=oPropertyMap[sProp];
}

this.propertyMapInitial=null;




this.execute=function $vpfn_siyn$G4BEYV9kChfUKNkXA44$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sProp;

if(!me.propertyMapInitial)
{
me.propertyMapInitial={};
for(sProp in me.propertyMap)
{
me.propertyMapInitial[sProp]=vp.core.getNestedProperty(me.item,sProp);
}
}

vp.core.applyPropertyMap(me.item,me.propertyMap);

me.item.refresh();
};




this.undo=function $vpfn_c_Rm4rN6rK7IPPxf4k5D3g65$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.core.applyPropertyMap(me.item,me.propertyMapInitial);

me.item.refresh();
};





this.isVoid=function $vpfn_9nSfbC7EqpYH5CxgzcpWXQ76$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_dhOLxRaztw75y6eaultxQA85$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("itemID",me.item.id);

return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.AlignToSafetyMargin=function $vpfn_wlsQrgIDj1D0D17B3KngKw13$41(oSelection,sDirection,oSafeAreaAndFoldRects,bIsBrochure)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Align to safety margin: "+sDirection;





this.selection=oSelection;





this.initialRects=[];

for(var i=0;i<oSelection.getLength();i++)
{
this.initialRects.add(oSelection.getItem(i).coordinates.getRectPrecise());
};





this.direction=sDirection;

var getRectWithRotation=function $vpfn_CXGzZxAqYCIpqnNSTQyIkw46$30(oObj)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return{
top:oObj.coordinates.getCoordPrecise("top"),
left:oObj.coordinates.getCoordPrecise("left"),
width:oObj.coordinates.getCoordPrecise(oObj.coordinates.rotation.isRotated()?"height":"width"),
height:oObj.coordinates.getCoordPrecise(oObj.coordinates.rotation.isRotated()?"width":"height")
};
};

var getClosestBrochureAlignment=function $vpfn_NHYSe2duWt$Eb78NDsIigA56$38(iLeft,iWidth)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iAlignLeft=oSafeAreaAndFoldRects.safeArea.left;
if(iLeft>=oSafeAreaAndFoldRects.brochureFoldLine1.left&&iLeft<oSafeAreaAndFoldRects.brochureFoldLine2.left)
{
return{
left:oSafeAreaAndFoldRects.brochureFoldArea1.left+oSafeAreaAndFoldRects.brochureFoldArea1.width,
center:(oSafeAreaAndFoldRects.brochureFoldArea1.left+oSafeAreaAndFoldRects.brochureFoldArea1.width+oSafeAreaAndFoldRects.brochureFoldArea2.left)/2,
right:oSafeAreaAndFoldRects.brochureFoldArea2.left
};
}
else
{
if(iLeft>oSafeAreaAndFoldRects.brochureFoldLine2.left)
{
return{
left:oSafeAreaAndFoldRects.brochureFoldArea2.left+oSafeAreaAndFoldRects.brochureFoldArea2.width,
center:(oSafeAreaAndFoldRects.brochureFoldArea2.left+oSafeAreaAndFoldRects.brochureFoldArea2.width+oSafeAreaAndFoldRects.safeArea.left+oSafeAreaAndFoldRects.safeArea.width)/2,
right:oSafeAreaAndFoldRects.safeArea.left+oSafeAreaAndFoldRects.safeArea.width
};
}
else
{
return{
left:oSafeAreaAndFoldRects.safeArea.left,
center:(oSafeAreaAndFoldRects.safeArea.left+oSafeAreaAndFoldRects.brochureFoldArea1.left)/2,
right:oSafeAreaAndFoldRects.brochureFoldArea1.left
};
}
}
};




this.execute=function $vpfn_x$cQrMRddeGawUSirBdzpg91$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var aItems=me.selection.getArray();

var oAlignment=null;

if(!bIsBrochure)
{

oAlignment={
left:oSafeAreaAndFoldRects.safeArea.left,
center:oSafeAreaAndFoldRects.safeArea.left+oSafeAreaAndFoldRects.safeArea.width/2,
right:oSafeAreaAndFoldRects.safeArea.left+oSafeAreaAndFoldRects.safeArea.width
};
}

var oRect;
for(var i=0;i<aItems.length;i++)
{
oRect=getRectWithRotation(aItems[i]);

if(bIsBrochure)
{

oAlignment=getClosestBrochureAlignment(oRect.left,oRect.width);
}

switch(me.direction)
{
case"left":
aItems[i].coordinates.setCoordPrecise("left",oAlignment.left);
break;
case"center":
aItems[i].coordinates.setCoordPrecise("left",oAlignment.center-oRect.width/2);
break;
case"right":
aItems[i].coordinates.setCoordPrecise("left",oAlignment.right-oRect.width);
break;
default:
break;
}
}
};




this.undo=function $vpfn_wqUr4J8VClm4t0HqHwP7CA138$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<oSelection.getLength();i++)
{
oSelection.getItem(i).coordinates.setRectPrecise(me.initialRects[i]);
}
};





this.isVoid=function $vpfn_hNcpHZvhkkHF8SV0Ga9vNQ150$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_k4h779FTeij3W2r9TE3_Gw159$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("type",this.direction);
oInfo.setSelection(this.selection);
return oInfo;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}











vp.studio.commands.AddArrow=function $vpfn_EzJOQ_s4XcW18sqZyUc3xw13$30(oColor,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Add Arrow";





this.color=oColor;





this.rotationAngle=iRotationAngle;

var _oArrow=null;

var _oSelectionCommand=null;




this.execute=function $vpfn_HkaF5BZThZng4LOCkL4U_A42$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_oArrow)
{
_oArrow=new vp.studio.Arrow();

Editor.assignUniqueID(_oArrow);


var aImageTypes=[DOCITEM_TYPE_SHAPE_LAYER,DOCITEM_TYPE_CALENDAR_GRID];
aImageTypes.append(DOCITEM_IMAGE_TYPES);

_oArrow.zIndex=Editor.getMaxProperty(aImageTypes,"zIndex")+1;


var iMinWidth=parseInt(Math.max(Editor.dimensions.width/3,200));
var oRect={top:0,left:0,width:iMinWidth,height:1};
oRect.left=Math.round((Editor.dimensions.width/2)-(oRect.width/2));
oRect.top=Math.round((Editor.dimensions.height/2)-(oRect.height/2)-20);
oRect.height=Math.round(oRect.width/3);




if(me.rotationAngle==90||me.rotationAngle==270)
{
oRect.width=Math.round(oRect.width/2);
}

_oArrow.coordinates.setRectPrecise(oRect);
if(me.rotationAngle>0)
{
_oArrow.coordinates.rotateBy(me.rotationAngle);
}

_oArrow.color=me.color;
}

Editor.addItem(_oArrow);
Editor.render();


if(!_oSelectionCommand)
{
var oNewSelection=new vp.studio.Selection();
oNewSelection.add(_oArrow);

_oSelectionCommand=new vp.studio.commands.ChangeSelection(
Editor.selection.getState(),
oNewSelection);
}

_oSelectionCommand.execute();
Editor.toolbar.refreshWithDelay();
};




this.undo=function $vpfn_Cy0jZ32MPfXmW3tWtUh6zA101$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_oSelectionCommand.undo();
Editor.removeItem(_oArrow);
};





this.isVoid=function $vpfn_s30URdDx_NJmGaQApKSKVw111$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_zyLj1L1Ps_izWC3e5qdTAg120$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("color",this.color.toString());
oInfo.setItem("rotation",this.rotationAngle);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}












vp.studio.commands.ChangeArrow=function $vpfn_Cy7XkaBcwZN9tNpXrJJxrA14$33(oArrow,oColor,iRotationAngle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Change Arrow";





this.color=oColor;

var _oOriginalColor=null;





this.rotationAngle=iRotationAngle;

this.arrow=oArrow;

var _oSelectionCommand=null;




this.execute=function $vpfn_dxXl9snAJ_vpK6RgP5Aetg45$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!_oOriginalColor)
{
_oOriginalColor=oArrow.color;
}

me.arrow.color=me.color;
me.arrow.coordinates.rotateTo(me.rotationAngle);
me.arrow.refresh();

Editor.toolbar.refreshWithDelay();
};




this.undo=function $vpfn__oBtgFHzhGEDDW3_1QoanA62$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.arrow.color=_oOriginalColor;
me.arrow.coordinates.rotateTo(-me.rotationAngle);
me.arrow.refresh();

Editor.toolbar.refreshWithDelay();
};





this.isVoid=function $vpfn_iDJMY$mvdh0JIupufkWzWQ75$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_b8bMhjTa9tQMxUtXzeboiQ84$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("arrow",this.arrow.id);
oInfo.setItem("color",this.color.toString());
oInfo.setItem("rotation",this.rotationAngle);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}










vp.studio.commands.Save=function $vpfn_4DnYOZRgJZtzxHRfgK783Q12$26(sSaveMethod)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Save: "+sSaveMethod;





this.saveMethod=sSaveMethod;




this.execute=function $vpfn_nCgeKg_wkstLpWPAbHHF4A31$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
switch(me.saveMethod)
{
case"save":
Editor.asyncActions.save(false,true);
return new vp.studio.commands.Null();
break;
case"save_as":
Editor.asyncActions.saveAs();
return new vp.studio.commands.Null();
break;
default:
break;
}

return null;
};

this.undo=function $vpfn_7X0Q_jcjJIg93nRSupkzAA50$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return;
};





this.isVoid=function $vpfn_WxoGTvu6cVSMftCSS5oTyA59$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_T0RYAyI5Jfo5o6eKQ8Lqkg68$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
return oInfo;
};
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}vp.studio.commands.UpdateColorOverrides=function $vpfn_fVB4mNVSGQ0WXwm00G1pkw1$42(oSelection,colorOverrides)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.commandName="Update Color Overrides";





this.selection=oSelection;




this.colorOverridesInitial=oSelection.colorOverrides;




this.execute=function $vpfn_iXQGqMkEpomxdlXWaWPEYA25$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oSelection.colorOverrides=colorOverrides;
oSelection.refresh();
if(oSelection.threadColorSelector)
{
oSelection.threadColorSelector.setSwatchColors(colorOverrides);
}
};




this.undo=function $vpfn_Yd4bzct8btD7db4f7qpHWQ38$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oSelection.colorOverrides=me.colorOverridesInitial;
if(oSelection.threadColorSelector)
{
oSelection.threadColorSelector.setSwatchColors(me.colorOverridesInitial);
}
oSelection.refresh();
};





this.isVoid=function $vpfn_ZWgr7PTZhsKK7mCm11kDZw52$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};





this.getInfo=function $vpfn_TcRt0vxLskC$OO4E4LSP8g61$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("image",this.selection.id);
oInfo.setArray("colorOverrides",colorOverrides);
return oInfo;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



vp.define("vp.studio");

vp.studio.HTML5Draggable=function $vpfn_4pMkJ$SqR_Jriho61dtxjg7$27(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var _data={files:e.originalEvent.dataTransfer.files};

this.bindDragHandler=function $vpfn_FgBJS$nU5sqxTGhtZqHiZQ11$27(fn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$(document).bind("dragover",fn);
};

this.unbindDragHandler=function $vpfn_UZqKgcru$a5wkFq__pL7Rg16$29(fn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$(document).unbind("dragover",fn);
};

this.setCustomData=function $vpfn_H1uLpAo4NYZaH41XB6XJqQ21$25(key,val)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_data[key]=val;
};

this.data=function $vpfn_MfLDe5M4z28QTd2zHgH1Dg26$16(key)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!key)
{
return _data;
}
else
{
return _data[key];
}
};
};

vp.studio.Draggable=function $vpfn_XkgUlITK9mCje0nhmOgm6g39$22(el,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.$el=$(el);

var initialize=function $vpfn_2UOBc8CdH57uTBzp8pcVbA44$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var defaults={
helperWidth:50,
helperElement:el,
helper:createThumbnail,
scope:"default",
zIndex:999999,
appendTo:"body"
};

options=$.extend(defaults,options);

if(!options.cursorAt)
{
options.cursorAt={left:options.helperWidth/2,top:options.helperWidth/2};
}

if(options.data)
{
me.$el.data(options.data);
}

createDraggable();
};

var createDraggable=function $vpfn_dbspVMKPAKAn8hJCw8el1w70$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.bind("dragstart",onStart);
me.$el.bind("dragstop",onStop);
me.$el.draggable(options);
};

var onStart=function $vpfn__9IP6Rn3l3Ps8Ii1Ea1dHA77$18(e,ui)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

e.stopPropagation();
vp.studio.Draggable.current=me;
if(vp.studio.DroppableManager.initialized)
{
vp.studio.DroppableManager.start(e,ui);
}
};

var onStop=function $vpfn_1lMvcnZd3IGswGehwZtSrw88$17(e,ui)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e.stopPropagation();
if(vp.studio.DroppableManager.initialized)
{
vp.studio.DroppableManager.stop(e,ui);
}
vp.studio.Draggable.current=null;
};

var createThumbnail=function $vpfn_Gv_Loykt1Yxe4VmY3XdcCQ98$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $helperElement=
$(options.helperElement)
.clone()
.removeAttr("id")
.fadeTo(0,0.5);

if(typeof(options.helperWidth)==="number")
{
var w=$(options.helperElement).width();
var h=$(options.helperElement).height();

$helperElement.css({
"width":options.helperWidth,
"height":h*options.helperWidth/w
});
}

return $helperElement;
};

this.option=function $vpfn_Op2O3$RHte1MPhrGUJOdvw120$18(key,value)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.$el.draggable("option",key,value);
};

this.setEnabled=function $vpfn_fGmjizU1zcqsq0qS0JhwLQ125$22(bEnableDragging)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(bEnableDragging&&!me.$el.data("draggable"))
{
createDraggable();
}

me.$el.draggable(bEnableDragging?"enable":"disable");
};

this.setCustomData=function $vpfn_H1uLpAo4NYZaH41XB6XJqQ135$25(key,val)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.data(key,val);
};

this.data=function $vpfn_MfLDe5M4z28QTd2zHgH1Dg140$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.$el.data.apply(me.$el,arguments);
};

this.bindDragHandler=function $vpfn_FgBJS$nU5sqxTGhtZqHiZQ145$27(fn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.bind("drag",fn);
};

this.unbindDragHandler=function $vpfn_UZqKgcru$a5wkFq__pL7Rg150$29(fn)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.unbind("drag",fn);
};

initialize();
};

vp.studio.Draggable.isDragging=false;

vp.studio.Droppable=function $vpfn_bcjxivYhAOW85Fp9BbwMpQ160$22(el,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.$el=$(el);

var initialize=function $vpfn_2UOBc8CdH57uTBzp8pcVbA165$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var defaults={
noHighlight:false,
over:addHoverElement,
out:removeHoverElement,
deactivate:removeHoverElement,
scope:"default",
tolerance:"pointer"
};

options=$.extend(defaults,options);

me.$el.droppable(options);
me.$el.bind("drop",removeHoverElement);
};

var addHoverElement=function $vpfn_wXN4XS_Aew4vPWQLrfYgog182$26(e,ui)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(options.noHighlight||options.scope!=ui.draggable.draggable("option","scope"))
{
return;
}

var elementPosition=me.$el.position();


$("<div>")
.fadeTo(0,0.35)
.css({
"width":me.$el.width(),
"height":me.$el.height(),
"position":"absolute",
"top":elementPosition.top,
"left":elementPosition.left,
"background-color":"navy",
"z-index":999998
})
.addClass("droppable-overlay")
.insertAfter(me.$el);
};

var removeHoverElement=function $vpfn_7FQCXBwZLI9hTenCyG_gEw207$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.next(".droppable-overlay").remove();
};

this.setEnabled=function $vpfn_fGmjizU1zcqsq0qS0JhwLQ212$22(bEnableDragging)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$el.droppable(bEnableDragging?'enable':'disable');
};

initialize();
};

vp.studio.DroppableManager=function $vpfn_VAYx3GnPuIe8d5b25H6mPA220$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var offsets={};
var droppables={};
var me=this;
var cid=0;
var current=null;
var lastX,lastY;

this.initialize=function $vpfn_bL73kZxWuPr4Lw4aeI4sdg229$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.upload.detectHTML5();
if(vp.upload.HTML5Enabled.DragAndDropUploads)
{
$(document).bind("dragenter",this.prepareHTML5Draggable);
}

this.initialized=true;
};

this.register=function $vpfn_an$JZuSBepo_d79TFqRmJg241$20(droppable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
droppable.id=cid;
droppables[cid]=droppable;
cid++;

if(vp.studio.Draggable.current)
{
me.prepareOffset(droppable);
}
};

this.prepareOffset=function $vpfn_tFABNu6CzbDsjykHziN5hQ253$25(droppable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!droppable.disabled&&vp.studio.Draggable.current&&droppable.view.$el.is(":visible"))
{
offsets[droppable.id]=$.extend(droppable.view.$el.offset(),{width:droppable.view.$el.width(),height:droppable.view.$el.height()});
}
};

this.removeOffset=function $vpfn_ObpXbPdMju5xzrYzBS5kQg261$24(droppable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
delete offsets[droppable.id];
};

this.prepareOffsets=function $vpfn_VIvPPo1yrex9xn9WLdJ$FQ266$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
offsets={};

for(var id in droppables)
{
if(droppables.hasOwnProperty(id))
{
me.prepareOffset(droppables[id]);
}
}

if(vp.studio.Draggable.current)
{
onDrag();
}
};

this.remove=function $vpfn_GMi$2onpesyng9JJO8lCmg284$18(droppable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
delete droppables[droppable.id];
delete offsets[droppable.id];
};

this.prepareHTML5Draggable=function $vpfn_eo2Wb8ne2JA0E6$3wTYuLw290$33(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.Draggable.current=new vp.studio.HTML5Draggable(e);
me.start(e);
};

this.start=function $vpfn_Rm_2Uo_mOmniimoLVCYOpA296$17(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.prepareOffsets();
vp.studio.Draggable.current.bindDragHandler(onDrag);

for(var id in droppables)
{
if(droppables.hasOwnProperty(id))
{
droppables[id].activate(e,vp.studio.Draggable.current);
}
}
};

this.stop=function $vpfn_moqwHIayuOfhak3ZMPW_AA310$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.studio.Draggable.current)
{
return;
}

vp.studio.Draggable.current.unbindDragHandler(onDrag);

var droppable=getActiveDroppableAt(e.originalEvent.pageX,e.originalEvent.pageY);
if(droppable)
{
droppable.view.$el.removeClass("over");
if(e&&e.originalEvent&&e.originalEvent.dataTransfer)
{
vp.studio.Draggable.current.setCustomData("files",e.originalEvent.dataTransfer.files);
}
droppable.drop(e,vp.studio.Draggable.current);
}

for(var id in droppables)
{
if(droppables.hasOwnProperty(id))
{
droppables[id].deactivate(e,vp.studio.Draggable.current);
}
};
};

var getActiveDroppableAt=function $vpfn_GeOPG8ie9Xzqs7J2I9oemQ339$31(x,y)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var activeDroppable=null;

for(var id in offsets)
{
if(offsets.hasOwnProperty(id))
{
var droppable=droppables[id];
var offset=offsets[id];

if(!droppable.disabled&&
x>=offset.left&&
x<=offset.left+offset.width&&
y>=offset.top&&
y<=offset.top+offset.height&&
droppable.accepts(vp.studio.Draggable.current)&&
(!activeDroppable||droppable.priority>activeDroppable.priority))
{
activeDroppable=droppable;
}
}
}

return activeDroppable;
};

var onDrag=function $vpfn__bk8fs5_pzuhcRXBvO5nKQ366$17(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(e)
{
lastX=e.originalEvent.pageX;
lastY=e.originalEvent.pageY;
}

var droppable=getActiveDroppableAt(lastX,lastY);

if(current&&(!droppable||current.id!=droppable.id))
{
current.view.$el.removeClass("over");
current.out(e,vp.studio.Draggable.current);
}

if(droppable)
{
if(!droppable.view.$el.hasClass("over"))
{
droppable.view.$el.addClass("over");
}
droppable.over(e,vp.studio.Draggable.current);
}

current=droppable;
};

this.initialize();
};


vp.studio.DroppableView=function $vpfn_TWff1KHq1cUFGlWw2cKy8A398$26(view,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.view=view;

var defaults=
{
priority:[],
accepts:function $vpfn_Jt3jjwo_s8WUes8V79OS8Q406$18(draggable){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return true;},
disabled:false,
drop:function(e,draggable){},
activate:function(e,draggable){},
deactivate:function(e,draggable){},
over:function(e,draggable){},
out:function(e,draggable){}
};

$.extend(this,defaults,options);

var initialize=function $vpfn_2UOBc8CdH57uTBzp8pcVbA417$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.studio.DroppableManager.initialized)
{
vp.studio.DroppableManager=new vp.studio.DroppableManager();
}

vp.studio.DroppableManager.register(me);

vp.upload.detectHTML5();
if(vp.upload.HTML5Enabled.DragAndDropUploads)
{
me.view.$el.bind("drop",onHTML5Drop);
}
};

var onHTML5Drop=function $vpfn_XeE4mJuByPIG95Qp8fyKOw433$22(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.DroppableManager.stop(e);
vp.studio.Draggable.current=null;
};

this.disable=function $vpfn_Dj59JEvjXA$3eMlAnfUW8Q439$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.disabled=true;
$(document).unbind("dragend",onHTML5Drop);
vp.studio.DroppableManager.removeOffset(me);
};

this.enable=function $vpfn_afJ4voEkA2CIId1HeTWv2Q446$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.disabled=false;
$(document).bind("dragend",onHTML5Drop);
vp.studio.DroppableManager.prepareOffset(me);
};

this.destroy=function $vpfn_MghA4uiugsxfDSc3QIUerg453$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.disable();
me.view.$el.unbind("drop");
vp.studio.DroppableManager.remove(me);
};

initialize();
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;



}





if(typeof vp=="undefined")
{
var vp={};
}





if(!vp.maps)
{
vp.maps=function(){};
}

vp.maps.URL_RENDER="/any/preview/map.caspx";
vp.maps.URL_GEOCODE="/maps/geocode.aspx";
vp.maps.URL_EDITOR="/maps/editor.aspx";









vp.maps.openAddDialog=function $vpfn_piyfS_JQ5EhGR832i5p5Jw37$24(oHostDialog,fnCallback,sPfid,fAspectRatio,bLocked,iProductKitId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParams={};
oParams.callback=fnCallback;
oParams.aspectratio=fAspectRatio||1.0;
oParams.aspectratiolocked=bLocked||false;
oParams.pfid=sPfid;
oParams.productkitid=iProductKitId;

vp.maps._openDialog(oHostDialog,fnCallback,oParams);
};










vp.maps.openEditDialog=function $vpfn_A2Tag$BwBTy3HahOHLZ19g58$25(oHostDialog,fnCallback,sPfid,oMapData,oMapAddress,bLocked,iProductKitId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParams={};
oParams.callback=fnCallback;
oParams.map=oMapData;
oParams.address=oMapAddress;
oParams.aspectratiolocked=bLocked;
oParams.pfid=sPfid;
oParams.productkitid=iProductKitId;

vp.maps._openDialog(oHostDialog,fnCallback,oParams);
};








vp.maps._openDialog=function $vpfn_ga0QAbM2K3ocObm31eoK9w78$22(oHostDialog,fnCallback,oParams)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oUrl=new vp.web.URL(vp.maps.URL_EDITOR);
oUrl.setItem("newmap",oParams.address?"0":"1");
oUrl.setItem("pfid",oParams.pfid?oParams.pfid:"");
oUrl.setItem("product_kit_id",oParams.productkitid?oParams.productkitid:"");


if(oHostDialog&&oHostDialog.dialogType!=DIALOG_TYPE_IFRAME)
{



oHostDialog.close();
oHostDialog=null;
}


if(!oHostDialog)
{
oHostDialog=new vp.dialog.IFrameDialog("MapDialog",{},null);
oHostDialog.chrome=vp.dialog.chrome.Primary;

oUrl.setItem("newdialog","1");
}


oHostDialog.params=oParams;


oHostDialog.navigate(oUrl.toString());
};







vp.maps.Location=function $vpfn_XeucdxDwHYiwElWXptRc5g117$19(fLat,fLon)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.latitude=fLat;





this.longitude=fLon;





this.clone=function $vpfn_laxgRGYGKiib$K7Scz4lHg137$17(oWindow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oScope=oWindow||window;
return new oScope.vp.maps.Location(me.latitude,me.longitude);
};





this.equals=function $vpfn_vXYWAeq17QMKq8UHMlF9iQ148$18(oLoc)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oLoc)
{
return me.latitude==oLoc.latitude&&me.longitude==oLoc.longitude;
}
return false;
};
};










vp.maps.Map=function $vpfn_aeJ6cR9uYZN_cnPkew_e1A167$14(fWidth,fHeight,iScale,oCenter,oPoi)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.id=0;





this.width=fWidth;





this.height=fHeight;





this.scale=iScale;





this.center=oCenter;





this.poi=oPoi||new vp.maps.Location(oCenter.latitude,oCenter.longitude);





this.zoom=1;





this.resize=function $vpfn_Jw3jAU43ijDg3NW5NjCtUw217$18(fRatio)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.width=me.width*fRatio;
me.height=me.height*fRatio;


me.scale=Math.round(me.scale/fRatio);
};





this.clone=function $vpfn_laxgRGYGKiib$K7Scz4lHg231$17(oWindow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oScope=oWindow||window;
var oMap=new oScope.vp.maps.Map(me.width,me.height,me.scale,
me.center.clone(oScope),me.poi.clone(oScope));
oMap.id=me.id;
return oMap;
};





this.equals=function $vpfn_vXYWAeq17QMKq8UHMlF9iQ244$18(oMap)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oMap)
{
return me.width==oMap.width&&
me.height==oMap.height&&
me.scale==oMap.scale&&
me.center.equals(oMap.center)&&
me.poi.equals(oMap.poi);
}
return false;
};
};










vp.maps.Address=function $vpfn_t73SJjoPJihYvibYK9w7FQ267$18(sStreet,sCity,sState,sZip,sCountry)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.id=0;


this.street=sStreet;
this.city=sCity;
this.state=sState;
this.zip=sZip;
this.country=sCountry;





this.clone=function $vpfn_laxgRGYGKiib$K7Scz4lHg288$17(oWindow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oScope=oWindow||window;
var oAddr=new oScope.vp.maps.Address(me.street,me.city,me.state,me.zip,me.country);
oAddr.id=me.id;
return oAddr;
};





this.equals=function $vpfn_vXYWAeq17QMKq8UHMlF9iQ300$18(oAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oAddress)
{
return me.street==oAddress.street&&
me.city==oAddress.city&&
me.state==oAddress.state&&
me.zip==oAddress.zip&&
me.country==oAddress.country;
}
return false;
};
};








vp.maps.Suggestion=function $vpfn_wrWmqB1MGWR7YDKjxwNhrA321$21(oAddress,oLocation)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.address=oAddress;





this.location=oLocation;
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;



}







if(typeof vp=="undefined")
{
var vp={};
}





if(!vp.maps)
{
vp.maps=function(){};
}
if(!vp.maps.provider)
{
vp.maps.provider=function(){};
}





vp.maps.provider.MapQuest=function $vpfn_dPQ$hMQLcFaWdLMr4eeGBQ35$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

var MAPQUEST_MIN_SIZE=100;
var DRAGGABLE_POI=true;
var PROXY_IMAGES=true;






this.mapObjects=new Array();







var ZOOM_LEVELS=new Array(
88011773,
29337258,
9779086,
3520471,
1504475,
701289,
324767,
154950,
74999,
36000,
18000,
9000,
4700,
2500,
1500,
1000
);






this.getDefaultScale=function $vpfn_B4edBYL9F$V0wI6t9neMnA80$27(oMapAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iScale=0;

if(oMapAddress.city.trim().length===0)
{

iScale=ZOOM_LEVELS[1];
}
else if(oMapAddress.street.trim().length===0)
{

iScale=ZOOM_LEVELS[8];
}
else
{

iScale=ZOOM_LEVELS[11];
}

return iScale;
};






var getClosestZoomLevel=function $vpfn_GXoZiQZRs50jB0PuCW9tmg108$30(iScale)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=ZOOM_LEVELS.length-1;i>=0;i--)
{
var iZoomScale=ZOOM_LEVELS[i];

if(iScale<=iZoomScale)
{
return i+1;
}
}
return 1;
};








var createVeil=function $vpfn_S3TsjMYcLIZcKBEtczxxlw129$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oVeil=document.createElement('DIV');
oVeil.style.fontSize='1px';
oVeil.style.display='none';
oVeil.style.top=0+'px';
oVeil.style.left=0+'px';
oVeil.style.width=100+'px';
oVeil.style.height=100+'px';
oVeil.style.position='absolute';
oVeil.style.backgroundColor='black';
vp.ui.setOpacity(oVeil,0.7);
return oVeil;
};







var updateVeils=function $vpfn_pdiX9jfsXMVvnOY$Pxku5g150$22(oVeils,oRect,iSize)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
oVeils.top.style.display=oRect.top>0?'block':'none';
oVeils.top.style.top=0+'px';
oVeils.top.style.left=0+'px';
oVeils.top.style.width=iSize+'px';
oVeils.top.style.height=oRect.top+'px';

oVeils.bottom.style.display=oRect.top+oRect.height<iSize?'block':'none';
oVeils.bottom.style.top=(oRect.top+oRect.height)+'px';
oVeils.bottom.style.left=0+'px';
oVeils.bottom.style.width=iSize+'px';
oVeils.bottom.style.height=Math.round(iSize-oRect.top-oRect.height)+'px';

oVeils.left.style.display=oRect.left>0?'block':'none';
oVeils.left.style.top=oRect.top+'px';
oVeils.left.style.left=0+'px';
oVeils.left.style.width=oRect.left+'px';
oVeils.left.style.height=oRect.height+'px';

oVeils.right.style.display=oRect.left+oRect.width<iSize?'block':'none';
oVeils.right.style.top=oRect.top+'px';
oVeils.right.style.left=(oRect.left+oRect.width)+'px';
oVeils.right.style.width=Math.round(iSize-oRect.left-oRect.width)+'px';
oVeils.right.style.height=oRect.height+'px';
};





var cropMapToFit=function $vpfn_Vl$ohYEl_WTVNnDNVSPprg181$23(oMapData,iMapSize)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fMapSizeRatio=Math.min(
iMapSize/oMapData.width,
iMapSize/oMapData.height);

oMapData.width=oMapData.width*fMapSizeRatio;
oMapData.height=oMapData.height*fMapSizeRatio;
};





var sizeMapToBestZoom=function $vpfn_U3Fs5d06gVH$CeY9vrJ0AQ195$28(oMapData,iMapSize)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var fMapSizeRatio=Math.min(
iMapSize/oMapData.width,
iMapSize/oMapData.height);
oMapData.resize(fMapSizeRatio);


var iZoom=getClosestZoomLevel(oMapData.scale);
var iScale=ZOOM_LEVELS[iZoom-1];


var fMapScaleRatio=oMapData.scale/iScale;
oMapData.resize(fMapScaleRatio);

return iZoom;
};





var readMapScaleCenterPoi=function $vpfn_lZ4qak_R3B5DSoyhtmEqVw218$32(oMap)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oMapData=oMap.vpMap;
var iSize=oMap.vpSize;


var iZoom=sizeMapToBestZoom(oMapData,iSize);
var iCurrentZoom=oMap.getZoomLevel();


if(iZoom!=iCurrentZoom)
{
var fScaleRatio=ZOOM_LEVELS[iCurrentZoom-1]/ZOOM_LEVELS[iZoom-1];
oMapData.scale=Math.round(oMapData.scale*fScaleRatio);
}


var oCenter=oMap.getCenter();
oMapData.center.latitude=oCenter.getLatitude();
oMapData.center.longitude=oCenter.getLongitude();


var oPoi=oMap.getShapes(true).getAt(0);
oMapData.poi.latitude=oPoi.getLatLng().getLatitude();
oMapData.poi.longitude=oPoi.getLatLng().getLongitude();



};




var stopManipulatorDeselect=function $vpfn_8YbW0$jzdwhdmHzNVKmKJA251$34(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e.cancelCustomEvent=true;
};










this.createMapObject=function $vpfn_vH4Qs$nQrwqgXKO9R2w1tg265$27(vMapArea,oMapData,iMapSize,iDesiredScale,bLockAspectRatio)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

iMapSize=Math.max(iMapSize,MAPQUEST_MIN_SIZE);


var oMapArea=vp.core.getElement(vMapArea,'vp.maps.provider.createMapObject');
oMapArea.style.position="relative";

while(oMapArea.hasChildNodes())
{
oMapArea.removeChild(oMapArea.firstChild);
}

var oMapContainer=document.createElement('DIV');
vp.ui.setWidth(oMapContainer,iMapSize);
vp.ui.setHeight(oMapContainer,iMapSize);
oMapArea.appendChild(oMapContainer);

var oMask=document.createElement('DIV');
oMask.style.display='none';
oMask.style.position='absolute';
oMask.style.backgroundImage='url('+vp.ui.imageUrl('/vp/images/c.gif')+')';
oMask.style.backgroundRepeat='repeat';
oMapArea.appendChild(oMask);

var oVeils=
{
top:createVeil(),
left:createVeil(),
right:createVeil(),
bottom:createVeil()
};
oMapArea.appendChild(oVeils.top);
oMapArea.appendChild(oVeils.left);
oMapArea.appendChild(oVeils.right);
oMapArea.appendChild(oVeils.bottom);


if(oMapData.scale===0)
{

cropMapToFit(oMapData,iMapSize);


if(iDesiredScale>0)
{
var iDesiredZoom=getClosestZoomLevel(iDesiredScale);
oMapData.scale=ZOOM_LEVELS[iDesiredZoom-1];
}
}


var iZoom=sizeMapToBestZoom(oMapData,iMapSize);


var oCenterPoint=new MQA.LatLng(oMapData.center.latitude,oMapData.center.longitude);
var oNewMap=new MQA.TileMap(
oMapContainer,
iZoom,
oCenterPoint,
'map');


var oOffMapPlacement=new MQA.MapCornerPlacement(MQA.MapCorner.BOTTOM_RIGHT,new MQA.Size(2*iMapSize,2*iMapSize));
oNewMap.setLogoPlacement(MQA.MapLogo.MAPQUEST,oOffMapPlacement);
oNewMap.setLogoPlacement(MQA.MapLogo.SCALES,oOffMapPlacement);





var oPoi=new MQA.Poi(new MQA.LatLng(oMapData.poi.latitude,oMapData.poi.longitude));
oPoi.setValue("draggable",DRAGGABLE_POI);
oNewMap.addShape(oPoi);


oNewMap.vpMap=oMapData;
oNewMap.vpMask=oMask;
oNewMap.vpVeils=oVeils;
oNewMap.vpSize=iMapSize;
oNewMap.vpLockAR=bLockAspectRatio;


me.mapObjects.push(oNewMap);
var iToken=me.mapObjects.length;


me.loadMapControls(iToken,false);

return iToken;
};







this.loadMapControls=function $vpfn_JISf24eM9vZQUYjRY5Zs4Q364$27(iMapToken,bCrop)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oMap=me.mapObjects[iMapToken-1];


var bCropping=oMap.controls.length===0;
if(bCrop==bCropping)
{
return false;
}




var oMapData=oMap.vpMap;
var iSize=oMap.vpSize;
var oVeils=oMap.vpVeils;
var oCropMask=oMap.vpMask;
var bLockAspectRatio=oMap.vpLockAR;

if(bCrop)
{

if(!oMap.vpManip)
{
var oManip=new vp.controls.Manipulator(oCropMask);
oManip.resizable=true;
oManip.draggable=true;
oManip.style.borderSelected="1px black solid";
oManip.setConstrainProportions(bLockAspectRatio);
oManip.setBoundingBox({top:0,left:0,width:iSize,height:iSize});

var fnUpdateVeils=function $vpfn_wweZQ2IENqoVskVZKuBZBw397$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oCropRect=vp.ui.getStyleRect(this.mask);
updateVeils(this.veils,oCropRect,this.size);
}
.getClosure({veils:oVeils,mask:oCropMask,size:iSize});
oManip.onresize.addHandler(fnUpdateVeils);
oManip.ondrag.addHandler(fnUpdateVeils);

oMap.vpManip=oManip;
}


oMap.enableDragging(false);



oMap.removeControl(oMap.controls[2]);


oMap.controls.removeAll();


var iX=Math.round((iSize-oMapData.width)/2.0);
var iY=Math.round((iSize-oMapData.height)/2.0);
oCropMask.style.top=iY+'px';
oCropMask.style.left=iX+'px';
oCropMask.style.width=oMapData.width+'px';
oCropMask.style.height=oMapData.height+'px';


vp.ui.expand(oCropMask);
oMap.vpManip.onbeforedeselect.addHandler(stopManipulatorDeselect);
oMap.vpManip.select();
}
else
{

if(oMap.vpManip)
{


readMapScaleCenterPoi(oMap);


vp.ui.collapse(oCropMask);
oMap.vpManip.onbeforedeselect.removeHandler(stopManipulatorDeselect);
oMap.vpManip.deselect();


var oCropRect=vp.ui.getStyleRect(oCropMask);
var oNewCenterPx=new MQA.Point(
Math.round(oCropRect.left+oCropRect.width/2.0),
Math.round(oCropRect.top+oCropRect.height/2.0));
var oNewCenterLL=oMap.pixToLL(oNewCenterPx);


oMapData.width=oCropRect.width;
oMapData.height=oCropRect.height;
var iZoom=sizeMapToBestZoom(oMapData,iSize);


oMapData.center.latitude=oNewCenterLL.getLatitude();
oMapData.center.longitude=oNewCenterLL.getLongitude();
var iCurrentZoom=oMap.getZoomLevel();
if(iZoom!=iCurrentZoom)
{

oMap.setCenter(oNewCenterLL,iZoom);
}
else
{

oMap.panToLatLng(oNewCenterLL);
}
}


var iXPad=Math.round((iSize-oMapData.width)/2.0);
var iYPad=Math.round((iSize-oMapData.height)/2.0);
var oRect={top:iYPad,left:iXPad,width:oMapData.width,height:oMapData.height};
updateVeils(oVeils,oRect,iSize);


oMap.enableDragging(true);

var myZControl=new MQA.ZoomControl(oMap);

$(myZControl.elem)
.find(".map-zoom-in img:first-child")
.attr({title:vp.LangMap.MapsEditorZoomButtonsAltText_0,alt:vp.LangMap.MapsEditorZoomButtonsAltText_0})
.end()
.find(".map-zoom-out img:first-child")
.attr({title:vp.LangMap.MapsEditorZoomButtonsAltText_1,alt:vp.LangMap.MapsEditorZoomButtonsAltText_1});

oMap.addControl(myZControl,new MQA.MapCornerPlacement(MQA.MapCorner.TOP_LEFT,new MQA.Size(iXPad,iYPad)));




}

return true;
};







this.updateMapObject=function $vpfn_AuhcF3b9ilyxbrlGl35APA508$27(iMapToken,oMapLocation,iDesiredScale)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oMap=me.mapObjects[iMapToken-1];


var oMapData=oMap.vpMap;




me.loadMapControls(iMapToken,false);






var oPoi=oMap.getShapes(true).getAt(0);
oPoi.setLatLng(new MQA.LatLng(oMapLocation.latitude,oMapLocation.longitude));


var iCurrentZoom=oMap.getZoomLevel();
var iZoom=iCurrentZoom;
if(iDesiredScale>0)
{


var iDesiredZoom=getClosestZoomLevel(iDesiredScale);
if(Math.abs(iZoom-iDesiredZoom)>2)
{
iZoom=iDesiredZoom;
}
}


var oNewCenter=new MQA.LatLng(oMapLocation.latitude,oMapLocation.longitude);
if(iCurrentZoom!=iZoom)
{
oMap.setCenter(oNewCenter,iZoom);
}
else
{

oMap.panToLatLng(oNewCenter);
}
};






this.readMapObject=function $vpfn_lx79_s7lYYwPEth0yNKzSA561$25(iMapToken)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oMap=me.mapObjects[iMapToken-1];


var bEndedCrop=me.loadMapControls(iMapToken,false);






if(!bEndedCrop)
{

readMapScaleCenterPoi(oMap);
}


return oMap.vpMap;
};





this.deleteMapObject=function $vpfn_SDDsFoWCUBdUK4qiaXSIAA588$27(iMapToken)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oMap=me.mapObjects[iMapToken-1];




oMap.dispose();
};








var getMapServiceUrl=function $vpfn_8DSmYdIL6MLnA_uLzflW1Q606$27(oMapData,bImage,bGray)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL(vp.maps.URL_RENDER);
oURL.setItem("w",oMapData.width);
oURL.setItem("h",oMapData.height);
oURL.setItem("s",oMapData.scale);
oURL.setItem("clat",oMapData.center.latitude);
oURL.setItem("clon",oMapData.center.longitude);
oURL.setItem("plat",oMapData.poi.latitude);
oURL.setItem("plon",oMapData.poi.longitude);


oURL.setItem("z",oMapData.zoom);
oURL.setItem("img",bImage?1:0);
oURL.setItem("gs",bGray?1:0);
oURL.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);

return oURL.toString();
};








this.updateMapPreview=function $vpfn_CgSC28NnPhDXiqrd$U7Gbg633$28(vMapElement,oMapData,bGray,fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oMapElement=vp.core.getElement(vMapElement,"vp.maps.provider.updateMapPreview");


var bImage=PROXY_IMAGES||bGray;


var serviceUrl=getMapServiceUrl(oMapData,bImage,bGray);

if(bImage)
{

vp.ui.setSrcPNG(oMapElement,serviceUrl,fnCallback);
}
else
{

var fnApplyImageUrl=function $vpfn_wweZQ2IENqoVskVZKuBZBw652$34(sResponse)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oResponse=vp.http.parseJSON(sResponse);


var sNewURL=oResponse.mapURL;


vp.ui.setSrcPNG(this.map,sNewURL,this.cb);
}
.getClosure({
map:oMapElement,
cb:fnCallback
});



vp.http.getAsync(serviceUrl,fnApplyImageUrl);
}
};









var getMapGeocodeUrl=function $vpfn_oSGjzyvC3p3bu_KWpPUJgA682$27(oMapAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL(vp.maps.URL_GEOCODE);
oURL.setItem("street",oMapAddress.street);
oURL.setItem("city",oMapAddress.city);
oURL.setItem("state",oMapAddress.state);
oURL.setItem("zip",oMapAddress.zip);
oURL.setItem("country",oMapAddress.country);

return oURL.toString();
};






this.geocodeAddress=function $vpfn_$8NoMDwCm0l6kFO0F68Xyw699$26(oMapAddress,fnCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var geocodeUrl=getMapGeocodeUrl(oMapAddress);


var fnResult=function $vpfn_wweZQ2IENqoVskVZKuBZBw705$23(sResponse)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oResponse=vp.http.parseJSON(sResponse);


var aSuggestions=oResponse.suggestions;


this.cb(aSuggestions);
}
.getClosure({cb:fnCallback});



vp.http.getAsync(geocodeUrl,fnResult);
};
};


vp.maps.source=new vp.maps.provider.MapQuest();











if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.ContextMenu=function $vpfn_$Zh5Bev9FNzjF0s6Yljj3Q11$24(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;





this.menuElement=null;





this.docItem=oDocItem;





this.visible=false;





this.oninit=new vp.events.CustomEvent(this,"oninit");





this.onbeforeshow=new vp.events.CustomEvent(this,"onbeforeshow");





this.onaftershow=new vp.events.CustomEvent(this,"onaftershow");





this.onhide=new vp.events.CustomEvent(this,"onhide");





var m_sOriginalTooltip="";

var _iTimer=null;

var _$document=$(document);
var _$window=$(window);





var init=function $vpfn_tX6QXWYFmXYvT0N7BnCdCA72$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.docItem.manipulator)
{
vp.events.add(me.docItem.getManipulatorElement(),"contextmenu",onRightClickHandler);
me.docItem.manipulator.onselect.addHandler(onManipulatorSelect);
}
};





var m_bManipulatorEventAdded=false;






var onManipulatorSelect=function $vpfn_rgGMF9M56nEx0tjCdas6IA92$30(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!m_bManipulatorEventAdded)
{
vp.events.add(this.getDOMElement(),"contextmenu",onRightClickHandler);
me.docItem.manipulator.onmousedown.addHandler(onManipulatorMouseDown);
}

clearAllContextMenus();
};




var onManipulatorMouseDown=function $vpfn_$8cZp5gFEkw9aIlTuXu_lg106$33(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearAllContextMenus();
};





var onRightClickHandler=function $vpfn_WmVYP7tudnemWviAwBkh4A115$30(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.events.isRightClick(e))
{
return;
}

me.show(e);
vp.studio.instrumentation.add("StudioContextMenu_rightClickToShowMenu");

vp.events.cancel(e);
};





this.show=function $vpfn_tuVySdPzWo9bYQ4ZQPmEWw132$16(e,oPosition)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();


if(!me.menuElement)
{
me.menuElement=document.createElement("div");
me.menuElement.className="contextMenu";


vp.events.add(me.menuElement,"contextmenu",vp.events.cancel);


vp.events.add(me.menuElement,"mousedown",vp.events.cancelBubble);

document.body.appendChild(me.menuElement);

me.oninit.fire();
}

var fnAddHideEvent=function $vpfn_u19$1nEVcX5NnoxKTBMi6Q153$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.add(document,"mousedown",me.hide);
};

window.setTimeout(fnAddHideEvent,1);
if(!me.visible)
{


m_sOriginalTooltip=me.docItem.getManipulatorElement().title;
me.docItem.getManipulatorElement().title="";
}

me.onbeforeshow.fire();

clearAllContextMenus();

var oMousePos;


if(oPosition)
{
oMousePos=oPosition;
}
else
{
oMousePos={
top:e.clientY+_$document.scrollTop(),
left:e.clientX+_$document.scrollLeft()
};
}

me.menuElement.style.top=oMousePos.top+'px';
me.menuElement.style.left=oMousePos.left+'px';
me.menuElement.style.visibility="hidden";
me.menuElement.style.display="block";

vp.studio.instrumentation.add("StudioContextMenu_showMenu");


var iMaxRight=_$document.scrollLeft()+_$window.width()-5;
if(me.menuElement.offsetLeft+me.menuElement.offsetWidth>iMaxRight)
{
me.menuElement.style.left=(iMaxRight-me.menuElement.offsetWidth)+'px';
}


var fnShow=function $vpfn_7dyaCWXOhCPu7mgx1huX1Q201$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

me.menuElement.style.visibility="visible";
me.visible=true;

me.onaftershow.fire();
};

window.setTimeout(fnShow,10);
};

var showWithDelay=function $vpfn_y_kaZc66FIl8T14G0k9X1A213$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();

_iTimer=window.setTimeout(me.show,200);
};

var hideWithDelay=function $vpfn_DJfRgnKkK4ktTE$Wf$C2dA220$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();
_iTimer=window.setTimeout(me.hide,200);
};

var clearTimer=function $vpfn_q0_ZFZmBZSr$rJ1ZJHkxDw226$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iTimer)
{
clearTimeout(_iTimer);
_iTimer=null;
}
};








this.addRow=function $vpfn_DI$1vjen7wBbIomIN3Ja4w242$18(sImg,sText,sCommandName,fnCommand,iIndex)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oItem=createRowItem(sImg,sText,sCommandName,fnCommand);
var oChildNodes=me.menuElement.childNodes;
if(iIndex&&iIndex<oChildNodes.length)
{
me.menuElement.insertBefore(oItem,oChildNodes[iIndex]);
}
else
{
me.menuElement.appendChild(oItem);
}

return oItem;
};







var createRowItem=function $vpfn_A9bWEQFBgGighqrSHqqvdg264$24(sImg,sText,sCommandName,fnCommand)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oItem=$("<div class='contextMenuItem'><dd><img class='contextMenuItemIcon'/></dd><dt></dt></div>");
oItem.find("dt").text(sText);
oItem.find("img").attr("src",sImg);

var fnWrapper=function $vpfn__rHg5B4SNHuyfAC3UsELww270$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.hide(e);
fnCommand(e);
vp.studio.instrumentation.add("StudioContextMenu_selectMenuOption_"+me.docItem.itemTypeString+"_"+sCommandName);
};

vp.events.add(oItem[0],"click",fnWrapper);

return oItem[0];
};





this.addTitle=function $vpfn_iMmTl9_t6CLGC06syxIfyQ286$20(sText)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oItem=document.createElement("DIV");
oItem.className="contextMenuItem contextMenuTitle";

oItem.innerHTML=sText;
me.menuElement.appendChild(oItem);

return oItem;
};





this.hide=function $vpfn_0OpJq587eTGBcUqw9uWugg301$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();


if(e)
{
e=vp.events.getEvent(e);

if(vp.events.isRightClick(e)&&e.target==me.docItem.getManipulatorElement())
{
return;
}
}

if(me.visible)
{
me.menuElement.style.display="none";
me.visible=false;


me.docItem.getManipulatorElement().title=m_sOriginalTooltip||"";


vp.events.remove(document,"mousedown",me.hide);

me.onhide.fire();

vp.studio.instrumentation.add("StudioContextMenu_hideMenu");
}
};




this.deleteSelection=function $vpfn_bWTrzp$1psMcvcYCFtv_5Q336$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=(new vp.studio.Selection()).getState();
oSelection.add(me.docItem,true);

var sWarningDialogId;
if(Editor.features.showWarningOnStaticImageDelete
&&!me.docItem.imageAreaID
&&(me.docItem.type==DOCITEM_TYPE_UPLOADED_IMAGE||
me.docItem.type==DOCITEM_TYPE_LIBRARY_IMAGE||
me.docItem.type==DOCITEM_TYPE_PLACEHOLDER))
{
sWarningDialogId="deleteStaticImage";
vp.studio.deleteimagewarning.docItem=me.docItem;
}

var oCmd=new vp.studio.commands.Delete(oSelection,sWarningDialogId);

oCmd.execute();
Editor.history.add(oCmd);
};




this.changeThreadColor=function $vpfn_BPoYnieICPaTh8jVtFV2Ow361$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.docItem.type===DOCITEM_TYPE_UPLOADED_IMAGE||
me.docItem.type===DOCITEM_TYPE_LIBRARY_IMAGE)
{
if(!me.docItem.threadColorSelector&&!$("ul.currentSwatches")[0].threadColorSelector)
{
new vp.studio.ThreadColorSelector(me.docItem);
}
if($("ul.currentSwatches")[0].threadColorSelector)
{
me.docItem.threadColorSelector=$("ul.currentSwatches")[0].threadColorSelector;
me.docItem.threadColorSelector.setImage(me.docItem);
}
me.docItem.threadColorSelector.showSwatches(true);
}
};




var clearAllContextMenus=function $vpfn_ff$5lPM4XnN6gY7wGCLO_w382$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=Editor.items.length;
for(var i=0;i<iLen;i++)
{
var oItem=Editor.items[i];
if(oItem.contextMenu)
{
oItem.contextMenu.hide();
}
}
};

init();
};








vp.studio.ImageContextMenu=function $vpfn_$ZBCk0k9j9bN5PeFABgWfQ405$29(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ContextMenu;
this.inheritFrom(oDocItem);

var m_oDocItem=oDocItem;




var changeImage=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA420$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openChangeImageTool(this);
}
.getClosure(oDocItem);




var cropImage=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA429$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.addAndCropImage(this.id);
}
.getClosure(oDocItem);




var changeMap=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA438$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openMapDialog(this.id);
}
.getClosure(oDocItem);




var changeComplexQrCode=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA447$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openComplexQrCodeDialog(this.id);
}
.getClosure(oDocItem);




var unlockImage=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA456$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();
oSelection.add(this,true);

var oCmd=new vp.studio.commands.Lock(oSelection,false);
oCmd.execute();
Editor.history.add(oCmd);
}
.getClosure(oDocItem);




var lockImage=function $vpfn_NZvHsAZFEQOhj1K1N4bu8Q470$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();

if(Editor.selection)
{
oSelection.addRange(Editor.selection);
}

oSelection.add(m_oDocItem,true);

var oCmd=new vp.studio.commands.Lock(oSelection,true);
oCmd.execute();
Editor.history.add(oCmd);
};

var makeImageSwappable=function $vpfn_eGrgnpSUc72MHTDsKXLmJA486$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();

if(Editor.selection)
{
oSelection.addRange(Editor.selection);
}

oSelection.add(m_oDocItem,true);

var oCmd=new vp.studio.commands.Swappable(oSelection,false);
oCmd.execute();
Editor.history.add(oCmd);
};

var makeImageNotSwappable=function $vpfn_yJhw6l$ob3ztezG8WILpKA502$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();

if(Editor.selection)
{
oSelection.addRange(Editor.selection);
}

oSelection.add(m_oDocItem,true);

var oCmd=new vp.studio.commands.Swappable(oSelection,true);
oCmd.execute();
Editor.history.add(oCmd);
};

var enableStretching=function $vpfn_jyNNHeTNJdXjg84BRoLSUg518$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();

if(Editor.selection)
{
oSelection.addRange(Editor.selection);
}

oSelection.add(m_oDocItem,true);

var oCmd=new vp.studio.commands.EnableStretching(oSelection,true);
oCmd.execute();
Editor.history.add(oCmd);
};

var addPhotoFilter=function $vpfn_F$kwpAII$3G6tAGuyq3FUA534$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openPhotoFilterDialog(m_oDocItem);
};




var onInitHandler=function $vpfn_VEOgQKMO8AsIH18A5vS_vg542$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!Editor.features.enableImageSmartTags)
{
me.titleRow=me.addTitle(JSLM_StudioContextMenuImageTitle);
}

me.cropImageRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/crop.gif",
JSLM_StudioContextMenuRecrop,
"crop",
cropImage);

me.changeComplexQrCodeRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/edit_complex_qr_code.gif",
JSLM_StudioContextMenuEdit,
"editComplexQrCode",
changeComplexQrCode);

me.changeMapRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/edit_map.gif",
JSLM_StudioContextMenuEditMap,
"editMap",
changeMap);

me.changeImageRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/change_image.gif",
JSLM_StudioContextMenuChange,
"replace",
changeImage);

me.addPhotoFilter=me.addRow(
"/vp/images/b09/studio/toolbar-button/add_photo_filter.gif",
JSLM_StudioContextMenuAddPhotoFilter,
"addphotoeffect",
addPhotoFilter);

me.unlockImageRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/unlock.gif",
JSLM_StudioContextMenuUnlock,
"unlock",
unlockImage);

me.lockImageRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/lock.gif",
JSLM_StudioContextMenuLock,
"lock",
lockImage);

me.swappableRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/unlock.gif",
"Swappable",
"swappable",
makeImageSwappable);

me.notSwappableRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/lock.gif",
"Not Swappable",
"notswappable",
makeImageNotSwappable);

me.deleteRow=me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/delete.gif",
JSLM_StudioContextMenuDelete,
"delete",
me.deleteSelection);

me.changeThreadColor=me.addRow(
"/vp/images/b09/studio/toolbar-button/thread-colors-icon.png",
JSLM_StudioToolbarThreadColors,
"changeThreadColor",
me.changeThreadColor);


me.mergeColors=me.addRow(
"/vp/images/b09/studio/toolbar-button/thread-colors-icon.png",
JSLM_StudioToolbarThermographyColorsArray_0,
"mergeColors",
function $vpfn_G4wrkJJ4BcT3cnZOOrERFA621$12(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}vp.studio.thermography.mergeColors(m_oDocItem);});

me.splitColors=me.addRow(
"/vp/images/b09/studio/toolbar-button/thread-colors-icon.png",
JSLM_StudioToolbarThermographyColorsArray_1,
"splitColors",
function $vpfn_G4wrkJJ4BcT3cnZOOrERFA627$12(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}vp.studio.thermography.splitColors(m_oDocItem);});

if(Editor.features.enableUnconstrainedImages||Editor.isCCTAgent)
{
me.enableStretchingRow=me.addRow(
"/vp/images/nns/studio/toolbar2/stretch.gif",
JSLM_StudioContextMenuAllowStretching,
"stretch",
enableStretching);
}


if(m_oDocItem.manipulator)
{
vp.events.add(me.menuElement,"mousemove",m_oDocItem.showHighlight);
}
};

this.oninit.addHandler(onInitHandler);




var onBeforeShowHandler=function $vpfn_s4vXabamNqg09jJj14TuPg650$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



var bHideCrop=m_oDocItem.type==DOCITEM_TYPE_MAP||
m_oDocItem.type==DOCITEM_TYPE_COMPLEX_QR_CODE||
m_oDocItem.type==DOCITEM_TYPE_PLACEHOLDER||
m_oDocItem.type==DOCITEM_TYPE_LOGO||(m_oDocItem.type==DOCITEM_TYPE_UPLOADED_IMAGE&&Editor.isEmbroidery);


var bHideChange=m_oDocItem.type==DOCITEM_TYPE_UPLOADED_IMAGE&&Editor.isEmbroidery||
m_oDocItem.type==DOCITEM_TYPE_COMPLEX_QR_CODE;


var bHideDelete=Editor.defaultPlaceholderId
&&Editor.features.isCollage
&&m_oDocItem.type==DOCITEM_TYPE_PLACEHOLDER
&&m_oDocItem.imageAreaID;


var bIsCollageImage=Editor.features.isCollage&&m_oDocItem.imageAreaID;

var bShowUnlock=(m_oDocItem.locked&&m_oDocItem.manipulator&&!bIsCollageImage);
var bShowLock=(!m_oDocItem.locked&&m_oDocItem.manipulator&&!bIsCollageImage);

var bShowSwappable=(Editor.enterprisePartnerTemplateID>0&&Editor.features.enableNotSwappableImages&&m_oDocItem.notSwappable);
var bShowNotSwappable=(Editor.enterprisePartnerTemplateID>0&&Editor.features.enableNotSwappableImages&&!m_oDocItem.notSwappable);

var bShowPhotoFilter=Editor.features.enableNewPhotoFilters&&window.photoFilterDialog&&(m_oDocItem.type==DOCITEM_TYPE_UPLOADED_IMAGE);

me.changeThreadColor.style.display=(m_oDocItem.type==DOCITEM_TYPE_UPLOADED_IMAGE||m_oDocItem.type==DOCITEM_TYPE_LIBRARY_IMAGE)
&&Editor.isEmbroidery?"block":"none";

me.cropImageRow.style.display=bHideCrop?"none":"block";
me.changeMapRow.style.display=m_oDocItem.type==DOCITEM_TYPE_MAP?"block":"none";
me.changeComplexQrCodeRow.style.display=m_oDocItem.type==DOCITEM_TYPE_COMPLEX_QR_CODE?"block":"none";
me.changeImageRow.style.display=bHideChange?"none":"block";
me.unlockImageRow.style.display=bShowUnlock?"block":"none";
me.lockImageRow.style.display=bShowLock?"block":"none";
me.deleteRow.style.display=bHideDelete?"none":"block";
me.swappableRow.style.display=bShowSwappable?"block":"none";
me.notSwappableRow.style.display=bShowNotSwappable?"block":"none";
me.addPhotoFilter.style.display=bShowPhotoFilter?"block":"none";

if(m_oDocItem.thermographyNumColorsSet&&m_oDocItem.type==DOCITEM_TYPE_UPLOADED_IMAGE)
{
var imageLookup=null;

if(vp.image.imageDataStorage)
{
imageLookup=vp.image.imageDataStorage.getImage(m_oDocItem.uploadID);
}
if(imageLookup&&imageLookup.thermographyColorCount>1)
{
me.mergeColors.style.display=m_oDocItem.thermographyNumColorsSet===1?"none":"block";
me.splitColors.style.display=m_oDocItem.thermographyNumColorsSet===1?"block":"none";
}
else
{
me.mergeColors.style.display=me.splitColors.style.display="none";
}
}
else
{
me.mergeColors.style.display=me.splitColors.style.display="none";
}

if(m_oDocItem.manipulator&&(Editor.features.enableUnconstrainedImages||Editor.isCCTAgent))
{
me.enableStretchingRow.style.display=m_oDocItem.manipulator.getConstrainProportions()?"block":"none";
}
};

this.onbeforeshow.addHandler(onBeforeShowHandler);
};








vp.studio.CaricatureContextMenu=function $vpfn_yUVnz38YmEzH_DK$AU6FYg734$34(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ContextMenu;
this.inheritFrom(oDocItem);

var m_oDocItem=oDocItem;




var onInitHandler=function $vpfn_VEOgQKMO8AsIH18A5vS_vg749$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTitle(JSLM_StudioContextMenuCaricaturesTitle);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/delete.gif",
JSLM_StudioContextMenuDelete,
"delete",
me.deleteSelection);


vp.events.add(me.menuElement,"mousemove",m_oDocItem.showHighlight);
};

this.oninit.addHandler(onInitHandler);
};








vp.studio.TextFieldContextMenu=function $vpfn_1JUjDBSO0$Ta7F3Oy6zHBw773$33(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ContextMenu;
this.inheritFrom(oDocItem);

var m_oDocItem=oDocItem;




var editText=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA788$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.activateInline();
}
.getClosure(m_oDocItem);

this.changeCurve=function $vpfn_xPrqRv6CZF5PL8oMyeksaw794$23(oWordArtStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_G4wrkJJ4BcT3cnZOOrERFA796$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oSelection=new vp.studio.Selection();
oSelection.add(me.docItem,true);
var oCmd=vp.studio.WordArt.getChangeWordArtCommand(oWordArtStyle,me.docItem,oSelection);
oCmd.execute();
Editor.history.add(oCmd);
};
};




var onInitHandler=function $vpfn_VEOgQKMO8AsIH18A5vS_vg809$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTitle(JSLM_StudioContextMenuTextTitle);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/edit_text.gif",
JSLM_StudioContextMenuEdit,
"edit",
editText);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/delete.gif",
JSLM_StudioContextMenuDelete,
"delete",
me.deleteSelection);

if(me.docItem.type==DOCITEM_TYPE_WORDART)
{
me.addRow(
"/vp/images/nns/studio/toolbar2/sprite/changeCurve1.gif",
JSLM_StudioContextMenuMediumCurveDown,
"changeCurve_SharpConvex",
me.changeCurve(vp.studio.WordArt.initialStyles.SHARP_CONVEX));
me.addRow(
"/vp/images/nns/studio/toolbar2/sprite/changeCurve2.gif",
JSLM_StudioContextMenuLightCurveDown,
"changeCurve_Convex",
me.changeCurve(vp.studio.WordArt.initialStyles.CONVEX));
me.addRow(
"/vp/images/nns/studio/toolbar2/sprite/changeCurve3.gif",
JSLM_StudioContextMenuStraightCurve,
"changeCurve_Straight",
me.changeCurve(vp.studio.WordArt.initialStyles.STRAIGHT));
me.addRow(
"/vp/images/nns/studio/toolbar2/sprite/changeCurve4.gif",
JSLM_StudioContextMenuLightCurveUp,
"changeCurve_Concave",
me.changeCurve(vp.studio.WordArt.initialStyles.CONCAVE));
me.addRow(
"/vp/images/nns/studio/toolbar2/sprite/changeCurve5.gif",
JSLM_StudioContextMenuMediumCurveUp,
"changeCurve_SharpConcave",
me.changeCurve(vp.studio.WordArt.initialStyles.SHARP_CONCAVE));

}


me.menuElement.onmousemove=m_oDocItem.showHighlight;
};



var m_sTooltipText="";




var onShowHandler=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA866$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
m_sTooltipText=this.imageElement.title;
this.imageElement.title="";
}
.getClosure(oDocItem);




var onHideHandler=function $vpfn_G4wrkJJ4BcT3cnZOOrERFA876$24(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.imageElement.title=m_sTooltipText||"";
}
.getClosure(oDocItem);

this.oninit.addHandler(onInitHandler);

this.onbeforeshow.addHandler(onShowHandler);
this.onhide.addHandler(onHideHandler);
};








vp.studio.ArrowContextMenu=function $vpfn_1vVxLRC689pH88dR_rcWcA895$29(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ContextMenu;
this.inheritFrom(oDocItem);

var _oDocItem=oDocItem;

var edit=function $vpfn_OhzF_hLETTJ8jFYQVC2iog907$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openEditArrowDialog(_oDocItem);
};




var onInitHandler=function $vpfn_VEOgQKMO8AsIH18A5vS_vg915$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTitle(JSLM_StudioContextMenuArrowTitle);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/properties.gif",
JSLM_StudioContextMenuEdit,
"edit",
edit);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/delete.gif",
JSLM_StudioContextMenuDelete,
"delete",
me.deleteSelection);


vp.events.add(me.menuElement,"mousemove",_oDocItem.showHighlight);
};

this.oninit.addHandler(onInitHandler);
};









vp.studio.TableContextMenu=function $vpfn_nyONUgzyGCcLErEj$YznkQ946$29(oDocItem)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.ContextMenu;
this.inheritFrom(oDocItem);

var _oDocItem=oDocItem;

var editText=function $vpfn_plnZgCwV2WCOmSiGiNvPXg958$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openEditTableDialog(_oDocItem);
};

var editStyle=function $vpfn_CdTZAxYm38d_eRqH2oy_dA963$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.openEditTableDialog(_oDocItem,"styleTab");
};




var onInitHandler=function $vpfn_VEOgQKMO8AsIH18A5vS_vg971$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.addTitle(JSLM_StudioContextMenuTableTitle);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/edit_text.gif",
JSLM_StudioTableEditorEnterTextTabTitle,
"editText",
editText);

me.addRow(
"/vp/images/b09/common/icon/edit_icon_small.gif",
JSLM_StudioTableEditorStyleTabTitle,
"changeAppearance",
editStyle);

me.addRow(
"/vp/images/nns/studio/image_helper_toolbar/delete.gif",
JSLM_StudioContextMenuDelete,
"delete",
me.deleteSelection);


vp.events.add(me.menuElement,"mousemove",_oDocItem.showHighlight);
};

this.oninit.addHandler(onInitHandler);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}









vp.studio.SmartTag=function $vpfn_Jm1Jo_uzN0CJ9JX9Ltkc3w11$21(oDocItem,sIconImg)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.docItem=oDocItem;

var _iTimer=null;
var _bIsVisible=false;
var _oElement=null;
var _bIsContextMenuShowing=false;

this.enabled=true;

var show=function $vpfn_ljqFeSdZd55_AcWymYY$eA24$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.enabled)
{
return;
}

clearTimer();

if(document._smartTagIsContextMenuShowing)
{
return;
}

if(document._resizeInProgress)
{
return;
}

if(!_oElement)
{
_oElement=document.createElement("DIV");
_oElement.className="smartTag";

if(sIconImg)
{
var oIcon=document.createElement("IMG");
oIcon.src=vp.ui.imageUrl(sIconImg);
oIcon.style.verticalAlign="middle";
_oElement.appendChild(oIcon);
}

var oCaption=document.createElement("SPAN");

if(Editor.features.enableImageSmartTags||Editor.features.enableTextFieldSmartTags)
{
oCaption.innerHTML=JSLM_StudioContextMenuEdit;
}
else
{
oCaption.innerHTML=JSLM_StudioSmartTagOptionsTitle;
}

oCaption.className="caption";

_oElement.appendChild(oCaption);

var oArrow=document.createElement("IMG");
oArrow.src=vp.ui.imageUrl("/vp/images/nns/studio/toolbar2/menu_arrow.gif");
oArrow.style.verticalAlign="middle";

_oElement.appendChild(oArrow);

vp.events.add(_oElement,"mouseover",show);
if(me.docItem.manipulator)
{
vp.events.add(_oElement,"mouseover",me.docItem.showHighlight);
vp.events.add(_oElement,"mouseout",me.docItem.hideHighlight);
}
vp.events.add(_oElement,"mouseout",hideWithDelay);
vp.events.add(_oElement,"mousedown",showMenu);
vp.events.add(_oElement,"contextmenu",vp.events.cancel);

document.body.appendChild(_oElement);
}

if(!document._smartTagIsShowing&&!_bIsVisible)
{
document._smartTagIsShowing=true;
var oItemRect=vp.ui.getRect(me.docItem.handleElement);
var oDocRect=vp.ui.getRect(Editor.documentArea);


var oNewRect={
top:oItemRect.top+4,
left:oItemRect.left+4,
width:_oElement.offsetWidth,
height:_oElement.offsetHeight
};


oNewRect.top=Math.max(oNewRect.top,oDocRect.top+2);
oNewRect.left=Math.max(oNewRect.left,oDocRect.left+2);


if(oItemRect.width<(oNewRect.width+16)||
oItemRect.height<(oNewRect.height+16)||
oDocItem.type==DOCITEM_TYPE_TEXT)
{
oNewRect.top=oItemRect.top-(oNewRect.height+2);


if(oNewRect.top<oDocRect.top)
{
oNewRect.top=oItemRect.top+oItemRect.height+2;
}
}

if(oDocItem.type==DOCITEM_TYPE_TEXT)
{
if(oDocItem.docElement.style.textAlign==="right")
{
oNewRect.left=Math.min(oItemRect.left+oItemRect.width-oNewRect.width,oDocRect.left+oDocRect.width-oNewRect.width);
}
}

_oElement.style.top=oNewRect.top+'px';
_oElement.style.left=oNewRect.left+'px';

_oElement.style.visibility="visible";
_bIsVisible=true;

vp.studio.instrumentation.add("StudioSmartTag_show");
}
};

var showWithDelay=function $vpfn_OVWpG1OED2pivn3rQ0c8oA140$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();
_iTimer=window.setTimeout(show,200);
};

this.hide=function $vpfn_yzEjg1yIxfvI7zzucK8OBA146$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bIsContextMenuShowing)
{
hideWithDelay();
return;
}

clearTimer();

if(_oElement)
{
_oElement.style.visibility="hidden";
document._smartTagIsShowing=false;
_bIsVisible=false;
vp.studio.instrumentation.add("StudioSmartTag_hide");
}
};

var hideWithDelay=function $vpfn_hTqA0b$V7hMminjvQGo$Cw165$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
clearTimer();
_iTimer=window.setTimeout(me.hide,200);
};

var clearTimer=function $vpfn_cTMS_Lg$MH8OeI9tK1mS6w171$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_iTimer)
{
clearTimeout(_iTimer);
_iTimer=null;
}
};

var hideAndRemoveEvent=function $vpfn_06NFo_2Z6R50TNMMCssKUA180$29(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_bIsContextMenuShowing=false;
document._smartTagIsContextMenuShowing=false;
document._smartTagIsShowing=false;
me.docItem.contextMenu.onhide.removeHandler(arguments.callee);
};

var showMenu=function $vpfn_P2uj6Lm5_$zRD8OipomCpA188$19(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.cancel(e);

if(_bIsContextMenuShowing)
{
me.docItem.contextMenu.hide(e);
_bIsContextMenuShowing=false;
document._smartTagIsContextMenuShowing=false;

me.docItem.contextMenu.onhide.removeHandler(hideAndRemoveEvent);
}
else
{
var oRect={
left:_oElement.offsetLeft,
top:(_oElement.offsetTop+_oElement.offsetHeight)-1
};

me.docItem.contextMenu.show(e,oRect);
_bIsContextMenuShowing=true;
document._smartTagIsContextMenuShowing=true;

me.docItem.contextMenu.onhide.addHandler(hideAndRemoveEvent);
}
};

if(me.docItem.handleElement)
{
var oHandle=me.docItem.getManipulatorElement();

if(me.docItem.manipulator)
{
me.docItem.manipulator.onmouseover.addHandler(showWithDelay);
me.docItem.manipulator.ondrop.addHandler(showWithDelay);
me.docItem.manipulator.onresizeend.addHandler(showWithDelay);

me.docItem.manipulator.onmouseout.addHandler(hideWithDelay);
me.docItem.manipulator.onstartdrag.addHandler(me.hide);
me.docItem.manipulator.onresizestart.addHandler(me.hide);

if(oHandle)
{
vp.events.add(oHandle,"mousedown",showWithDelay);
}
}
else
{
vp.events.add(me.docItem.handleElement,"mouseover",showWithDelay);
vp.events.add(me.docItem.handleElement,"mouseout",hideWithDelay);

if(oHandle)
{
vp.events.add(oHandle,"mousedown",showWithDelay);
}
}

me.docItem.onunrender.addHandler(me.hide);
}

this.wireDoubleClick=function $vpfn_qvVLtkIHOlbTFa0pug0Eqg248$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.docItem.ondblclick.addHandler(function $vpfn_7qkHVk36aHQLI_nO9pZymg250$41(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}show();showMenu(e);});
};

this.unwireDoubleClick=function $vpfn_$r$x4WUN1R0M_9urLow2Xg253$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.docItem.ondblclick.removeHandler(function $vpfn_7qkHVk36aHQLI_nO9pZymg255$44(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}show();showMenu();});
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.InactiveToolBarPop=function $vpfn_tDXnRgr1AqyuUcY3OBKWFA10$31(oEditor)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
var Editor=oEditor;
var parent=document.body;

var id="divInactiveToolBarPop";

var smallHeight=40;
var smallWidth=220;
var largeHeight=180;
var largeWidth=320;

var width;
var height;
var padRight=38;
var padTop=28;

var shadowWidth=5;

var zIndex=10000;

var borderColor="#588EED";
var closeColor="#2E2F91";

var backImage="url("+vp.ui.imageUrl("/vp/images/nns/studio/pops/inactive_pop_background.jpg")+")";
var graphicSrc=vp.ui.imageUrl("/vp/images/nns/studio/pops/select_text_ill.gif",true);
var closeImageSrc=vp.ui.imageUrl("/vp/images/nns/common/buttons/close_window.gif");
var msgImageLeft="url("+vp.ui.imageUrl("/vp/images/nns/studio/pops/highlite_lt.gif")+")";
var msgImageCenter="url("+vp.ui.imageUrl("/vp/images/nns/studio/pops/highlite_tl.gif")+")";
var msgImageRight="url("+vp.ui.imageUrl("/vp/images/nns/studio/pops/highlite_rt.gif")+")";
var msgIconSrc=vp.ui.imageUrl("/vp/images/nns/studio/pops/info_icon_studio.gif");




this.element=function $vpfn__Jt0xyT7dU9Ve_TuXql8vw46$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return document.getElementById(id);
};




this.init=function $vpfn_140fJ7EFof8tHP_IJud$Rw54$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!Editor.isAdvanced)
{
return;
}

height=largeHeight;
width=largeWidth;

if(this.element()!==null)
{

return;
}
var divPopup=document.createElement("DIV");
divPopup.id=id;
divPopup.style.border="1px black solid";
divPopup.style.height=height+"px";
divPopup.style.width=width+"px";
divPopup.style.backgroundImage=backImage;
divPopup.style.borderColor=borderColor;
divPopup.style.backgroundColor="";

renderAll(divPopup);
divPopup.style.zIndex=zIndex;

parent.appendChild(divPopup);
};






var renderAll=function $vpfn_VjguB3$3a8JfRJqiZMxQeg90$20(divPopup)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var tblPopup=document.createElement("TABLE");
tblPopup.id="tblInactiveToolBarPop";
tblPopup.style.width=width-padRight+"px";
tblPopup.align="center";
tblPopup.cellPadding="0";
tblPopup.cellSpacing="0";
tblPopup.style.borderWidth='0px';
var rowHeader=tblPopup.insertRow(0);
var rowMessage=tblPopup.insertRow(1);
var rowGraphic=tblPopup.insertRow(2);


var cellHeader=rowHeader.insertCell(0);
cellHeader.align="right";
var divClose=document.createElement("div");
divClose.style.paddingTop="10px";
divClose.style.paddingBottom="10px";

var spanClose=document.createElement("span");
spanClose.style.color=closeColor;

var imgClose=document.createElement("IMG");
imgClose.src=closeImageSrc;
spanClose.appendChild(document.createTextNode(JSLM_CloseWindowButtonText));
spanClose.appendChild(document.createTextNode(" "));
spanClose.appendChild(imgClose);
vp.events.add(spanClose,"click",me.hide);
vp.ui.setStyleValue(spanClose,"cursor","pointer");
vp.ui.addClass(spanClose,"a.nav");

divClose.appendChild(spanClose);
cellHeader.appendChild(divClose);
cellHeader.colSpan="3";


var cellMsgLeft=rowMessage.insertCell(0);
var cellMsgCenter=rowMessage.insertCell(1);
var cellMsgRight=rowMessage.insertCell(2);

rowMessage.style.width=tblPopup.style.width;

cellMsgLeft.style.backgroundImage=msgImageLeft;
cellMsgLeft.style.width="9px";
cellMsgLeft.style.height="50px";
cellMsgLeft.style.backgroundColor="";

cellMsgCenter.style.backgroundImage=msgImageCenter;
cellMsgCenter.style.height="50px";
cellMsgCenter.style.width=width-padRight-2*9+"px";
cellMsgCenter.style.backgroundColor="";

cellMsgRight.style.backgroundImage=msgImageRight;
cellMsgRight.style.width="9px";
cellMsgRight.style.height="50px";
cellMsgRight.style.backgroundColor="";

renderMessage(cellMsgCenter);


var cellGraphic=rowGraphic.insertCell(0);
var imgGraphic=document.createElement("IMG");
imgGraphic.src=graphicSrc;
cellGraphic.align="center";
cellGraphic.appendChild(imgGraphic);
cellGraphic.colSpan="3";
cellGraphic.style.paddingTop="10px";
cellGraphic.style.paddingBottom="10px";

divPopup.appendChild(tblPopup);
};





var renderMessage=function $vpfn_98kvrEj93oP9g9GXDy64VA167$24(oContainer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var tblMessage=document.createElement("TABLE");
tblMessage.insertRow(0);
tblMessage.cellPadding="0";
tblMessage.cellSpacing="0";
tblMessage.style.borderWidth='0px';

var cellCount=0;

var cellMsgIcon=tblMessage.rows[0].insertCell(cellCount);
cellCount++;
var msgIcon=document.createElement("IMG");
msgIcon.src=msgIconSrc;
cellMsgIcon.style.width=msgIcon.style.width;
cellMsgIcon.style.paddingLeft="7px";
cellMsgIcon.style.paddingRight="12px";
cellMsgIcon.appendChild(msgIcon);

var cellMsgText=tblMessage.rows[0].insertCell(cellCount);
cellCount++;
cellMsgText.innerHTML=JSLM_InactiveToolBarClick;
cellMsgText.style.color="black";
cellMsgText.style.fontSize="12px";
cellMsgText.style.fontWeight="bold";

oContainer.appendChild(tblMessage);

};





this.show=function $vpfn_roEcFeM2PVafMupD7CSduQ201$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element().style.position="absolute";
var left;
var top;
var rectTarget;
if(e.target)
{
rectTarget=vp.ui.getRect(e.target);
}
else
{
rectTarget=vp.ui.getRect(e.srcElement);
}

top=rectTarget.top+padTop;
left=rectTarget.left+15;

var rectToolbar=vp.ui.getRect(document.getElementById("divStudioToolbarOuterContainer"));
if(left+width>rectToolbar.left+rectToolbar.width+15)
{
left-=left+width-(rectToolbar.left+rectToolbar.width+15);
}

me.element().style.left=left+"px";
me.element().style.top=top+"px";
me.element().style.visibility="visible";

vp.uilib.showShadow(me.element(),
shadowWidth,
shadowWidth,
true);

vp.events.add(me.element(),"mousedown",me.onmousedown);
vp.events.add(vp.ui.getRootElement(),"mousedown",me.hide);
vp.events.cancel(e);
};





this.hide=function $vpfn_8xHPx10SJQ98a0Yuj5p7Pw243$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element().style.visibility="hidden";
vp.uilib.hideShadow();
vp.events.remove(vp.ui.getRootElement(),"mousedown",me.hide);
};





this.onmousedown=function $vpfn_3uamyzZ2PC_A2DATd1ntfg254$23(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.cancel(e);
};

me.init();

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}




vp.EditorPage={};

vp.EditorPage.onPageChangeHandler=function $vpfn_$bJS48_W91Doim0kux54BQ14$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.pageTitles)
{
var currentPageTitle=Editor.pageTitles[Editor.pageNumber];
var titleElement=vp.ui.get("spnSectionTitle");
if(currentPageTitle&&titleElement)
{
titleElement.innerHTML=currentPageTitle;
}
}
};




vp.EditorPage.forceToMPSOButtonClick=function $vpfn_R2d5Y4aDp5ZXhCToloopHQ30$39(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.goPostStudio=true;
Editor.proceedByNextButton=true;

vp.studio.ui.forceGoToMPSO();
};




vp.EditorPage.nextButtonClick=function $vpfn_HQDdLIV5QP1GXkzwM_u5sw40$32(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.goPostStudio=false;
Editor.proceedByNextButton=true;

vp.studio.ui.validateAndGoNext(Editor.pageNumber+1);
};




vp.EditorPage.nextButtonClickGoBack=function $vpfn_mOkFCFfYNftWtT6gkJXYGg51$38(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.ui.goToPage(Editor.pageNumber-1);
};






vp.EditorPage.alertOfferEngineSubmitIfNecessary=function $vpfn_wHIFU9MgOzUYU3__9UvCvQ61$50(evt)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.eoe&&
vp.eoe.topEventManager)
{
vp.eoe.topEventManager.AlertPageSubmission(evt);
}
};




vp.EditorPage.backButtonClick=function $vpfn_Erh1dSfYBjjfo2H3Yjq0zQ73$32(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fnCallback=function $vpfn_I4PAP5KRVGfanb9T3NXRJQ75$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.showProgressBar();
Editor.goToPage(Editor.pageNumber-1);
};

if(Editor.pageNumber==2)
{
vp.studio.ui.save(fnCallback);
return;
}

fnCallback();
};





vp.EditorPage.checkApprovalBox=function $vpfn_WcZxk3vWrowhhUxwIViCSg94$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!vp.controls.approvalbox||vp.controls.approvalbox.onContinue())
{
return true;
}
return false;
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(!window.vp)
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(!vp.studio.smartcanvas)
{
vp.studio.smartcanvas={};
}

vp.studio.smartcanvas.dialogId="smartCanvasPop";

vp.studio.smartcanvas.init=function $vpfn_rC7nxVxevS1zBj3szCTGDg21$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.isAdvanced)
{
return;
}

vp.studio.smartcanvas.addHandlers();



Editor.oncombochange.addHandler(vp.studio.smartcanvas.addHandlers);
};

vp.studio.smartcanvas.addHandlers=function $vpfn_Zv$KTmX22rVw_5$Z68p51Q36$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.isAdvanced)
{
return;
}


for(var i=0;i<Editor.items.length;i++)
{
var oDocItem=Editor.items[i];
if(oDocItem.handleElement)
{


oDocItem.smartCanvasHandler=function $vpfn_R3S4MP95XgXVrODyDIIojg52$42(event)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.studio.instrumentation.add("Light Studio Item Type "+oDocItem.type+" Clicked");




if(this.itemIsEditableInLightStudio)
{
vp.events.setEventData(event,"handledByItem",true);
}
else if(Editor.useSmartCanvas&&this.smartCanvasHandlerBase)
{


this.smartCanvasHandlerBase(event);





vp.events.setEventData(event,"handledByItem",true);
}
}.getClosure(
{smartCanvasHandlerBase:oDocItem.smartCanvasHandler,
itemIsEditableInLightStudio:oDocItem.isEditableInLiteStudio
});

vp.events.add(oDocItem.handleElement,"click",oDocItem.smartCanvasHandler);
}
}


if(!Editor.smartCanvasHandler)
{


Editor.smartCanvasHandler=function $vpfn_R9MyIfViURW49G7$SYfH$A90$36(event)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


vp.studio.instrumentation.add("Light Studio Canvas Clicked");



if(Editor.useSmartCanvas&&!vp.events.getEventData(event,"handledByItem"))
{
vp.studio.smartcanvas.showPopup();
}
};
}

if(Editor.isLoadComplete)
{

vp.events.remove(Editor.docItemHandleArea,"click",Editor.smartCanvasHandler);
vp.events.add(Editor.docItemHandleArea,"click",Editor.smartCanvasHandler);
}
else
{
Editor.oninitialrender.addHandler(function $vpfn_R3S4MP95XgXVrODyDIIojg113$42()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.remove(Editor.docItemHandleArea,"click",Editor.smartCanvasHandler);
vp.events.add(Editor.docItemHandleArea,"click",Editor.smartCanvasHandler);
});
}


Editor.onupgradecomplete.addHandler(vp.studio.smartcanvas.removeOnClickHandlers);
};

vp.studio.smartcanvas.removeOnClickHandlers=function $vpfn_QjhS3UesE3Y0wL1WPxHvAg124$46()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<Editor.items.length;i++)
{
var oDocItem=Editor.items[i];
if(oDocItem.handleElement&&oDocItem.smartCanvasHandler)
{
vp.events.remove(oDocItem.handleElement,"click",oDocItem.smartCanvasHandler);
}
}

if(Editor.smartCanvasHandler)
{
vp.events.remove(Editor.docItemHandleArea,"click",Editor.smartCanvasHandler);
}
};








vp.studio.smartcanvas.showPopup=function $vpfn_slYPF2arDY$WSFsHYwZ0qw148$34(sText,sTitle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(window!==vp.dialog._getRootWindow())
{
return;
}

sText=sText?sText:vp.studio.smartcanvas.defaultPopupText;
sTitle=sTitle?sTitle:vp.studio.smartcanvas.defaultPopupTitle;

var popupDiv=vp.ui.get("smartCanvasPopupDiv");

var textContainer=vp.ui.get("smartCanvasPopupTextContainer");



textContainer.innerHTML=sText;

var smartPopup=new vp.dialog.NodeDialog(vp.studio.smartcanvas.dialogId,{top:-200,width:250,height:140},popupDiv);
smartPopup.options.title=sTitle;
smartPopup.chrome=vp.dialog.chrome.Message;
smartPopup.open();
smartPopup.resizeToFitContent(true);

vp.spot.trackWithQueryString("/studio/smart_canvas_popup","pfid="+Editor.PFID);
};





vp.studio.smartcanvas.upgradeToAdvanced=function $vpfn_UOmGWz71iMI0AJncuwBn2g180$42()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.studio.instrumentation.add("Upgrade from Smart Canvas");


var smartPop=vp.dialog.getDialogById(vp.studio.smartcanvas.dialogId);
if(smartPop)
{
smartPop.close();
}


vp.studio.ui.upgradeToAdvanced();
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



if(!vp.studio)
{
vp.studio={};
}






vp.studio.backsideMiniPreview=function $vpfn_oFn1ZNdEVIFtOzCODQYwcg15$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.previewImagePlaceholder=vp.ui.get("imgBacksidePreview");




this.init=function $vpfn__nEAYHiYTLq8am8XhduacA27$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.oncombochange.addHandler(me.refreshPreview);
};




this.refreshPreview=function $vpfn_CWmPgmH_n_hZficsljK8IQ35$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.backsidePreviewUrl)
{
var oUrl=new vp.web.URL(Editor.backsidePreviewUrl);
oUrl.setItem("d",new Date().valueOf());
me.previewImagePlaceholder.src=oUrl.toString();
}

};


this.init();

};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(!vp.studio.backside)
{
vp.studio.backside={};
}



vp.studio.backside.updateControlOnComboChange=function $vpfn_y3EXhJbbO4knCXWcXmgLjw21$48()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var currentIcParts=Editor.icParts;
var currentComboId=Editor.comboID;
var currentDominantImageId=Editor.dominantImageID;
var currentImageList=Editor.imageList;


Editor.oncombochange.addHandler(function $vpfn_GPeg5UqG6BRiOBvJU0ttzA30$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.icParts!=currentIcParts||Editor.comboID!=currentComboId)
{

currentIcParts=Editor.icParts;
currentComboId=Editor.comboID;
currentDominantImageId=Editor.dominantImageID;
currentImageList=Editor.imageList;


var oElement=vp.ui.get('imgBacksidePreview');
if(oElement)
{

if(Editor.docID)
{

var oURL=new vp.web.URL(oElement.src);


oURL.removeItem("combo");
oURL.removeItem("combo_id");
oURL.removeItem("dominant_image_id");
oURL.removeItem("image_list");


oURL.setItem(EditorConst.renderingTechnologyParam,Editor.renderingTechnology);


oURL.setItem("doc_id",Editor.docID);

oURL.setItem("matching_backside",true);


oURL.setItem("random",Math.random()*10000000);


oElement.src=oURL.toString();
}
}


oURL=new vp.web.URL(EditorConst.backsideGalleryURL);


if(currentComboId===0)
{

oURL.removeItem("combo_id");
}
else
{
oURL.setItem("combo_id",currentComboId);
}


oURL.setItem("dominant_image_id",currentDominantImageId);
oURL.setItem("image_list",currentImageList);


oURL.setItem("combo",Editor.icParts);


EditorConst.backsideGalleryURL=oURL.toString();
}
});
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(!vp.studio.colorvariation)
{
vp.studio.colorvariation={};
}




vp.studio.colorvariation.actions=function(){};

vp.studio.colorvariation.actions.changeColorScheme=function $vpfn_uJCWGjKLWuYp4xQSWFtQaw24$53(iSchemeId,arrHexSchemeColors)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(arrHexSchemeColors.length!==6)
{
throw new Error("[vp.studio.colorvariation.actions.changeColorScheme]: length of array hex color scheme is not equal to 6.");
}

var arrColorsClone=[];
for(var i=0;i<arrHexSchemeColors.length;i++)
{
arrColorsClone[i]=arrHexSchemeColors[i];
}
var oCmd=new vp.studio.commands.ChangeColorScheme(iSchemeId,arrColorsClone);
oCmd.execute();
Editor.history.add(oCmd);

if(Editor.toolbar)
{
Editor.toolbar.refreshWithDelay();
}
};

vp.studio.colorvariation.actions.changeCombo=function $vpfn_7MSmdnL60FonlqAp9TFEsQ46$47(comboId,comboHash)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.asyncActions.changeCombo(comboHash,comboId,{doMinChange:true});
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(typeof vp=="undefined")
{
var vp={};
}

if(typeof vp.studio=="undefined")
{
vp.studio={};
}






vp.studio.TextFieldOffer=function $vpfn__fEMSbAz0FwpL59x7ZGczw21$27(elementId,purposeName,onAddCallback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.sElementId=elementId;




this.sPurposeName=[];

if(purposeName instanceof Array)
{
this.sPurposeName=purposeName;
}
else
{
this.sPurposeName.push(purposeName);
}

this.onAddCallback=onAddCallback;

this.init=function $vpfn_6nrz8mocx$nVDqKyGGPRVA46$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isLoadComplete)
{
me.addOfferLink();
}
else
{
Editor.oninitialrender.addHandler(me.addOfferLink);
}



Editor.onrender.addHandler(me.addOfferLink);
};




this.getOfferField=function $vpfn_ISolvMPuW4SgfR_JQgVydQ65$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT).concat(Editor.getItemsByType(DOCITEM_TYPE_WORDART));
var returnValue=[];
for(var i=0;i<textFields.length;i++)
{
var textField=textFields[i];
if(me.sPurposeName instanceof Array)
{
for(var j=0,l=me.sPurposeName.length;j<l;j++)
{
if(textField.purposeName==me.sPurposeName[j])
{
returnValue.push(textField);
}
}
}
}
if(returnValue&&returnValue.length>0)
{
return returnValue;
}
else
{
return null;
}
};




this.addOfferLink=function $vpfn_XNtrT1Hmh5eaXNXd7bmiFA96$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oOfferField=me.getOfferField();



if(oOfferField instanceof Array)
{
for(var i=0,l=oOfferField.length;i<l;i++)
{

if(!oOfferField[i]
||!oOfferField[i].externalTextField
||$(oOfferField[i].externalTextElement).find("."+me.sElementId).length>0)
{
continue;
}

var jOriginalElement=$("#"+me.sElementId);



var clone=jOriginalElement
.clone()
.prependTo(oOfferField[i].externalTextLabelElement)
.show()
.addClass(me.sElementId)
.attr("id","");


jOriginalElement.hide();

if(me.onAddCallback)
{
me.onAddCallback(oOfferField[i],clone);
}
}
}
};




















this.updateTextField=function $vpfn_$BIBA5Z8zoIVEpweLxOzWA155$27(sValue,iForce,oPurposeNames)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var aItems=Editor.getItemsByType(DOCITEM_TYPE_TEXT).concat(Editor.getItemsByType(DOCITEM_TYPE_WORDART));
if(aItems.length===0)
{
return;
}


if(!oPurposeNames)
{
if(typeof me.sPurposeName==="string")
{
oPurposeNames=[me.sPurposeName];
}
else
{
oPurposeNames=me.sPurposeName;
}
}


if(iForce==vp.studio.TextFieldOffer.ANY_FIELD)
{
oPurposeNames.push(null);
}




var oTextField=null;
for(var j=0;j<oPurposeNames.length;j++)
{
for(var i=aItems.length-1;i>=0;i--)
{
var sPurposeName=oPurposeNames[j];
if((sPurposeName===null||aItems[i].purposeName===sPurposeName)
&&(!aItems[i].hasText()||iForce==vp.studio.TextFieldOffer.REPLACE_FIELD))
{
oTextField=aItems[i];
break;
}
}

if(oTextField)
{
break;
}
}


if(iForce==vp.studio.TextFieldOffer.ANY_FIELD&&!oTextField)
{
oTextField=aItems[aItems.length-1];
}

if(oTextField)
{
var oCommand=new vp.studio.commands.ChangeText(
oTextField,"text",
oTextField.getProcessedData(),oTextField.getStyles(),
sValue,null);
oCommand.execute();
Editor.history.add(oCommand);
}
};
};

vp.studio.TextFieldOffer.NO_FORCE=0;
vp.studio.TextFieldOffer.ANY_FIELD=1;
vp.studio.TextFieldOffer.REPLACE_FIELD=2;
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}

if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.ringcenter)
{
vp.ringcenter={};
}

vp.ringcenter.openSelectNumberWindow=function $vpfn_AmbH$i6xHB6rZTOsSs28Kw13$39(sTitle,impressionId,sPfid)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.ringcenter.isSavingDocument)
{
return;
}
var openSelectNumberWindow=function $vpfn_I3cBp6$ze7l7UWvrNbE9KQ19$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sURL="/ring-central.aspx?docId="+Editor.docID+"&impression="+impressionId;

if(sPfid)
{
sURL+="&pf_id="+sPfid;
}


window.oRingCenterWindow=vp.dialog.IFrameDialog.open("oRingCenterWindow",sTitle,sURL,vp.dialog.chrome.Primary,vp.ringcenter.POPUP_SIZE["selectorTab"].width,vp.ringcenter.POPUP_SIZE["selectorTab"].height,{scrollType:DIALOG_SCROLL_TYPE_NO});


Editor.RingCentralWin=window.oRingCenterWindow;
};

if(Editor.docID&&Editor.docID!==0)
{
openSelectNumberWindow();
}
else
{
vp.ringcenter.isSavingDocument=true;
Editor.showProgressBar();
Editor.save(function $vpfn_wLYZ10cm2RfeWOwPgI3PGw43$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.hideProgressBar();
openSelectNumberWindow();
vp.ringcenter.isSavingDocument=false;
});
}
};

vp.ringcenter.selectNumber=function $vpfn_mUV3MEyd_gGpwFWbRaMCog52$29(sNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(window.Editor)
{
vp.ringcenter.selectNumberInStudio(sNumber);
}
else
{
vp.ringcenter.selectNumberInMPSO(sNumber);
}
};

vp.ringcenter.selectNumberInStudio=function $vpfn_VUrl9i2KnPfpA2KIJxVS9g64$37(sNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.addSelectedPhoneNumberToDocument(sNumber);
};


vp.ringcenter.selectFaxNumberInStudio=function $vpfn_G2V$l5yikAaHO6352sWKxQ70$40(sNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.addSelectedFaxNumberToDocument(sNumber);
};

vp.ringcenter.selectNumberInMPSO=function(sNumber)
{
};

vp.ringcenter.resize=function $vpfn_M47YTK9Pw$FWRc$1XRs6tQ79$23(pageId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.RingCentralWin.resize(vp.ringcenter.POPUP_SIZE[pageId].width,vp.ringcenter.POPUP_SIZE[pageId].height);
};

vp.ringcenter.POPUP_SIZE={
selectorTab:{width:615,height:575},
detailsTab:{width:530,height:670},
confirmation:{width:470,height:290}
};


vp.ringcenter.isSavingDocument=false;

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.ringcenter)
{
vp.ringcenter={};
}

if(!vp.ringcenter.studio)
{
vp.ringcenter.studio={};
}




vp.ringcenter.studio.isRegularPhoneNumber=function $vpfn_LsMmLt9j0dR6WzFC$hb8xw24$44(phone)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
phone=phone.replace(/\D/g,"");
var pattern="800-866-877-888";
var prefix=phone.substr(0,3);
if(prefix.length>3&&pattern.indexOf(prefix)!=-1)
{
return false;
}
return true;
};

vp.ringcenter.studio.Offer=null;
vp.ringcenter.studio.FaxOffer=null;




vp.ringcenter.studio.init=function $vpfn_Qw1stDfg2kzkSHSlKglecw42$28(sTitle,impressionId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.PhoneOffer=new vp.studio.TextFieldOffer("spanRingCentralOfferLink","phone");
vp.ringcenter.studio.PhoneOffer.init();
};




vp.ringcenter.studio.initFax=function $vpfn_5U7t8tN0Rq_UK9M2gvnbmw51$31(sTitle,impressionId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.FaxOffer=new vp.studio.TextFieldOffer("spanRingCentralFaxOfferLink","fax");
vp.ringcenter.studio.FaxOffer.init();
};

vp.ringcenter.studio.addSelectedPhoneNumberToDocument=function $vpfn_qvUWGp2FCyCc4oVF4naxaQ57$56(sNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.PhoneOffer.updateTextField(sNumber,vp.studio.TextFieldOffer.ANY_FIELD,["phone","fax"]);
};

vp.ringcenter.studio.addSelectedFaxNumberToDocument=function $vpfn_SDCIJT2SEn6ryiTcCTYMRA62$54(sNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ringcenter.studio.FaxOffer.updateTextField(sNumber,vp.studio.TextFieldOffer.ANY_FIELD,["fax","phone"]);
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




if(!vp)
{
var vp={};
}

if(!vp.customerSites)
{
vp.customerSites={};
}

if(!vp.customerSites.studio)
{
vp.customerSites.studio={};
}


vp.customerSites.studio.initialize=function $vpfn_FTYKFCUpigkR00USU4qh2g22$37(id,lightImpressionId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.customerSites.studio.sourceElementId=id;
vp.customerSites.studio.impressionId=lightImpressionId;
};


vp.customerSites.studio.init=function $vpfn_JilDTVLtvyeh$1x$svaDSw29$31(sOfferPurpose,bIsConsumer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.customerSites.studio.Offer=new vp.studio.TextFieldOffer("spanWebsiteOfferLink",sOfferPurpose);
vp.customerSites.studio.Offer.init();

vp.customerSites.studio.offerPurpose=sOfferPurpose;
vp.customerSites.studio.isConsumer=bIsConsumer;
};

vp.customerSites.studio.offerredDomain='';

vp.customerSites.studio.showCustomerSitesOffer=function $vpfn_o5u7NvTjeM6wYE2RB6EI8w40$49(source,sDialogTitle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sDialogTitle===undefined)
{
sDialogTitle="";
}

var openWebsiteWindow=function $vpfn_Jo44TXsZgkaE7_uDQdTnIg47$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL("/websites-studio-offer.aspx");
oURL.setItem("doc_id",Editor.docID);
oURL.setItem("log","1");
oURL.setItem("impression",vp.customerSites.studio.impressionId);
oURL.setItem("area","studio");
var currentURL=new vp.web.URL(window.location);
if(currentURL.getItem("debugxs"))
{
oURL.setItem("debugxs",currentURL.getItem("debugxs"));
}
if(vp.customerSites.studio.isConsumer)
{
oURL.setItem("xnav","weddingSiteOffer");
}
if(vp.customerSites.studio.offerredDomain)
{
oURL.setItem('chosen_domain',vp.customerSites.studio.offerredDomain);
}

var width,height;

if(vp.customerSites.studio.showLargerWebsitesOfferDialog)
{
width=640;
height=500;
}
else
{
width=615;
height=415;
}

window.oCustomerSitesWindow=vp.dialog.IFrameDialog.open(
"oCustomerSitesWindow",
sDialogTitle,
oURL.toString(),
vp.dialog.chrome.Primary,
width,
height,
{scrollType:DIALOG_SCROLL_TYPE_VERTICAL});
};


Editor.asyncManager.start(Editor.save,openWebsiteWindow);
};

vp.customerSites.studio.setUrl=function $vpfn_p9SBjNKIIFovKJCMDWZtfA95$33(url)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(window.oCustomerSitesWindow)
{
window.oCustomerSitesWindow.close();
window.oCustomerSitesWindow=undefined;
}


if(url&&url.length>0)
{
vp.customerSites.studio.Offer.updateTextField(url,vp.studio.TextFieldOffer.REPLACE_FIELD);
}
};

vp.customerSites.studio.formatDomainName=function $vpfn_adXN1UYdFQlPtukIj4H$uA110$43(sDomain,sFormat,sPrefix,sDomainSuffix,sSuffix)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var formattedText='';
var domainName='';
if(sDomain!=='')
{
var firstDotIndex=sDomain.indexOf('.');
domainName=sDomain.substr(0,firstDotIndex);
var topLevelDomain=sDomain.replace(domainName,'');
formattedText=sFormat.replace('<domain />',sPrefix+domainName+sDomainSuffix+topLevelDomain+sSuffix);
}
return formattedText;
};

vp.customerSites.studio.DomainOffer=function $vpfn_J7FmnF4AUIq3qfMMYr7YTA124$38(elementId,purposeName,CompanyFieldPurpose,topContainerId,topContainerString,domainCheckUrl,localeId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.TextFieldOffer;

this.inheritFrom(elementId,purposeName);

this.id=elementId;

this.inlineActive=false;




this.sTopContainerString=topContainerString;

this.oTopContainer=vp.ui.get(topContainerId);

this.sCompanyPurpose=CompanyFieldPurpose;

this.sDomainCheckUrl=domainCheckUrl;

this.oCompanyNameField=null;

this.iLocaleId=localeId;

this.DomainCheckTimeout=null;

this.DomainCache=[];

this.DomainFilterRegex=/[\x00-\x2c\x2e-\x2f\x3a-\x3f\x5b-\x60\x7b-\xbf\u0180-\uffff]/g;

this.init=function $vpfn_8ctQkspNtA$7NyNeReiVqw160$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isLoadComplete)
{
me.addOfferLink();
}
else
{
Editor.oninitialrender.addHandler(me.addOfferLink);
}
};





this.getOfferField=function $vpfn_qeiAL2qzLwerwxR3PqX6NA176$25(purposeName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var textFields=Editor.getItemsByType(DOCITEM_TYPE_TEXT).concat(Editor.getItemsByType(DOCITEM_TYPE_WORDART));
for(var i=0;i<textFields.length;i++)
{
var textField=textFields[i];
if(textField.purposeName==purposeName)
{
return textField;
}
}
return null;
};




this.addOfferLink=function $vpfn_RNu0aeXtyxF$GzBFSt6buA193$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oOfferField=me.getOfferField(this.sPurposeName);



if(!oOfferField||!oOfferField.externalTextField)
{
return;
}

var domainText='';
me.oCompanyNameField=me.getOfferField(me.sCompanyPurpose);
if(me.oCompanyNameField)
{
me.GetAvailableDomain();
me.oCompanyNameField.onaftertextchange.addHandler(me.GetDomainAvailabilityWithTimeDelay);
}

var oOriginalElement=document.getElementById(me.sElementId);
oOriginalElement.style.display="block";
$("#divStudioTextFields").append(oOriginalElement);
};

this.GetDomainAvailabilityWithTimeDelay=function $vpfn_$qROpDIegH41O3YYaVM2Ng217$46()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.oCompanyNameField&&me.oCompanyNameField.clickText.toUpperCase()!==me.oCompanyNameField.data.toUpperCase())
{
if(me.DomainCheckTimeout)
{
clearTimeout(me.DomainCheckTimeout);
}
me.DomainCheckTimeout=setTimeout(me.GetAvailableDomain,2000);
}
};

this.GetAvailableDomain=function $vpfn_Cz2f3Ehti8r2M6_bpSSyOw229$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var testkey=me.oCompanyNameField.data.replace(me.DomainFilterRegex,'');
if(typeof me.DomainCache[testkey]!='undefined')
{
me.DomainRetrieved(me.DomainCache[testkey],testkey);
}
else
{

vp.http.callAsmxAsync(
me.sDomainCheckUrl,
'GetAvailableDomain',
{'candidateName':testkey,'localeIdInt':me.iLocaleId},
function $vpfn_XRcNjjWxkr3aDwH80zVK$w244$16(sDomain){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}me.DomainRetrieved(sDomain,this.testkey);}.getClosure({testkey:testkey}));
}
};

this.DomainRetrieved=function $vpfn_6kqOlzRQ2vFXmXD7zkGl0g248$27(sDomain,testkey){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var topContainerText=vp.customerSites.studio.formatDomainName(sDomain,me.sTopContainerString,'www.<span style=\"color:#65ad31;font-weight:bold;\">','</span>','');

$(me.oTopContainer).empty();
vp.customerSites.studio.offerredDomain='';
if(topContainerText!=='')
{
if(me.oTopContainer&&topContainerText!=='')
{
vp.customerSites.studio.offerredDomain=sDomain;
$(me.oTopContainer).append(topContainerText);
}
}
me.DomainCache[testkey]=sDomain;

};
this.getUpdateXML=function()
{

};

this.terminate=function $vpfn_$Wcd4NtlPNe7H7pbzXX8Ug269$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oOriginalElement=document.getElementById(me.sElementId);
vp.ui.collapse(oOriginalElement);
};

this.unrender=function $vpfn_Yhq8P4Dcm$V$O5PGl2P26w275$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.terminate();
};

this.render=function()
{

};

this.refresh=function()
{

};

this.upgrade=function()
{

};

this.unrenderExternalTextField=function()
{

};
};

vp.customerSites.studio.domainOffer=function $vpfn_TBREFBt7qwpRmbZcfkR8BA301$38(sOfferPurpose,bIsConsumer,CompanyFieldPurpose,topContainerId,topContainerString,domainCheckUrl,localeId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.customerSites.studio.Offer=new vp.customerSites.studio.DomainOffer(
"WebsiteOfferPanel",
sOfferPurpose,
CompanyFieldPurpose,
topContainerId,
topContainerString,
domainCheckUrl,
localeId);
vp.customerSites.studio.Offer.init();
if(Editor)
{
Editor.items.add(vp.customerSites.studio.Offer);
}

vp.customerSites.studio.offerPurpose=sOfferPurpose;
vp.customerSites.studio.isConsumer=bIsConsumer;
};

vp.customerSites.studio.showRelatedDomains=function $vpfn_yS_Q8MOPusoiM1kGH8f$Ew322$45(sCompanyName,sContainerString,sDomainCheckUrl,iLocaleId,sDefault,sContainerType,sInputName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var topContainer=$('.'+sContainerType);
vp.http.callAsmxAsync(
sDomainCheckUrl,
'GetRelatedDomains',
{'candidateName':sCompanyName,'localeIdInt':iLocaleId,'maxItems':5},
function $vpfn_XRcNjjWxkr3aDwH80zVK$w329$8(aDomains)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(aDomains.length>0)
{
topContainer.empty();
for(var idx=0;idx<aDomains.length;idx++)
{
var sDomain=aDomains[idx];
if(sDomain!=='')
{
var formattedDomainName=vp.customerSites.studio.formatDomainName(sDomain,sContainerString,'<span class="domain-name-text">','','</span>');
if(formattedDomainName!=='')
{
var checked='';
if(sDomain===sDefault)
{
checked='checked="checked"';
}
$('<input type="radio" name="'+sInputName+'" id="'+sInputName+'" value="'+sDomain+'"'+checked+'>'+formattedDomainName+'</input> <br/>').appendTo(topContainer);
}
}
}
}
});
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



if(!vp)
{
var vp={};
}

if(!vp.emailHosting)
{
vp.emailHosting={};
}

if(!vp.emailHosting.studio)
{
vp.emailHosting.studio={};
}


vp.emailHosting.studio.initialize=function $vpfn_OLN5wIsPjMmEoegsDg6q8w21$36(id,lightImpressionId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.emailHosting.studio.sourceElementId=id;
vp.emailHosting.studio.impressionId=lightImpressionId;
};


vp.emailHosting.studio.init=function $vpfn_xDluFhcM$x1u6YcS5jYcGA28$30(sOfferPurpose)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.emailHosting.studio.Offer=new vp.studio.TextFieldOffer("spanEmailHostingOfferLink",sOfferPurpose);
vp.emailHosting.studio.Offer.init();

vp.emailHosting.studio.offerPurpose=sOfferPurpose;
};

vp.emailHosting.studio.showEmailHostingOffer=function $vpfn_1GhHUA80U7TwwBHzQK$7Zg36$47(source,sDialogTitle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sDialogTitle===undefined)
{
sDialogTitle="";
}


var openEmailHostingWindow=function $vpfn_kDAqLVztWTK_bpXCmqBWWQ44$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL("/business-email-studio-offer.aspx");
oURL.setItem("doc_id",Editor.docID);
oURL.setItem("log","1");
oURL.setItem("impression",vp.emailHosting.studio.impressionId);
oURL.setItem("area","studio");

window.oEmailHostingWindow=vp.dialog.IFrameDialog.open(
"oEmailHostingWindow",
sDialogTitle,
oURL.toString(),
vp.dialog.chrome.Primary,
615,
400);
};


if(Editor.docID&&Editor.docID!==0)
{
openEmailHostingWindow();
}
else
{
Editor.showProgressBar();
Editor.save(
function $vpfn_bZ947bdH2UAQveSNMEqjFg70$12()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
Editor.hideProgressBar();
openEmailHostingWindow();
});
}
};

vp.emailHosting.studio.updateTextField=function $vpfn_AaeHzX27btpNyCV1HD6OfQ78$41(sEmailAddress)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(window.oEmailHostingWindow)
{
window.oEmailHostingWindow.close();
window.oEmailHostingWindow=undefined;
}


if(sEmailAddress&&sEmailAddress.length>0)
{
vp.emailHosting.studio.Offer.updateTextField(sEmailAddress,vp.studio.TextFieldOffer.REPLACE_FIELD);
}
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}

if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.controls)
{
vp.controls={};
}

if(!vp.controls.approvalbox)
{
vp.controls.approvalbox={};
}






vp.controls.approvalbox.onContinue=function $vpfn_R1DPypzyi$irW69Mwlcq6Q23$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bValidated=true;

var oCheckBox=document.getElementById("approvalCheckBox");
if(oCheckBox!==null&&!oCheckBox.checked)
{
vp.dialog.get("approvalAlertErrorMessage").open();
oCheckBox.focus();

bValidated=false;
}

return bValidated;
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.studio)
{
vp.studio={};
}

if(!vp.studio.colorvariation)
{
vp.studio.colorvariation={};
}




vp.studio.colorvariation.SeeMoreOptionsLink=function(){};






vp.studio.colorvariation.SeeMoreOptionsLink.SELECTION_GRID_URL="/studio/color-variation-selector.aspx";

vp.studio.colorvariation.SeeMoreOptionsLink.init=function $vpfn_WWdveWaP8aCmH8CJ6IYWqg31$51()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor&&Editor.onupgradecomplete)
{



var fnOnUpCompleteHandler=function $vpfn_sNktqW8HWqQTrizRLnX9yw39$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.colorvariation.SeeMoreOptionsLink.show();
Editor.oncombochange.addHandler(vp.studio.colorvariation.SeeMoreOptionsLink.refresh);
};

Editor.onupgradecomplete.addHandler(fnOnUpCompleteHandler);

}
};





vp.studio.colorvariation.SeeMoreOptionsLink.refresh=function $vpfn_LZt0m4l_dqw_6_sPpx5euw54$54()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.colorvariation.SeeMoreOptionsLink.show();
};

vp.studio.colorvariation.SeeMoreOptionsLink.show=function $vpfn_C83nMV3YRkVsujtL6i3Emg59$51()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!Editor.showChangeColorLink)
{
return;
}

var heading=vp.ui.get("divOptionalOptionsHeading");
if(heading)
{
heading.style.display="block";
}

var colorPicker=vp.ui.get("divColorVariationPicker");

if(colorPicker)
{
colorPicker.style.display="block";
}
};


vp.studio.colorvariation.SeeMoreOptionsLink.hide=function $vpfn_iaPhU9fNlU8liGUWWwbXYg81$51(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.ui.get("divColorVariationPicker").style.display="none";
};







vp.studio.colorvariation.SeeMoreOptionsLink.showSelectionGrid=function $vpfn_anDFHmFKr0IOi$jshh_TuA92$64(iComboId,sPfId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL(vp.studio.colorvariation.SeeMoreOptionsLink.SELECTION_GRID_URL);
oURL.setItem("pf_id",sPfId);
oURL.setItem("combo_id",iComboId);
oURL.setItem("page",Editor.pageNumber);
if(Editor.substrateColor)
{
oURL.setItem("ssc",Editor.substrateColor);
}
var oDialog=new vp.dialog.IFrameDialog("dlgSelectColorVariation",{width:510,height:615},oURL.toString());
oDialog.chrome=vp.dialog.chrome.Primary;
oDialog.open(oURL.toString());
vp.studio.instrumentation.add("seeothercoloroptions");
};







vp.studio.colorvariation.SeeMoreOptionsLink.showSelectionGridFromComboHash=function $vpfn_6A$reTzdkTsO0Yzt5vpmVg114$77(sComboHash,sPfId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oURL=new vp.web.URL(vp.studio.colorvariation.SeeMoreOptionsLink.SELECTION_GRID_URL);
oURL.setItem("pf_id",sPfId);
oURL.setItem("combo",sComboHash);
oURL.setItem("page",Editor.pageNumber);
if(Editor.substrateColor)
{
oURL.setItem("ssc",Editor.substrateColor);
}
var oDialog=new vp.dialog.IFrameDialog("dlgSelectColorVariation",{width:500,height:615},oURL.toString());
oDialog.chrome=vp.dialog.chrome.Primary;
oDialog.open(oURL.toString());
vp.studio.instrumentation.add("seeothercoloroptions");
};


vp.events.addToOnLoad(vp.studio.colorvariation.SeeMoreOptionsLink.init);

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



vp.define("vp.studio.lightStudioAddImageButton");

vp.studio.lightStudioAddImageButton.mapOnClickHandler=function $vpfn_oUhDuDu1yk48a4E5TmvItA7$56()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("lightstudioaddmap");
vp.studio.lightStudioAddImageButton.ensurePageIsColorizedThenAddItem(vp.studio.lightStudioAddImageButton.addOrReplaceMap,PLACEHOLDER_TYPE_Map);
return false;
};

vp.studio.lightStudioAddImageButton.addOrReplaceMap=function $vpfn_2Y4qUAiHgWA6Mt26oR4llw14$54(oDocItem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oDocItem){

vp.studio.ui.openMapDialog(oDocItem.id);
}
else{

vp.studio.ui.openMapDialog();
}
};



vp.studio.lightStudioAddImageButton.qrCodeOnClickHandler=function $vpfn_7R$Xlubus0dcGpM1sy_3kQ27$59(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.instrumentation.add("lightstudioaddqrcode");
vp.studio.lightStudioAddImageButton.ensurePageIsColorizedThenAddItem(vp.studio.lightStudioAddImageButton.addOrReplaceQrCode,PLACEHOLDER_TYPE_ComplexQrCode);
return false;
};

vp.studio.lightStudioAddImageButton.addOrReplaceQrCode=function $vpfn_V5WKT9zvkL5H8jcj2Qs3uQ33$57(oDocItem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oDocItem){

vp.studio.ui.openComplexQrCodeDialog(oDocItem.id);
}
else{

vp.studio.ui.openComplexQrCodeDialog();
}
};







vp.studio.lightStudioAddImageButton.ensurePageIsColorizedThenAddItem=function $vpfn_yXVoh1arTbzp7YMaRrFYOA50$71(fnAddImageType,iPlaceHolderType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(Editor.pageColorization==PAGE_COLORIZATION_blank)
{
vp.studio.ui.changePageColorization(PAGE_COLORIZATION_color,true,
function $vpfn_WoJu7SPfVXS3Ims_a7sVAg56$12()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.lightStudioAddImageButton.addImageToNonBlankPage(this.addImageFunction,this.plageHolderType);
}.getClosure({addImageFunction:fnAddImageType,plageHolderType:iPlaceHolderType})
);
}
else
{
vp.studio.lightStudioAddImageButton.addImageToNonBlankPage(fnAddImageType,iPlaceHolderType);
}
};

vp.studio.lightStudioAddImageButton.addImageToNonBlankPage=function $vpfn_Bj0MwyJVL0weI8N_76MiZw68$61(fnAddImageType,iPlaceHolderType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor.isAdvanced)
{

vp.studio.lightStudioAddImageButton.addImageInAdvancedStudio(fnAddImageType,iPlaceHolderType);
return false;
}
else
{


var didReplacePlaceholder=vp.studio.lightStudioAddImageButton.tryReplacePlaceholder(fnAddImageType,iPlaceHolderType);

if(!didReplacePlaceholder)
{

Editor.onupgradecomplete.addHandler(
function $vpfn_WoJu7SPfVXS3Ims_a7sVAg86$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.lightStudioAddImageButton.addImageInAdvancedStudio(this.addImageFunction,this.plageHolderType);
}.getClosure({addImageFunction:fnAddImageType,plageHolderType:iPlaceHolderType}));


vp.studio.ui.upgradeToAdvanced();
}
}

return false;
};

vp.studio.lightStudioAddImageButton.addImageInAdvancedStudio=function $vpfn_wIBtO7JyD7zT5r4qDUvnFQ99$63(fnAddImageType,iPlaceHolderType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oPlaceholderToReplace;





if(Editor.selection.getItem(0)&&(DOCITEM_TYPE_PLACEHOLDER==Editor.selection.getItem(0).type)&&
(Editor.selection.getItem(0).placeholderType==iPlaceHolderType))
{
oPlaceholderToReplace=Editor.selection.getItem(0);

fnAddImageType(oPlaceholderToReplace);

return;
}

var didReplacePlaceholder=vp.studio.lightStudioAddImageButton.tryReplacePlaceholder(fnAddImageType,iPlaceHolderType);

if(!didReplacePlaceholder)
{



fnAddImageType();

return;
}

};





vp.studio.lightStudioAddImageButton.tryReplacePlaceholder=function $vpfn_2Agt0ipQ5zw1o_TVjZvcdQ135$60(fnAddImageType,iPlaceHolderType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var placeholderItems=Editor.getItemsByType(DOCITEM_TYPE_PLACEHOLDER);


if(placeholderItems[0])
{

var oPlaceholderToReplace=null;



for(var currentPlaceholderCount=0;currentPlaceholderCount<placeholderItems.length;currentPlaceholderCount++)
{

if(placeholderItems[currentPlaceholderCount].placeholderType==iPlaceHolderType)
{
if(oPlaceholderToReplace===null)
{
oPlaceholderToReplace=placeholderItems[currentPlaceholderCount];
}
else
{
oPlaceholderToReplace=placeholderItems[currentPlaceholderCount].zIndex>oPlaceholderToReplace.zIndex?
placeholderItems[currentPlaceholderCount]:oPlaceholderToReplace;
}
}
}


if(oPlaceholderToReplace===null)
{

return false;
}


fnAddImageType(oPlaceholderToReplace);

return true;
}

return false;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


vp.define("vp.controls");

vp.controls.cropDialog=function $vpfn_pQk5QbqHC27GZNQ_ZrGqfA6$25(cropToolDialog)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.url="";
this.dialogDiv=cropToolDialog;
this.dialog=null;
this.destination="";

var _callbackFunction=null;

var init=function $vpfn_S5lkRaU1jvzhEcLIgogGJw16$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.dialogDiv)
{
me.dialog=vp.dialog.get(me.dialogDiv);
if(me.dialog)
{
me.url=new vp.web.URL(me.dialog.url);
window.cropDialog=me;
}
}
else
{
throw new Error("Can't find a reference to crop dialog div");
}
};

this.changeParameters=function $vpfn_Hot5H4u0nphHbSaPZ7B1hg33$28(paramArray)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

for(var item in vp.controls.cropDialog.urlParams)
{
me.url.removeItem(vp.controls.cropDialog.urlParams[item]);
}
me.destination="";


for(var k in paramArray)
{
if(k&&vp.controls.cropDialog.urlParams[k])
{
me.url.setItem(vp.controls.cropDialog.urlParams[k],convertValues(paramArray[k]));
}
else
{
if(k=="destinationId")
{
me.destination=paramArray[k];
}
}
}

me.dialog.url=me.url.toString();
};

var convertValues=function $vpfn_i7TOtmUgMoJ7Cc18QZJ$tw61$24(value)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
value=fixLargeNumbers(value);

if(value===false)
{
return"False";
}
else if(value===true)
{
return"True";
}
return value;
};

this.open=function $vpfn_q4B5SvnSeg0LC5RO0dLfMg76$16(callback)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(callback)
{
_callbackFunction=callback;
me.dialog.open();
}
else
{
throw new Error("No callback function passed");
}
};

this.callBack=function $vpfn_3PZYaoS3wDK6hUut6$M_wg89$20(cropResult)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window.cropDialog.cropResult=cropResult;
cropResult.destination=me.destination;
_callbackFunction.apply(me.dialog,new Array(cropResult));
};

var fixLargeNumbers=function $vpfn_qGcRp9E69KHLd85ZBJMh8A96$26(item)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof item=="number")
{
return round(item,5);
}
return item;
};

var round=function $vpfn_55W3s_wP3LHFSnfQ6_pYGw105$16(n,dec)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
n=parseFloat(n);
if(!isNaN(n))
{
if(!dec){dec=0;}
var factor=Math.pow(10,dec);
return Math.floor(n*factor+((n*factor*10)%10>=5?1:0))/factor;
}
else
{
return n;
}
};

init();
};

vp.controls.cropDialog.urlParams={
HideRotation:"hiderot",
DisableUnlocking:"disunlock",
UnlockByDefault:"unlockbydef",
HideModes:"hidemode",
AspectRatio:"aspectratio",
ImageId:"imgId",
ImageType:"type",
CropTop:"croptop",
CropRight:"cropright",
CropBottom:"cropbottom",
CropLeft:"cropleft",
Rotation:"rotation",
AspectRatioFromCrop:"arfcrop"
};

vp.controls.cropDialog.convertImageType=function $vpfn_PUA9KmXMExzmIAn$hGcPdw139$42(studioImageType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var imageType=1;
studioImageType=studioImageType.toString();
if(studioImageType){
switch(studioImageType){
case"image":
case 2:
case"2":
imageType=0;
break;
case 3:
case"3":
case"upload":
imageType=1;
break;
default:
imageType=studioImageType;
break;
}
}
return imageType;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

vp.typochecker={};

vp.typochecker.Typo=function $vpfn_KUAt7Kmb73BNOH0cSTfEeA11$22(text,field)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
me.field=field;
me.text=text;
me.suggestions=new Array();

this.addSuggestion=function $vpfn_jQ6rrFu_Shj8MLZueeTYmQ18$25(suggestion)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.suggestions[me.suggestions.length]=suggestion;
};

this.change=function $vpfn_fG3oLGoLkLCeh8aR$Uqajw23$18(suggestion)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var studioItem=vp.typochecker.getElementByName(me.field,me.text);
studioItem.setData(studioItem.data.replace(me.text,suggestion));
studioItem.refresh();
};
};

vp.typochecker.typos=new Array();

vp.typochecker.add=function $vpfn_6WMkWiQDR17DC17JLoGvjg33$21(typo)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(!vp.typochecker.isSpellChecker&&typo.field.indexOf("address")!==-1)
{
return null;
}

if(typo.field.indexOf("greek")!==-1)
{
return null;
}
vp.typochecker.typos[vp.typochecker.typos.length]=typo;
return vp.typochecker.typos.length;
};

vp.typochecker.reset=function $vpfn_wEPCtmoLsf5xuS9T0uWxcQ50$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.typochecker.isSpellChecker=undefined;
vp.typochecker.typos=[];
vp.typochecker.currentTypoIndex=0;
vp.typochecker.review="";
vp.typochecker.isDocumentChanged=false;
};

vp.typochecker.get=function $vpfn_OCigypm1pkrAhm4DJy7o7g58$21(value)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(value)=="number")
{
if(value<vp.typochecker.typos.length&&value>=0)
{
return vp.typochecker.typos[value];
}
else
{
return null;
}
}
else if(typeof(value)=="string")
{
for(var i=0;i<vp.typochecker.typos.length;i++)
{
if(vp.typochecker.typos[i].text==value)
{
return vp.typochecker.typos[i];
}
}
return null;
}
return null;
};

vp.typochecker.show=function $vpfn_jkgE3zgAJQzlyw414NPtUw85$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.typochecker.status.innerHTML=(vp.typochecker.currentTypoIndex+1)+' of '+vp.typochecker.typos.length;

var typo=vp.typochecker.get(vp.typochecker.currentTypoIndex);

var editorItem=vp.typochecker.getElementByName(typo.field,typo.text);

if(editorItem===null){return;}

var fullText=editorItem.data.replace(/\\n/g,'<br>').replace(new RegExp(typo.text),"<span class=typo>"+typo.text+"</span>");

vp.typochecker.typoFullText.innerHTML=fullText;

while(vp.typochecker.suggestionList.options.length>0)
{
vp.typochecker.suggestionList.options[0]=null;
}

for(var i=0;i<typo.suggestions.length;i++)
{
var suggestion=typo.suggestions[i];
vp.typochecker.suggestionList.options[vp.typochecker.suggestionList.options.length]=new Option(suggestion,suggestion);
}

if(vp.typochecker.suggestionList.options.length>0)
{
vp.typochecker.suggestionList.options[0].selected=true;
}
};

vp.typochecker.showNext=function $vpfn_QwcpRyeXdKre4U9tGS2ZbA116$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.typochecker.currentTypoIndex++;
if(vp.typochecker.currentTypoIndex<vp.typochecker.typos.length)
{
vp.typochecker.show();
}
else
{
vp.typochecker.complete();
}
};

vp.typochecker.change=function $vpfn_OMzqAuXhvRqaSWhgIo_ZNw129$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var suggestion="";
if(vp.typochecker.userSuggestion.value.replace(/ /g,"")!=="")
{
suggestion=vp.typochecker.userSuggestion.value.replace(/^\s+|\s+$/g,"");
vp.typochecker.userSuggestion.value="";
}
else if(vp.typochecker.suggestionList.options.length>0)
{
suggestion=vp.typochecker.suggestionList.options[vp.typochecker.suggestionList.selectedIndex].value;
}
else
{
return;
}

var typo=vp.typochecker.get(vp.typochecker.currentTypoIndex);
typo.change(suggestion);
vp.typochecker.review+="<tr><td width=70px><span class=typo>"+typo.text+'</span></td><td class=arrow>&nbsp;</td><td>'+suggestion+'</td></tr>';
vp.typochecker.showNext();
vp.typochecker.isDocumentChanged=true;
};

vp.typochecker.getElementByName=function $vpfn_o3cIePcusSCEIaeFpebWYA153$34(name,typo)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(Editor)=='undefined')
{
throw new Error("Editor is undefine");
}

for(var i=0;i<Editor.items.length;i++)
{
var item=Editor.items[i];

if(item.data&&item.purposeName==name&&
(item.data.indexOf(typo)!==-1||typo.match(item.data)))
{
return item;
}
}

throw new Error("Couldn't find element "+name);
};

vp.typochecker.build=function $vpfn_DaNmTeBBWQNBpvEMzSoidw174$23(page){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var validationDiv=vp.validation.getValidationErrorDialogDiv();
var typoPageContainer=validationDiv.find("#typoPageContainer")[0];

typoPageContainer.innerHTML=validationDiv.find('#'+page)[0].innerHTML.replace(/_id_/g,"");
vp.typochecker.typoFullText=validationDiv.find('#txtTypoFullText')[0];

if(page==vp.typochecker.SingleView){
Editor.ValidationWin.resize(420,410);
vp.typochecker.suggestionList=validationDiv.find('#lstSuggestions')[0];
vp.typochecker.userSuggestion=validationDiv.find('#txtUserSuggestion')[0];
vp.typochecker.status=validationDiv.find('#lblStatus')[0];
vp.typochecker.show();
}
else{
var height=285;
if(Editor.typoValidationRequestedByUser){
height=245;
}
vp.validation.validationDialog.resize(440,height);
vp.typochecker.summary();
}
};

vp.typochecker.summary=function $vpfn_UpUnrrZBHByXvoyc6d3LSA198$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var previous_field=null;
var fullText="";
vp.typochecker.typoFullText.innerHTML="";
for(var i=vp.typochecker.currentTypoIndex;i<vp.typochecker.typos.length;i++)
{
var typo=vp.typochecker.get(i);
if(previous_field!=typo.field)
{
vp.typochecker.typoFullText.innerHTML+=fullText;
fullText=vp.typochecker.getElementByName(typo.field,typo.text).data+'<br><br>';
previous_field=typo.field;
}
fullText=fullText.replace(/\\n/g,'<br>').replace(new RegExp(typo.text,"g"),"<span class=typo>"+typo.text+"</span>");
}
vp.typochecker.typoFullText.innerHTML+=fullText;
};

vp.typochecker.complete=function $vpfn_3vKKLk1AHSq326BWchbd3Q217$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.typochecker.review===""){
vp.typochecker.close();
}
else{
vp.validation.validationDialog.resize(360,245);
var validationDiv=vp.validation.getValidationErrorDialogDiv();
validationDiv.find('#typoPageContainer')[0].style.width="360px";
validationDiv.find('#typoPageContainer')[0].innerHTML=validationDiv.find('#completionPage')[0].innerHTML.replace(/_id_/g,"");
validationDiv.find('#txtChanges')[0].innerHTML="<table border=0>"+vp.typochecker.review+"</table>";
}
};

vp.typochecker.close=function $vpfn_j89k6sWUfeL60Wl2GKF42w230$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.typochecker.typoValidationRequestedByUser){
Editor.typoValidationRequestedByUser=false;
}
vp.typochecker._clearCallbacks();
vp.validation.saveAndClose();
};

vp.typochecker.start=function $vpfn_0SWg2nsVYkfDNEa$QG3wsw238$23(view){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.typochecker.reset();


var validationDiv=vp.ui.get('divValidationContainer');
if(validationDiv){
validationDiv.style.display='none';
}

if(typeof(Editor.typoValidationRequestedByUser)=='undefined'||!Editor.typoValidationRequestedByUser){
vp.typochecker.typoValidationRequestedByUser=false;
}
else{
vp.typochecker.typoValidationRequestedByUser=true;
}
var rootWindow=(window===window.parent)?window:window.parent;
if(rootWindow.Editor){
rootWindow.Editor=Editor;
}



if(Editor.validationErrorData&&Editor.validationErrorData.TypoError.HasError){
var data=Editor.validationErrorData.TypoError.Data;
var itemCount=data.Items.length;
for(var i=0;i<itemCount;i++){
var item=data.Items[i];
var typo=new vp.typochecker.Typo(item.Text,item.Field);
var suggestionCount=item.Suggestions.length;
for(var j=0;j<suggestionCount;j++){
typo.addSuggestion(item.Suggestions[j]);
}
vp.typochecker.add(typo);
}
}

if(vp.typochecker.typos.length===0){
vp.typochecker.close();
}
else{
if(vp.typochecker.typos.length==1){
vp.typochecker.build(vp.typochecker.SingleView);
}
else{
vp.typochecker.build(view);
}
}
};


vp.typochecker._registerCallbacks=function $vpfn_tmedSaXt6taXTIH2J1Ih1A289$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var handler=function $vpfn_z7bXfAhfNmnWkhqGmxsq6A290$18(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var target=e.target;
if(target&&target.id){
switch(target.id){
case"typoViewAll":
vp.typochecker.build(vp.typochecker.SummaryView);
break;
case"imgSuggestChangeButton":
vp.typochecker.build(vp.typochecker.SingleView);
break;
case"imgIgnoreButton":
vp.typochecker.showNext();
break;
case"imgChangeButton":
vp.typochecker.change();
break;
case"imgCloseButton":
vp.typochecker.close();
break;
case"imgCompletionCloseButton":
case"imgReturnToDocumentButton":
case"imgContinueButton":
vp.typochecker.close();
break;
default:
break;
}
}
};

var validation=vp.validation.getValidationErrorDialogDiv();

validation.unbind("click");
validation.bind("click",handler);
};

vp.typochecker._clearCallbacks=function $vpfn_MHsemh0DesC4d3nTnihVQg326$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var validation=vp.validation.getValidationErrorDialogDiv();
validation.unbind("click");
};


vp.typochecker.SingleView='singleTypoPage';
vp.typochecker.SummaryView='summaryTypoPage';
vp.typochecker.currentTypoIndex=0;
vp.typochecker.review="";
vp.typochecker.isDocumentChanged=false;

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}

if(!vp)
{
var vp={};
}

vp.validation={};

var VALIDATION_IFRAME_MAX_HEIGHT=340;
var VALIDATION_CONTENT_MAX_HEIGHT=265;
var VALIDATION_IFRAME_MIN_HEIGHT=130;
var VALIDATION_CONTENT_MIN_HEIGHT=90;

vp.validation.showError=function $vpfn_lZagDVK_1_N4DAdGe$vItQ15$26(callback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!callback){
callback=function()
{};
}
vp.validation.callback=callback;


if(Editor.validationErrorData.MatchingTagSubstitutionError.HasError||Editor.validationErrorData.ValidationError.HasError){
vp.validation.showNonTypoError();
}else{
vp.validation.showTypoError();
}

};

vp.validation.showNonTypoError=function $vpfn_mxGnwEj7KseaJkxJu5LSKw32$33(data)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var contentNode;
if(!data)
{
if(Editor.validationErrorData.MatchingTagSubstitutionError.HasError)
{
data=Editor.validationErrorData.MatchingTagSubstitutionError;
}
else if(Editor.validationErrorData.ValidationError.HasError)
{
data=Editor.validationErrorData.ValidationError;
}
else
{
return;
}
}

contentNode=$(data.Html)[0];
var iconUrl=vp.validation.icons["exclamation"];
var dialogOptions={iconUrl:iconUrl,title:data.Title};
var dialog=vp.validation.showValidationErrorDialog(contentNode,dialogOptions,vp.validation._registerCallbacks);

var validationErrorDiv=vp.validation.getValidationErrorDialogDiv()[0];

validationErrorDiv.style.visibility="visible";


var contentHeight=validationErrorDiv.offsetHeight;

var iContentSpacing=0;

var sContentHeight=Math.min(contentHeight-iContentSpacing,
VALIDATION_CONTENT_MAX_HEIGHT);

sContentHeight=Math.max(sContentHeight,VALIDATION_CONTENT_MIN_HEIGHT);

var separator=$(validationErrorDiv).find('.separator')[0];
var separatorHeight=separator.offsetHeight;

var buttonContainer=$(validationErrorDiv).find('#divValidationButtions')[0];
var buttonContainerHeight=buttonContainer.offsetHeight;


var container=$(validationErrorDiv).find('#divErrorContainer')[0];
container.style.height=(sContentHeight-buttonContainerHeight-separatorHeight)+"px";
container.style.overflowY="auto";
container.style.overflowX="hidden";


sContentHeight=Math.min(sContentHeight,VALIDATION_IFRAME_MAX_HEIGHT);
sContentHeight=Math.max(sContentHeight,VALIDATION_IFRAME_MIN_HEIGHT);


var iWindowSpacing=dialog.options.contentTopMargin+dialog.options.contentBottomMargin+dialog.chrome.styleCompensation.top+dialog.chrome.styleCompensation.bottom+dialog.chrome.titleBarHeight;


vp.validation.validationDialog.resize(0,sContentHeight+iWindowSpacing,true);
};

vp.validation.showTypoError=function $vpfn_MGpIN1YvBnSiaZP59X1yBQ94$30(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var data=Editor.validationErrorData.TypoError;
if(data.HasError){
var contentNode=$(data.Html)[0];
var dialogOptions={iconUrl:vp.validation.icons["typo"],title:data.Title};

var onTypoLoadedCallback=function $vpfn_Ycma8al1yTfPRlpblqfApw100$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.typochecker._registerCallbacks();
};

vp.validation.showValidationErrorDialog(contentNode,dialogOptions,onTypoLoadedCallback);

vp.typochecker.start(vp.typochecker.SingleView);
}
};

vp.validation.showValidationErrorDialog=function $vpfn_UJsqSlXcuk7Stg_$cjrHLw111$42(contentNode,dialogOptions,onOpenCallback){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var dialog=vp.dialog.get("validationErrorDialog");
if(dialog){

if(dialogOptions){
dialog.setTitle(dialogOptions.title);


var validationErrorDiv=vp.validation.getValidationErrorDialogDiv();
var image=validationErrorDiv.find("[vp-dialog-type=iconContainer] img");
if(image.length&&dialogOptions.iconUrl){
image.attr("src",dialogOptions.iconUrl);
}
}
dialog.replaceContentNode(contentNode);
}else{
dialog=vp.dialog.NodeDialog.create("validationErrorDialog","Validation Failed",contentNode,vp.dialog.chrome.Primary,430,380,dialogOptions);
}
vp.validation.validationDialog=dialog;

dialog.onopen.removeAll();
dialog.onopen.addHandler(onOpenCallback);
dialog.open();

Editor.ValidationWin=dialog;
return dialog;
};

vp.validation.getValidationErrorDialogDiv=function $vpfn_Qd7Qu8gYoW76lbaIHgo8ZA140$44(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(vp.validation.validationDialog.getContentContainer());
};

vp.validation.getRootWindow=function $vpfn__3cEA5ePFxilzaTplxMEQg144$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(window!==window.parent)?window.parent:window;
};

vp.validation._registerCallbacks=function $vpfn_d9bLUcmIwuRWRFkvDrA5QQ149$35(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var handler=function $vpfn_nkPxVHDASP2tLXaQmjddDg150$18(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var target=e.target;
if(target&&target.id){
switch(target.id){
case"imgCancelButton":
return vp.validation.goBack();
case"imgDoneButton":
return vp.validation.applyChanges();
case"imgWillFixButton":
return vp.validation.goBack();
case"imgContinueButton":
return vp.validation.goNext();
case"imgContinueDisabledButton":

break;
default:
break;
}
}

return null;
};

var validation=vp.validation.getValidationErrorDialogDiv();
validation.unbind("click");
validation.bind("click",handler);
};

vp.validation._clearCallbacks=function $vpfn_hq_XkNCLhAOzJR4R9hWLog178$32(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var validation=vp.validation.getValidationErrorDialogDiv();
validation.unbind("click");
};

vp.validation.goNext=function $vpfn_ejIfX4dlXbogCq7TBDC2KA183$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var validationErrorLogId=Editor.validationErrorData.ValidationErrorId;
if(validationErrorLogId){
try{

vp.http.postJson("/sales/studio/services/ValidationService.asmx/UserIgnoredValidation",{"validationErrorLogId":validationErrorLogId});
}catch(e){

vp.instrumentation.logException(e);
}
}

if(Editor.validationErrorData.TypoError.HasError){
vp.validation.showTypoError();
}
else{
vp.validation.saveAndClose();
}
};

vp.validation.goBack=function $vpfn_v0HexyIPWnke6XS_QNjDmQ203$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.validation.close();
};

vp.validation.applyChanges=function $vpfn_IooafIiRLOUk1oAiK3Ihuw207$29()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oParentWindow=vp.dialog.getParent();

if(oParentWindow)
{
var oApprovalCheckBox=oParentWindow.vp.ui.get("approvalCheckBox");

if(oApprovalCheckBox)
{
oApprovalCheckBox.checked=false;
}


var inputs=$("input[matchingtagtoreplace]");


for(var i=0;i<inputs.length;i++)
{
var sReplacementValue=inputs[i].value;

if(sReplacementValue)
{
var jInput=$(inputs[i]);
var oDocItemIdsToUpdate=vp.web.htmlDecode(jInput.attr("matchingtagfieldids")).split(",");
var sMatchingTagToReplace=vp.web.htmlDecode(jInput.attr("matchingtagtoreplace"));


for(var j=0;j<oDocItemIdsToUpdate.length;j++)
{
var docItemArray=oDocItemIdsToUpdate[j].split("|");

var iItemId=docItemArray[0];
var iRowNumber=-1;
var iColNumber=-1;

if(docItemArray[1])
{
iRowNumber=docItemArray[1];
}
if(docItemArray[2])
{
iColNumber=docItemArray[2];
}

var studioItem=vp.validation.getDocItemById(iItemId,sMatchingTagToReplace,iRowNumber,iColNumber);
if(studioItem)
{
vp.validation.replaceDocItemData(studioItem,sMatchingTagToReplace,sReplacementValue,iRowNumber,iColNumber);
studioItem.refresh();
}
}
}
}
}

return vp.validation.close();
};

vp.validation.replaceDocItemData=function $vpfn_AqvR9nSmYXoHCBk5Qu_I5w266$35(oItem,sTextToReplace,sReplacementText,iRowNumber,iColNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oItem.data)
{
oItem.setData(oItem.data.replace(sTextToReplace,sReplacementText));
}
if(oItem.type==window.DOCITEM_TYPE_TABLE&&iRowNumber>=0&&iColNumber>=0)
{

var oldContent=oItem.content.getCell(iRowNumber,iColNumber);
var newContent=oldContent.replace(sTextToReplace,sReplacementText);

oItem.content.setCell(iRowNumber,iColNumber,newContent);
}
};

vp.validation.getDocItemById=function $vpfn_o7pB829tMWHHM33KGClm2Q282$31(iItemId,textToSubstitute,iRowNumber,iColNumber)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof(Editor)=='undefined')
{
throw new Error("Editor is undefined");
}

for(var i=0;i<Editor.items.length;i++)
{
var item=Editor.items[i];

if((item.id==iItemId))
{
if(item.data&&(item.data.indexOf(textToSubstitute)!==-1||textToSubstitute.match(item.data)))
{
return item;
}
else if(item.type==window.DOCITEM_TYPE_TABLE&&iRowNumber>=0&&iColNumber>=0)
{
var cellContent=item.content.getCell(iRowNumber,iColNumber);

if(cellContent&&(cellContent.indexOf(textToSubstitute)!==-1||textToSubstitute.match(cellContent)))
{
return item;
}
}
}
}

return null;
};

vp.validation.close=function $vpfn_0WraYEZClOSk51lOOheNPA314$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.validation.validationDialog&&vp.validation.validationDialog.isVisible())
{
vp.validation.validationDialog.close();
}
vp.validation.callback=null;
return false;
};

vp.validation.saveAndClose=function $vpfn_PdLagRRQpRjpZCDWgZtKRw323$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

vp.validation._clearCallbacks();

if(vp.typochecker.isDocumentChanged){
Editor.setDocumentChanged(true);
Editor.save(vp.validation.callback);
}else{
if(vp.validation.callback){
vp.validation.callback(vp.validation.validationDialog);
}
}
vp.validation.close();
};

vp.validation.callback=function()
{};

vp.validation.validationDialog=null;

vp.validation.ErrorType={
Typo:0,
NonTypo:1
};

vp.validation.icons={
typo:"/vp/images/nns/common/icons/spell_check_icon.gif",
error:"/vp/images/nns/common/icons/x_error_icon.gif",
exclamation:"/vp/images/b09/common/icon/exclamation-icon.png",
exclamationYellow:"/vp/images/nns/common/icons/exclamation_icon_yellow.gif"
};

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}vp.define("vp.studio.richtext");
vp.studio.richtext.StyleManager=function $vpfn_t_mic6apD4iMbN_6qtpg3w2$34(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var colorMap={};









this.serializeStyleValue=function $vpfn_Dtv_y_Qq0pbgjwpF5HTqUg13$31(prop,value){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!value){
return value;
}

if(prop=="color"){

return storeColor(value);
}
else if(prop=="font-size"){

return value&&(typeof(value)==="number"||!value.match(/px/))?value+"px":value;
}else if(prop==="font-family")
{



if(!value.match(/^\".+\"$/)&&value.match(/^(?:\d.+|.+\s.+)$/)){
return"\'"+value+"\'";
}
return value;
}


return value.toString();
};









this.deserializeStyleValue=function $vpfn_hBPi7bIjTKOaDlbXhxtVFw48$33(prop,value){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(prop==="color"){

var color=fetchColor(value);
if(!color){
color=new vp.color.Color(value);
storeColor(color);
}
return color;
}
else if(prop==="font-size"){

return parseInt(value);
}else if(prop==="font-family"){
return value.replace(/[\'\"]/ig,"");
}
else{

return value;
}
};







var storeColor=function $vpfn_O7yFfXqe6ignntXzbLRUfg76$21(value){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var sRgbHex=value.toHex();

colorMap[sRgbHex]=value;

return sRgbHex;
};







var fetchColor=function $vpfn_q8DHXJcvwxzlrf3if3nNBA91$21(value){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var oRgbColor=new vp.color.Color(value);

return colorMap[oRgbColor.toHex()];
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}




vp.define("vp.studio.richtext");

vp.studio.richtext.TextArea=function $vpfn_5WjtLOzfAo6rvFAk3Dac0g8$30(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;


var isRendered=false;


this.contentEditableElement=null;
this.$contentEditableElement=null;





this.maxHeight=100;





this.minHeight=18;


var currentValue="";





this.onfocus=new vp.events.CustomEvent(this,"onfocus");





this.onblur=new vp.events.CustomEvent(this,"onblur");





this.onchange=new vp.events.CustomEvent(this,"onchange");





this.ondelaychange=new vp.events.CustomEvent(this,"ondelaychange");





this.onkeydown=new vp.events.CustomEvent(this,"onkeydown");





this.onkeyup=new vp.events.CustomEvent(this,"onkeyup");





this.onselectionchange=new vp.events.CustomEvent(this,"onselectionchange");



this.isFocused=false;


var KEYDOWN_TIMER_INTERVAL=350;
var POLL_INTERVAL=350;


var keyTimer=null;


var pollTimer=null;


var isChanged=false;

var forceDelayChangeEvent=false;

var styleManager=new vp.studio.richtext.StyleManager();
this.styleManager=styleManager;




var startUpdateTimer=function $vpfn_dP49R_Qtah8eQBYr5QihMA101$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(keyTimer)
{
clearTimeout(keyTimer);
}

keyTimer=setTimeout(fireDelayChanged,KEYDOWN_TIMER_INTERVAL);
};

var startPollingForValueChange=function $vpfn_nCE2Du8Di9pEN3cLLDBHYg111$37()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!pollTimer)
{
pollTimer=setInterval(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw115$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
fireDelayChanged();
},POLL_INTERVAL);
}
};





this.style={
"font-weight":"normal",
"font-style":"normal",
"color":"#000000",
"font-size":"16px",
"font-family":"Arial",
"text-align":"left"
};





var SUPPORTED_STYLES=["font-size","font-family","color","font-weight","font-style","text-align"];

this.setStyleSimple=function $vpfn_9huci9IGh0U5CDrk832zdg140$26(styleName,styleValue,applyToContentEditable)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var value=styleValue?styleManager.serializeStyleValue(styleName,styleValue):styleValue;
if(me.style[styleName]!==value)
{
me.style[styleName]=value;
isChanged=true;

if(me.contentEditableElement&&applyToContentEditable)
{
me.setNodeStyle(me.contentEditableElement,styleName,value);
}
}
};

this.getNodeStyle=function $vpfn_UCulnYAomrCc17lAiSNceg155$24(oNode,sStyle)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var value=$(oNode).getStyles()[sStyle];
return sStyle==="fontFamily"?value.replace(/\'/ig,""):value;
};

this.getStyles=function $vpfn_UnarqktZADdBzmqCODBHkg161$21(styleName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValue;
if(styleName)
{
styleValue=me.style[styleName];
return styleManager.deserializeStyleValue(styleName,styleValue);
}
else
{
styleValue={};
for(styleName in me.style)
{
var value=me.style[styleName];
styleValue[styleName]=styleManager.deserializeStyleValue(styleName,value);
}
return styleValue;

}
};





this.render=function $vpfn_f1iJ8mIqHtmGMeWr4kkFJw186$18(parentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(isRendered)
{
return;
}
var fnAfterLoad=function $vpfn_3OiV90vJZ1nfr4ez5mMIVw192$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
isRendered=true;
if(options&&options.style)
{

for(var style in options.style)
{
var styleValue=styleManager.serializeStyleValue(style,options.style[style]);
if(styleValue)
{
me.style[style]=styleValue;
me.setNodeStyle(me.contentEditableElement,style,styleValue);
}
}
}

if(options.showStylesOnTextField)
{

me._handleLightTextColor();
}

me.setNodeStyle(me.contentEditableElement,"min-height",me.minHeight);
me.contentEditableElement.innerHTML=currentValue;
currentValue=me.contentEditableElement.innerHTML;


initPlugins();

me.$contentEditableElement.on({
keydown:function $vpfn_rN$Tbfav3vEN7r8YsR3JDw223$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.onkeydown.fire(e);
},
keyup:function $vpfn_rN$Tbfav3vEN7r8YsR3JDw227$23(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
checkForChanges(true);
me.onkeyup.fire(e);
},
focus:onFocusHandler,
blur:me.blur,
mouseup:fireSelectionChanged,
mousedown:function $vpfn_rN$Tbfav3vEN7r8YsR3JDw235$27(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e.stopPropagation();
},
paste:onPasteHandler
});
};


me.$contentEditableElement=$("<DIV>").attr("contentEditable",true);
me.contentEditableElement=me.$contentEditableElement.get(0);

parentElement.appendChild(me.contentEditableElement);
me.$contentEditableElement.addClass("studioRichTextField");
if(!options.showStylesOnTextField)
{

$(me.contentEditableElement).addClass("studioRichTextFieldDisableStyles");
}

fnAfterLoad();
};





this.getValue=function $vpfn_B2XpFk0P7JwsTe1D0Z2j5A262$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(isRendered)
{
var jElement=$("<DIV>");
jElement.html(me.$contentEditableElement.html());

var result=vp.studio.richtext.util.convertNodeToXml(jElement.get(0),null,styleManager);
var xml=vp.web.getInnerXML(result);
return xml;
}
return"";
};






this.setValue=function $vpfn_0tkVEccLP3P4f9QrSwpOAw281$20(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.contentEditableElement)
{
if(sValue==currentValue)
{
return;
}
me.contentEditableElement.innerHTML=vp.studio.richtext.util.convertNodeFromXml($("<div>").html(sValue).get(0),null,me.styleManager).innerHTML;
}
currentValue=sValue;

if(me.contentEditableElement)
{
checkForChanges(true);
}
};




var onContentEditableFocusHandler=function $vpfn_B8T3rBFBrbQrArmh670fYA302$40()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
setTimeout(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw304$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.richtext.util.moveCursorToEndOfElement(me.contentEditableElement);
$(me.contentEditableElement).off("focus",onContentEditableFocusHandler);
},100);
};





this.focus=function $vpfn_Vrb6A1U34y5Fji_e3P74AQ314$17()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(isRendered)
{
$(me.contentEditableElement).on("focus",onContentEditableFocusHandler);
$(me.contentEditableElement).focus();
}
};




this.blur=function $vpfn_NwS9MEAT83vvFLNJhhHI7g326$16()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
onDocumentMouseDownHandler();
};





var onFocusHandler=function $vpfn_CKp1haJZJLclZL8aoOjTpw335$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
startUpdateTimer();

if(me.isFocused)
{
return;
}

me.isFocused=true;
setTimeout(checkForChanges,150);
startPollingForValueChange();


vp.events.add(document,"mousedown",onDocumentMouseDownHandler);
me.onfocus.fire();
};






var onDocumentMouseDownHandler=function $vpfn_ok33Z3s6Y$D9znf3oL0OcA358$37(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!me.isFocused)
{
return;
}


if(e)
{
e=vp.events.getEvent(e);

var oTarget=e.target;

if(oTarget)
{
if(oTarget==me.element||vp.ui.isChildOf(oTarget,me.element))
{
return;
}


if(me._isUnselectable(oTarget))
{
return;
}
}
}


vp.events.remove(document,"mousedown",onDocumentMouseDownHandler);


if(pollTimer)
{
clearInterval(pollTimer);
pollTimer=null;
}

fireSelectionChanged();

me.isFocused=false;
$(me.contentEditableElement).blur();
me.onblur.fire();
};





var onPasteHandler=function $vpfn_eiDHtGrrqpivOq9KJjZV1Q409$25(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
setTimeout(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw411$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
cleanUnsanctionedTags();
vp.studio.richtext.util.moveCursorToEndOfElement(me.contentEditableElement);
startUpdateTimer();
},100);
};

var fireSelectionChanged=function $vpfn_VjzpGS_3Qu2NpvN2uKIKOA418$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.onselectionchange.fire();
};

this.refresh=function $vpfn_JI3ybOHZrYCZSsncjm7_Ug423$19(callback,forceRefresh)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(isChanged||forceRefresh)
{
setChanged();
}
if(callback)
{
callback();
}
};

var fireDelayChanged=function $vpfn_1tbakTZqFBc$3uIf8BlwxA435$27()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.actionInProgress)
{
return;
}

if(hasInnerHtmlChanged()||isChanged||forceDelayChangeEvent)
{
forceDelayChangeEvent=false;
me.ondelaychange.fire();
}
};






var checkForChanges=function $vpfn_rZU0KNo326m564hj_nue9g454$26(bIsKeyEvent)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(hasInnerHtmlChanged())
{
if(!bIsKeyEvent)
{
cleanUnsanctionedTags();
}
setChanged();
}
};

this.isSelected=function $vpfn_JNXW2ZQzZPl8YYlykunD0Q466$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!isRendered)
{
return false;
}
return me.isFocused;
};





var hasInnerHtmlChanged=function $vpfn_424ruO5230BtMvwwxQ0L4g479$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return me.getValue()!=currentValue;
};








var setChanged=function $vpfn_4Q1ZUobB5NEQCzvGXfZ6VA491$21(bForceDelayChange,bSuppressEvents)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

currentValue=me.getValue();
isChanged=false;
bSuppressEvents=bSuppressEvents?true:false;

if(options&&options.ensureStylesOnContentEditable)
{
ensureStylesOnContentEditable();
}



var contentEditableStyles=me.$contentEditableElement.getStyles();
for(var i=0;i<SUPPORTED_STYLES.length;i++)
{
var sStyle=SUPPORTED_STYLES[i];
var value=contentEditableStyles[sStyle];


me.style[sStyle]=styleManager.deserializeStyleValue(sStyle,value);
}

if(!bSuppressEvents)
{
forceDelayChangeEvent=true;
if(bForceDelayChange)
{

fireDelayChanged();
}
else
{

startUpdateTimer();
}
me.onchange.fire();
}
};


var cleanUnsanctionedTags=function $vpfn_rt3goKmL99HA0Z$WwEQQpg533$32()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.$contentEditableElement.handleUnsanctionedTags();
};

this.pasteInto=function $vpfn_bEHg4dVqHpK77Ij9mm$Pwg538$21(sChar,selectedRange)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var element=$("<span>").html(sChar).get(0);
var range=null;
if(selectedRange&&$(this.element).has(selectedRange.startContainer).length)
{
range=selectedRange;
}
else
{
range=rangy.createRangyRange();
range.selectNodeContents(me.contentEditableElement);
}
range.collapse();
range.insertNode(element);
me.refresh(null,true);
};

var ensureStylesOnContentEditable=function $vpfn__BtvX2GthLT_SaEmjlL$_A556$40()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styles=me.$contentEditableElement.getStyles();

for(var i=0;i<SUPPORTED_STYLES.length;i++)
{
var sStyle=SUPPORTED_STYLES[i];
if(!styles[sStyle])
{
var value=me.style[sStyle];
if(sStyle==="font-weight"||sStyle==="font-height")
{
value="normal";
}
me.setNodeStyle(me.contentEditableElement,sStyle,me.styleManager.serializeStyleValue(sStyle,value));
}
}
};

var initPlugins=function $vpfn_FHv2NK0qfBR3pEnNK9stfQ575$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(vp.studio.richtext.TextArea.PluginManager&&vp.studio.richtext.TextArea.PluginManager.plugins)
{
_.each(vp.studio.richtext.TextArea.PluginManager.plugins,function $vpfn_rN$Tbfav3vEN7r8YsR3JDw579$70(plugin){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var p=new plugin();
p._init(me);
});
}
};
};










vp.studio.richtext.TextArea.prototype.setNodeStyle=function $vpfn_nKYfZisR9fyVnxE4gMNXOA596$53(oNode,sStyle,vValue){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$(oNode).css(sStyle,vValue);
};








vp.studio.richtext.TextArea.prototype._isUnselectable=function $vpfn_dpkv9NIkqd15AcoAs9b$0A607$56(oElem){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(oElem.nodeType==1&&vp.core.getAttribute(oElem,"unselectable","").toLowerCase()=="on"){
return true;
}
else if(oElem.nodeType==1&&oElem.tagName!="BODY"){
return this._isUnselectable(oElem.parentNode);
}
else{
return false;
}
};






vp.studio.richtext.TextArea.prototype._handleLightTextColor=function $vpfn_XO8XP1KQVdk7DGH9CwcmpQ624$62()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var color=new vp.color.Color(this.getNodeStyle(this.contentEditableElement,"color"));

if(color&&color.getBrightness()>235)
{

this.setNodeStyle(this.$contentEditableElement.parent(),"background-color","#CCCCCC");
}
};

vp.studio.richtext.TextArea.PluginManager={
textArea:vp.studio.richtext.TextArea,
plugins:[],
Register:function $vpfn_rN$Tbfav3vEN7r8YsR3JDw638$14(plugin){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var key in plugin){
if(typeof(plugin[key])==='function'&&!key.match(/^_/)){
this.textArea.prototype[key]=plugin[key];
}
}
this.textArea.PluginManager.plugins.push(plugin);
}
};

(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw648$1()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var keyboardEventHandler=function $vpfn_1RyDDLFoDkRFPUD8nUm0Fw650$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var _me=this;

var _keyCodes={
BackSpace:8,
Enter:13,
Space:32,
ArrowLeft:37,
ArrowUp:38,
ArrowRight:39,
ArrowDown:40,
Delete:46,
A:65,
B:66,
C:67,
I:73,
K:75,
U:85,
V:86,
X:88
};

this._init=function $vpfn_aoRvFPhKsJGtFap6pZaOMQ673$21(textArea)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._textArea=textArea;
$(this._textArea.contentEditableElement).on({
"keydown":onKeyDownHandler,
"keypress":onKeyPressHandler,
"keyup":onKeyUpHandler
});
};





var onKeyPressHandler=function(e)
{
};




var onKeyDownHandler=function $vpfn_vlmBuf70SrP0NRILLl8XEw694$31(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);

if(e.ctrlKey&&!e.altKey)
{
switch(e.keyCode)
{
case _keyCodes.Bold:
vp.studio.commands.RichText.createAndExecute("font-weight","bold");
vp.events.cancel(e);
break;
case _keyCodes.Italic:
vp.studio.commands.RichText.createAndExecute("font-style","italic");
vp.events.cancel(e);
break;
case _keyCodes.C:
case _keyCodes.V:
case _keyCodes.X:
case _keyCodes.ArrowDown:
case _keyCodes.ArrowLeft:
case _keyCodes.ArrowUp:
case _keyCodes.ArrowRight:
setTimeout(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw717$35(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_me._textArea.onselectionchange.fire();
},10);
vp.events.cancelBubble(e);
break;
case _keyCodes.A:
vp.events.cancelBubble(e);
break;
case _keyCodes.K:
case _keyCodes.U:
vp.events.cancelEvent(e);
break;

default:
if(!document.all)
{
vp.events.fireEvent(document,"keydown",e);
}
break;
}
}
else if(e.keyCode==_keyCodes.Delete||e.keyCode==_keyCodes.BackSpace)
{
vp.events.cancelBubble(e);
}
else if(e.keyCode>=_keyCodes.ArrowLeft&&e.keyCode<=_keyCodes.ArrowDown)
{
setTimeout(function $vpfn_rN$Tbfav3vEN7r8YsR3JDw744$27(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_me._textArea.onselectionchange.fire();
},10);
vp.events.cancelBubble(e);
}
};






var onKeyUpHandler=function $vpfn_k2tBw4qWXEv5tB1rjMeARQ756$29(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);



switch(e.keyCode)
{
case _keyCodes.Enter:
var html=_me._textArea.$contentEditableElement.html();
_me._textArea.$contentEditableElement.convertDivsToP();
if(_me._textArea.$contentEditableElement.html()!==html)
{

vp.studio.richtext.util.moveCursorToEndOfElement(_me._textArea.contentEditableElement);
}
break;
case _keyCodes.BackSpace:
case _keyCodes.Delete:
break;
default:
break;
}

};
};
vp.studio.richtext.TextArea.PluginManager.Register(keyboardEventHandler);
})();
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}



vp.define("vp.studio.richtext");

vp.studio.richtext.commands=function $vpfn_fg6wN7e8EkNegVu8KYVfQg7$30()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var createAndExecute=function $vpfn_JQxEfdI0kskQ2gNgv7eGZg9$27(commandName,attr,range)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var commandToExecute;
var currentSelectionNode;


if(range)
{
if(range.isCollapsed)
{
return;
}
currentSelectionNode=range.startContainer;
}
else
{
var selection=rangy.getSelection();
if(selection.isCollapsed)
{
return;
}
var selectedRange=selection.getAllRanges()[0];
currentSelectionNode=selectedRange.startContainer;
}

var contentEditableParent=$(currentSelectionNode).is(":block")?
$(currentSelectionNode).closest("[contentEditable='true']"):
$(currentSelectionNode).parents("[contentEditable='true']");

var contentEditableContainer=contentEditableParent.get(0);
var options={contentEditableElement:contentEditableContainer};
switch(attr.type)
{
case"inline":
commandToExecute=function $vpfn_SJGAfar6Z0OWlhU$tZNC1w43$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_.extend(options,{
tagName:attr.elementTagName,
properties:attr.elementProperties
});

return range?rangy.toggleRange(range,options):rangy.toggleSelection(options);
};

break;
case"block":
commandToExecute=function $vpfn_SJGAfar6Z0OWlhU$tZNC1w55$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_.extend(options,{
tagName:attr.elementTagName,
attr:attr.elementProperties
});
return range?rangy.toggleSurroundRange(range,options):rangy.toggleSurroundSelection(options,contentEditableContainer);
};
break;
case"complex":
commandToExecute=function $vpfn_SJGAfar6Z0OWlhU$tZNC1w65$35()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_.extend(options,{tagName:attr.setElementTagName});
return range?rangy.toggleSurroundRangeSet(range,options):rangy.toggleSurroundSelectionSet(options,contentEditableContainer);
};
break;
default:
throw new Error("Unknown command type");
}
commandToExecute();
};

var commandsLookup={
makeBold:{
elementTagName:"span",
className:"bold",
elementProperties:{style:"font-weight: bold;"},
type:"inline"
},
makeItalic:{
elementTagName:"span",
className:"italic",
elementProperties:{style:"font-style: italic;"},
type:"inline"
},
changeColor:{
elementTagName:"span",
className:"color",
elementProperties:{style:"color: $$$;"},
acceptsParams:true,
type:"inline"
},
changeFont:{
elementTagName:"span",
className:"fontFamily",
elementProperties:{style:"font-family: $$$;"},
acceptsParams:true,
type:"inline"
},
changeFontSize:{
elementTagName:"span",
className:"fontSize",
elementProperties:{style:"font-size: $$$;"},
acceptsParams:true,
type:"inline"
},
leftAlign:{
elementTagName:"p",
elementProperties:{style:"text-align: left;"},
type:"block"
},
centerAlign:{
elementTagName:"p",
elementProperties:{style:"text-align: center;"},
type:"block"
},
rightAlign:{
elementTagName:"p",
elementProperties:{style:"text-align: right;"},
type:"block"
},
createOrderedList:{
elementTagName:"li",
setElementTagName:"ol",
type:"complex"
},
createUnorderedList:{
elementTagName:"li",
setElementTagName:"ul",
type:"complex"
}
};

this.execute=function $vpfn_b2rN_$VMeTWhqY86AECqHQ138$19(commandName,param,range)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var command=commandsLookup[commandName];
if(command)
{
var cmd={};

if(command.acceptsParams)
{
cmd=$.extend(true,{},command);
for(var item in cmd.elementProperties)
{
cmd.elementProperties[item]=cmd.elementProperties[item].replace("$$$",param);
}
}else
{
cmd=command;
}
createAndExecute(commandName,cmd,range);
}
};

return this;
}();
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








vp.studio.richtext.StateDetector=function $vpfn_0f77YqjQmwA0dJhajvAfkQ10$35(sProperty)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




this.property=sProperty;
this.supportedTypes=[];

this.isDisabled=function $vpfn_JRoqId5pE6_7$6XH9Z7Q9A19$22()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!this.supportedTypes.length)
{

return!Editor.selection.containsType(DOCITEM_TYPE_TEXT);
}

return!_.any(this.supportedTypes,function $vpfn_OQU1wQgoCf3Z5Z0l9MD5Lw27$42(supportedType)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return Editor.selection.containsType(supportedType);
});
};
};







vp.studio.richtext.ValueStateDetector=function $vpfn_Pg38bQ1WHPPuQUBx9JEUWA40$40(sProperty)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.richtext.StateDetector;
this.inheritFrom(sProperty);

this.getValue=function $vpfn_Gi7xmdqIyti9_k8oNzVx9A50$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValue=null;
var hasSameValue=true;

var nodes=vp.studio.richtext.util.getSelectedTextNodes(true);
if(nodes.length)
{

var nodesWithStyle=nodes.getSelfOrParentWithStyle({styleName:this.property});

if(nodes.length===nodesWithStyle.length)
{
styleValue=nodesWithStyle.first().getStyles()[this.property];

nodesWithStyle.each(function $vpfn_OQU1wQgoCf3Z5Z0l9MD5Lw65$36()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
hasSameValue=$(this).getStyles()[me.property]===styleValue;
return hasSameValue;
});

if(hasSameValue&&styleValue)
{
return vp.studio.richtext.cleanupStyle(this.property,styleValue);
}
return null;
}
return styleValue;
}else
{
return Editor.selection.getStyleArray(vp.studio.richtext.util.getDocumentItemPropertyName(me.property))[0];
}
};
};










vp.studio.richtext.MultiStateDetector=function $vpfn_HFHkczx8r8kDfCtnW8Ql0w94$40(sProperty,sOnValue,sOffValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.inheritFrom=vp.studio.richtext.StateDetector;
this.inheritFrom(sProperty);





this.onValue=sOnValue;





this.offValue=sOffValue;

if(sProperty==="unorderedList")
{
this.listTagName=tagName.UL;
}else if(sProperty==="orderedList")
{
this.listTagName=tagName.OL;
}


var isApplied=function $vpfn_p0AImNwHkN6OYDdt$dXXsA125$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var nodes=vp.studio.richtext.util.getSelectedTextNodes(true);
if(nodes.length)
{
if(me.listTagName)
{

return nodes.listSurrounded({singleList:true,tagName:me.listTagName});
}else
{
var nodesWithStyleValue=nodes.getSelfOrParentWithStyleValue({styleName:me.property,styleValue:me.onValue});
return nodesWithStyleValue.length!==0;
}
}else
{
var styleName=vp.studio.richtext.util.getDocumentItemPropertyName(me.property);
if(styleName)
{
var styleValue=Editor.selection.getStyleArray(styleName)[0];
return styleValue===me.onValue;
}
}
};

this.getState=function $vpfn_E3LqVH8PwUHNcJBFa6$YRA151$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.getValue();
};

this.getValue=function $vpfn_Gi7xmdqIyti9_k8oNzVx9A156$20()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return isApplied()?STATE_ON:STATE_OFF;
};
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}






vp.define("vp.studio.commands");
vp.studio.commands.RichText=function $vpfn_pa2GkIu1u4yzSuRvxVvVxw9$30(commandName,commandValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;
this.commandName=commandName;
this.commandValue=commandValue;

var alignmentLookup={
left:"leftAlign",
center:"centerAlign",
right:"rightAlign"
};

var commandLookup={
"font-weight":"makeBold",
"font-style":"makeItalic",
"font-family":"changeFont",
"font-size":"changeFontSize",
color:"changeColor",
"text-align":alignmentLookup[me.commandValue],
"orderedList":"createOrderedList",
"unorderedList":"createUnorderedList"
};

this.initialValue=null;
this.finalValue=null;



var selectedTextFields=vp.studio.richtext.util.getSelectedTextFields();
var selectedWordArtFields=vp.studio.richtext.util.getSelectedWordArtFields();
var selectedTableFields=vp.studio.richtext.util.getSelectedTableFields();

var isAlignmentCommand=me.commandName.match(/align$/)!==null;
var isListCommand=me.commandName.match(/List$/)!==null;

var applyRichTextCommand=function $vpfn_kbdHu2rMFePSMPxVnqXb4Q44$31(textArea,range)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var command=commandLookup[me.commandName];
if(!command)
{
throw"Invalid Command: "+me.commandName;
}

var value=textArea.styleManager.serializeStyleValue(me.commandName,me.commandValue);
vp.studio.richtext.commands.execute(command,value,range);
};

var applyToUserSelection=function $vpfn_R4eCSlCjGfBR$TYmZn4myg56$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




if(isAlignmentCommand&&vp.studio.richtext.util.userSelectionIsInList())
{
applyToContentEditable(selectedTextFields[0]);
return;
}
var textArea=selectedTextFields[0].getActiveTextArea();
applyRichTextCommand(textArea);
};






var applyToContentEditable=function $vpfn_d6pFiSkXU2O4iPhVZijKKg76$33(textField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var textArea=textField.getActiveTextArea();
var styleValue=textArea.getStyles(me.commandName);


textArea.setStyleSimple(me.commandName,getStyleValue(styleValue),true);
};

var getStyleValue=function $vpfn_1WH_VcRcoSs8$EH$P3DDXA85$24(currentValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var value=me.commandValue;
if(currentValue===value&&(me.commandName==="font-weight"||me.commandName==="font-style"))
{
value="normal";
}
return vp.studio.richtext.cleanupStyle(me.commandName,value);
};

var applyToTextFields=function $vpfn_3HoNCRmbqFcpQnKcyQhz3A95$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
_.each(selectedTextFields,function $vpfn_JPvsOn1D0MDR0t$Vp7lsLA97$35(textField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(isListCommand)
{

var textArea=textField.getActiveTextArea();
var contentEditable=textArea.$contentEditableElement;
if(contentEditable.text()!=="")
{
var range=rangy.createRangyRange();
range.selectNodeContents(contentEditable.get(0));
applyRichTextCommand(textArea,range);
}
}else
{
applyToContentEditable(textField);
}
});

var styleName=vp.studio.richtext.util.getDocumentItemPropertyName(me.commandName);

_.each(selectedWordArtFields,function $vpfn_JPvsOn1D0MDR0t$Vp7lsLA118$38(textField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValue=textField.getStyles()[styleName];
textField.setStyle(styleName,getStyleValue(styleValue));
});

_.each(selectedTableFields,function $vpfn_JPvsOn1D0MDR0t$Vp7lsLA124$36(tableField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValue=tableField[styleName];
tableField.setStyle(styleName,getStyleValue(styleValue));
});
};




this.execute=function $vpfn_koK8ciTT1cJaX1a4psIRTw134$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(Editor&&Editor.selection)
{

var selection=rangy.getSelection();
(selection.isCollapsed||!vp.studio.richtext.util.isValidSelection())?applyToTextFields():applyToUserSelection();


_.each(selectedTextFields,function $vpfn_JPvsOn1D0MDR0t$Vp7lsLA143$39(textField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

textField.getActiveTextArea().refresh(null,true);
});
}
};
this.isVoid=function $vpfn_$xLejCSN$utFLp3nTFB$ow150$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return false;
};





this.getInfo=function $vpfn__f5oKqygisOGahgfNiYkGQ160$19()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oInfo=new vp.studio.LogInfo(me.commandName);
oInfo.setItem("property",this.property);
oInfo.setArray("initial",this.initialValues);
oInfo.setArray("final",this.finalValues);
return oInfo;
};
};




vp.studio.commands.RichText.createAndExecute=function $vpfn_kpe7PqKVl8wHyDR6pabFMg173$47(commandName,commandValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!(Editor&&Editor.selection))
{
return null;
}

var command=new vp.studio.commands.RichText(commandName,commandValue);
var result=command.execute();
return command;
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}/*! 
 * @license Rangy, a cross-browser JavaScript range and selection library 
 * http://code.google.com/p/rangy/ 
 * 
 * Copyright 2011, Tim Down 
 * Licensed under the MIT license. 
 * Version: 1.2.2 
 * Build date: 13 November 2011 
 */

var rangy=(function $vpfn_ej3mp2EBpZazz6mYG7C2tg11$13(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";

var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed",
"commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];

var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore",
"setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents",
"extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];

var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];


var textRangeMethods=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark",
"moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];





function isHostMethod(o,p){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var t=typeof o[p];
return t==FUNCTION||(!!(t==OBJECT&&o[p]))||t=="unknown";
}isHostMethod._vpfn='$vpfn_Wf1pzIpzRSgle$1mt8f3Bg33$4';

function isHostObject(o,p){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!!(typeof o[p]==OBJECT&&o[p]);
}isHostObject._vpfn='$vpfn_oKxYDAQy2oabPSP3NLPuSA38$4';

function isHostProperty(o,p){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return typeof o[p]!=UNDEFINED;
}isHostProperty._vpfn='$vpfn_qWAQwg9BXcQoF7_1nVZ3gA42$4';


function createMultiplePropertyTest(testFunc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg48$15(o,props){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i=props.length;
while(i--){
if(!testFunc(o,props[i])){
return false;
}
}
return true;
};
}createMultiplePropertyTest._vpfn='$vpfn_M6hAGeoN1oACxQgRnT_0Og47$4';


var areHostMethods=createMultiplePropertyTest(isHostMethod);
var areHostObjects=createMultiplePropertyTest(isHostObject);
var areHostProperties=createMultiplePropertyTest(isHostProperty);

function isTextRange(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties);
}isTextRange._vpfn='$vpfn__CS_B5VkbPDoOZMuQSLYdw64$4';

var api={
version:"1.2.2",
initialized:false,
supported:true,

util:{
isHostMethod:isHostMethod,
isHostObject:isHostObject,
isHostProperty:isHostProperty,
areHostMethods:areHostMethods,
areHostObjects:areHostObjects,
areHostProperties:areHostProperties,
isTextRange:isTextRange
},

features:{},

modules:{},
config:{
alertOnWarn:false,
preferTextRange:false
}
};

function fail(reason){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
window.alert("Rangy not supported in your browser. Reason: "+reason);
api.initialized=true;
api.supported=false;
}fail._vpfn='$vpfn_ryUaR0la9VWfpvkgEq_Udg92$4';

api.fail=fail;

function warn(msg){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var warningMessage="Rangy warning: "+msg;
if(api.config.alertOnWarn){
window.alert(warningMessage);
}else if(typeof window.console!=UNDEFINED&&typeof window.console.log!=UNDEFINED){
window.console.log(warningMessage);
}
}warn._vpfn='$vpfn_B2n_FwpU7JKGKedCsujbkg100$4';

api.warn=warn;

if({}.hasOwnProperty){
api.util.extend=function $vpfn_r_X9g5B4dKt2Y9X12LynYw112$26(o,props){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i in props){
if(props.hasOwnProperty(i)&&i!=="style"){
o[i]=props[i];
}
else if(i==="style")
{
o.style.cssText=props.style.cssText;
}
}
};
}else{
fail("hasOwnProperty not supported");
}

var initListeners=[];
var moduleInitializers=[];


function init(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(api.initialized){
return;
}
var testRange;
var implementsDomRange=false,implementsTextRange=false;



if(isHostMethod(document,"createRange")){
testRange=document.createRange();
if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){
implementsDomRange=true;
}
testRange.detach();
}

var body=isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0];

if(body&&isHostMethod(body,"createTextRange")){
testRange=body.createTextRange();
if(isTextRange(testRange)){
implementsTextRange=true;
}
}

if(!implementsDomRange&&!implementsTextRange){
fail("Neither Range nor TextRange are implemented");
}

api.initialized=true;
api.features={
implementsDomRange:implementsDomRange,
implementsTextRange:implementsTextRange
};


var allListeners=moduleInitializers.concat(initListeners);
for(var i=0,len=allListeners.length;i<len;++i){
try{
allListeners[i](api);
}catch(ex){
if(isHostObject(window,"console")&&isHostMethod(window.console,"log")){
window.console.log("Init listener threw an exception. Continuing.",ex);
}

}
}
}init._vpfn='$vpfn_kv8pkiwAkD8U$1xyDZnJGg131$4';


api.init=init;


api.addInitListener=function $vpfn_KUDuvHPkalOdc$kezBBH0w185$26(listener){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(api.initialized){
listener(api);
}else{
initListeners.push(listener);
}
};

var createMissingNativeApiListeners=[];

api.addCreateMissingNativeApiListener=function $vpfn_Sz9bpon05cLfdXK1zTQZ7g195$44(listener){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
createMissingNativeApiListeners.push(listener);
};

function createMissingNativeApi(win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
win=win||window;
init();


for(var i=0,len=createMissingNativeApiListeners.length;i<len;++i){
createMissingNativeApiListeners[i](win);
}
}createMissingNativeApi._vpfn='$vpfn_BsImpD_2hPK_rn1axL_diA199$4';

api.createMissingNativeApi=createMissingNativeApi;




function Module(name){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.name=name;
this.initialized=false;
this.supported=false;
}Module._vpfn='$vpfn_BMrUnz1C9KqimSMl8SZUJw214$4';

Module.prototype.fail=function $vpfn_iuHzTzg24As3p_l2a4g6RA220$28(reason){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.initialized=true;
this.supported=false;

throw new Error("Module '"+this.name+"' failed to load: "+reason);
};

Module.prototype.warn=function $vpfn_DHE9cVerS$NVMjtNz4ypqQ227$28(msg){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.warn("Module "+this.name+": "+msg);
};

Module.prototype.createError=function $vpfn_dXi008QWbjk9OtimWlJbHA231$35(msg){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new Error("Error in Rangy "+this.name+" module: "+msg);
};

api.createModule=function $vpfn_pTtSuKRKn0$vCXKz67mSzw235$23(name,initFunc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var module=new Module(name);
api.modules[name]=module;

moduleInitializers.push(function $vpfn_ej3mp2EBpZazz6mYG7C2tg239$32(api){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
initFunc(api,module);
module.initialized=true;
module.supported=true;
});
};

api.requireModules=function $vpfn_2HfQdy5tpHVCRXKRc6isGQ246$25(modules){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0,len=modules.length,module,moduleName;i<len;++i){
moduleName=modules[i];
module=api.modules[moduleName];
if(!module||!(module instanceof Module)){
throw new Error("Module '"+moduleName+"' not found");
}
if(!module.supported){
throw new Error("Module '"+moduleName+"' not supported");
}
}
};





var docReady=false;

var loadHandler=function $vpfn_Nmsbx6ukz23X2wEaNNPGQQ265$22(e){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(!docReady){
docReady=true;
if(!api.initialized){
init();
}
}
};


if(typeof window==UNDEFINED){
fail("No window found");
return;
}
if(typeof document==UNDEFINED){
fail("No document found");
return;
}

if(isHostMethod(document,"addEventListener")){
document.addEventListener("DOMContentLoaded",loadHandler,false);
}


if(isHostMethod(window,"addEventListener")){
window.addEventListener("load",loadHandler,false);
}else if(isHostMethod(window,"attachEvent")){
window.attachEvent("onload",loadHandler);
}else{
fail("Window does not have required addEventListener or attachEvent method");
}

return api;
})();
rangy.createModule("DomUtil",function $vpfn_ej3mp2EBpZazz6mYG7C2tg300$30(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var UNDEF="undefined";
var util=api.util;


if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){
module.fail("document missing a Node creation method");
}

if(!util.isHostMethod(document,"getElementsByTagName")){
module.fail("document missing getElementsByTagName method");
}

var el=document.createElement("div");
if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||
!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){
module.fail("Incomplete Element implementation");
}


if(!util.isHostProperty(el,"innerHTML")){
module.fail("Element is missing innerHTML property");
}

var textNode=document.createTextNode("test");
if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||
!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||
!util.areHostProperties(textNode,["data"]))){
module.fail("Incomplete Text Node implementation");
}






var arrayContains


=

function $vpfn_Ox0iR1PYEkcTKIEo5mz29A342$8(arr,val){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i=arr.length;
while(i--){
if(arr[i]===val){
return true;
}
}
return false;
};


function isHtmlNamespace(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ns;
return typeof node.namespaceURI==UNDEF||((ns=node.namespaceURI)===null||ns=="http://www.w3.org/1999/xhtml");
}isHtmlNamespace._vpfn='$vpfn_N1bqiZzXZWp9YwonzUxj2Q353$4';

function parentElement(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent=node.parentNode;
return(parent.nodeType==1)?parent:null;
}parentElement._vpfn='$vpfn_9Z6r1hzWBEBaqgjaY4$4Jg358$4';

function getNodeIndex(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i=0;
while((node=node.previousSibling)){
i++;
}
return i;
}getNodeIndex._vpfn='$vpfn_T3ZpXsg60xlq1vYS37SdZA363$4';

function getNodeLength(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var childNodes;
return isCharacterDataNode(node)?node.length:((childNodes=node.childNodes)?childNodes.length:0);
}getNodeLength._vpfn='$vpfn_fioZVJ7jhA_yxhT$7caMhQ371$4';

function getCommonAncestor(node1,node2){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ancestors=[],n;
for(n=node1;n;n=n.parentNode){
ancestors.push(n);
}

for(n=node2;n;n=n.parentNode){
if(arrayContains(ancestors,n)){
return n;
}
}

return null;
}getCommonAncestor._vpfn='$vpfn_0Q3ksnrGdMr2_fuTnMmBEA376$4';

function isAncestorOf(ancestor,descendant,selfIsAncestor){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var n=selfIsAncestor?descendant:descendant.parentNode;
while(n){
if(n===ancestor){
return true;
}else{
n=n.parentNode;
}
}
return false;
}isAncestorOf._vpfn='$vpfn_HTHteDfXqEG1fa8LGj$BNg391$4';

function getClosestAncestorIn(node,ancestor,selfIsAncestor){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var p,n=selfIsAncestor?node:node.parentNode;
while(n){
p=n.parentNode;
if(p===ancestor){
return n;
}
n=p;
}
return null;
}getClosestAncestorIn._vpfn='$vpfn_adMkhJ6nZUG5GltD8Qu9fQ403$4';

function isCharacterDataNode(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var t=node.nodeType;
return t==3||t==4||t==8;
}isCharacterDataNode._vpfn='$vpfn_apAA0IH8ZeETc8vzCtC7Hw415$4';

function insertAfter(node,precedingNode){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;
if(nextNode){
parent.insertBefore(node,nextNode);
}else{
parent.appendChild(node);
}
return node;
}insertAfter._vpfn='$vpfn_dA2OWg44MqeEc3SlEme9Bg420$4';


function splitDataNode(node,index){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newNode=node.cloneNode(false);
newNode.deleteData(0,index);
node.deleteData(index,node.length-index);
insertAfter(newNode,node);
return newNode;
}splitDataNode._vpfn='$vpfn_tAzKrnTlQ4iwxTAcTfMvxg431$4';

function getDocument(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(node.nodeType==9){
return node;
}else if(typeof node.ownerDocument!=UNDEF){
return node.ownerDocument;
}else if(typeof node.document!=UNDEF){
return node.document;
}else if(node.parentNode){
return getDocument(node.parentNode);
}else{
throw new Error("getDocument: no document found for node");
}
}getDocument._vpfn='$vpfn_0xmCdUr7j43pRvltsL8E$g439$4';

function getWindow(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var doc=getDocument(node);
if(typeof doc.defaultView!=UNDEF){
return doc.defaultView;
}else if(typeof doc.parentWindow!=UNDEF){
return doc.parentWindow;
}else{
throw new Error("Cannot get a window object for node");
}
}getWindow._vpfn='$vpfn_O3DY8bKU180pLt74qPLK4A453$4';

function getIframeDocument(iframeEl){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof iframeEl.contentDocument!=UNDEF){
return iframeEl.contentDocument;
}else if(typeof iframeEl.contentWindow!=UNDEF){
return iframeEl.contentWindow.document;
}else{
throw new Error("getIframeWindow: No Document object found for iframe element");
}
}getIframeDocument._vpfn='$vpfn_aKLef49SBajbOUTLmrJ4Dw464$4';

function getIframeWindow(iframeEl){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof iframeEl.contentWindow!=UNDEF){
return iframeEl.contentWindow;
}else if(typeof iframeEl.contentDocument!=UNDEF){
return iframeEl.contentDocument.defaultView;
}else{
throw new Error("getIframeWindow: No Window object found for iframe element");
}
}getIframeWindow._vpfn='$vpfn_TipiPm_4qblUc5Ajw4WmPw474$4';

function getBody(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return util.isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0];
}getBody._vpfn='$vpfn_AbrRyacTMjHevfz8FB10aQ484$4';

function getRootContainer(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent;
while((parent=node.parentNode)){
node=parent;
}
return node;
}getRootContainer._vpfn='$vpfn_YXbh6cgUtemYnAG9lMmUnA488$4';

function comparePoints(nodeA,offsetA,nodeB,offsetB){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var nodeC,root,childA,childB,n;
if(nodeA==nodeB){


return offsetA===offsetB?0:(offsetA<offsetB)?-1:1;
}else if((nodeC=getClosestAncestorIn(nodeB,nodeA,true))){


return offsetA<=getNodeIndex(nodeC)?-1:1;
}else if((nodeC=getClosestAncestorIn(nodeA,nodeB,true))){


return getNodeIndex(nodeC)<offsetB?-1:1;
}else{


root=getCommonAncestor(nodeA,nodeB);
childA=(nodeA===root)?root:getClosestAncestorIn(nodeA,root,true);
childB=(nodeB===root)?root:getClosestAncestorIn(nodeB,root,true);

if(childA===childB){


throw new Error("comparePoints got to case 4 and childA and childB are the same!");
}else{
n=root.firstChild;
while(n){
if(n===childA){
return-1;
}else if(n===childB){
return 1;
}
n=n.nextSibling;
}
throw new Error("Should not be here!");
}
}
}comparePoints._vpfn='$vpfn_cd$uR8lnOfG7eQDfaPrkew496$4';

function fragmentFromNodeChildren(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var fragment=getDocument(node).createDocumentFragment(),child;
while((child=node.firstChild)){
fragment.appendChild(child);
}
return fragment;
}fragmentFromNodeChildren._vpfn='$vpfn_SoCdSm3_0npYV_umboU9og537$4';

function inspectNode(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!node){
return"[No node]";
}
if(isCharacterDataNode(node)){
return'"'+node.data+'"';
}else if(node.nodeType==1){
var idAttr=node.id?' id="'+node.id+'"':"";
return"<"+node.nodeName+idAttr+">["+node.childNodes.length+"]";
}else{
return node.nodeName;
}
}inspectNode._vpfn='$vpfn_l5$9NtsdyYiI6GonCMD_Nw545$4';




function NodeIterator(root){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.root=root;
this._next=root;
}NodeIterator._vpfn='$vpfn_WSx5kQwPQRlTEP0U$sPGVQ562$4';

NodeIterator.prototype={
_current:null,

hasNext:function $vpfn_ej3mp2EBpZazz6mYG7C2tg570$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!!this._next;
},

next:function $vpfn_ej3mp2EBpZazz6mYG7C2tg574$14(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var n=this._current=this._next;
var child,next;
if(this._current){
child=n.firstChild;
if(child){
this._next=child;
}else{
next=null;
while((n!==this.root)&&!(next=n.nextSibling)){
n=n.parentNode;
}
this._next=next;
}
}
return this._current;
},

detach:function $vpfn_ej3mp2EBpZazz6mYG7C2tg592$16(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._current=this._next=this.root=null;
}
};

function createIterator(root){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new NodeIterator(root);
}createIterator._vpfn='$vpfn_HEaSVQy7XSjn12JLkOAo7g597$4';




function DomPosition(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.node=node;
this.offset=offset;
}DomPosition._vpfn='$vpfn_9pomsJwwIMJpsOvkPdF_pg604$4';

DomPosition.prototype={
equals:function $vpfn_ej3mp2EBpZazz6mYG7C2tg610$16(pos){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.node===pos.node&this.offset==pos.offset;
},

inspect:function $vpfn_ej3mp2EBpZazz6mYG7C2tg614$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]";
}
};




function DOMException(codeName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.code=this[codeName];
this.codeName=codeName;
this.message="DOMException: "+this.codeName;
}DOMException._vpfn='$vpfn_AkMqPfU3imNZZw9vArB23g622$4';

DOMException.prototype={
INDEX_SIZE_ERR:1,
HIERARCHY_REQUEST_ERR:3,
WRONG_DOCUMENT_ERR:4,
NO_MODIFICATION_ALLOWED_ERR:7,
NOT_FOUND_ERR:8,
NOT_SUPPORTED_ERR:9,
INVALID_STATE_ERR:11
};

DOMException.prototype.toString=function $vpfn_3kO8Ek1NTFoEJ9$NHflZfA638$38(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.message;
};

api.dom={
arrayContains:arrayContains,
isHtmlNamespace:isHtmlNamespace,
parentElement:parentElement,
getNodeIndex:getNodeIndex,
getNodeLength:getNodeLength,
getCommonAncestor:getCommonAncestor,
isAncestorOf:isAncestorOf,
getClosestAncestorIn:getClosestAncestorIn,
isCharacterDataNode:isCharacterDataNode,
insertAfter:insertAfter,
splitDataNode:splitDataNode,
getDocument:getDocument,
getWindow:getWindow,
getIframeWindow:getIframeWindow,
getIframeDocument:getIframeDocument,
getBody:getBody,
getRootContainer:getRootContainer,
comparePoints:comparePoints,
inspectNode:inspectNode,
fragmentFromNodeChildren:fragmentFromNodeChildren,
createIterator:createIterator,
DomPosition:DomPosition
};

api.DOMException=DOMException;
});rangy.createModule("DomRange",function $vpfn_ej3mp2EBpZazz6mYG7C2tg668$34(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.requireModules(["DomUtil"]);


var dom=api.dom;
var DomPosition=dom.DomPosition;
var DOMException=api.DOMException;





function isNonTextPartiallySelected(node,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(node.nodeType!=3)&&
(dom.isAncestorOf(node,range.startContainer,true)||dom.isAncestorOf(node,range.endContainer,true));
}isNonTextPartiallySelected._vpfn='$vpfn_xcDmHWLlM4gx5700HputnQ680$4';

function getRangeDocument(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return dom.getDocument(range.startContainer);
}getRangeDocument._vpfn='$vpfn_Qc5UTocs89LUbJ9KBc3TZQ685$4';

function dispatchEvent(range,type,args){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var listeners=range._listeners[type];
if(listeners){
for(var i=0,len=listeners.length;i<len;++i){
listeners[i].call(range,{target:range,args:args});
}
}
}dispatchEvent._vpfn='$vpfn_rYPqvqJXZBa1$fGKeWPXBw689$4';

function getBoundaryBeforeNode(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new DomPosition(node.parentNode,dom.getNodeIndex(node));
}getBoundaryBeforeNode._vpfn='$vpfn_UlU6YKRhyPnATtNSE769WA698$4';

function getBoundaryAfterNode(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new DomPosition(node.parentNode,dom.getNodeIndex(node)+1);
}getBoundaryAfterNode._vpfn='$vpfn_ooWZ8SKV8Ww8LlRxsuEMbg702$4';

function insertNodeAtPosition(node,n,o){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var firstNodeInserted=node.nodeType==11?node.firstChild:node;
if(dom.isCharacterDataNode(n)){
if(o==n.length){
dom.insertAfter(node,n);
}else{
n.parentNode.insertBefore(node,o==0?n:dom.splitDataNode(n,o));
}
}else if(o>=n.childNodes.length){
n.appendChild(node);
}else{
n.insertBefore(node,n.childNodes[o]);
}
return firstNodeInserted;
}insertNodeAtPosition._vpfn='$vpfn_No4uX1IqpUmeJuBM7hyW6g706$4';

function cloneSubtree(iterator){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var partiallySelected;
for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){
partiallySelected=iterator.isPartiallySelectedSubtree();

node=node.cloneNode(!partiallySelected);
if(partiallySelected){
subIterator=iterator.getSubtreeIterator();
node.appendChild(cloneSubtree(subIterator));
subIterator.detach(true);
}

if(node.nodeType==10){
throw new DOMException("HIERARCHY_REQUEST_ERR");
}
frag.appendChild(node);
}
return frag;
}cloneSubtree._vpfn='$vpfn_k4W0u2v0C03n2oL5BzwXYg722$4';

function iterateSubtree(rangeIterator,func,iteratorState){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var it,n;
iteratorState=iteratorState||{stop:false};
for(var node,subRangeIterator;node=rangeIterator.next();){

if(rangeIterator.isPartiallySelectedSubtree()){


if(func(node)===false){
iteratorState.stop=true;
return;
}else{
subRangeIterator=rangeIterator.getSubtreeIterator();
iterateSubtree(subRangeIterator,func,iteratorState);
subRangeIterator.detach(true);
if(iteratorState.stop){
return;
}
}
}else{


it=dom.createIterator(node);
while((n=it.next())){
if(func(n)===false){
iteratorState.stop=true;
return;
}
}
}
}
}iterateSubtree._vpfn='$vpfn_TSuDdlrFQw7cb0USatJR4A742$4';

function deleteSubtree(iterator){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var subIterator;
while(iterator.next()){
if(iterator.isPartiallySelectedSubtree()){
subIterator=iterator.getSubtreeIterator();
deleteSubtree(subIterator);
subIterator.detach(true);
}else{
iterator.remove();
}
}
}deleteSubtree._vpfn='$vpfn_QoiUzZXwM2Sg8CXjz8SYSg775$4';

function extractSubtree(iterator){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){


if(iterator.isPartiallySelectedSubtree()){
node=node.cloneNode(false);
subIterator=iterator.getSubtreeIterator();
node.appendChild(extractSubtree(subIterator));
subIterator.detach(true);
}else{
iterator.remove();
}
if(node.nodeType==10){
throw new DOMException("HIERARCHY_REQUEST_ERR");
}
frag.appendChild(node);
}
return frag;
}extractSubtree._vpfn='$vpfn_FAudCOdyDnt1C7kjdTNORg788$4';

function getNodesInRange(range,nodeTypes,filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;
var filterExists=!!filter;
if(filterNodeTypes){
regex=new RegExp("^("+nodeTypes.join("|")+")$");
}

var nodes=[];
iterateSubtree(new RangeIterator(range,false),function $vpfn_ej3mp2EBpZazz6mYG7C2tg818$56(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){
nodes.push(node);
}
});
return nodes;
}getNodesInRange._vpfn='$vpfn_eHp4CZNpf30C5tpJuD2Szg809$4';

function inspect(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var name=(typeof range.getName=="undefined")?"Range":range.getName();
return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+
dom.inspectNode(range.endContainer)+":"+range.endOffset+")]";
}inspect._vpfn='$vpfn_R9TgNvd93E4BtZ6yeDq7gg826$4';








function RangeIterator(range,clonePartiallySelectedTextNodes){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.range=range;
this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;



if(!range.collapsed){
this.sc=range.startContainer;
this.so=range.startOffset;
this.ec=range.endContainer;
this.eo=range.endOffset;
var root=range.commonAncestorContainer;

if(this.sc===this.ec&&dom.isCharacterDataNode(this.sc)){
this.isSingleCharacterDataNode=true;
this._first=this._last=this._next=this.sc;
}else{
this._first=this._next=(this.sc===root&&!dom.isCharacterDataNode(this.sc))?
this.sc.childNodes[this.so]:dom.getClosestAncestorIn(this.sc,root,true);
this._last=(this.ec===root&&!dom.isCharacterDataNode(this.ec))?
this.ec.childNodes[this.eo-1]:dom.getClosestAncestorIn(this.ec,root,true);
}

}
}RangeIterator._vpfn='$vpfn_zx6$N1mRXs5vLcqV71hnVg839$4';

RangeIterator.prototype={
_current:null,
_next:null,
_first:null,
_last:null,
isSingleCharacterDataNode:false,

reset:function $vpfn_ej3mp2EBpZazz6mYG7C2tg872$15(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._current=null;
this._next=this._first;
},

hasNext:function $vpfn_ej3mp2EBpZazz6mYG7C2tg877$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!!this._next;
},

next:function $vpfn_ej3mp2EBpZazz6mYG7C2tg881$14(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var current=this._current=this._next;
if(current){
this._next=(current!==this._last)?current.nextSibling:null;


if(dom.isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){
if(current===this.ec){

(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo);
}
if(this._current===this.sc){

(current=current.cloneNode(true)).deleteData(0,this.so);
}
}
}

return current;
},

remove:function $vpfn_ej3mp2EBpZazz6mYG7C2tg903$16(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var current=this._current,start,end;

if(dom.isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){
start=(current===this.sc)?this.so:0;
end=(current===this.ec)?this.eo:current.length;
if(start!=end){
current.deleteData(start,end-start);
}
}else{
if(current.parentNode){
current.parentNode.removeChild(current);
}else{

}
}
},


isPartiallySelectedSubtree:function $vpfn_ej3mp2EBpZazz6mYG7C2tg922$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var current=this._current;
return isNonTextPartiallySelected(current,this.range);
},

getSubtreeIterator:function $vpfn_ej3mp2EBpZazz6mYG7C2tg927$28(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var subRange;
if(this.isSingleCharacterDataNode){
subRange=this.range.cloneRange();
subRange.collapse();
}else{
subRange=new Range(getRangeDocument(this.range));
var current=this._current;
var startContainer=current,startOffset=0,endContainer=current,endOffset=dom.getNodeLength(current);

if(dom.isAncestorOf(current,this.sc,true)){
startContainer=this.sc;
startOffset=this.so;
}
if(dom.isAncestorOf(current,this.ec,true)){
endContainer=this.ec;
endOffset=this.eo;
}

updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset);
}
return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes);
},

detach:function $vpfn_ej3mp2EBpZazz6mYG7C2tg951$16(detachRange){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(detachRange){
this.range.detach();
}
this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null;
}
};








function RangeException(codeName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.code=this[codeName];
this.codeName=codeName;
this.message="RangeException: "+this.codeName;
}RangeException._vpfn='$vpfn_xMV_sUlcW1T3T0le3kiSyQ966$4';

RangeException.prototype={
BAD_BOUNDARYPOINTS_ERR:1,
INVALID_NODE_TYPE_ERR:2
};

RangeException.prototype.toString=function $vpfn_dCHTq1QDGk8eaFktybYeqA977$40(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.message;
};








function RangeNodeIterator(range,nodeTypes,filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nodes=getNodesInRange(range,nodeTypes,filter);
this._next=this.nodes[0];
this._position=0;
}RangeNodeIterator._vpfn='$vpfn_ULJNfo47HBchTAqB3aixaQ988$4';

RangeNodeIterator.prototype={
_current:null,

hasNext:function $vpfn_ej3mp2EBpZazz6mYG7C2tg997$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!!this._next;
},

next:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1001$14(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._current=this._next;
this._next=this.nodes[++this._position];
return this._current;
},

detach:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1007$16(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._current=this._next=this.nodes=null;
}
};

var beforeAfterNodeTypes=[1,3,4,5,7,8,10];
var rootContainerNodeTypes=[2,9,11];
var readonlyNodeTypes=[5,6,10,12];
var insertableNodeTypes=[1,3,4,5,7,8,10,11];
var surroundNodeTypes=[1,3,4,5,7,8];

function createAncestorFinder(nodeTypes){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg1019$15(node,selfIsAncestor){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var t,n=selfIsAncestor?node:node.parentNode;
while(n){
t=n.nodeType;
if(dom.arrayContains(nodeTypes,t)){
return n;
}
n=n.parentNode;
}
return null;
};
}createAncestorFinder._vpfn='$vpfn_6pvBy7BPFD5TlDsJ_KIUQA1018$4';

var getRootContainer=dom.getRootContainer;
var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);
var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);
var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);

function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(getDocTypeNotationEntityAncestor(node,allowSelf)){
throw new RangeException("INVALID_NODE_TYPE_ERR");
}
}assertNoDocTypeNotationEntityAncestor._vpfn='$vpfn_8sJdujfjAW8D_hFpzCiONA1037$4';

function assertNotDetached(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!range.startContainer){
throw new DOMException("INVALID_STATE_ERR");
}
}assertNotDetached._vpfn='$vpfn_yUBW13nxdZvODN4O8FrhGA1043$4';

function assertValidNodeType(node,invalidTypes){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!dom.arrayContains(invalidTypes,node.nodeType)){
throw new RangeException("INVALID_NODE_TYPE_ERR");
}
}assertValidNodeType._vpfn='$vpfn_CA50qdL$HCHMyj_Sokl0Uw1049$4';

function assertValidOffset(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(offset<0||offset>(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)){
throw new DOMException("INDEX_SIZE_ERR");
}
}assertValidOffset._vpfn='$vpfn_XrtSEMaalnGDnpeCsDno$w1055$4';

function assertSameDocumentOrFragment(node1,node2){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){
throw new DOMException("WRONG_DOCUMENT_ERR");
}
}assertSameDocumentOrFragment._vpfn='$vpfn_EwQ5$GQMUKxYVEGdGpj8jQ1061$4';

function assertNodeNotReadOnly(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(getReadonlyAncestor(node,true)){
throw new DOMException("NO_MODIFICATION_ALLOWED_ERR");
}
}assertNodeNotReadOnly._vpfn='$vpfn__QnUBudEgx6IIlU_TUJkig1067$4';

function assertNode(node,codeName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!node){
throw new DOMException(codeName);
}
}assertNode._vpfn='$vpfn_iwdI8wUMO4lcqNndMIheFQ1073$4';

function isOrphan(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!dom.arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,true);
}isOrphan._vpfn='$vpfn_ycIuQSQS5Z9Qq7gwsCldkQ1079$4';

function isValidOffset(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return offset<=(dom.isCharacterDataNode(node)?node.length:node.childNodes.length);
}isValidOffset._vpfn='$vpfn_lXcZKucX_kfHMJloRJufjQ1083$4';

function assertRangeValid(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(range);
if(isOrphan(range.startContainer)||isOrphan(range.endContainer)||
!isValidOffset(range.startContainer,range.startOffset)||
!isValidOffset(range.endContainer,range.endOffset)){
throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")");
}
}assertRangeValid._vpfn='$vpfn_PkGeip0Ik4NrYWHSKu2_xQ1087$4';




var styleEl=document.createElement("style");
var htmlParsingConforms=false;
try{
styleEl.innerHTML="<b>x</b>";
htmlParsingConforms=(styleEl.firstChild.nodeType==3);
}catch(e){

}

api.features.htmlParsingConforms=htmlParsingConforms;

var createContextualFragment=htmlParsingConforms?





function $vpfn_ej3mp2EBpZazz6mYG7C2tg1116$8(fragmentStr){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var node=this.startContainer;
var doc=dom.getDocument(node);



if(!node){
throw new DOMException("INVALID_STATE_ERR");
}



var el=null;


if(node.nodeType==1){
el=node;


}else if(dom.isCharacterDataNode(node)){
el=dom.parentElement(node);
}




if(el===null||(
el.nodeName=="HTML"
&&dom.isHtmlNamespace(dom.getDocument(el).documentElement)
&&dom.isHtmlNamespace(el)
)){



el=doc.createElement("body");
}else{
el=el.cloneNode(false);
}





el.innerHTML=fragmentStr;







return dom.fragmentFromNodeChildren(el);
}:



function $vpfn_ej3mp2EBpZazz6mYG7C2tg1173$8(fragmentStr){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);
var doc=getRangeDocument(this);
var el=doc.createElement("body");
el.innerHTML=fragmentStr;

return dom.fragmentFromNodeChildren(el);
};



var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed",
"commonAncestorContainer"];

var s2s=0,s2e=1,e2e=2,e2s=3;
var n_b=0,n_a=1,n_b_a=2,n_i=3;

function RangePrototype(){}

RangePrototype.prototype={
attachListener:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1193$24(type,listener){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this._listeners[type].push(listener);
},

compareBoundaryPoints:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1197$31(how,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertSameDocumentOrFragment(this.startContainer,range.startContainer);

var nodeA,offsetA,nodeB,offsetB;
var prefixA=(how==e2s||how==s2s)?"start":"end";
var prefixB=(how==s2e||how==s2s)?"start":"end";
nodeA=this[prefixA+"Container"];
offsetA=this[prefixA+"Offset"];
nodeB=range[prefixB+"Container"];
offsetB=range[prefixB+"Offset"];
return dom.comparePoints(nodeA,offsetA,nodeB,offsetB);
},

insertNode:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1211$20(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertValidNodeType(node,insertableNodeTypes);
assertNodeNotReadOnly(this.startContainer);

if(dom.isAncestorOf(node,this.startContainer,true)){
throw new DOMException("HIERARCHY_REQUEST_ERR");
}





var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);
this.setStartBefore(firstNodeInserted);
},

cloneContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1228$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);

var clone,frag;
if(this.collapsed){
return getRangeDocument(this).createDocumentFragment();
}else{
if(this.startContainer===this.endContainer&&dom.isCharacterDataNode(this.startContainer)){
clone=this.startContainer.cloneNode(true);
clone.data=clone.data.slice(this.startOffset,this.endOffset);
frag=getRangeDocument(this).createDocumentFragment();
frag.appendChild(clone);
return frag;
}else{
var iterator=new RangeIterator(this,true);
clone=cloneSubtree(iterator);
iterator.detach();
}
return clone;
}
},

canSurroundContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1250$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertNodeNotReadOnly(this.startContainer);
assertNodeNotReadOnly(this.endContainer);



var iterator=new RangeIterator(this,true);
var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||
(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));
iterator.detach();
return!boundariesInvalid;
},

surroundContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1264$26(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertValidNodeType(node,surroundNodeTypes);

if(!this.canSurroundContents()){
throw new RangeException("BAD_BOUNDARYPOINTS_ERR");
}


var content=this.extractContents();


if(node.hasChildNodes()){
while(node.lastChild){
node.removeChild(node.lastChild);
}
}


insertNodeAtPosition(node,this.startContainer,this.startOffset);
node.appendChild(content);

this.selectNode(node);
},

cloneRange:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1288$20(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
var range=new Range(getRangeDocument(this));
var i=rangeProperties.length,prop;
while(i--){
prop=rangeProperties[i];
range[prop]=this[prop];
}
return range;
},

toString:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1299$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
var sc=this.startContainer;
if(sc===this.endContainer&&dom.isCharacterDataNode(sc)){
return(sc.nodeType==3||sc.nodeType==4)?sc.data.slice(this.startOffset,this.endOffset):"";
}else{
var textBits=[],iterator=new RangeIterator(this,true);

iterateSubtree(iterator,function $vpfn_ej3mp2EBpZazz6mYG7C2tg1307$41(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(node.nodeType==3||node.nodeType==4){
textBits.push(node.data);
}
});
iterator.detach();
return textBits.join("");
}
},




compareNode:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1322$21(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);

var parent=node.parentNode;
var nodeIndex=dom.getNodeIndex(node);

if(!parent){
throw new DOMException("NOT_FOUND_ERR");
}

var startComparison=this.comparePoint(parent,nodeIndex),
endComparison=this.comparePoint(parent,nodeIndex+1);

if(startComparison<0){
return(endComparison>0)?n_b_a:n_b;
}else{
return(endComparison>0)?n_a:n_i;
}
},

comparePoint:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1342$22(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertNode(node,"HIERARCHY_REQUEST_ERR");
assertSameDocumentOrFragment(node,this.startContainer);

if(dom.comparePoints(node,offset,this.startContainer,this.startOffset)<0){
return-1;
}else if(dom.comparePoints(node,offset,this.endContainer,this.endOffset)>0){
return 1;
}
return 0;
},

createContextualFragment:createContextualFragment,

toHtml:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1357$16(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
var container=getRangeDocument(this).createElement("div");
container.appendChild(this.cloneContents());
return container.innerHTML;
},



intersectsNode:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1366$24(node,touchingIsIntersecting){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertNode(node,"NOT_FOUND_ERR");
if(dom.getDocument(node)!==getRangeDocument(this)){
return false;
}

var parent=node.parentNode,offset=dom.getNodeIndex(node);
assertNode(parent,"NOT_FOUND_ERR");

var startComparison=dom.comparePoints(parent,offset,this.endContainer,this.endOffset),
endComparison=dom.comparePoints(parent,offset+1,this.startContainer,this.startOffset);

return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;
},


isPointInRange:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1383$24(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertNode(node,"HIERARCHY_REQUEST_ERR");
assertSameDocumentOrFragment(node,this.startContainer);

return(dom.comparePoints(node,offset,this.startContainer,this.startOffset)>=0)&&
(dom.comparePoints(node,offset,this.endContainer,this.endOffset)<=0);
},




intersectsRange:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1395$25(range,touchingIsIntersecting){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);

if(getRangeDocument(range)!=getRangeDocument(this)){
throw new DOMException("WRONG_DOCUMENT_ERR");
}

var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.endContainer,range.endOffset),
endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.startContainer,range.startOffset);

return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;
},

intersection:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1408$22(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.intersectsRange(range)){
var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),
endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);

var intersectionRange=this.cloneRange();

if(startComparison==-1){
intersectionRange.setStart(range.startContainer,range.startOffset);
}
if(endComparison==1){
intersectionRange.setEnd(range.endContainer,range.endOffset);
}
return intersectionRange;
}
return null;
},

union:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1426$15(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.intersectsRange(range,true)){
var unionRange=this.cloneRange();
if(dom.comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1){
unionRange.setStart(range.startContainer,range.startOffset);
}
if(dom.comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)==1){
unionRange.setEnd(range.endContainer,range.endOffset);
}
return unionRange;
}else{
throw new RangeException("Ranges do not intersect");
}
},

containsNode:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1441$22(node,allowPartial){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(allowPartial){
return this.intersectsNode(node,false);
}else{
return this.compareNode(node)==n_i;
}
},

containsNodeContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1449$30(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.comparePoint(node,0)>=0&&this.comparePoint(node,dom.getNodeLength(node))<=0;
},

containsRange:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1453$23(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.intersection(range).equals(range);
},

containsNodeText:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1457$26(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nodeRange=this.cloneRange();
nodeRange.selectNode(node);
var textNodes=nodeRange.getNodes([3]);
if(textNodes.length>0){
nodeRange.setStart(textNodes[0],0);
var lastTextNode=textNodes.pop();
nodeRange.setEnd(lastTextNode,lastTextNode.length);
var contains=this.containsRange(nodeRange);
nodeRange.detach();
return contains;
}else{
return this.containsNodeContents(node);
}
},

createNodeIterator:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1473$28(nodeTypes,filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
return new RangeNodeIterator(this,nodeTypes,filter);
},

getNodes:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1478$18(nodeTypes,filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
return getNodesInRange(this,nodeTypes,filter);
},

getDocument:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1483$21(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return getRangeDocument(this);
},

collapseBefore:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1487$24(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);

this.setEndBefore(node);
this.collapse(false);
},

collapseAfter:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1494$23(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);

this.setStartAfter(node);
this.collapse(true);
},

getName:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1501$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"DomRange";
},

equals:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1505$16(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return Range.rangesEqual(this,range);
},

inspect:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1509$17(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return inspect(this);
}
};

function copyComparisonConstantsToObject(obj){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
obj.START_TO_START=s2s;
obj.START_TO_END=s2e;
obj.END_TO_END=e2e;
obj.END_TO_START=e2s;

obj.NODE_BEFORE=n_b;
obj.NODE_AFTER=n_a;
obj.NODE_BEFORE_AND_AFTER=n_b_a;
obj.NODE_INSIDE=n_i;
}copyComparisonConstantsToObject._vpfn='$vpfn_1YwFOW29glQxJ9$2lBJwcQ1514$4';

function copyComparisonConstants(constructor){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
copyComparisonConstantsToObject(constructor);
copyComparisonConstantsToObject(constructor.prototype);
}copyComparisonConstants._vpfn='$vpfn_yI_Oy7m$o8B1Wq0oWrYnzw1526$4';

function createRangeContentRemover(remover,boundaryUpdater){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg1532$15(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);

var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;

var iterator=new RangeIterator(this,true);


var node,boundary;
if(sc!==root){
node=dom.getClosestAncestorIn(sc,root,true);
boundary=getBoundaryAfterNode(node);
sc=boundary.node;
so=boundary.offset;
}


iterateSubtree(iterator,assertNodeNotReadOnly);

iterator.reset();


var returnValue=remover(iterator);
iterator.detach();


boundaryUpdater(this,sc,so,sc,so);

return returnValue;
};
}createRangeContentRemover._vpfn='$vpfn_VFGavC$hQynulaD$pCERcA1531$4';

function createPrototypeRange(constructor,boundaryUpdater,detacher){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
function createBeforeAfterNodeSetter(isBefore,isStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg1566$19(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);
assertValidNodeType(node,beforeAfterNodeTypes);
assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);

var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);
(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset);
};
}createBeforeAfterNodeSetter._vpfn='$vpfn_6h9iTkDOuZb4wzRU7qW60w1565$8';

function setRangeStart(range,node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ec=range.endContainer,eo=range.endOffset;
if(node!==range.startContainer||offset!==range.startOffset){


if(getRootContainer(node)!=getRootContainer(ec)||dom.comparePoints(node,offset,ec,eo)==1){
ec=node;
eo=offset;
}
boundaryUpdater(range,node,offset,ec,eo);
}
}setRangeStart._vpfn='$vpfn_a8GPuLiZi7SA97d4fJhf1g1576$8';

function setRangeEnd(range,node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sc=range.startContainer,so=range.startOffset;
if(node!==range.endContainer||offset!==range.endOffset){


if(getRootContainer(node)!=getRootContainer(sc)||dom.comparePoints(node,offset,sc,so)==-1){
sc=node;
so=offset;
}
boundaryUpdater(range,sc,so,node,offset);
}
}setRangeEnd._vpfn='$vpfn_7ehcC61r8YsyZKtR83yr5A1589$8';

function setRangeStartAndEnd(range,node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(node!==range.startContainer||offset!==range.startOffset||node!==range.endContainer||offset!==range.endOffset){
boundaryUpdater(range,node,offset,node,offset);
}
}setRangeStartAndEnd._vpfn='$vpfn_gogV7tuVBRoqstRokHfUcw1602$8';

constructor.prototype=new RangePrototype();

api.util.extend(constructor.prototype,{
setStart:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1611$22(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);
assertNoDocTypeNotationEntityAncestor(node,true);
assertValidOffset(node,offset);

setRangeStart(this,node,offset);
},

setEnd:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1619$20(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);
assertNoDocTypeNotationEntityAncestor(node,true);
assertValidOffset(node,offset);

setRangeEnd(this,node,offset);
},

setStartBefore:createBeforeAfterNodeSetter(true,true),
setStartAfter:createBeforeAfterNodeSetter(false,true),
setEndBefore:createBeforeAfterNodeSetter(true,false),
setEndAfter:createBeforeAfterNodeSetter(false,false),

collapse:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1632$22(isStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
if(isStart){
boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset);
}else{
boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset);
}
},

selectNodeContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1641$32(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



assertNotDetached(this);
assertNoDocTypeNotationEntityAncestor(node,true);

boundaryUpdater(this,node,0,node,dom.getNodeLength(node));
},

selectNode:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1651$24(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);
assertNoDocTypeNotationEntityAncestor(node,false);
assertValidNodeType(node,beforeAfterNodeTypes);

var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);
boundaryUpdater(this,start.node,start.offset,end.node,end.offset);
},

extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),

deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),

canSurroundContents:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1664$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);
assertNodeNotReadOnly(this.startContainer);
assertNodeNotReadOnly(this.endContainer);



var iterator=new RangeIterator(this,true);
var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||
(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));
iterator.detach();
return!boundariesInvalid;
},

detach:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1678$20(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
detacher(this);
},

splitBoundaries:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1682$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);


var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;
var startEndSame=(sc===ec);

if(dom.isCharacterDataNode(ec)&&eo>0&&eo<ec.length){
dom.splitDataNode(ec,eo);

}

if(dom.isCharacterDataNode(sc)&&so>0&&so<sc.length){

sc=dom.splitDataNode(sc,so);
if(startEndSame){
eo-=so;
ec=sc;
}else if(ec==sc.parentNode&&eo>=dom.getNodeIndex(sc)){
eo++;
}
so=0;

}
boundaryUpdater(this,sc,so,ec,eo);
},

normalizeBoundaries:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1709$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertRangeValid(this);

var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;

var mergeForward=function $vpfn_O40gaQzONdRPeGrWNqthGw1714$35(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sibling=node.nextSibling;
if(sibling&&sibling.nodeType==node.nodeType){
ec=node;
eo=node.length;
node.appendData(sibling.data);
sibling.parentNode.removeChild(sibling);
}
};

var mergeBackward=function $vpfn_uyhzN5vm$ICJBAgBWZiGYQ1724$36(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var sibling=node.previousSibling;
if(sibling&&sibling.nodeType==node.nodeType){
sc=node;
var nodeLength=node.length;
so=sibling.length;
node.insertData(0,sibling.data);
sibling.parentNode.removeChild(sibling);
if(sc==ec){
eo+=so;
ec=sc;
}else if(ec==node.parentNode){
var nodeIndex=dom.getNodeIndex(node);
if(eo==nodeIndex){
ec=node;
eo=nodeLength;
}else if(eo>nodeIndex){
eo--;
}
}
}
};

var normalizeStart=true;

if(dom.isCharacterDataNode(ec)){
if(ec.length==eo){
mergeForward(ec);
}
}else{
if(eo>0){
var endNode=ec.childNodes[eo-1];
if(endNode&&dom.isCharacterDataNode(endNode)){
mergeForward(endNode);
}
}
normalizeStart=!this.collapsed;
}

if(normalizeStart){
if(dom.isCharacterDataNode(sc)){
if(so==0){
mergeBackward(sc);
}
}else{
if(so<sc.childNodes.length){
var startNode=sc.childNodes[so];
if(startNode&&dom.isCharacterDataNode(startNode)){
mergeBackward(startNode);
}
}
}
}else{
sc=ec;
so=eo;
}

boundaryUpdater(this,sc,so,ec,eo);
},

collapseToPoint:function $vpfn_ej3mp2EBpZazz6mYG7C2tg1784$29(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(this);

assertNoDocTypeNotationEntityAncestor(node,true);
assertValidOffset(node,offset);

setRangeStartAndEnd(this,node,offset);
}
});

copyComparisonConstants(constructor);
}createPrototypeRange._vpfn='$vpfn_i7T1auesOClwQ$nZKXcIGA1564$4';




function updateCollapsedAndCommonAncestor(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
range.collapsed=(range.startContainer===range.endContainer&&range.startOffset===range.endOffset);
range.commonAncestorContainer=range.collapsed?
range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer);
}updateCollapsedAndCommonAncestor._vpfn='$vpfn_Zed6_KeRp_5aEGKlktaFbg1800$4';

function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var startMoved=(range.startContainer!==startContainer||range.startOffset!==startOffset);
var endMoved=(range.endContainer!==endContainer||range.endOffset!==endOffset);

range.startContainer=startContainer;
range.startOffset=startOffset;
range.endContainer=endContainer;
range.endOffset=endOffset;

updateCollapsedAndCommonAncestor(range);
dispatchEvent(range,"boundarychange",{startMoved:startMoved,endMoved:endMoved});
}updateBoundaries._vpfn='$vpfn_tkfrt27PKOMorCL39N7zJw1806$4';

function detach(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNotDetached(range);
range.startContainer=range.startOffset=range.endContainer=range.endOffset=null;
range.collapsed=range.commonAncestorContainer=null;
dispatchEvent(range,"detach",null);
range._listeners=null;
}detach._vpfn='$vpfn_DtuB7k1kExROWZZgAJLbPg1819$4';




function Range(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.startContainer=doc;
this.startOffset=0;
this.endContainer=doc;
this.endOffset=0;
this._listeners={
boundarychange:[],
detach:[]
};
updateCollapsedAndCommonAncestor(this);
}Range._vpfn='$vpfn_3x85V61AXkHUwK8BGr8Jng1830$4';

createPrototypeRange(Range,updateBoundaries,detach);

api.rangePrototype=RangePrototype.prototype;

Range.rangeProperties=rangeProperties;
Range.RangeIterator=RangeIterator;
Range.copyComparisonConstants=copyComparisonConstants;
Range.createPrototypeRange=createPrototypeRange;
Range.inspect=inspect;
Range.getRangeDocument=getRangeDocument;
Range.rangesEqual=function $vpfn_wifQ1MrcuN__VR6Ih2MhSg1852$24(r1,r2){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return r1.startContainer===r2.startContainer&&
r1.startOffset===r2.startOffset&&
r1.endContainer===r2.endContainer&&
r1.endOffset===r2.endOffset;
};

api.DomRange=Range;
api.RangeException=RangeException;
});rangy.createModule("WrappedRange",function $vpfn_ej3mp2EBpZazz6mYG7C2tg1861$38(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.requireModules(["DomUtil","DomRange"]);




var WrappedRange;
var dom=api.dom;
var DomPosition=dom.DomPosition;
var DomRange=api.DomRange;



















function getTextRangeContainerElement(textRange){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentEl=textRange.parentElement();

var range=textRange.duplicate();
range.collapse(true);
var startEl=range.parentElement();
range=textRange.duplicate();
range.collapse(false);
var endEl=range.parentElement();
var startEndContainer=(startEl==endEl)?startEl:dom.getCommonAncestor(startEl,endEl);

return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer);
}getTextRangeContainerElement._vpfn='$vpfn_7y2gw_gVSF6tnAsEcn0HgQ1890$4';

function textRangeIsCollapsed(textRange){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return textRange.compareEndPoints("StartToEnd",textRange)==0;
}textRangeIsCollapsed._vpfn='$vpfn_nahWSDn9JCf5cL7QTkSO8Q1904$4';





function getTextRangeBoundaryPosition(textRange,wholeRangeContainerElement,isStart,isCollapsed){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var workingRange=textRange.duplicate();

workingRange.collapse(isStart);
var containerElement=workingRange.parentElement();




if(!dom.isAncestorOf(wholeRangeContainerElement,containerElement,true)){
containerElement=wholeRangeContainerElement;

}





if(!containerElement.canHaveHTML){
return new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));
}

var workingNode=dom.getDocument(containerElement).createElement("span");
var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";
var previousNode,nextNode,boundaryPosition,boundaryNode;



do{
containerElement.insertBefore(workingNode,workingNode.previousSibling);
workingRange.moveToElementText(workingNode);
}while((comparison=workingRange.compareEndPoints(workingComparisonType,textRange))>0&&
workingNode.previousSibling);



boundaryNode=workingNode.nextSibling;

if(comparison==-1&&boundaryNode&&dom.isCharacterDataNode(boundaryNode)){



workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);


var offset;

if(/[\r\n]/.test(boundaryNode.data)){





























var tempRange=workingRange.duplicate();
var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;

offset=tempRange.moveStart("character",rangeLength);
while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){
offset++;
tempRange.moveStart("character",1);
}
}else{
offset=workingRange.text.length;
}
boundaryPosition=new DomPosition(boundaryNode,offset);
}else{




previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;
nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;



if(nextNode&&dom.isCharacterDataNode(nextNode)){
boundaryPosition=new DomPosition(nextNode,0);
}else if(previousNode&&dom.isCharacterDataNode(previousNode)){
boundaryPosition=new DomPosition(previousNode,previousNode.length);
}else{
boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode));
}
}


workingNode.parentNode.removeChild(workingNode);

return boundaryPosition;
}getTextRangeBoundaryPosition._vpfn='$vpfn_qL8AH$SVgd_BnCW91AKZoQ1912$4';




function createBoundaryTextRange(boundaryPosition,isStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;
var doc=dom.getDocument(boundaryPosition.node);
var workingNode,childNodes,workingRange=doc.body.createTextRange();
var nodeIsDataNode=dom.isCharacterDataNode(boundaryPosition.node);

if(nodeIsDataNode){
boundaryNode=boundaryPosition.node;
boundaryParent=boundaryNode.parentNode;
}else{
childNodes=boundaryPosition.node.childNodes;
boundaryNode=(boundaryOffset<childNodes.length)?childNodes[boundaryOffset]:null;
boundaryParent=boundaryPosition.node;
}


workingNode=doc.createElement("span");



workingNode.innerHTML="&#feff;";



if(boundaryNode){
boundaryParent.insertBefore(workingNode,boundaryNode);
}else{
boundaryParent.appendChild(workingNode);
}

workingRange.moveToElementText(workingNode);
workingRange.collapse(!isStart);


boundaryParent.removeChild(workingNode);


if(nodeIsDataNode){
workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset);
}

return workingRange;
}createBoundaryTextRange._vpfn='$vpfn_As3OXmcYlYAH_FSUwIW_Yw2029$4';



if(api.features.implementsDomRange&&(!api.features.implementsTextRange||!api.config.preferTextRange)){




(function $vpfn_ej3mp2EBpZazz6mYG7C2tg2080$9(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeProto;
var rangeProperties=DomRange.rangeProperties;
var canSetRangeStartAfterEnd;

function updateRangeProperties(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var i=rangeProperties.length,prop;
while(i--){
prop=rangeProperties[i];
range[prop]=range.nativeRange[prop];
}
}updateRangeProperties._vpfn='$vpfn_ITdaCf$Xp3Hw9R2DEdmIwg2085$12';

function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var startMoved=(range.startContainer!==startContainer||range.startOffset!=startOffset);
var endMoved=(range.endContainer!==endContainer||range.endOffset!=endOffset);


if(startMoved||endMoved){
range.setEnd(endContainer,endOffset);
range.setStart(startContainer,startOffset);
}
}updateNativeRange._vpfn='$vpfn_TSEnYRqtv8Hkf8rHxk2Fvg2093$12';

function detach(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
range.nativeRange.detach();
range.detached=true;
var i=rangeProperties.length,prop;
while(i--){
prop=rangeProperties[i];
range[prop]=null;
}
}detach._vpfn='$vpfn_DtuB7k1kExROWZZgAJLbPg2104$12';

var createBeforeAfterNodeSetter;

WrappedRange=function $vpfn_DVrVQc1ZRK1hPwXdljG7iA2116$27(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!range){
throw new Error("Range must be specified");
}
this.nativeRange=range;
updateRangeProperties(this);
};

DomRange.createPrototypeRange(WrappedRange,updateNativeRange,detach);

rangeProto=WrappedRange.prototype;

rangeProto.selectNode=function $vpfn_pW4wRHZZO81qryZ26Aq_wA2128$36(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.selectNode(node);
updateRangeProperties(this);
};

rangeProto.deleteContents=function $vpfn_W4n6DGvufkgTaAh9Wu9PCg2133$40(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.deleteContents();
updateRangeProperties(this);
};

rangeProto.extractContents=function $vpfn_oaezj$CTNV7mCFJ1BJceqg2138$41(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var frag=this.nativeRange.extractContents();
updateRangeProperties(this);
return frag;
};

rangeProto.cloneContents=function $vpfn_Z3c1oxC724EHOjCTpjL83w2144$39(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.nativeRange.cloneContents();
};












rangeProto.surroundContents=function $vpfn_n7pnSw9j0FlvslMpdZ_lpg2159$42(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.surroundContents(node);
updateRangeProperties(this);
};

rangeProto.collapse=function $vpfn_gKmDJoxXdXiToJIGbwIDZw2164$34(isStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.collapse(isStart);
updateRangeProperties(this);
};

rangeProto.cloneRange=function $vpfn_ZY4YylJ5z_SjeMUznF7Ryg2169$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return new WrappedRange(this.nativeRange.cloneRange());
};

rangeProto.refresh=function $vpfn_8oaxFft3$iHnL$nnv_M8jg2173$33(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
updateRangeProperties(this);
};

rangeProto.toString=function $vpfn_D$$R2mhSjN97PQY2wvcoww2177$34(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.nativeRange.toString();
};



var testTextNode=document.createTextNode("test");
dom.getBody(document).appendChild(testTextNode);
var range=document.createRange();






range.setStart(testTextNode,0);
range.setEnd(testTextNode,0);

try{
range.setStart(testTextNode,1);
canSetRangeStartAfterEnd=true;

rangeProto.setStart=function $vpfn_oumwXk8_Q$5sjd8LDFoKUg2199$38(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.setStart(node,offset);
updateRangeProperties(this);
};

rangeProto.setEnd=function $vpfn_jqM4mAZaIAOmL3iBiQhsdA2204$36(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.setEnd(node,offset);
updateRangeProperties(this);
};

createBeforeAfterNodeSetter=function $vpfn_6h9iTkDOuZb4wzRU7qW60w2209$46(name){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg2210$27(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange[name](node);
updateRangeProperties(this);
};
};

}catch(ex){


canSetRangeStartAfterEnd=false;

rangeProto.setStart=function $vpfn_oumwXk8_Q$5sjd8LDFoKUg2221$38(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try{
this.nativeRange.setStart(node,offset);
}catch(ex){
this.nativeRange.setEnd(node,offset);
this.nativeRange.setStart(node,offset);
}
updateRangeProperties(this);
};

rangeProto.setEnd=function $vpfn_jqM4mAZaIAOmL3iBiQhsdA2231$36(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try{
this.nativeRange.setEnd(node,offset);
}catch(ex){
this.nativeRange.setStart(node,offset);
this.nativeRange.setEnd(node,offset);
}
updateRangeProperties(this);
};

createBeforeAfterNodeSetter=function $vpfn_6h9iTkDOuZb4wzRU7qW60w2241$46(name,oppositeName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return function $vpfn_ej3mp2EBpZazz6mYG7C2tg2242$27(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try{
this.nativeRange[name](node);
}catch(ex){
this.nativeRange[oppositeName](node);
this.nativeRange[name](node);
}
updateRangeProperties(this);
};
};
}

rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");
rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");
rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");
rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");





range.selectNodeContents(testTextNode);
if(range.startContainer==testTextNode&&range.endContainer==testTextNode&&
range.startOffset==0&&range.endOffset==testTextNode.length){
rangeProto.selectNodeContents=function $vpfn_JefANaJnGozGUrdS2NZ56g2266$48(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeRange.selectNodeContents(node);
updateRangeProperties(this);
};
}else{
rangeProto.selectNodeContents=function $vpfn_JefANaJnGozGUrdS2NZ56g2271$48(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.setStart(node,0);
this.setEnd(node,DomRange.getEndOffset(node));
};
}






range.selectNodeContents(testTextNode);
range.setEnd(testTextNode,3);

var range2=document.createRange();
range2.selectNodeContents(testTextNode);
range2.setEnd(testTextNode,4);
range2.setStart(testTextNode,2);

if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&
range.compareBoundaryPoints(range.END_TO_START,range2)==1){



rangeProto.compareBoundaryPoints=function $vpfn_e16xYQSaVcF1yyqyWdeBwA2295$51(type,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
range=range.nativeRange||range;
if(type==range.START_TO_END){
type=range.END_TO_START;
}else if(type==range.END_TO_START){
type=range.START_TO_END;
}
return this.nativeRange.compareBoundaryPoints(type,range);
};
}else{
rangeProto.compareBoundaryPoints=function $vpfn_e16xYQSaVcF1yyqyWdeBwA2305$51(type,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range);
};
}




if(api.util.isHostMethod(range,"createContextualFragment")){
rangeProto.createContextualFragment=function $vpfn_ip1m41eaiS1N2QeLFxKWeQ2314$54(fragmentStr){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this.nativeRange.createContextualFragment(fragmentStr);
};
}




dom.getBody(document).removeChild(testTextNode);
range.detach();
range2.detach();
})();

api.createNativeRange=function $vpfn_NUl36XJh7tN$TXdmZfP9wg2327$32(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
doc=doc||document;
return doc.createRange();
};
}else if(api.features.implementsTextRange){



WrappedRange=function $vpfn_DVrVQc1ZRK1hPwXdljG7iA2335$23(textRange){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.textRange=textRange;
this.refresh();
};

WrappedRange.prototype=new DomRange(document);

WrappedRange.prototype.refresh=function $vpfn_AXeucXrf1k_uESDdqAJ8dg2342$41(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var start,end;


var rangeContainerElement=getTextRangeContainerElement(this.textRange);

if(textRangeIsCollapsed(this.textRange)){
end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true);
}else{

start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);
end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false);
}

this.setStart(start.node,start.offset);
this.setEnd(end.node,end.offset);
};

DomRange.copyComparisonConstants(WrappedRange);


var globalObj=(function $vpfn_ej3mp2EBpZazz6mYG7C2tg2363$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return this;})();
if(typeof globalObj.Range=="undefined"){
globalObj.Range=WrappedRange;
}

api.createNativeRange=function $vpfn_NUl36XJh7tN$TXdmZfP9wg2368$32(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
doc=doc||document;
return doc.body.createTextRange();
};
}

if(api.features.implementsTextRange){
WrappedRange.rangeToTextRange=function $vpfn_sJKwRu5iCfiZDgHbbdCTSg2375$40(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(range.collapsed){
var tr=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);



return tr;


}else{
var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);
var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false);
var textRange=dom.getDocument(range.startContainer).body.createTextRange();
textRange.setEndPoint("StartToStart",startRange);
textRange.setEndPoint("EndToEnd",endRange);
return textRange;
}
};
}

WrappedRange.prototype.getName=function $vpfn_n6RVpNzXk0D_YRLSBJxoAw2395$37(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"WrappedRange";
};

api.WrappedRange=WrappedRange;

api.createRange=function $vpfn_NQdR7iTLLISJLk_V1Lp9Xw2401$22(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
doc=doc||document;
return new WrappedRange(api.createNativeRange(doc));
};

api.createRangyRange=function $vpfn_WkZLZu4uVOm9Xrd7AGrSow2406$27(doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
doc=doc||document;
return new DomRange(doc);
};

api.createIframeRange=function $vpfn_387mKXiKqYOpp$tGiKyPWQ2411$28(iframeEl){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return api.createRange(dom.getIframeDocument(iframeEl));
};

api.createIframeRangyRange=function $vpfn_6ff4fqz4aFOs8G$mCPYPYw2415$33(iframeEl){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return api.createRangyRange(dom.getIframeDocument(iframeEl));
};

api.addCreateMissingNativeApiListener(function $vpfn_ej3mp2EBpZazz6mYG7C2tg2419$42(win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var doc=win.document;
if(typeof doc.createRange=="undefined"){
doc.createRange=function $vpfn_hp$u9d6K$vwVSC_ml5I_zA2422$30(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return api.createRange(this);
};
}
doc=win=null;
});
});rangy.createModule("WrappedSelection",function $vpfn_ej3mp2EBpZazz6mYG7C2tg2428$42(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



api.requireModules(["DomUtil","DomRange","WrappedRange"]);

api.config.checkSelectionRanges=true;

var BOOLEAN="boolean",
windowPropertyName="_rangySelection",
dom=api.dom,
util=api.util,
DomRange=api.DomRange,
WrappedRange=api.WrappedRange,
DOMException=api.DOMException,
DomPosition=dom.DomPosition,
getSelection,
selectionIsCollapsed,
CONTROL="Control";



function getWinSelection(winParam){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(winParam||window).getSelection();
}getWinSelection._vpfn='$vpfn_8GNhp2mPR8mYYXkXYsSy0A2450$4';

function getDocSelection(winParam){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(winParam||window).document.selection;
}getDocSelection._vpfn='$vpfn_QHbfWbi2U32MfrQoZ5xphw2454$4';



var implementsWinGetSelection=api.util.isHostMethod(window,"getSelection"),
implementsDocSelection=api.util.isHostObject(document,"selection");

var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);

if(useDocumentSelection){
getSelection=getDocSelection;
api.isSelectionValid=function $vpfn_E5lbMclqD_J0w7weY8RmUA2467$31(winParam){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var doc=(winParam||window).document,nativeSel=doc.selection;


return(nativeSel.type!="None"||dom.getDocument(nativeSel.createRange().parentElement())==doc);
};
}else if(implementsWinGetSelection){
getSelection=getWinSelection;
api.isSelectionValid=function $vpfn_E5lbMclqD_J0w7weY8RmUA2475$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return true;
};
}else{
module.fail("Neither document.selection or window.getSelection() detected.");
}

api.getNativeSelection=getSelection;

var testSelection=getSelection();
var testRange=api.createNativeRange(document);
var body=dom.getBody(document);


var selectionHasAnchorAndFocus=util.areHostObjects(testSelection,["anchorNode","focusNode"]&&
util.areHostProperties(testSelection,["anchorOffset","focusOffset"]));
api.features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;


var selectionHasExtend=util.isHostMethod(testSelection,"extend");
api.features.selectionHasExtend=selectionHasExtend;


var selectionHasRangeCount=(typeof testSelection.rangeCount=="number");
api.features.selectionHasRangeCount=selectionHasRangeCount;

var selectionSupportsMultipleRanges=false;
var collapsedNonEditableSelectionsSupported=true;

if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&
typeof testSelection.rangeCount=="number"&&api.features.implementsDomRange){

(function $vpfn_ej3mp2EBpZazz6mYG7C2tg2507$9(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iframe=document.createElement("iframe");
body.appendChild(iframe);

var iframeDoc=dom.getIframeDocument(iframe);
iframeDoc.open();
iframeDoc.write("<html><head></head><body>12</body></html>");
iframeDoc.close();

var sel=dom.getIframeWindow(iframe).getSelection();
var docEl=iframeDoc.documentElement;
var iframeBody=docEl.lastChild,textNode=iframeBody.firstChild;


var r1=iframeDoc.createRange();
r1.setStart(textNode,1);
r1.collapse(true);
sel.addRange(r1);
collapsedNonEditableSelectionsSupported=(sel.rangeCount==1);
sel.removeAllRanges();


var r2=r1.cloneRange();
r1.setStart(textNode,0);
r2.setEnd(textNode,2);
sel.addRange(r1);
sel.addRange(r2);

selectionSupportsMultipleRanges=(sel.rangeCount==2);


r1.detach();
r2.detach();

body.removeChild(iframe);
})();
}

api.features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;
api.features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;


var implementsControlRange=false,testControlRange;

if(body&&util.isHostMethod(body,"createControlRange")){
testControlRange=body.createControlRange();
if(util.areHostProperties(testControlRange,["item","add"])){
implementsControlRange=true;
}
}
api.features.implementsControlRange=implementsControlRange;


if(selectionHasAnchorAndFocus){
selectionIsCollapsed=function $vpfn_9Zi_$n898lDGWPTPA5sPXw2561$31(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset;
};
}else{
selectionIsCollapsed=function $vpfn_9Zi_$n898lDGWPTPA5sPXw2565$31(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false;
};
}

function updateAnchorAndFocusFromRange(sel,range,backwards){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var anchorPrefix=backwards?"end":"start",focusPrefix=backwards?"start":"end";
sel.anchorNode=range[anchorPrefix+"Container"];
sel.anchorOffset=range[anchorPrefix+"Offset"];
sel.focusNode=range[focusPrefix+"Container"];
sel.focusOffset=range[focusPrefix+"Offset"];
}updateAnchorAndFocusFromRange._vpfn='$vpfn_sJNxK7i06X3nlxrHBXyxZQ2570$4';

function updateAnchorAndFocusFromNativeSelection(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nativeSel=sel.nativeSelection;
sel.anchorNode=nativeSel.anchorNode;
sel.anchorOffset=nativeSel.anchorOffset;
sel.focusNode=nativeSel.focusNode;
sel.focusOffset=nativeSel.focusOffset;
}updateAnchorAndFocusFromNativeSelection._vpfn='$vpfn_TNDNJ1E2C6rawOfSBzD7kQ2578$4';

function updateEmptySelection(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
sel.anchorNode=sel.focusNode=null;
sel.anchorOffset=sel.focusOffset=0;
sel.rangeCount=0;
sel.isCollapsed=true;
sel._ranges.length=0;
}updateEmptySelection._vpfn='$vpfn_ZK0RRqI6To5jAR3LGiXaXg2586$4';

function getNativeRange(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nativeRange;
if(range instanceof DomRange){
nativeRange=range._selectionNativeRange;
if(!nativeRange){
nativeRange=api.createNativeRange(dom.getDocument(range.startContainer));
nativeRange.setEnd(range.endContainer,range.endOffset);
nativeRange.setStart(range.startContainer,range.startOffset);
range._selectionNativeRange=nativeRange;
range.attachListener("detach",function $vpfn_ej3mp2EBpZazz6mYG7C2tg2603$47(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

this._selectionNativeRange=null;
});
}
}else if(range instanceof WrappedRange){
nativeRange=range.nativeRange;
}else if(api.features.implementsDomRange&&(range instanceof dom.getWindow(range.startContainer).Range)){
nativeRange=range;
}
return nativeRange;
}getNativeRange._vpfn='$vpfn_6vFecL8FntUt9QRSdrYkeA2594$4';

function rangeContainsSingleElement(rangeNodes){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!rangeNodes.length||rangeNodes[0].nodeType!=1){
return false;
}
for(var i=1,len=rangeNodes.length;i<len;++i){
if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){
return false;
}
}
return true;
}rangeContainsSingleElement._vpfn='$vpfn_L4D6TDYIC9Iqi$TB4ds32g2616$4';

function getSingleElementFromRange(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nodes=range.getNodes();
if(!rangeContainsSingleElement(nodes)){
throw new Error("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element");
}
return nodes[0];
}getSingleElementFromRange._vpfn='$vpfn_Z_FatccDzpmiwo05EjqUKg2628$4';

function isTextRange(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!!range&&typeof range.text!="undefined";
}isTextRange._vpfn='$vpfn__CS_B5VkbPDoOZMuQSLYdw2636$4';

function updateFromTextRange(sel,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var wrappedRange=new WrappedRange(range);
sel._ranges=[wrappedRange];

updateAnchorAndFocusFromRange(sel,wrappedRange,false);
sel.rangeCount=1;
sel.isCollapsed=wrappedRange.collapsed;
}updateFromTextRange._vpfn='$vpfn_Y$gvCc03q0HMl9toDg3SEg2640$4';

function updateControlSelection(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

sel._ranges.length=0;
if(sel.docSelection.type=="None"){
updateEmptySelection(sel);
}else{
var controlRange=sel.docSelection.createRange();
if(isTextRange(controlRange)){



updateFromTextRange(sel,controlRange);
}else{
sel.rangeCount=controlRange.length;
var range,doc=dom.getDocument(controlRange.item(0));
for(var i=0;i<sel.rangeCount;++i){
range=api.createRange(doc);
range.selectNode(controlRange.item(i));
sel._ranges.push(range);
}
sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;
updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false);
}
}
}updateControlSelection._vpfn='$vpfn_WNSXWNy1e8ygfdJM$nC7Ig2650$4';

function addRangeToControlSelection(sel,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var controlRange=sel.docSelection.createRange();
var rangeElement=getSingleElementFromRange(range);



var doc=dom.getDocument(controlRange.item(0));
var newControlRange=dom.getBody(doc).createControlRange();
for(var i=0,len=controlRange.length;i<len;++i){
newControlRange.add(controlRange.item(i));
}
try{
newControlRange.add(rangeElement);
}catch(ex){
throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");
}
newControlRange.select();


updateControlSelection(sel);
}addRangeToControlSelection._vpfn='$vpfn_WTeyHAd7eGB5Eeo0cAZ17Q2676$4';

var getSelectionRangeAt;

if(util.isHostMethod(testSelection,"getRangeAt")){
getSelectionRangeAt=function $vpfn_5$SupVOXP_iwouZxkwA8$w2701$30(sel,index){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
try{
return sel.getRangeAt(index);
}catch(ex){
return null;
}
};
}else if(selectionHasAnchorAndFocus){
getSelectionRangeAt=function $vpfn_5$SupVOXP_iwouZxkwA8$w2709$30(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var doc=dom.getDocument(sel.anchorNode);
var range=api.createRange(doc);
range.setStart(sel.anchorNode,sel.anchorOffset);
range.setEnd(sel.focusNode,sel.focusOffset);



if(range.collapsed!==this.isCollapsed){
range.setStart(sel.focusNode,sel.focusOffset);
range.setEnd(sel.anchorNode,sel.anchorOffset);
}

return range;
};
}




function WrappedSelection(selection,docSelection,win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeSelection=selection;
this.docSelection=docSelection;
this._ranges=[];
this.win=win;
this.refresh();
}WrappedSelection._vpfn='$vpfn_vR64TPVAHpGLRH8G5Cu_sA2729$4';

api.getSelection=function $vpfn_aoxFwR4m8jUeJT0rN5zIaQ2737$23(win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
win=win||window;
var sel=win[windowPropertyName];
var nativeSel=getSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;
if(sel){
sel.nativeSelection=nativeSel;
sel.docSelection=docSel;
sel.refresh(win);
}else{
sel=new WrappedSelection(nativeSel,docSel,win);
win[windowPropertyName]=sel;
}
return sel;
};

api.getIframeSelection=function $vpfn_BMXbGsqNWC1w8b_XOVIj2Q2752$29(iframeEl){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return api.getSelection(dom.getIframeWindow(iframeEl));
};

var selProto=WrappedSelection.prototype;

function createControlSelection(sel,ranges){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var doc=dom.getDocument(ranges[0].startContainer);
var controlRange=dom.getBody(doc).createControlRange();
for(var i=0,el;i<rangeCount;++i){
el=getSingleElementFromRange(ranges[i]);
try{
controlRange.add(el);
}catch(ex){
throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");
}
}
controlRange.select();


updateControlSelection(sel);
}createControlSelection._vpfn='$vpfn_zbk25Mj5921Sm3uXhKDalw2758$4';


if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){
selProto.removeAllRanges=function $vpfn_ejUe1286wAQF72St7ReVuQ2778$35(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.nativeSelection.removeAllRanges();
updateEmptySelection(this);
};

var addRangeBackwards=function $vpfn_oSmRU1O$L5Jnvgo$89Ke4g2783$32(sel,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var doc=DomRange.getRangeDocument(range);
var endRange=api.createRange(doc);
endRange.collapseToPoint(range.endContainer,range.endOffset);
sel.nativeSelection.addRange(getNativeRange(endRange));
sel.nativeSelection.extend(range.startContainer,range.startOffset);
sel.refresh();
};

if(selectionHasRangeCount){
selProto.addRange=function $vpfn_kFD$QFIAHJqb0boNF5AxtQ2793$32(range,backwards){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){
addRangeToControlSelection(this,range);
}else{
if(backwards&&selectionHasExtend){
addRangeBackwards(this,range);
}else{
var previousRangeCount;
if(selectionSupportsMultipleRanges){
previousRangeCount=this.rangeCount;
}else{
this.removeAllRanges();
previousRangeCount=0;
}
this.nativeSelection.addRange(getNativeRange(range));


this.rangeCount=this.nativeSelection.rangeCount;

if(this.rangeCount==previousRangeCount+1){




if(api.config.checkSelectionRanges){
var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);
if(nativeRange&&!DomRange.rangesEqual(nativeRange,range)){

range=new WrappedRange(nativeRange);
}
}
this._ranges[this.rangeCount-1]=range;
updateAnchorAndFocusFromRange(this,range,selectionIsBackwards(this.nativeSelection));
this.isCollapsed=selectionIsCollapsed(this);
}else{

this.refresh();
}
}
}
};
}else{
selProto.addRange=function $vpfn_kFD$QFIAHJqb0boNF5AxtQ2835$32(range,backwards){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(backwards&&selectionHasExtend){
addRangeBackwards(this,range);
}else{
this.nativeSelection.addRange(getNativeRange(range));
this.refresh();
}
};
}

selProto.setRanges=function $vpfn_7A2dSgXOaxGC_o5j6whj2A2845$29(ranges){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(implementsControlRange&&ranges.length>1){
createControlSelection(this,ranges);
}else{
this.removeAllRanges();
for(var i=0,len=ranges.length;i<len;++i){
this.addRange(ranges[i]);
}
}
};
}else if(util.isHostMethod(testSelection,"empty")&&util.isHostMethod(testRange,"select")&&
implementsControlRange&&useDocumentSelection){

selProto.removeAllRanges=function $vpfn_ejUe1286wAQF72St7ReVuQ2858$35(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

try{
this.docSelection.empty();


if(this.docSelection.type!="None"){


var doc;
if(this.anchorNode){
doc=dom.getDocument(this.anchorNode);
}else if(this.docSelection.type==CONTROL){
var controlRange=this.docSelection.createRange();
if(controlRange.length){
doc=dom.getDocument(controlRange.item(0)).body.createTextRange();
}
}
if(doc){
var textRange=doc.body.createTextRange();
textRange.select();
this.docSelection.empty();
}
}
}catch(ex){}
updateEmptySelection(this);
};

selProto.addRange=function $vpfn_kFD$QFIAHJqb0boNF5AxtQ2886$28(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.docSelection.type==CONTROL){
addRangeToControlSelection(this,range);
}else{
WrappedRange.rangeToTextRange(range).select();
this._ranges[0]=range;
this.rangeCount=1;
this.isCollapsed=this._ranges[0].collapsed;
updateAnchorAndFocusFromRange(this,range,false);
}
};

selProto.setRanges=function $vpfn_7A2dSgXOaxGC_o5j6whj2A2898$29(ranges){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.removeAllRanges();
var rangeCount=ranges.length;
if(rangeCount>1){
createControlSelection(this,ranges);
}else if(rangeCount){
this.addRange(ranges[0]);
}
};
}else{
module.fail("No means of selecting a Range or TextRange was found");
return false;
}

selProto.getRangeAt=function $vpfn_mBOXsv1Pf3PrdLYcJn$v4g2912$26(index){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(index<0||index>=this.rangeCount){
throw new DOMException("INDEX_SIZE_ERR");
}else{
return this._ranges[index];
}
};

var refreshSelection;

if(useDocumentSelection){
refreshSelection=function $vpfn_W3k7OjuvjPOdT9QHbNmXkQ2923$27(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range;
if(api.isSelectionValid(sel.win)){
range=sel.docSelection.createRange();
}else{
range=dom.getBody(sel.win.document).createTextRange();
range.collapse(true);
}


if(sel.docSelection.type==CONTROL){
updateControlSelection(sel);
}else if(isTextRange(range)){
updateFromTextRange(sel,range);
}else{
updateEmptySelection(sel);
}
};
}else if(util.isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount=="number"){
refreshSelection=function $vpfn_W3k7OjuvjPOdT9QHbNmXkQ2942$27(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL){
updateControlSelection(sel);
}else{
sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;
if(sel.rangeCount){
for(var i=0,len=sel.rangeCount;i<len;++i){
sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i));
}
updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackwards(sel.nativeSelection));
sel.isCollapsed=selectionIsCollapsed(sel);
}else{
updateEmptySelection(sel);
}
}
};
}else if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&api.features.implementsDomRange){
refreshSelection=function $vpfn_W3k7OjuvjPOdT9QHbNmXkQ2959$27(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range,nativeSel=sel.nativeSelection;
if(nativeSel.anchorNode){
range=getSelectionRangeAt(nativeSel,0);
sel._ranges=[range];
sel.rangeCount=1;
updateAnchorAndFocusFromNativeSelection(sel);
sel.isCollapsed=selectionIsCollapsed(sel);
}else{
updateEmptySelection(sel);
}
};
}else{
module.fail("No means of obtaining a Range or TextRange from the user's selection was found");
return false;
}

selProto.refresh=function $vpfn_lz2aVWvtkVmc5$v0u8oL$g2976$23(checkForChanges){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var oldRanges=checkForChanges?this._ranges.slice(0):null;
refreshSelection(this);
if(checkForChanges){
var i=oldRanges.length;
if(i!=this._ranges.length){
return false;
}
while(i--){
if(!DomRange.rangesEqual(oldRanges[i],this._ranges[i])){
return false;
}
}
return true;
}
};


var removeRangeManually=function $vpfn_tbrRF8nL9rzw3o0gq_Z_Xg2994$30(sel,range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var ranges=sel.getAllRanges(),removed=false;
sel.removeAllRanges();
for(var i=0,len=ranges.length;i<len;++i){
if(removed||range!==ranges[i]){
sel.addRange(ranges[i]);
}else{



removed=true;
}
}
if(!sel.rangeCount){
updateEmptySelection(sel);
}
};

if(implementsControlRange){
selProto.removeRange=function $vpfn_1evv4SoPuT7F61iIV$vzuw3013$31(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.docSelection.type==CONTROL){
var controlRange=this.docSelection.createRange();
var rangeElement=getSingleElementFromRange(range);



var doc=dom.getDocument(controlRange.item(0));
var newControlRange=dom.getBody(doc).createControlRange();
var el,removed=false;
for(var i=0,len=controlRange.length;i<len;++i){
el=controlRange.item(i);
if(el!==rangeElement||removed){
newControlRange.add(controlRange.item(i));
}else{
removed=true;
}
}
newControlRange.select();


updateControlSelection(this);
}else{
removeRangeManually(this,range);
}
};
}else{
selProto.removeRange=function $vpfn_1evv4SoPuT7F61iIV$vzuw3040$31(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
removeRangeManually(this,range);
};
}


var selectionIsBackwards;
if(!useDocumentSelection&&selectionHasAnchorAndFocus&&api.features.implementsDomRange){
selectionIsBackwards=function $vpfn_fHIE1qPSFfm4Ft9gm$oKfg3048$31(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var backwards=false;
if(sel.anchorNode){
backwards=(dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1);
}
return backwards;
};

selProto.isBackwards=function $vpfn_0dO$goaqwCrsvGdrxQ$xww3056$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return selectionIsBackwards(this);
};
}else{
selectionIsBackwards=selProto.isBackwards=function $vpfn_0dO$goaqwCrsvGdrxQ$xww3060$54(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return false;
};
}



selProto.toString=function $vpfn_62FeJCVB$oS_hT1xVRtzgg3067$24(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var rangeTexts=[];
for(var i=0,len=this.rangeCount;i<len;++i){
rangeTexts[i]=""+this._ranges[i];
}
return rangeTexts.join("");
};

function assertNodeInSameDocument(sel,node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(sel.anchorNode&&(dom.getDocument(sel.anchorNode)!==dom.getDocument(node))){
throw new DOMException("WRONG_DOCUMENT_ERR");
}
}assertNodeInSameDocument._vpfn='$vpfn_rJklC7bVMLRP$AZ7G1p3mw3076$4';


selProto.collapse=function $vpfn_uYJlxV7gV1raf43uSE83ww3083$24(node,offset){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNodeInSameDocument(this,node);
var range=api.createRange(dom.getDocument(node));
range.collapseToPoint(node,offset);
this.removeAllRanges();
this.addRange(range);
this.isCollapsed=true;
};

selProto.collapseToStart=function $vpfn_ihFJhUdSoPcgyTN685UUtQ3092$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.rangeCount){
var range=this._ranges[0];
this.collapse(range.startContainer,range.startOffset);
}else{
throw new DOMException("INVALID_STATE_ERR");
}
};

selProto.collapseToEnd=function $vpfn_TKisv9JS3vDk40lRf8045A3101$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.rangeCount){
var range=this._ranges[this.rangeCount-1];
this.collapse(range.endContainer,range.endOffset);
}else{
throw new DOMException("INVALID_STATE_ERR");
}
};



selProto.selectAllChildren=function $vpfn_IasEPylFPK853jqBbpBb4A3112$33(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
assertNodeInSameDocument(this,node);
var range=api.createRange(dom.getDocument(node));
range.selectNodeContents(node);
this.removeAllRanges();
this.addRange(range);
};

selProto.deleteFromDocument=function $vpfn_k_Rf33O8Nlioq7RN$azRnA3120$34(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){
var controlRange=this.docSelection.createRange();
var element;
while(controlRange.length){
element=controlRange.item(0);
controlRange.remove(element);
element.parentNode.removeChild(element);
}
this.refresh();
}else if(this.rangeCount){
var ranges=this.getAllRanges();
this.removeAllRanges();
for(var i=0,len=ranges.length;i<len;++i){
ranges[i].deleteContents();
}


this.addRange(ranges[len-1]);
}
};


selProto.getAllRanges=function $vpfn_DNp5eKXpnPVahn$hpV7LsQ3144$28(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return this._ranges.slice(0);
};

selProto.setSingleRange=function $vpfn_s8K0W407uHtzbyxZmd6mIQ3148$30(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.setRanges([range]);
};

selProto.containsNode=function $vpfn_07uGC66fT44HqZzMHfRjtQ3152$28(node,allowPartial){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0,len=this._ranges.length;i<len;++i){
if(this._ranges[i].containsNode(node,allowPartial)){
return true;
}
}
return false;
};

selProto.toHtml=function $vpfn_aWvbDr3zdbl1t6kjHUyydg3161$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var html="";
if(this.rangeCount){
var container=DomRange.getRangeDocument(this._ranges[0]).createElement("div");
for(var i=0,len=this._ranges.length;i<len;++i){
container.appendChild(this._ranges[i].cloneContents());
}
html=container.innerHTML;
}
return html;
};

function inspect(sel){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeInspects=[];
var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);
var focus=new DomPosition(sel.focusNode,sel.focusOffset);
var name=(typeof sel.getName=="function")?sel.getName():"Selection";

if(typeof sel.rangeCount!="undefined"){
for(var i=0,len=sel.rangeCount;i<len;++i){
rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i));
}
}
return"["+name+"(Ranges: "+rangeInspects.join(", ")+
")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]";

}inspect._vpfn='$vpfn_R9TgNvd93E4BtZ6yeDq7gg3173$4';

selProto.getName=function $vpfn_MrteVJlZ65VT3mEPMEQ0kg3189$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return"WrappedSelection";
};

selProto.inspect=function $vpfn_WtELQ_Q76WidsUmg$SDwkQ3193$23(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return inspect(this);
};

selProto.detach=function $vpfn_QzmZiEhzdG6$lVEwU_1VBg3197$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.win[windowPropertyName]=null;
this.win=this.anchorNode=this.focusNode=null;
};

WrappedSelection.inspect=inspect;

api.Selection=WrappedSelection;

api.selectionPrototype=selProto;

api.addCreateMissingNativeApiListener(function $vpfn_ej3mp2EBpZazz6mYG7C2tg3208$42(win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(typeof win.getSelection=="undefined"){
win.getSelection=function $vpfn_UcWfGdwWS9THF4CHxrc9fg3210$31(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return api.getSelection(this);
};
}
win=null;
});
});


if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}$(window).load(function $vpfn_rjJ6wuHNeEYGH8q_JK4ImA1$15(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

rangy.init();




rangy.rangePrototype.splitByBlock=function $vpfn_XUMf9nMUU4d6o47wdXYFpA8$40(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockRanges=[];

var range=this.cloneRange();
if(range.collapsed){
return range;
}

var nodes=range.getNodes([3,1],function $vpfn_rjJ6wuHNeEYGH8q_JK4ImA16$43(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return isBlockOrLineBreak(node)||(node.nodeType===3&&!isWhitespaceNode(node));
});
var tempRange;
var currentTopNode=null;

while(nodes.length>0){

if(nodes[0].nodeType===1){
if(!(currentTopNode&&$(currentTopNode).has(nodes[0]).length)){
currentTopNode=nodes[0];
}
nodes.splice(0,1);
continue;
}else if(currentTopNode&&!$(currentTopNode).has(nodes[0]).length){
currentTopNode=null;
}


if(nodes[0].parentNode.childNodes.length>1||!isBlockOrLineBreak(getTopParentWithSingleChild(nodes[0]))){

tempRange=rangy.createRangyRange();
tempRange.setStartBefore(nodes[0]);
for(var i=0,l=nodes.length;i<l;i++){

if(nodes[i].nodeType===1){
continue;
}
if(isBlockOrLineBreak(nodes[i].nextSibling)||
(!nodes[i].nextSibling&&isBlockOrLineBreak(nodes[i].parentNode))||
(nodes[i+1]&&isBlockOrLineBreak(nodes[i+1]))){
tempRange.setEndAfter(nodes[i]);
break;
}


if(currentTopNode&&!$(currentTopNode).has(nodes[i+1]).length){
tempRange.setEndAfter(nodes[i]);
break;
}
}


if(tempRange.startContainer===tempRange.endContainer&&tempRange.startOffset===tempRange.endOffset){
i--;
tempRange.setEndAfter(nodes[i]);
}
blockRanges.push(tempRange);
nodes.splice(0,i+1);
}

else{
if(isBlockOrLineBreak(getTopParentWithSingleChild(nodes[0]))){
tempRange=rangy.createRangyRange();
tempRange.selectNodeContents(nodes[0]);
blockRanges.push(tempRange);
nodes.splice(0,1);
}
}
}
return blockRanges;
};


rangy.rangePrototype.serializeRange=function $vpfn_kMEo0IL9FK5_pM789N3Y9w80$42(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range=this.cloneRange();

var contentEditable=$(range.startContainer).closest("[contenteditable='true']");
var serializedRange=getRangeStartAndEnd(contentEditable,range,true,true);
return{startOffset:serializedRange.startOffset,endOffset:serializedRange.endOffset};
};


var getRangeStartAndEnd=function $vpfn_uh_rkkfmrNXTU7mU37Y1RA89$30(node,range,stillLookingForStart,stillLookingForEnd){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allContentNodes=$(node).contents();
var startOffset=0,
endOffset=0;
for(var i=0,l=allContentNodes.length;i<l;i++){
if(allContentNodes[i]===range.startContainer&&stillLookingForStart){
startOffset+=range.startOffset;
stillLookingForStart=false;
}
if(allContentNodes[i]===range.endContainer&&stillLookingForEnd){
endOffset+=range.endOffset;
stillLookingForEnd=false;
}
if(stillLookingForStart||stillLookingForEnd){
if(allContentNodes[i].nodeType===3){
if(stillLookingForStart){
startOffset+=$(allContentNodes[i]).text().length;
}
if(stillLookingForEnd){
endOffset+=$(allContentNodes[i]).text().length;
;
}
}else{
var result=getRangeStartAndEnd(allContentNodes[i],range,stillLookingForStart,stillLookingForEnd);
startOffset+=result.startOffset;
endOffset+=result.endOffset;
stillLookingForStart=!result.foundStart;
stillLookingForEnd=!result.foundEnd;
}
}else{
break;
}
}
return{
startOffset:startOffset,
endOffset:endOffset,
foundStart:!stillLookingForStart,
foundEnd:!stillLookingForEnd
};
};


rangy.rangePrototype.deserializeRange=function $vpfn_PZNBYnA9Wn4oQjqheqdNBQ131$44(serializedSelection,contentEditable){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allTextNodes=[];
collectTextNodes(contentEditable,allTextNodes);
var characterNumber=0;
var startFound,endFound;
var range=this;
startFound=endFound=false;
for(var i=0,l=allTextNodes.length;i<l;i++){
if(characterNumber<=serializedSelection.startOffset&&characterNumber+allTextNodes[i].length>=serializedSelection.startOffset){
range.setStart(allTextNodes[i],allTextNodes[i].length-(characterNumber+allTextNodes[i].length-serializedSelection.startOffset));
startFound=true;
}
if(characterNumber<=serializedSelection.endOffset&&characterNumber+allTextNodes[i].length>=serializedSelection.endOffset){
range.setEnd(allTextNodes[i],allTextNodes[i].length-(characterNumber+allTextNodes[i].length-serializedSelection.endOffset));
endFound=true;
}
if(startFound&&endFound){
break;
}
else{
characterNumber+=allTextNodes[i].length;
}
}
return range;
};


var collectTextNodes=function $vpfn_Z2GbIHRQiV42GhJ7Ak$esg158$27(element,texts){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var child=element.firstChild;child!==null;child=child.nextSibling){
if(child.nodeType===3)texts.push(child);
else if(child.nodeType===1)collectTextNodes(child,texts);
}
};

var getTopNodes=function $vpfn_d5zXnIb20AAxclAgGDtUgQ165$22(nodes){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newNodeCollection=[];
for(var i=0,l=nodes.length;i<l;i++){
var foundParent=false;
for(var j=0,len=nodes.length;j<len;j++){

if($.contains(nodes[j],nodes[i])){
foundParent=true;
break;
}
}
if(!foundParent){
newNodeCollection.push(nodes[i]);
}
}
return newNodeCollection;
};

var getTopParentWithSingleChild=function $vpfn_IH0bX5z$nFMV8wTgIvWaeA183$38(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(node.parentNode.childNodes.length===1){
return getTopParentWithSingleChild(node.parentNode);
}
else{
return node;
}

};








var isWhitespaceNode=function $vpfn__zrojYTrV6VWEuJ8vuTu_Q200$27(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!node||node.nodeType!=3){
return false;
}
var text=node.data;
if(text===""||text==='\uFEFF'){
return true;
}
var parent=node.parentNode;
if(!parent||parent.nodeType!=1){
return false;
}
var computedWhiteSpace=getComputedStyleProperty(node.parentNode,"whiteSpace");

return((/^[\t\n\r ]+$/).test(text)&&(/^(normal|nowrap)$/).test(computedWhiteSpace))
||((/^[\t\r ]+$/).test(text)&&computedWhiteSpace=="pre-line");
};

var getComputedStyleProperty;

if(typeof window.getComputedStyle!="undefined"){
getComputedStyleProperty=function $vpfn_9kWRDG0UG6J3kzpD0mdRbA221$35(el,propName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return rangy.dom.getWindow(el).getComputedStyle(el,null)[propName];
};
}else if(typeof document.documentElement.currentStyle!="undefined"){
getComputedStyleProperty=function $vpfn_9kWRDG0UG6J3kzpD0mdRbA225$35(el,propName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return el.currentStyle[propName];
};
}else{
throw new Error("Can't create getComputedStyleProperty");
}

var inlineDisplayRegex=/^(none|inline(-block|-table)?)$/i;




var isBlockOrLineBreak=function $vpfn_n6SBT0tMvT4RXtmMdHOvQA237$29(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!node){
return false;
}
var nodeType=node.nodeType;
return nodeType==1&&(!inlineDisplayRegex.test(getComputedStyleProperty(node,"display"))||node.tagName==="BR")
||nodeType==9||nodeType==11;
};







function getRangeFromSavedSelection(savedSelection){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeInfo=savedSelection.rangeInfos[0];
if(rangeInfo.collapsed){
return null;
}

var startElement=$("#"+rangeInfo.startMarkerId)[0];
var endElement=$("#"+rangeInfo.endMarkerId)[0];
return createRangeFromElements(startElement,endElement);
}getRangeFromSavedSelection._vpfn='$vpfn_79tBr0yxwyVBPa5GOeXxWQ252$4';








function createRangeFromElements(startElement,endElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range=rangy.createRangyRange();
range.setStartBefore(startElement);
range.setEndAfter(endElement);
return range;
}createRangeFromElements._vpfn='$vpfn_v3j9l1OuyJ4nNvKKqzdsxA270$4';






function getTextNodes(range){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!range.isCollapsed)
{
return $(range.getNodes([3])).filter(function $vpfn_rjJ6wuHNeEYGH8q_JK4ImA285$49(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!isWhitespaceNode(this);
});
}
}getTextNodes._vpfn='$vpfn_sYRjIofzLpi3FUbwQeGlxA282$4';

rangy.util.getRangeFromSavedSelection=getRangeFromSavedSelection;
rangy.util.createRangeFromElements=createRangeFromElements;
rangy.util.getTextNodes=getTextNodes;

rangy.util.isWhitespaceNode=isWhitespaceNode;
rangy.util.isBlockOrLineBreak=isBlockOrLineBreak;
rangy.util.getTopNodes=getTopNodes;
rangy.util.getTopParentWithSingleChild=getTopParentWithSingleChild;
});

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;



}








rangy.createModule("BlockElementApplier",function $vpfn_RGNzPFS1YuxWq6Kxer$7PA14$42(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.requireModules(["WrappedSelection","WrappedRange"]);




var blockSurroundOptions=function $vpfn_3f4a_JuAWIUMIC9DjfS7EQ20$31(initOptions,contentEditableElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(initOptions.isProcessed){
return initOptions;
}

var me=this;
this.tagName="";
this.attr="";

this.blockSurroundTag="";
this.blockSurroundState="";
this.originalRange="";
this.contentEditableElement="";
this.styleName="";
this.styleValue="";


for(var prop in initOptions)
{
if(typeof this[prop]==='function')
{
continue;
}

if(this[prop]===undefined)
{
throw"unknown initOption property specified. property: "+prop;
}

this[prop]=initOptions[prop];
}

if(initOptions.attr)
{



var styles=initOptions.attr.style.split(";");
styles=_.filter(styles,function $vpfn_RGNzPFS1YuxWq6Kxer$7PA58$38(style){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return style&&style.length>0;
});


_.each(styles,function $vpfn_RGNzPFS1YuxWq6Kxer$7PA63$27(style){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValues=style.split(":");
me.styleName=$.trim(styleValues[0]);
me.styleValue=$.trim(styleValues[1]);
});

var tempElement=$("<div/>").attr(initOptions.attr);
for(var attr in initOptions.attr)
{
this.attr[attr]=tempElement.attr(attr);
}
}

this.contentEditableElement=this.contentEditableElement||contentEditableElement;

if(this.contentEditableElement===""){
throw"contentEditableElement is not specified";
}

this.isProcessed=true;
return this;
};




var blockSurroundState=function $vpfn_qSTpZUmWv9uJoEa3gMeOBA89$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}



this.Surrounded=0;
this.UnSurrounded=1;
this.Mixed=2;
this.Invalid=3;

this.surroundedIndexes=[];
this.unSurroundedIndexes=[];

this._state="";
this.computeState=function $vpfn_YLEaqjofHmJNN2vM50QxqQ102$28(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(this.surroundedIndexes.length&&!this.unSurroundedIndexes.length){
this._state=this.Surrounded;
}else if(this.unSurroundedIndexes.length&&!this.surroundedIndexes.length){
this._state=this.UnSurrounded;
}else if(this.surroundedIndexes.length&&this.unSurroundedIndexes.length){
this._state=this.Mixed;
}else{
this._state=this.Invalid;
}
return this._state;
};

this.state=function $vpfn_9wths_A2jOaxIcChforNTA115$21(newState){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(newState){
this._state=newState;
}
if(!this._state){
this._state=this.computeState();
}
return this._state;
};
};







function createRange(startElement,endElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range=rangy.createRangyRange();
range.setStartBefore(startElement);
range.setEndAfter(endElement);
return range;
}createRange._vpfn='$vpfn_XmHuvgDNB0OmTlsImTV0Kw132$4';






function getRangeFromSavedSelection(savedSelection){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeInfo=savedSelection.rangeInfos[0];
if(rangeInfo.collapsed){
return null;
}

var startElement=$("#"+rangeInfo.startMarkerId)[0];
var endElement=$("#"+rangeInfo.endMarkerId)[0];
return createRange(startElement,endElement);
}getRangeFromSavedSelection._vpfn='$vpfn_m_uywSqKYVTgrPpHp4qP7w144$4';






function areRangesBlockSurrounded(ranges,options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeCount=ranges.length;
var surroundState=new blockSurroundState();
var nodesByRange=getTopNodesFromRanges(ranges);

for(var i=0;i<rangeCount;i++){
nodesByRange[i].blockSurrounded(options)?surroundState.surroundedIndexes.push(i):surroundState.unSurroundedIndexes.push(i);
}

return surroundState;
}areRangesBlockSurrounded._vpfn='$vpfn_9fvVhhbSJXu9Tf5WrzweUw160$4';








function isBlockSetSurrounded(ranges,blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
blockOptions["blockSurroundTag"]=tagName.LI;
var surroundState=areRangesBlockSurrounded(ranges,blockOptions);



if(surroundState.state()===surroundState.Surrounded){
var listElements=$();
$.each(surroundState.surroundedIndexes,function $vpfn_RGNzPFS1YuxWq6Kxer$7PA187$52(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
listElements.push(ranges[this].startContainer);
});
if(!listElements.hasSameListParent()){
surroundState.state(surroundState.Mixed);
}

var parent=$(ranges[0].startContainer).closest("li").parent();
if(parent.prop("tagName")!==blockOptions.tagName.toUpperCase()){
surroundState.state(surroundState.UnSurrounded);
}
}
return surroundState;
}isBlockSetSurrounded._vpfn='$vpfn_FI2Lmz94$$$zOWTS1m6_sA179$4';




function getSelectedListElements(jListParent,blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var jListElement=jListParent.children();


var beforeSelection=$(),
selection=$(),
afterSelection=$();
var target=beforeSelection;

jListElement.each(function $vpfn_RGNzPFS1YuxWq6Kxer$7PA214$26(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(blockOptions.originalRange.intersectsNode(this)){
target=afterSelection;
selection.push(this);
return true;
}
target.push(this);
return true;
});

return{tagName:jListParent.prop("tagName"),beforeSelection:beforeSelection,selection:selection,afterSelection:afterSelection};
}getSelectedListElements._vpfn='$vpfn_tdweUmP0aSctk22kLJaqlA205$4';







function getTopNodesFromRanges(ranges){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nodeCollection={};
for(var i=0;i<ranges.length;i++){
nodeCollection[i]=$();
$(rangy.util.getTopNodes(ranges[i].getNodes())).each(function $vpfn_RGNzPFS1YuxWq6Kxer$7PA237$65(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
nodeCollection[i].push(this);
});
}
return nodeCollection;
}getTopNodesFromRanges._vpfn='$vpfn_Z$WYYhM8CnaD$a4nT8KrYg233$4';





function closeListsAroundSelection(splitRanges,blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockSurroundedResult=blockOptions.blockSurroundState;

var wrapUnselectedListItems=function $vpfn_Q4U459i3elDUUercCk9xPw251$38(selectionResult){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

selectionResult.beforeSelection.wrapWithOptions({tagName:selectionResult.tagName});
selectionResult.afterSelection.wrapWithOptions({tagName:selectionResult.tagName});
};

var evaluateSelection=function $vpfn_8NuPzzSfn4cv1J_43e8dTA257$32(selectedElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent=selectedElement.closest(tagName.LI).parent();
var selectionResult=getSelectedListElements(parent,blockOptions);
return{parent:parent,selectionResult:selectionResult};
};


var selectionBegin;
if(blockSurroundedResult.surroundedIndexes[0]===0){
selectionBegin=evaluateSelection($(splitRanges[0].startContainer));
}

var rangeCount=splitRanges.length;
var selectionEnd;
if(blockSurroundedResult.surroundedIndexes[blockSurroundedResult.surroundedIndexes.length-1]===rangeCount-1)
{
selectionEnd=evaluateSelection($(splitRanges[rangeCount-1].startContainer));
}


if(selectionBegin){
selectionBegin.parent.unwrapWithOptions();
wrapUnselectedListItems(selectionBegin.selectionResult);
}

if(selectionEnd&&(!selectionBegin||(selectionBegin.parent[0]!==selectionEnd.parent[0]))){
selectionEnd.parent.unwrapWithOptions();
wrapUnselectedListItems(selectionEnd.selectionResult);
}
}closeListsAroundSelection._vpfn='$vpfn_3$7LuJupHHiNIYKfAptdXQ248$4';







function surroundRangeSet(splitRanges,blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockSurroundedResult=blockOptions.blockSurroundState;
var nodesByBlockRange=getTopNodesFromRanges(splitRanges);
var wrappedNodes=$();

closeListsAroundSelection(splitRanges,blockOptions);

var rangeLookup={};
$.each(blockSurroundedResult.surroundedIndexes,function $vpfn_RGNzPFS1YuxWq6Kxer$7PA302$56(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
rangeLookup[this]=1;
});


var rangeCount=splitRanges.length;
for(var i=0;i<rangeCount;i++){
var nodeContainer;
if(!rangeLookup[i]){


if(nodesByBlockRange[i][0].nodeType==3&&nodesByBlockRange[i][0].nodeValue.charCodeAt(0)==65279){
continue;
}

nodeContainer=nodesByBlockRange[i].wrapWithBlock({tagName:tagName.LI,contentEditableElement:blockOptions.contentEditableElement});
wrappedNodes.push(nodeContainer[0]);
}else{

var node=nodesByBlockRange[i].first().closest(tagName.LI);
if(!(node.parents(tagName.OL)[0]||node.parents(tagName.UL)[0])){
wrappedNodes.push(node[0]);
continue;
}


node.parent().children().each(function $vpfn_RGNzPFS1YuxWq6Kxer$7PA328$46(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
wrappedNodes.push(this);
});
node.parent().unwrapWithOptions();
}
}

var container=wrappedNodes.wrapWithOptions(blockOptions);
$(blockOptions.contentEditableElement).cleanup();


}surroundRangeSet._vpfn='$vpfn_FjR1eKrnSBECf1jYsFwf5w294$4';







function unSurroundRangeSet(splitRanges,blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var jParent=$(splitRanges[0].startContainer).closest(tagName.LI).parent();
var parentTag=jParent.prop("tagName");

var selectedLIs=getSelectedListElements(jParent,blockOptions);


jParent.unwrapWithOptions();


selectedLIs.beforeSelection.wrapWithOptions({tagName:parentTag});


selectedLIs.selection.unwrapWithOptions({"insertBr":true,"maintainStyles":true});


selectedLIs.afterSelection.wrapWithOptions({tagName:parentTag});
$(blockOptions.contentEditableElement).cleanup();
}unSurroundRangeSet._vpfn='$vpfn_urP$Ebgy517DVQ8fWp8Waw347$4';







function expandSelection(selectionRange,contentEditableElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!contentEditableElement){
return selectionRange;
}

var contentEditableRange=rangy.createRangyRange();
contentEditableRange.selectNodeContents(contentEditableElement);

var blocks=contentEditableRange.splitByBlock();
var clonedSelectionRange=selectionRange.cloneRange();


for(var i=0,l=blocks.length;i<l;i++){
if(clonedSelectionRange.intersectsRange(blocks[i])){

if(blocks[i].comparePoint(clonedSelectionRange.startContainer,clonedSelectionRange.startOffset)===0){
clonedSelectionRange.setStart(blocks[i].startContainer,blocks[i].startOffset);
}

if(blocks[i].comparePoint(clonedSelectionRange.endContainer,clonedSelectionRange.endOffset)===0){
clonedSelectionRange.setEnd(blocks[i].endContainer,blocks[i].endOffset);
}
}
}
return clonedSelectionRange;
}expandSelection._vpfn='$vpfn_WINV$qzHudYa4Zj$LE07WQ373$4';







function toggleSurroundRangeSet(range,options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockOptions=new blockSurroundOptions(options);

blockOptions["originalRange"]=range;
var splitRanges=range.splitByBlock();
var surroundState=isBlockSetSurrounded(splitRanges,blockOptions);
blockOptions.blockSurroundState=surroundState;
var newRanges=null;
if(surroundState.state()===surroundState.UnSurrounded||
surroundState.state()===surroundState.Mixed){
surroundRangeSet(splitRanges,blockOptions);
}else if(surroundState.state()===surroundState.Surrounded){
unSurroundRangeSet(splitRanges,blockOptions);
}
$(blockOptions.contentEditableElement).cleanup();
}toggleSurroundRangeSet._vpfn='$vpfn_d9VdA3W5qFgWGQn6QISTfA406$4';







function toggleSurroundSelectionSet(options,contentEditableElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockOptions=new blockSurroundOptions(options,contentEditableElement);


var savedSel=rangy.saveSelection();




var range=getRangeFromSavedSelection(savedSel);









if(range){
var expandedRanges=expandSelection(range,contentEditableElement);
toggleSurroundRangeSet(expandedRanges,blockOptions);
}

rangy.restoreSelection(savedSel);






}toggleSurroundSelectionSet._vpfn='$vpfn_jqWR17ZZzZHS3UaXYQAfUg429$4';







function toggleSurroundRange(range,options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(range.isCollapsed){
return;
}

var blockOptions=new blockSurroundOptions(options);

var newRanges=[];
var splitRanges=range.splitByBlock();
var surroundState=areRangesBlockSurrounded(splitRanges,blockOptions);

var nodesByRange=getTopNodesFromRanges(splitRanges);


for(var rangeIndex in nodesByRange){
var jNodes=nodesByRange[rangeIndex];
if(surroundState.state()==surroundState.Surrounded){
jNodes.unwrapBlock(blockOptions);
newRanges.push(createRange(jNodes[0],jNodes[jNodes.length-1]));
}else{
var container=nodesByRange[rangeIndex].wrapWithBlock(blockOptions);
newRanges.push(createRange(container[0],container[0]));
}
}
$(blockOptions.contentEditableElement).cleanup();
return newRanges;
}toggleSurroundRange._vpfn='$vpfn_kew4qcyX_2lnKHo$GYwPRw468$4';







function toggleSurroundSelection(options,contentEditableElement){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var blockOptions=new blockSurroundOptions(options,contentEditableElement);



var savedSel=rangy.saveSelection();







var range=getRangeFromSavedSelection(savedSel);

if(range){
var expandedRange=expandSelection(range,contentEditableElement);
range=toggleSurroundRange(expandedRange,blockOptions);
}

rangy.restoreSelection(savedSel);





return range;
}toggleSurroundSelection._vpfn='$vpfn_Yx1PSTKv613JDNxhCKKN5g502$4';



api.toggleSurroundRange=toggleSurroundRange;
api.toggleSurroundSelection=toggleSurroundSelection;


api.toggleSurroundRangeSet=toggleSurroundRangeSet;
api.toggleSurroundSelectionSet=toggleSurroundSelectionSet;
});

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}








rangy.createModule("InlineElementApplier",function $vpfn_F4VsylNP9TxnsP3IH9HS9w10$43(api,module)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.requireModules(["WrappedSelection","WrappedRange"]);



function excludeSelectionBoundarySpanFilter()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return!$(this).hasClass("rangySelectionBoundary");
}excludeSelectionBoundarySpanFilter._vpfn='$vpfn_3xA3qMOvhWj5t_jWpqo8VA16$4';

function inlineSurroundOptions(initOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(initOptions._isProcessed)
{

return initOptions;
}

var me=this;
this.tagName="";
this.properties="";
this.attr={};
this.contentEditableElement="";
this.styleName="";
this.styleValue="";

for(var prop in initOptions)
{
if(this[prop]===undefined)
{
throw"unknown initOption property specified. property: "+prop;
}

this[prop]=initOptions[prop];
}



var styles=initOptions.properties.style.split(";");
styles=_.filter(styles,function $vpfn_F4VsylNP9TxnsP3IH9HS9w50$34(style)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return style&&style.length>0;
});


_.each(styles,function $vpfn_F4VsylNP9TxnsP3IH9HS9w56$23(style)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styleValues=style.split(":");
me.styleName=$.trim(styleValues[0]);
me.styleValue=$.trim(styleValues[1]);
});


var div=$("<div>").css(this.styleName,this.styleValue);
this.attr["style"]=div[0].style.cssText;


this._isProcessed=true;
}inlineSurroundOptions._vpfn='$vpfn_qjKtYJh31tR1rFEb0jl3TQ21$4';




function isApplied(range,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return rangy.util.getTextNodes(range).hasStyle(options);
}isApplied._vpfn='$vpfn_s3lkvJRlRlUM9$iykOJURw74$4';




function applyToTextNode(textNode,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent=textNode.parent();

var children=parent.contents().filter(excludeSelectionBoundarySpanFilter);

if(children.length>1||parent.prop("tagName").toLowerCase()!==options.tagName)
{
textNode.wrapWithOptions(options);
}else
{
parent.css(options.styleName,options.styleValue);
}
}applyToTextNode._vpfn='$vpfn_3yAkHUJA8upM7NifcVQMYg82$4';




function applyToRange(range,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
rangy.util.getTextNodes(range).each(function $vpfn_F4VsylNP9TxnsP3IH9HS9w102$44()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
applyToTextNode($(this),options);
});
}applyToRange._vpfn='$vpfn_5bR9SNyt4Qe5Ckr5Tsrqmw100$4';




function undoToTextNode(textNode,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentWithStyle=textNode.getSelfOrParentWithStyleValue(options);
















var range=rangy.createRangyRange();
range.selectNodeContents(parentWithStyle[0]);

var otherTextNodes=_.filter(rangy.util.getTextNodes(range),function $vpfn_F4VsylNP9TxnsP3IH9HS9w133$70(node)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return node!==textNode.get(0);
});

_.each(otherTextNodes,function $vpfn_F4VsylNP9TxnsP3IH9HS9w138$31(node)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$(node).wrapWithOptions(options);
});

if(parentWithStyle[0]===options.contentEditableElement||parentWithStyle.is(":block")||_.size(parentWithStyle.getStyles())>1)
{
parentWithStyle[0].style.cssText=parentWithStyle[0].style.cssText.replace(options.attr["style"],"");
}else
{
parentWithStyle.unwrapWithOptions(options);
}
}undoToTextNode._vpfn='$vpfn_$C4FyhVPqSOwoYOin9OSbQ111$4';




function undoToRange(range,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
rangy.util.getTextNodes(range).each(function $vpfn_F4VsylNP9TxnsP3IH9HS9w157$44()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
undoToTextNode($(this),options);

});
}undoToRange._vpfn='$vpfn_zD$uTg3KmBcunQEJrmjqYQ155$4';




function toggleRange(range,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(range.collapsed)
{
return range;
}

var initOptions=new inlineSurroundOptions(options);
var textNodes=rangy.util.getTextNodes(range);
var surroundState=isApplied(range,initOptions);

if(surroundState)
{
undoToRange(range,initOptions);
}else
{
applyToRange(range,initOptions);
}


$(options.contentEditableElement).cleanup();
}toggleRange._vpfn='$vpfn_QmzcTBu$ORCbMFbmBbUtsw167$4';




function toggleSelection(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var inlineOptions=new inlineSurroundOptions(options);

var savedSel=rangy.saveSelection();








var range=rangy.util.getRangeFromSavedSelection(savedSel);
if(range)
{
toggleRange(range,inlineOptions);
}
rangy.restoreSelection(savedSel);





return range;
}toggleSelection._vpfn='$vpfn_KpU4s_4FFMiQC1ti7h8bvA193$4';


api.toggleRange=toggleRange;
api.toggleSelection=toggleSelection;
});
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;/*! 
 * @license Selection save and restore module for Rangy. 
 * Saves and restores user selections using marker invisible elements in the DOM. 
 * 
 * Part of Rangy, a cross-browser JavaScript range and selection library 
 * http://code.google.com/p/rangy/ 
 * 
 * Depends on Rangy core. 
 * 
 * Copyright 2011, Tim Down 
 * Licensed under the MIT license. 
 * Version: 1.2.2 
 * Build date: 13 November 2011 
 */}
rangy.createModule("SaveRestore",function $vpfn_pxw5Q_Pjhtj0LEASSAAtVg15$34(api,module){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
api.requireModules(["DomUtil","DomRange","WrappedRange"]);

var dom=api.dom;

var markerTextChar="\ufeff";

function gEBI(id,doc){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return(doc||document).getElementById(id);
}gEBI._vpfn='$vpfn_jpGrari5Mh7iIDzc0_eCbA22$4';

function insertRangeBoundaryMarker(range,atStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var markerId="selectionBoundary_"+(+new Date())+"_"+(""+Math.random()).slice(2);
var markerEl;
var doc=dom.getDocument(range.startContainer);


var boundaryRange=range.cloneRange();
boundaryRange.collapse(atStart);


markerEl=doc.createElement("span");
markerEl.id=markerId;
markerEl.style.lineHeight="0";
markerEl.style.display="none";
markerEl.className="rangySelectionBoundary";
markerEl.appendChild(doc.createTextNode(markerTextChar));

boundaryRange.insertNode(markerEl);
boundaryRange.detach();
return markerEl;
}insertRangeBoundaryMarker._vpfn='$vpfn_N2d$8E1e8holvezzrujBkg26$4';

function setRangeBoundary(doc,range,markerId,atStart){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var markerEl=gEBI(markerId,doc);
if(markerEl){
range[atStart?"setStartBefore":"setEndBefore"](markerEl);
markerEl.parentNode.removeChild(markerEl);
}else{
module.warn("Marker element has been removed. Cannot restore selection.");
}
}setRangeBoundary._vpfn='$vpfn_g9zCf$AoQADi1d$vFjn_hQ48$4';

function compareRanges(r1,r2){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return r2.compareBoundaryPoints(r1.START_TO_START,r1);
}compareRanges._vpfn='$vpfn_iNj_$9mZtfo5OTvSxUR16Q58$4';

function saveSelection(win){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
win=win||window;
var doc=win.document;
if(!api.isSelectionValid(win)){
module.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");
return;
}
var sel=api.getSelection(win);
var ranges=sel.getAllRanges();
var rangeInfos=[],startEl,endEl,range;


ranges.sort(compareRanges);

for(var i=0,len=ranges.length;i<len;++i){
range=ranges[i];
if(range.collapsed){
endEl=insertRangeBoundaryMarker(range,false);
rangeInfos.push({
markerId:endEl.id,
collapsed:true
});
}else{
endEl=insertRangeBoundaryMarker(range,false);
startEl=insertRangeBoundaryMarker(range,true);

rangeInfos[i]={
startMarkerId:startEl.id,
endMarkerId:endEl.id,
collapsed:false,
backwards:ranges.length==1&&sel.isBackwards()
};
}
}



for(i=len-1;i>=0;--i){
range=ranges[i];
if(range.collapsed){
range.collapseBefore(gEBI(rangeInfos[i].markerId,doc));
}else{
range.setEndBefore(gEBI(rangeInfos[i].endMarkerId,doc));
range.setStartAfter(gEBI(rangeInfos[i].startMarkerId,doc));
}
}


sel.setRanges(ranges);
return{
win:win,
doc:doc,
rangeInfos:rangeInfos,
restored:false
};
}saveSelection._vpfn='$vpfn_5fB4YM7X3_163_zSc1z6Ww62$4';

function restoreSelection(savedSelection,preserveDirection){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!savedSelection.restored){
var rangeInfos=savedSelection.rangeInfos;
var sel=api.getSelection(savedSelection.win);
var ranges=[];



for(var len=rangeInfos.length,i=len-1,rangeInfo,range;i>=0;--i){
rangeInfo=rangeInfos[i];
range=api.createRange(savedSelection.doc);
if(rangeInfo.collapsed){
var markerEl=gEBI(rangeInfo.markerId,savedSelection.doc);
if(markerEl){
markerEl.style.display="inline";
var previousNode=markerEl.previousSibling;


if(previousNode&&previousNode.nodeType==3){
markerEl.parentNode.removeChild(markerEl);
range.collapseToPoint(previousNode,previousNode.length);
}else{
range.collapseBefore(markerEl);
markerEl.parentNode.removeChild(markerEl);
}
}else{
module.warn("Marker element has been removed. Cannot restore selection.");
}
}else{
setRangeBoundary(savedSelection.doc,range,rangeInfo.startMarkerId,true);
setRangeBoundary(savedSelection.doc,range,rangeInfo.endMarkerId,false);
}




if(len==1){
range.normalizeBoundaries();
}
ranges[i]=range;
}
if(len==1&&preserveDirection&&api.features.selectionHasExtend&&rangeInfos[0].backwards){
sel.removeAllRanges();
sel.addRange(ranges[0],true);
}else{
sel.setRanges(ranges);
}

savedSelection.restored=true;
}
}restoreSelection._vpfn='$vpfn_OEHf0lkrC26gIqBNS8A7_g119$4';

function removeMarkerElement(doc,markerId){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var markerEl=gEBI(markerId,doc);
if(markerEl){
markerEl.parentNode.removeChild(markerEl);
}
}removeMarkerElement._vpfn='$vpfn_nCEM5aMBgPhAHnm8f3YaFA171$4';

function removeMarkers(savedSelection){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var rangeInfos=savedSelection.rangeInfos;
for(var i=0,len=rangeInfos.length,rangeInfo;i<len;++i){
rangeInfo=rangeInfos[i];
if(rangeInfo.collapsed){
removeMarkerElement(savedSelection.doc,rangeInfo.markerId);
}else{
removeMarkerElement(savedSelection.doc,rangeInfo.startMarkerId);
removeMarkerElement(savedSelection.doc,rangeInfo.endMarkerId);
}
}
}removeMarkers._vpfn='$vpfn_kWSABrljs_w9GGQfLxuOHQ178$4';

api.saveSelection=saveSelection;
api.restoreSelection=restoreSelection;
api.removeMarkerElement=removeMarkerElement;
api.removeMarkers=removeMarkers;
});

if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}

var tagName={
LI:"LI",
OL:"OL",
UL:"UL",
BR:"BR",
DIV:"DIV",
SPAN:"SPAN",
P:"P"
};

var NODE_TYPE={
ELEMENT:1,
ATTRIBUTE:2,
TEXT:3,
COMMENT:8
};

var rangySelectionBoundaryClassName="rangySelectionBoundary";

(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g22$1($){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

$.extend($.expr[':'],{




block:function $vpfn_KnIAR_hbHOe4vKM2LiQ16g29$15(element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return element.nodeType!==3&&((element&&element.tagName==="BR")||(($(element).css("display")==="block"||$(element).css("display")==="list-item")&&$(element).css("float")==="none"));
},




blockChildren:function $vpfn_KnIAR_hbHOe4vKM2LiQ16g37$23(element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

return $(element).children().not(this).filter(":block").length>0;
}
});
























$.fn.closestWithNoMultipleBlockLevelChildren=function $vpfn_EtZyykKEwIMx$IIwBgaWVQ66$51(topMostElement,dynamicCeiling){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allNodes=[];
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g68$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent;
$(this).parentsUntil(topMostElement).each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g70$54(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var filterResult=dynamicCeiling?dynamicCeiling(this):true;
var blockChildrenCount=$(this).children(":block").length;
var isValid=filterResult&&
(blockChildrenCount<2)&&
(!blockChildrenCount||blockChildrenCount===this.childNodes.length);
if(isValid){
parent=this;
}
return isValid;
});
var result=parent||this;
if($.inArray(result,allNodes)===-1){
allNodes.push(result);
}
});

return $(allNodes);
};








var seekDirection={Next:0,Prev:1};
function getSiblingIncludingTextNodes(nodes,direction,filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allNodes=$();
var isNext=direction===seekDirection.Next;
nodes.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g101$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result;
var children=$(this).parent().contents().get();
var index=$.inArray($(this).get(0),children);


var increment=isNext?1:-1;
for(var i=index+increment;isNext?i<children.length:i>=0;i=i+increment){
var filterResult=filter?filter(i,children[i]):true;
if(filterResult){
result=children[i];
break;
}
}
if(result){
allNodes.push(result);
}
});
return allNodes;
}getSiblingIncludingTextNodes._vpfn='$vpfn_Y2FYDmL5_v8JBPxAXwYBMg98$4';







$.fn.prevSiblingIncludingTextNodes=function $vpfn_asjXPzL0AxuIcbUnl$o$Dg128$41(filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return getSiblingIncludingTextNodes(this,seekDirection.Prev,filter);
};






$.fn.nextSiblingIncludingTextNodes=function $vpfn_F$AjecOP7YeG7mPh1RP6eA137$41(filter){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return getSiblingIncludingTextNodes(this,seekDirection.Next,filter);
};

$.fn.allNextIncludingTextNodes=function $vpfn_YGR2ivb7lRu0e4Kd3Z3Tow141$37(filter)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var content=$(this).parent().contents().filter(filter);
var index=content.index(this);
return content.splice(index+1).map(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g145$45(val){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(val);
});
};

$.fn.allPrevIncludingTextNodes=function $vpfn_LKXiG7Q8D5Di1FNd3nofzw150$37(filter)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var content=$(this).parent().contents().filter(filter);
var index=content.index(this);
return content.splice(0,index).map(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g154$44(val){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(val);
});
};




$.fn.getStyles=function $vpfn_3tqX6_01BQqD8lr1rVc5qg162$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var returnValue={};
var htmlElement=this.get(0);
if(htmlElement.nodeType===NODE_TYPE.TEXT)
{
return returnValue;
}


var style=this.attr("style");
var cssText=(style)?style.split(';'):[];

cssText=_.filter(cssText,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g175$36(val){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $.trim(val)!=="";
});

_.each(cssText,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g179$24(style){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var index=style.indexOf(':');
var key=$.trim(style.substring(0,index));
var value=$.trim(style.substring(index+1));


if(value)
{
switch(key)
{

case"font-family":

value=value.replace(/[\'\"]/ig,"");
break;
case"font-weight":

if(!isNaN(value))
{
var newValue=parseInt(value);
value=(newValue===700)?"bold":"normal";
}
break;
default:
break;
}
returnValue[key.toLowerCase()]=value;
}
});

return returnValue;
};





$.fn.wrapWithOptions=function $vpfn_ob6cmge_D7Ut6HkL7u0C4A216$27(options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var wrapContainer=$();
if(this.length>0){
wrapContainer=$.createContainerWithOptions(options);
var rangyStartTag=this.first().prevSiblingIncludingTextNodes();
if(rangyStartTag.hasClass(rangySelectionBoundaryClassName))
{
wrapContainer.append(rangyStartTag);
}
this.first().before(wrapContainer);
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g226$22(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
wrapContainer.append(this);
});

var rangyEndTag=this.last().nextSiblingIncludingTextNodes();
if(rangyEndTag.hasClass(rangySelectionBoundaryClassName))
{
wrapContainer.append(rangyEndTag);
}
}
return wrapContainer;
};





$.fn.unwrapWithOptions=function $vpfn_Ch4Uozrh_AmKHlmYWWnOvg243$29(options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var children=$();

this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g246$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $this=$(this);


var prevNode=$this.prevSiblingIncludingTextNodes(noEmptyTextNodeOrRangySelectionMarkerSpanFilter);
if(prevNode.length&&!prevNode.is(":block")&&options&&options["insertBr"])
{
$this.before($("<br />"));
}


var nextNode=$this.nextSiblingIncludingTextNodes(noEmptyTextNodeOrRangySelectionMarkerSpanFilter);
if(nextNode.length&&!nextNode.is(":block")&&options&&options["insertBr"]&&$this.blockOrLastChildBlock().length===0){
$this.after($("<br />"));
}

var contents=$(this).contents();


var styles=$this.getStyles();
if(options&&options["maintainStyles"]&&_.size(styles))
{
var newContainer=contents.wrapWithOptions({tagName:"span",attr:{style:$this.attr("style")}});
newContainer.unwrap();
children=children.add(newContainer);
}else
{
contents.first().unwrap();
children=children.add(contents);
}
});

return children;
};

$.fn.blockOrLastChildBlock=function $vpfn_ghsGf4PyeAqqNq79zRaGnQ281$33()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=[];

this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g285$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var lastChild=$(this).children(":last-child");
while(lastChild.length>0)
{
if(lastChild.is(":block"))
{
result.push(lastChild[0]);
break;
}
else
{
lastChild=lastChild.children(":last-child");
}
}
});

return $(result);
};





$.fn.blockSurrounded=function $vpfn_gXLfQdMeO7a$3ASk$SoTaQ309$27(blockOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var areSurrounded=true;


this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g314$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent=blockOptions.blockSurroundTag?
$(this).closest(blockOptions.blockSurroundTag):
$(this).closestWithNoMultipleBlockLevelChildren(blockOptions.contentEditableElement.parentNode,noLIsFilter);

if(!(parent.length&&parent.is(":block")))
{
return areSurrounded=false;
}


if(blockOptions.attr)
{
for(var attr in blockOptions.attr)
{
switch(attr)
{
case"style":
var parentWithStyle=parent.getSelfOrParentWithStyleValue(blockOptions);
if(!parentWithStyle.get(0))
{
return areSurrounded=false;
}
break;
default:
var parentAttr=parent.attr(attr);
if(!parentAttr||parentAttr.indexOf(blockOptions.attr[attr])===-1)
{
return areSurrounded=false;
}
break;
}
}
}

return areSurrounded=true;
});

return areSurrounded;
};








$.fn.listSurrounded=function $vpfn_pcft17lV1PJZ6D6Oci6ZXA362$26(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allNodesListSurrounded=_.all(this,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g364$49(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(node).closest(tagName.LI).parents("[contenteditable=true]").get(0);
});

if(allNodesListSurrounded)
{
var parents=this.closest(tagName.LI).parent();
if(options&&options["singleList"]&&parents.length>1)
{
return false;
}

if(options&&options["tagName"])
{
var hasSameTagName=false;
parents.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g379$29(index,element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
hasSameTagName=element.tagName===options["tagName"];
return hasSameTagName;
});
return hasSameTagName;
}
return true;
}

return false;
};





$.fn.wrapWithBlock=function $vpfn_8g2YoUgZ124fYm3iyzLv_A395$24(blockOptions){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var blockParent=this.closestWithNoMultipleBlockLevelChildren(blockOptions.contentEditableElement,noLIsFilter);

var container;
if(!blockParent.first().is(":block")){
container=blockParent.wrapWithOptions(blockOptions);
}else{
if(blockOptions.tagName.toUpperCase()===tagName.LI){
container=blockParent.wrapWithOptions(blockOptions);
}else{
blockParent.css(blockOptions.styleName,blockOptions.styleValue);
container=blockParent;
}
}


var br=container.next();
if(br.length&&br.prop("tagName")==tagName.BR){
br.remove();
}
return container;
};





$.fn.unwrapBlock=function $vpfn_7yHrFb5_KJ2rAbTGkBdkAA423$23(blockOptions)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var blockParent=this.getSelfOrParentWithStyle(blockOptions);
if(!blockParent.length)
{
return this;
}

if(_.size(blockParent.getStyles())>1||blockParent.attr("contentEditable"))
{

return blockParent.css(blockOptions.styleName,"");
}else
{
var blockParentNextSibling=blockParent.nextSiblingIncludingTextNodes(noEmptyTextNodeOrRangySelectionMarkerSpanFilter);

var hasNonBlockNextSibling=blockParentNextSibling.length&&!blockParentNextSibling.is(":block");

var insertBr=!hasNonBlockNextSibling;
return blockParent.unwrapWithOptions({"insertBr":insertBr});
}
};





$.fn.hasSameListParent=function $vpfn_BGYBle5HrAvvBSFrvIefnA451$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parent=this.first().closest(tagName.LI).parent();
if(parent.length===0){
return false;
}

var hasSameParent=true;
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g458$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
hasSameParent=parent.has(this).length!==0;
return hasSameParent;
});
return hasSameParent;
};

var noLIsFilter=function $vpfn_UmYhCNE0QowntV0W5qHGFg465$22(element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return element.tagName!==tagName.LI;};
var noEmptyTextNodesFilter=function $vpfn_bvGjwb2YJixIJKhqbbLpwg466$33(index,element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return!(element.nodeType===3&&element.nodeValue.match(/^\s*$/ig));};
var noRangySelectionMarkerSpanFilter=function $vpfn_PSFJ6CvJnM_30oX$6rqA_w467$43(index,element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return!$(element).hasClass(rangySelectionBoundaryClassName);};
var noEmptyTextNodeOrRangySelectionMarkerSpanFilter=function $vpfn_xyVWNu8t4Gx1Ejg4vIyZ$g468$58(index,element)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return noEmptyTextNodesFilter(index,element)&&noRangySelectionMarkerSpanFilter(index,element);
};



$.fn.hasStyle=function $vpfn_3CciwAH8VZRD612x8wPrNg475$20(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentsWithStyle=this.getSelfOrParentWithStyleValue(options);
return this.length===parentsWithStyle.length;
};

$.fn.hasSameStyle=function $vpfn_MNpeIIrESozO$JqOYeD0AA481$24(jNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var thisStyles=this.getStyles();
var thatStyles=jNode.getStyles();
return _.isEqual(thisStyles,thatStyles);
};

$.fn.getSelfOrParentWithStyleValue=function $vpfn_OLC3QeeFntbVfUo0bRV0dw488$41(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=$();
var nodesWithStyle=this.getSelfOrParentWithStyle(options).filter(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g491$75(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styles=$(this).getStyles();
return options.styleValue===styles[options.styleName];
});
if(nodesWithStyle.length===this.length)
{
return nodesWithStyle;
}
return result;
};

$.fn.getSelfOrParentWithStyle=function $vpfn_o7Rb65i8kzQu9TPaF7QW$g502$36(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=$();
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g505$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var contentEditableElement=options.contentEditableElement||$(this).closest("[contenteditable=true]").first()[0];
if(contentEditableElement)
{
var parentsAndSelf=$(this).parentsUntil(contentEditableElement.parentNode);

parentsAndSelf.splice(0,0,this);

parentsAndSelf.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g513$36(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styles=$(this).getStyles();

if(styles&&styles[options.styleName])
{
result.push(this);
return false;
}
return true;
});
}
});
return result;
};

$.fn.getAttributes=function $vpfn_UNGENh_HOODhk7rIp$0RDA528$25()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result={};
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g531$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<this.attributes.length;i++)
{
result[this.attributes[i].name]=1;
}
});
return _.keys(result);
};












































$.createContainerWithOptions=function $vpfn_nf2N3PzFdwkBH8jU85U_KQ583$35(options){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newElement=$("<"+options.tagName+">");
if(options.attr){
newElement.attr(options.attr);
}
newElement.css(options.styleName,options.styleValue);
return newElement;
};





if(document.documentElement.contains){
jQuery.contains=function $vpfn_Utpss1Ndz7aQfqmO0DlOtg597$26(a,b){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


if(a===b){
return false;
}


if(a.nodeType===3)
{
return false;
}


var bup=b.parentNode||{};
return a===bup||(bup.nodeType===1?(!a.contains||a.contains(bup)):
((a!==b&&a.contains)?a.contains(b):true));
};
}




$.fn.compareNodes=function $vpfn_dPFy80FjbRs7q20dwsAcEA620$24($node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!this[0]||!$node[0]){
return false;
}
var isEqual=true;

var attributes=["style","id","class"];


if(this.prop('tagName')===$node.prop('tagName')){

var $currentNode=this;
$.each(attributes,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g632$31(i,attrib){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(attrib==="style")
{
var nodeStyles=$node.getStyles();
var currentNodeStyles=$currentNode.getStyles();

if(_.size(nodeStyles)!==_.size(currentNodeStyles))
{
isEqual=false;
}else
{
isEqual=_.all(nodeStyles,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g643$52(styleValue,styleName){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return currentNodeStyles[styleName]&&currentNodeStyles[styleName].toLowerCase()===styleValue.toLowerCase();
});
}
}
else
{
var thisAttr=$currentNode.attr(attrib)&&$.trim($currentNode.attr(attrib));
var thatAttr=$node.attr(attrib)&&$.trim($node.attr(attrib));

isEqual=thisAttr===thatAttr;
}
return isEqual;
});

if(isEqual){

var thisContent=this.contents().filter(noEmptyTextNodesFilter);
var thatContent=$node.contents().filter(noEmptyTextNodesFilter);


isEqual=thisContent.length===thatContent.length;

for(var i=0,l=thisContent.length;i<l&&isEqual;i++){
isEqual=thisContent[i].nodeType===3?$.trim(thisContent[i].nodeValue)===$.trim(thatContent[i].nodeValue):$(thisContent[i]).compareNodes($(thatContent[i]));
}
}
}
else{
isEqual=false;
}

return isEqual;
};

})(jQuery);





(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g684$1($)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var configuration={
attributes:{
"style":1
},
style:{
"font-style":1,
"font-weight":1,

"color":1,
"font-size":1,
"text-align":1
},
tag:{
"P":1,
"DIV":1,
"UL":1,
"OL":1,
"LI":1,
"SPAN":1
},
nodeType:{
"1":1,
"3":1
}
};

var noEmptyTextNodesFilter=function $vpfn_bvGjwb2YJixIJKhqbbLpwg712$33(index,element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return!(element.nodeType===3&&element.nodeValue.match(/^\s*$/ig));};
var noRangySelectionMarkerSpanFilter=function $vpfn_PSFJ6CvJnM_30oX$6rqA_w713$43(index,element){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}return!$(element).hasClass(rangySelectionBoundaryClassName);};
var noEmptyTextNodeOrRangySelectionMarkerSpanFilter=function $vpfn_xyVWNu8t4Gx1Ejg4vIyZ$g714$58(index,element)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return noEmptyTextNodesFilter(index,element)&&noRangySelectionMarkerSpanFilter(index,element);
};



$.fn.removeEmptyLists=function $vpfn_O3JxM15hhXxhSuT7yH2l5A721$28(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.removeEmptyElement(tagName.OL);
this.removeEmptyElement(tagName.UL);
};




$.fn.mergeAdjunctLists=function $vpfn_tLOhRuH5aDNqY7PwqMz96g729$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var mergeLists=function $vpfn_F7uKVOLdqx6zezTABD9oRg730$25(lists){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var tagName=$(lists[0]).prop("tagName");
while(lists.length){
var currentList=$(lists[lists.length-1]);
lists.splice(lists.length-1,1);
var prevNode=currentList.prevSiblingIncludingTextNodes(noEmptyTextNodeOrRangySelectionMarkerSpanFilter);
if(prevNode&&prevNode.prop("tagName")===tagName){
lists.splice(lists.length-1,1);

var children=$();
prevNode.children().each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g740$45(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
children.push(this);
});
currentList.children().each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g743$48(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
children.push(this);
});

prevNode.unwrapWithOptions();
currentList.unwrapWithOptions();
lists.push(children.wrapWithOptions({tagName:tagName}));
}
}
};

mergeLists(this.find(tagName.OL));
mergeLists(this.find(tagName.UL));
};




$.fn.cleanupLists=function $vpfn_hxDnnNymmt7y8K8mMhpdow761$24(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.removeEmptyLists();
this.mergeAdjunctLists();
};



var seekDirection={Next:0,Prev:1};
var getMergableElement=function $vpfn_xxNwFQkbP9ZuUeOGe0o2fA769$29(jElement,direction,filter)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=$();
var adjacentElement=direction==seekDirection.Next?jElement.nextSiblingIncludingTextNodes(filter):jElement.prevSiblingIncludingTextNodes(filter);


if(adjacentElement.length&&adjacentElement.prop("nodeType")===1&&
jElement.prop("nodeType")===adjacentElement.prop("nodeType")&&
!adjacentElement.is(":block")&&
jElement.hasSameStyle(adjacentElement))
{
result.push(adjacentElement[0]);
}
return result;
};

$.fn.nextMergableElement=function $vpfn_rWPIWTPfRaqOEEjYKbV12A785$31(filter)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return getMergableElement($(this),seekDirection.Next,filter);
};

$.fn.prevMergableElement=function $vpfn_NK6__uJjOsxCtp191kcf8A790$31(filter)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return getMergableElement($(this),seekDirection.Prev,filter);
};

function mergeNodes(node1,node2)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

node1.append(node2.contents());
node2.remove();
return node1;
}mergeNodes._vpfn='$vpfn_JulYIRpe5LDlLy3noWDnrQ795$4';

var getContentNodes=function $vpfn_6ZlCLa5Xx8YPk9TE6OH4dA803$26(jelement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return jelement.contents().filter(noEmptyTextNodeOrRangySelectionMarkerSpanFilter).map(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g805$95(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(this);
});
};




var mergableTags={SPAN:1,DIV:1,P:1};




var styleableTags={SPAN:1,DIV:1,P:1,LI:1,UL:1,OL:1};









$.fn.mergeInlineElements=function $vpfn_Rom$H5ingMfYOhb7cSIxvg828$31()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g830$18(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $this=$(this);
var nodes=getContentNodes($this);

nodes.mergeInlineElements();


var nodesLength=nodes.length;
for(var i=1;i<nodesLength;i++)
{
if(!nodes[i].is(":block"))
{
var prevMergableElement=nodes[i].prevMergableElement(noEmptyTextNodesFilter);
if(prevMergableElement.get(0))
{


var prevNode=nodes[i].prevSiblingIncludingTextNodes();
if(prevNode.get(0)!==prevMergableElement.get(0))
{

prevMergableElement.append(prevNode.get(0));
}
mergeNodes(prevMergableElement,nodes[i]);
}
}
}


if($this.get(0).nodeType===NODE_TYPE.TEXT)
{
return;
}


nodes=getContentNodes($this);




nodes.filter(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g870$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentTagName=$this.prop("tagName");
return styleableTags[parentTagName]&&
!(this.get(0).nodeType===NODE_TYPE.TEXT);
}).each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g874$20(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var styles=$(this).getStyles();
if(nodes.length===1)
{

_.each(styles,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g879$35(styleValue,styleKey){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
$this.css(styleKey,styleValue);
nodes.get(0).css(styleKey,"");
});
}else
{

_.each(styles,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g886$35(styleValue,styleKey){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(nodes.hasStyle({styleName:styleKey,styleValue:styleValue}))
{
$this.css(styleKey,styleValue);
nodes.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g890$39(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.css(styleKey,"");
});
}
});
}
});



nodes.filter(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g900$25(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


return!(this.get(0).nodeType===NODE_TYPE.TEXT
||this.is(":block")&&nodes.length>1
||!mergableTags[this.prop("tagName")]);
}).each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g906$20(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var contentNode=$(this);
var styles=contentNode.getStyles();



var allStylesApplied=_.all(styles,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g913$53(styleValue,styleKey){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentWithStyle=contentNode.parent().getSelfOrParentWithStyle({styleName:styleKey});
return parentWithStyle.get(0)&&(parentWithStyle.getStyles()[styleKey]===styleValue);
});

if(allStylesApplied)
{
contentNode.contents().first().unwrap();
return;
}
});


var parentStyles=$this.getStyles();
nodes=getContentNodes($this);
_.each(parentStyles,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g928$34(styleValue,styleKey){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var allNodesHaveStyle=_.all(nodes,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g929$53(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return node.getStyles()[styleKey];
});

if(allNodesHaveStyle)
{
$this.css(styleKey,"");
}
});
});
};





$.fn.removeEmptyElement=function $vpfn_vXwkNifMzKQrEqOS7xzXjA945$30(tagName,options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var insertBr=!options||options.insertBr;
do
{
this.find(tagName+":empty").each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g950$47(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var element=$(this);
if(insertBr&&element.is(":block")&&element.nextSiblingIncludingTextNodes(noRangySelectionMarkerSpanFilter).length&&element.prevSiblingIncludingTextNodes(noRangySelectionMarkerSpanFilter).length)
{

element.before("<br />");
}
element.remove();
});
}while(this.find(tagName).is(":empty"));
};




$.fn.removeEmptyElements=function $vpfn_jmBNo5tXvMCKP461Lgjxyg965$31(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.removeEmptyElement(tagName.SPAN);
this.removeEmptyElement(tagName.P,options);
this.removeEmptyElement(tagName.DIV,options);
};

$.fn.handleRangySelectionMarkers=function $vpfn_jjI2nRX3_$SugGyyiety2g972$39()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.find("."+rangySelectionBoundaryClassName).each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g974$62(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var parentContents=$(this).parent().contents();
if(parentContents.length===1)
{
parentContents.unwrap();
}
});
};

var getReplacementNode=function $vpfn_Vci6mZ9pKmnN6dbaArqv_A983$29(jNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var nodeType=jNode.get(0).nodeType;
if(!configuration.nodeType[nodeType])
{
jNode.remove();
return null;
}


if(nodeType==NODE_TYPE.TEXT)
{
var nodeValue=jNode.get(0).nodeValue;

nodeValue=nodeValue.replace(/<!--[\S\s]*?-->/ig,'');


if(nodeValue===""||!nodeValue.match(/\S+/ig)||nodeValue.match(/^[\xA0]+$/ig))
{
jNode.remove();
return null;
}


jNode.get(0).nodeValue=nodeValue.replace(/\n/ig,"").replace(/[\xA0|\s+]{2,}/ig," ");
return null;
}

var tagName=jNode.prop("tagName");
if(configuration.tag[tagName])
{

_.each(jNode.getAttributes(),function $vpfn_KnIAR_hbHOe4vKM2LiQ16g1015$42(attribute){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!configuration.attributes[attribute])
{
try
{

jNode.removeAttr(attribute);
}
catch(e){}
}
});

var cssText="";
_.each(jNode.getStyles(),function $vpfn_KnIAR_hbHOe4vKM2LiQ16g1028$38(value,style){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var keepStyle=configuration.style[style];
if(keepStyle)
{
switch(style)
{
case"font-size":
keepStyle=value.match(/\d+\s?px/);
break;
case"color":
keepStyle=value.match(/^#[a-fA-F0-9]{6}$/||value.match(/^rgb\(\d+,\s*\d+\,\s*\d+\)$/));
break;
default:
break;
}
}

if(keepStyle)
{
cssText+=style+': '+value+'; ';
}
});
jNode.get(0).style.cssText=cssText;

return null;
}


switch(jNode.prop("tagName"))
{
case"B":
return $("<span style='font-weight: bold'></span>").html(jNode.html());
case"I":
return $("<span style='font-style: italic'></span>").html(jNode.html());
case"U":
case"S":
case"FONT":
return $("<span></span>").html(jNode.html());
case"BR":
return $("<br/>");
default:
return $("<p></p>").html(jNode.html());
}
};

var handleUnsanctionedTags=function $vpfn_QN9fp3pJfNG_JGevBXO0yQ1073$33(nodes)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
nodes.each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g1075$19(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $this=$(this);
handleUnsanctionedTags($this.contents());

var replacementNode=getReplacementNode($this);
if(replacementNode)
{
$this.replaceWith(replacementNode);
}
});
};

$.fn.handleUnsanctionedTags=function $vpfn_xWHkEt37MvLixgF7znGkZA1087$34()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
handleUnsanctionedTags($(this).contents());
$(this).cleanup({insertBr:false});
};

var attributes=["style","id","class"];
$.fn.convertDivsToP=function $vpfn_Sks$j$hauibtDnYJ8yZxwA1094$26()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var result=$();
$(this).children().each(function $vpfn_KnIAR_hbHOe4vKM2LiQ16g1097$32(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $this=$(this);
$this.convertDivsToP();

if(this.tagName===tagName.DIV)
{
var pElement=$("<p>").html($this.html());

_.each(attributes,function $vpfn_KnIAR_hbHOe4vKM2LiQ16g1105$35(attribute){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var attrValue=$this.attr(attribute);
if(attrValue)
{
pElement.attr(attribute,attrValue);
}
});

$this.before(pElement);
$this.remove();
result.push(pElement.get(0));
}
});
return result;
};




$.fn.cleanup=function $vpfn_67MpOU949bI2OWCThmUopQ1124$19(options)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var $this=$(this);
$this.handleRangySelectionMarkers();
$this.removeEmptyElements(options);
$this.mergeInlineElements();
$this.cleanupLists();
};

})(jQuery);
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}vp.define("vp.studio.richtext");

vp.studio.richtext.util={};

vp.studio.richtext.util.STYLE_NAME_MAP={
"font-style":"fontStyle",
"font-weight":"fontWeight",
"font-size":"fontSize",
"color":"fontColor",
"text-align":"align",
"font-family":"fontFamily"
};




vp.studio.richtext.util.getDocumentItemPropertyName=function $vpfn_oFyl7tkZATiX2cg04QiV3w17$54(propertyName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.studio.richtext.util.STYLE_NAME_MAP[propertyName]||propertyName;
};

vp.studio.richtext.cleanupStyle=function $vpfn_AjRxAhgZpu5HFkowLS5qBQ22$34(styleName,styleValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
switch(styleName)
{
case"font-size":

return styleValue.replace(/\s*px\s*/i,'');
case"font-family":

return styleValue.replace(/\'/ig,'');
default:
return styleValue;
}
};

vp.studio.richtext.util.getSelectedTextFields=function $vpfn_Ug1k1Wj$$wh1Mpp1OzvwyA37$48()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.studio.richtext.util.getSelectedFields(DOCITEM_TYPE_TEXT);
};

vp.studio.richtext.util.getSelectedWordArtFields=function $vpfn_XOWNVHTZqQw6Xwymne$Xig42$51()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.studio.richtext.util.getSelectedFields(DOCITEM_TYPE_WORDART);
};

vp.studio.richtext.util.getSelectedTableFields=function $vpfn_mlbyzqU4fhpIObeByDiJ9g47$49()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return vp.studio.richtext.util.getSelectedFields(DOCITEM_TYPE_TABLE);
};

vp.studio.richtext.util.getSelectedFields=function $vpfn_6b2vELl8ohuZ78AbzZFOMw52$44(type)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _.filter(Editor.selection.getArray(),function $vpfn_Frsne4YQNJ_Brcp_qodh3w54$49(textField){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return textField.type===type;
});
};

vp.studio.richtext.util.getSelectedTextNodes=function $vpfn_IRQvhaa0M3ks9jXk3nCPRw59$47(allowCollapsedSelection)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var selectedNodes=$();
var textFields=vp.studio.richtext.util.getSelectedTextFields();
if(!textFields.length)
{
return selectedNodes;
}

var range=null;
var userSelection=rangy.getSelection();

if(userSelection.isCollapsed||!vp.studio.richtext.util.isValidSelection())
{
if(allowCollapsedSelection&&vp.studio.richtext.util.isValidSelection())
{
range=userSelection.getRangeAt(0);
selectedNodes.push(range.startContainer);
return selectedNodes;
}


_.each(textFields,function $vpfn_Frsne4YQNJ_Brcp_qodh3w81$27(textField){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var contentEditable=textField.getActiveTextArea().contentEditableElement;



if($(contentEditable).text()==="")
{
selectedNodes=selectedNodes.add($(contentEditable));
return;
}
vp.studio.richtext.util.getTextNodesFromElement(contentEditable).each(function $vpfn_Frsne4YQNJ_Brcp_qodh3w91$82(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
selectedNodes=selectedNodes.add($(this));
});
});
}
else
{
range=userSelection.getAllRanges()[0];
selectedNodes=rangy.util.getTextNodes(range);
}
return selectedNodes;
};




vp.studio.richtext.util.isValidSelection=function $vpfn_YNOUFEC9pTqeBMxYCZpevQ107$43()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var userSelection=rangy.getSelection();
var range=userSelection.getAllRanges()[0];
if(range)
{
var textFields=vp.studio.richtext.util.getSelectedTextFields();
return _.any(textFields,function $vpfn_Frsne4YQNJ_Brcp_qodh3w114$33(textField)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var contentEditable=textField.getActiveTextArea().$contentEditableElement;
return contentEditable.has(range.startContainer).get(0);
});
}
return false;
};

vp.studio.richtext.util.getTextNodesFromElement=function $vpfn_GrknWz97AsDFXmbc6N_f$w123$50(element)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range=rangy.createRangyRange();
range.selectNodeContents(element);
return rangy.util.getTextNodes(range);
};

vp.studio.richtext.util.moveCursorToEndOfElement=function $vpfn_kvJhVA_JgSoR6h1zxsnI$A130$51(element)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var range=new rangy.createRangyRange();
range.selectNodeContents(element);
range.collapse();

var selection=rangy.getSelection();
selection.setSingleRange(range);
};

vp.studio.richtext.util.convertNodeToXml=function $vpfn_qWnKXr9XlvrDKyPGNAyk_A140$43(element,xmlDocument,styleManager)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var bIsFirstNode=false;


if(!xmlDocument)
{
oXmlDoc=vp.web.getXMLDocument();
bIsFirstNode=true;
}

var oNewNode;
if(element.nodeType==1)
{
oNewNode=oXmlDoc.createElement(element.tagName.toUpperCase());
if(bIsFirstNode)
{
oNewNode.setAttribute("xml:space","preserve");
}


if(element.style.cssText)
{
var sCssText=element.style.cssText.toLowerCase();
var oCss=new vp.web.CssString(sCssText);

if(oCss.items["color"])
{
var oColor=styleManager.deserializeStyleValue("color",oCss.items["color"]);
oCss.setItem("color",oColor.toString());
}

if(oCss.items["font-family"])
{
var fontFamily=styleManager.deserializeStyleValue("font-family",oCss.items["font-family"]);
oCss.setItem("font-family",fontFamily.replace(/\'/ig,""));
}

sCssText=oCss.toString();

if(sCssText)
{
oNewNode.setAttribute("style",sCssText);
}
}

if(element.align)
{
oNewNode.setAttribute("align",element.align);
}
}

else
{
oNewNode=oXmlDoc.createTextNode(element.nodeValue);
}

for(var i=0;i<element.childNodes.length;i++)
{
var oNewChild=vp.studio.richtext.util.convertNodeToXml(element.childNodes[i],oXmlDoc,styleManager);
oNewNode.appendChild(oNewChild);
}

return oNewNode;
};

vp.studio.richtext.util.convertNodeFromXml=function $vpfn_1k0v6PSQwhg3dm1vWiQGvA206$45(element,xmlDocument,styleManager)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var $element=$(element);
var color=$element.getStyles()["color"];
if(color)
{
$element.css("color",styleManager.serializeStyleValue("color",new vp.color.Color(color)));
}
$element.children().each(function $vpfn_Frsne4YQNJ_Brcp_qodh3w215$29(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.studio.richtext.util.convertNodeFromXml(this,null,styleManager);
});
return element;
};

vp.studio.richtext.util.userSelectionIsInList=function $vpfn_DKH091GWgp7T1aKEhdYBXA221$48()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var selection=rangy.getSelection();
var range=selection.getAllRanges()[0];
return _.any(rangy.util.getTextNodes(range),function $vpfn_Frsne4YQNJ_Brcp_qodh3w225$49(node){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return $(node).closest(tagName.LI).length!==0;
});
};

vp.studio.richtext.util.getDefaultStyleValue=function $vpfn_sx$T0Gd5MX4MH_nCF41dww230$47(styleName)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(styleName==="font-weight"||styleName==="font-style")
{
return"normal";
}
else if(styleValue===value&&me.commandName==="text-align")
{
return"left";
}
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.widget)
{
vp.widget={};
}






vp.widget.MenuBox=function $vpfn_vwZWec9rvDcR2CszQiGesg19$20(oParentElement)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;

this.parentElement=oParentElement;
this.element=null;

this.currentValue="";

var _oLeftImg=null;
var _oMiddleCol=null;
var _oRightImg=null;

this.render=function $vpfn_gETwRdXlPA3VAeb46y0pDg32$18()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}

var outerTable=document.createElement("TABLE");
outerTable.style.borderCollapse="collapse";
outerTable.style.padding=0;
outerTable.style.width="100%";
var oMainRow=outerTable.insertRow(-1);

var oLeftCol=oMainRow.insertCell(-1);
oLeftCol.style.padding=0;
_oLeftImg=document.createElement("IMG");
_oLeftImg.width=me.chrome.leftImageWidth;
_oLeftImg.src=me.chrome.leftImage;
oLeftCol.appendChild(_oLeftImg);

_oMiddleCol=oMainRow.insertCell(-1);
_oMiddleCol.vAlign="middle";
_oMiddleCol.style.padding=0;
_oMiddleCol.width="99%";

if(me.chrome&&me.chrome.middleImage)
{
_oMiddleCol.style.backgroundImage="url("+me.chrome.middleImage+")";
}

var oRightCol=oMainRow.insertCell(-1);
oRightCol.style.padding=0;
oRightCol.style.verticalAlign="bottom";

if(me.chrome.rightImage)
{
_oRightImg=document.createElement("IMG");
_oRightImg.src=me.chrome.rightImage;
_oRightImg.width=me.chrome.rightImageWidth;
oRightCol.appendChild(_oRightImg);
}
else
{
oRightCol.innerHTML="&nbsp;";
}


me.element=outerTable;
me.parentElement.appendChild(me.element);

me.textElement=document.createElement("DIV");
me.textElement.style.overflow="hidden";
me.textElement.style.whiteSpace="nowrap";

var iElementWidth=me.element.offsetWidth>0?me.element.offsetWidth:parseInt(vp.ui.getCurrentStyle(me.element,"width"));

me.textElement.style.width=iElementWidth+"px";

_oMiddleCol.appendChild(me.textElement);

};

var _bClicked=false;
this.setClicked=function $vpfn_gkqSUpTdPvfBtMRUgvTupw91$22(bClicked)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(bClicked==_bClicked)
{
return;
}

_bClicked=bClicked;

if(bClicked)
{
if(_oRightImg&&me.chrome.rightImageClicked)
{
_oRightImg.src=me.chrome.rightImageClicked;
}
}
else
{
if(_oRightImg&&me.chrome.rightImage)
{
_oRightImg.src=me.chrome.rightImage;
}
}
};

this.isClicked=function $vpfn_osBji1cZmdU1hPVXPkD8jg116$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _bClicked;
};

var _bEnabled=true;
this.setEnabled=function $vpfn_jxVvSaGOIEOUDWkoL5TG_g122$22(bEnabled)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(bEnabled==_bEnabled)
{
return;
}

_bEnabled=bEnabled;

vp.ui.setStyleValue(me.element,"cursor",bEnabled?"pointer":"default");

if(!bEnabled)
{
if(_oLeftImg&&me.chrome.leftImageDisabled)
{
_oLeftImg.src=me.chrome.leftImageDisabled;
}
if(me.chrome.middleImageDisabled)
{
_oMiddleCol.style.backgroundImage="url("+me.chrome.middleImageDisabled+")";
}
if(_oRightImg&&me.chrome.rightImageDisabled)
{
_oRightImg.src=me.chrome.rightImageDisabled;
}


me.textElement.innerHTML="&nbsp;";
}
else
{
if(_oLeftImg&&me.chrome.leftImage)
{
_oLeftImg.src=me.chrome.leftImage;
}
if(me.chrome.middleImage)
{
_oMiddleCol.style.backgroundImage="url("+me.chrome.middleImage+")";
}
if(_oRightImg&&me.chrome.rightImage)
{
_oRightImg.src=me.chrome.rightImage;
}


me.textElement.innerHTML=me.currentValue;
}
};

this.isEnabled=function $vpfn_Oe0SFuCCcvqOFFyEUnzMaA171$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _bEnabled;
};

this.setValue=function $vpfn_jpiHhNSRc5795DyQHk_2Fw176$20(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.currentValue=sValue;
me.textElement.innerHTML=sValue;
};


this.chrome={};
this.chrome.leftImage=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/left.gif");
this.chrome.leftImageWidth=2;
this.chrome.middleImage=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/middle.gif");
this.chrome.rightImage=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/right.gif");
this.chrome.rightImageWidth=17;
this.chrome.leftImageDisabled=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/left_disabled.gif");
this.chrome.middleImageDisabled=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/middle_disabled.gif");
this.chrome.rightImageDisabled=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/right_disabled.gif");
this.chrome.rightImageClicked=vp.ui.imageUrl("/vp/images/nns/common/richmenu/default/right_clicked.gif");
};
if(!window.__td){window.__MT=100;window.__ti=0;window.__td=[];window.__td.length=window.__MT;window.__noTrace=false;}


if(typeof(vp)=="undefined")
{
var vp={};
}

if(!vp.widget)
{
vp.widget={};
}








vp.widget.HierarchicalMenuItem=function $vpfn_t_x8Fq8txoNveyBguVPO6g21$33(oElement,oParentMenu)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var me=this;




this.element=oElement;




this.parentMenu=oParentMenu;





this.highlightColor=oParentMenu?oParentMenu.highlightColor:"#DDDDDD";




this.onchange=new vp.events.CustomEvent(this,"onchange");





var init=function $vpfn_1yWaAw3$eid2sly0E7XtIA50$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}


var fnClickHandler=function $vpfn_2Iey3Qq1eOLj4oOfIAUF5A54$29(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
vp.events.cancel(e);

var fnDelayed=function $vpfn_LdaHagVCAvQb268m1ma0xQ58$28()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var newValue=vp.core.getAttribute(me.element,"value");



if(newValue)
{
var e={"newValue":newValue};
me.onchange.fire(e);
}
};

highlight(true);

setTimeout(fnDelayed,100);
};

vp.events.add(me.element,"click",fnClickHandler);
vp.events.add(me.element,"mousedown",vp.events.cancelEvent);



var fnChangeHandler=function $vpfn_qHzkXwXS2tvMdnOrq35Hzg81$30(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.parentMenu)
{
me.parentMenu.hide();
me.parentMenu.onchange.fire(e);
}
};

me.onchange.addHandler(fnChangeHandler);


if(me.highlightColor)
{
vp.events.add(me.element,"mouseover",function $vpfn_ADbELMteGLjLV$HEBshSPg95$51(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}highlight(true);});
vp.events.add(me.element,"mouseout",function $vpfn_ADbELMteGLjLV$HEBshSPg96$50(){if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}highlight(false);});
}

vp.ui.makeUnselectable(me.element);
};

var highlight=function $vpfn_fCvwelKjZ4LSmFz0ZkPMIw102$20(enabled)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.element.style.backgroundColor=enabled?me.highlightColor:"";
};

init();
};





























vp.widget.HierarchicalMenu=function $vpfn_7n9weg4d70qT0Y5xTFgxzg138$29(oElement,oParentMenu)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
this.inheritFrom=vp.widget.HierarchicalMenuItem;
this.inheritFrom(oElement,oParentMenu);

var me=this;

this.menus=[];
this.menuItems=[];




this.menuContainer=null;





this.clickMode="hover";





this.currentValue="";

this.onshowmenu=new vp.events.CustomEvent(this,"onshowmenu");
this.onhidemenu=new vp.events.CustomEvent(this,"onhidemenu");




var init=function $vpfn_1yWaAw3$eid2sly0E7XtIA171$15()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var iLen=me.element.childNodes.length;
for(var i=0;i<iLen;i++)
{
me.parseMenuStructure(me.element.childNodes[i]);
}
};




var _bMenuInitialized=false;






var initMenu=function $vpfn_47sMQuL_ZiD0TZsDbA3l3w190$19(oMenuContainer)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(_bMenuInitialized)
{
return;
}

me.menuContainer=oMenuContainer;
me.menuContainer.style.display="none";


if(me.clickMode=="click")
{
vp.events.add(me.element,"mouseup",containerClickHandler);
}
else
{
toggleContainerHandler(true);
}

vp.ui.makeUnselectable(me.menuContainer);

_bMenuInitialized=true;
};




var _bIsShowing=false;





var toggleContainerHandler=function $vpfn_jhYQlfueYCoZS$u16MNxcg224$33(bShow)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.clickMode=="hover")
{
if(bShow)
{
vp.events.add(me.element,"mouseover",containerOverHandler);
}
else
{
vp.events.remove(me.element,"mouseover",containerOverHandler);
}
}
};






var containerOverHandler=function $vpfn_ADbELMteGLjLV$HEBshSPg244$31(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
vp.events.cancelBubble(e);

if(!_bIsShowing)
{
me.show(e);
}

}.getClosure(me.element);





var containerClickHandler=function $vpfn_ADbELMteGLjLV$HEBshSPg260$32(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
e=vp.events.getEvent(e);
vp.events.cancelBubble(e);

if(!_bIsShowing)
{
me.show(e);
}
else
{
me.hide();
me.hideSubMenus();
}

}.getClosure(me.element);




this.hideSubMenus=function $vpfn__21kxT7mtSFlF6dMghQ8Zw280$24()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
for(var i=0;i<me.menus.length;i++)
{
var menu=me.menus[i];
menu.hide();
menu.hideSubMenus();
}
};





this.show=function $vpfn__oImhr0P$RqM0jcqiCZZFQ294$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(!me.isEnabled())
{
return;
}


if(me.parentMenu)
{
if(me.parentMenu.isShowing())
{
me.parentMenu.hideSubMenus();
}
else
{
me.parentMenu.show();
}
}

if(me.highlightColor)
{
me.element.style.backgroundColor=me.highlightColor;
}

me.menuContainer.style.display="block";

vp.events.add(vp.ui.getRootElement(),"mouseup",me.hide);
toggleContainerHandler(false);

_bIsShowing=true;
me.onshowmenu.fire(e);
};





this.hide=function $vpfn_FnDEIoZ5mLH9WInCP3M1Jg332$16(e)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(e)
{
e=vp.events.getEvent(e);
vp.events.cancelEvent(e);


if(e.target==me.element||vp.ui.isChildOf(e.target,me.element))
{
return;
}


if(e.target==me.menuContainer||vp.ui.isChildOf(e.target,me.menuContainer))
{
return;
}
}

if(me.highlightColor)
{
me.element.style.backgroundColor="";
}

me.menuContainer.style.display="none";
vp.events.remove(vp.ui.getRootElement(),"mouseup",me.hide);
toggleContainerHandler(true);
_bIsShowing=false;
me.onhidemenu.fire(e);
};




this.isShowing=function $vpfn_Kc45OgA0f8PDsq4GIpmNrw367$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _bIsShowing;
};




this.setValue=function $vpfn_AFTN9HILoGAjE6OsEqZSfw375$20(sValue)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.currentValue==sValue)
{
return;
}
me.currentValue=sValue;
for(var i=0;i<me.menus.length;i++)
{
me.menus[i].setValue(sValue);
}
};





this.getSubMenu=function $vpfn_VYX7q7tuvPkpPeztRwl0VA392$22(menuId)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(me.element.id==menuId)
{
return me;
}
else
{
for(var i=0;i<me.menus.length;i++)
{
var returnedMenu=me.menus[i].getSubMenu(menuId);
if(returnedMenu)
{
return returnedMenu;
}
}
return null;
}
};







this.parseMenuStructure=function $vpfn_n1DWMo7scm5cTZdQBsWXPA418$30(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}




if(vp.core.getAttribute(oNode,"value"))
{
me.menuItems.push(new vp.widget.HierarchicalMenuItem(oNode,me));
}



else if(vp.core.getAttribute(oNode,"menu"))
{
me.menus.push(new vp.widget.HierarchicalMenu(oNode,me));
}

else
{



var menuContainerAttribute=vp.core.getAttribute(oNode,"menu-container");
if(menuContainerAttribute)
{
me.clickMode=menuContainerAttribute;
initMenu(oNode);
}




var iLen=oNode.childNodes.length;
for(var i=0;i<iLen;i++)
{
me.parseMenuStructure(oNode.childNodes[i]);
}
}
};







this.appendToMenu=function $vpfn_mAOO0_e8pqVVCH0ULFCduQ465$24(oNode)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.menuContainer.appendChild(oNode);
me.parseMenuStructure(oNode);
};






this.getAllValues=function $vpfn_orw22ClmjE_VlSOGBte2NA476$24(bRecursive)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
var results=[];
for(var i=0;i<me.menuItems.length;i++)
{
results.push(vp.core.getAttribute(me.menuItems[i].element,"value"));
}

if(bRecursive)
{
for(var k=0;k<me.menus.length;k++)
{
var childResults=me.menus[k].getAllValues(bRecursive);
for(var j=0;j<childResults.len;j++)
{
results.push(childResults[j]);
}
}
}

return results;
};






this.setHighlighting=function $vpfn_DK3jNl8aF2$GWOp_ndBcqA504$27(sHighlightColor,bRecursive)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
me.highlightColor=sHighlightColor;
for(var j=0;j<me.menuItems.length;j++)
{
me.menuItems[j].highlightColor=sHighlightColor;
}
if(bRecursive)
{
for(var k=0;k<me.menus.length;k++)
{
me.menus[k].setHighlighting(sHighlightColor,bRecursive);
}
}
};

var _bEnabled=true;






this.setEnabled=function $vpfn_yeYOxLI8CVJbzwFQy54aCA527$22(bEnabled,bRecursive)
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
if(bEnabled==_bEnabled)
{
return;
}

_bEnabled=bEnabled;

if(bRecursive)
{
for(var k=0;k<me.menus.length;k++)
{
me.menus[k].setEnabled(bEnabled,bRecursive);
}
}
};




this.isEnabled=function $vpfn_9pVgeglF4u0weHi3nPK_CQ548$21()
{if(!window.__noTrace){__td[__ti]=arguments;__ti=__ti>=__MT?0:__ti+1;}
return _bEnabled;
};

init();
};

